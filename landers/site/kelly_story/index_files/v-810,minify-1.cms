
	    // objAuth moved to objVc
var jscommon_v = '810';
Object.defineProperty(window, "wl", { value: window.location, writable: false });

objMonetize = window.objMonetize || {};
var isScrolling;
objExp = {
    mkt: 'yNhUyh4sTVW7RDeLlNFKgg',
    old: 'OGxKTlcvS2G6EC-VMkXovQ',
    agen: 'vQAkz5DzRqOY1lSJywDv4gA',
    ipad: 'W3Bhu7jjQqKGdnJWTOAKnw',
    canAds: 'T4DbYgmHRBa7PN8SZWDZHQ',
    primePermo: '_7FuX32VTS-KmK4BVsnViA'
}

var etFlag = {
    isIndia: (window.geoinfo && geoinfo.geolocation == "1" && geoinfo.CountryCode === "IN"),
    isCA: (window.geoinfo && geoinfo.geolocation == "2" && geoinfo.region_code == "CA"),
    isEU: (window.geoinfo && geoinfo.geolocation == "5"),
    isLive: (wl.origin.indexOf('dev') != -1 || wl.origin.indexOf('stg') != -1 ? 0 : 1)
}

var allowLogs = getParameterByName('etlogs') != "1";
if(allowLogs && etFlag.isLive) {
    console.log = function() {}
}

	    var objAuth = {
	        oauth: objVc.oauth,
	        planPage: objVc.planPage,
	        subs: objVc.subscriptions,
	        kryp: objVc.krypton
	    };
	    
	    var showAd = 1;
	    Date.prototype.addDays = function(days) {this.setDate(this.getDate() + parseInt(days));return this;};
	    Array.prototype.remove = function (value) { var index = this.indexOf(value); if (index > -1) { this.splice(index, 1); } }
        String.prototype.toCapitalize=function(){return this.toLowerCase().replace( /\b\w/g, function (m) {return m.toUpperCase();});};
        
        skinningExist = window.skinningExist ? window.skinningExist : 0;
        
        window.winActive = true;
        $(window).focus(function() { this.winActive = true; });
        $(window).hover(function() { this.winActive = true; });
        $(window).blur(function() { this.winActive = false; });
        $(window).mouseout(function() { this.winActive = false; });
        
        var jscommon_v = '810';
        
        objPage = typeof objPage == 'undefined' ? {} : objPage; // main object for individual page 
        skip = typeof skip == 'undefined' ? {} : skip; // skip object for skipping plugin js
        var usersessionkey = "";
        var loginFbSts = "";
        var fbAutoLoginStatusProceed = false;
        var PROTOCOL = 'https:';
        var hookFnCall = true;
        var hookOverLayCall = false;
        
        /*polyfill for IE 10*/
        if (!window.location.origin) {
          window.location.origin = window.location.protocol + "//" 
            + window.location.hostname 
            + (window.location.port ? ':' + window.location.port : '');
        }
        
        objDomain = {
            img:'https://img.etimg.com',
            js:'https://economictimes.indiatimes.com',
            css:'https://economictimes.indiatimes.com',
            et:'https://economictimes.indiatimes.com',
            met:'https://m.economictimes.com'
        };
        
        
            
// jQuery Cookie Plugin
(function(factory){if(typeof define==='function'&&define.amd&&define.amd.jQuery){define(['jquery'],factory);}else{factory(jQuery);}}(function($){var pluses=/\+/g;function raw(s){return s;}
function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}
function converted(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');}
return config.json?JSON.parse(s):s;}
var config=$.cookie=function(key,value,options){try{if(value!==undefined){options=$.extend({},config.defaults,options);if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=config.json?JSON.stringify(value):String(value);return(document.cookie=[encodeURIComponent(key),'=',config.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
var decode=config.raw?raw:decoded;var cookies=document.cookie.split('; ');var result=key?undefined:{};for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split('=');var name=decode(parts.shift());var cookie=decode(parts.join('='));if(key&&key===name){result=converted(cookie);break;}
if(!key){result[name]=converted(cookie);}}
return result;}catch(e){console.log("e", e);}};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==undefined){$.cookie(key,'',$.extend(options,{expires:-1}));return true;}
return false;};}));

// jQuery Easing Plugin
jQuery.easing['jswing']=jQuery.easing['swing'];jQuery.extend(jQuery.easing,{def:'easeOutQuad',swing:function(x,t,b,c,d){return jQuery.easing[jQuery.easing.def](x,t,b,c,d);},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},easeInBounce:function(x,t,b,c,d){return c-jQuery.easing.easeOutBounce(x,d-t,0,c,d)+b;},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return jQuery.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return jQuery.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b;}});

//Extended debounce and throttle
(function($) {
    $.extend({
    	debounce : function(fn, timeout, invokeAsap, ctx) {
    		if(arguments.length == 3 && typeof invokeAsap != 'boolean') {
    			ctx = invokeAsap;
    			invokeAsap = false;
    		}
    		var timer;
    		return function() {
    			var args = arguments;
                ctx = ctx || this;
    			invokeAsap && !timer && fn.apply(ctx, args);
    			clearTimeout(timer);
    			timer = setTimeout(function() {
    				!invokeAsap && fn.apply(ctx, args);
    				timer = null;
    			}, timeout);
    		};
    	},
    	throttle : function(fn, timeout, ctx) {
    		var timer, args, needInvoke;
    		return function() {
    			args = arguments;
    			needInvoke = true;
    			ctx = ctx || this;
    			if(!timer) {
    				(function() {
    					if(needInvoke) {
    						fn.apply(ctx, args);
    						needInvoke = false;
    						timer = setTimeout(arguments.callee, timeout);
    					}
    					else {
    						timer = null;
    					}
    				})();
    			}
    		};
    	}
    });
})(jQuery);

// jQuery LazyLoading Plugin
(function ($, window, document, undefined) {
	var $window = $(window);
	$.fn.lazyload = function (options) {
		var elements = this;
		var $container;
		var settings = {
			threshold : 200,
			failure_limit : 0,
			event : "scroll",
			effect : "show",
			container : window,
			data_attribute : "original",
			skip_invisible : true,
			appear : null,
			load : null
		};

		function update() {
			var counter = 0;
			elements.each(function (i, j) {
				var $this = $(this);
				if($this.hasClass('debugger')) {
				    debugger;
				}
				if ((settings.skip_invisible && !$this.is(":visible")) || $this.attr('src') == $this.attr('data-original')) {
					return;
				}
				// console.log(i, j);
				if ($.abovethetop(this, settings)) {}
				else if (!$.belowthefold(this, settings)) {
					$this.trigger("appear");
					counter = 0;
				}/* else {
					if (++counter > settings.failure_limit) {
						return false;
					}
				}*/
			});
		}
		if (options) {
			if (undefined !== options.failurelimit) {
				options.failure_limit = options.failurelimit;
				delete options.failurelimit;
			}
			if (undefined !== options.effectspeed) {
				options.effect_speed = options.effectspeed;
				delete options.effectspeed;
			}
			$.extend(settings, options);
		}
		$container = (settings.container === undefined || settings.container === window) ? $window : $(settings.container);
		if (0 === settings.event.indexOf("scroll")) {
			$container.bind(settings.event, function (event) {
				return update();
			});
		}
		this.each(function () {
			var self = this;
			var $self = $(self);
			self.loaded = false;
			$self.one("appear", function () {
				if (!this.loaded) {
					if (settings.appear) {
						var elements_left = elements.length;
						settings.appear.call(self, elements_left, settings);
					}
					$("<img />").bind("load", function () {
						$self /*.hide()*/
						.attr("src", $self.data(settings.data_attribute))
						[settings.effect](settings.effect_speed);
						self.loaded = true;
						var temp = $.grep(elements, function (element) {
								return !element.loaded;
							});
						elements = $(temp);
						if (settings.load) {
							var elements_left = elements.length;
							settings.load.call(self, elements_left, settings);
						}
					}).attr("src", $self.data(settings.data_attribute));
				}
			});
			if (0 !== settings.event.indexOf("scroll")) {
				$self.bind(settings.event, function (event) {
					if (!self.loaded) {
						$self.trigger("appear");
					}
				});
			}
		});
		$window.bind("resize", function (event) {
			update();
		});
		if ((/iphone|ipod|ipad.*os 5/gi).test(navigator.appVersion)) {
			$window.bind("pageshow", function (event) {
				if (event.originalEvent.persisted) {
					elements.each(function () {
						$(this).trigger("appear");
					});
				}
			});
		}
		$(window).on('load',function () {
			update();
		});
		return this;
	};
	$.belowthefold = function (element, settings) {
		var fold;
		if (settings.container === undefined || settings.container === window) {
			fold = $window.height() + $window.scrollTop();
		} else {
			fold = $(settings.container).offset().top + $(settings.container).height();
		}
		return fold <= $(element).offset().top - settings.threshold;
	};
	$.rightoffold = function (element, settings) {
		var fold;
		if (settings.container === undefined || settings.container === window) {
			fold = $window.width() + $window.scrollLeft();
		} else {
			fold = $(settings.container).offset().left + $(settings.container).width();
		}
		return fold <= $(element).offset().left - settings.threshold;
	};
	$.abovethetop = function (element, settings) {
		var fold;
		if (settings.container === undefined || settings.container === window) {
			fold = $window.scrollTop();
		} else {
			fold = $(settings.container).offset().top;
		}
		return fold >= $(element).offset().top + settings.threshold + $(element).height();
	};
	$.leftofbegin = function (element, settings) {
		var fold;
		if (settings.container === undefined || settings.container === window) {
			fold = $window.scrollLeft();
		} else {
			fold = $(settings.container).offset().left;
		}
		return fold >= $(element).offset().left + settings.threshold + $(element).width();
	};
	$.inviewport = function (element, settings) {
		return $(element).length && !$.rightoffold(element, settings) && !$.leftofbegin(element, settings) && !$.belowthefold(element, settings) && !$.abovethetop(element, settings);
	};
	$.extend($.expr[':'], {
		"below-the-fold" : function (a) {
			return $.belowthefold(a, {
				threshold : 0
			});
		},
		"above-the-top" : function (a) {
			return !$.belowthefold(a, {
				threshold : 0
			});
		},
		"right-of-screen" : function (a) {
			return $.rightoffold(a, {
				threshold : 0
			});
		},
		"left-of-screen" : function (a) {
			return !$.rightoffold(a, {
				threshold : 0
			});
		},
		"in-viewport" : function (a) {
			return $.inviewport(a, {
				threshold : 0
			});
		},
		"above-the-fold" : function (a) {
			return !$.belowthefold(a, {
				threshold : 0
			});
		},
		"right-of-fold" : function (a) {
			return $.rightoffold(a, {
				threshold : 0
			});
		},
		"left-of-fold" : function (a) {
			return !$.rightoffold(a, {
				threshold : 0
			});
		}
	});
})(jQuery, window, document);

/*
 * visible function to check weather element is in viewed window or not
 * 
 * e.g. $(selector).visible();
 * parameter partial (true|false) default false;
 * to check weather element is partial in viewed part
 */

(function($){
    $.fn.visible = function(partial){
        if($(this).length) {
            try {
                var $t              = $(this),
                    $w              = $(window),
                    viewTop         = $w.scrollTop(),
                    viewBottom      = viewTop + $w.height(),
                    _top            = $t.offset().top,
                    _bottom         = _top + $t.height(),
                    compareTop      = partial === true ? _bottom : _top,
                    compareBottom   = partial === true ? _top : _bottom;
                    return ((compareBottom <= viewBottom) && (compareTop >= viewTop));
            } catch (e) {
                if(typeof console != 'undefined' && typeof console.log != 'undefined') {
                    console.log('Error: ', e);
                }
            }
        } else {
            return false;
        }
    };
})(jQuery);
/*
(function () {
    var errorSent = 0;
    window.onerror = function (errorMsg, url, lineNumber, column, errorObj) {
        _log('Error Log: ', errorMsg);
        var wlh = window.location.href;
        url = url != '' ? url : (wlh.indexOf('articleshow') != -1 ? 'articleshow.cms' : window.location.href);
        var errorMsgLower = errorMsg.toLowerCase() + ' ' + wlh;
        var skipError = ['style', 'script', 'dom exception 11', 'googlebot', 'phantomjs', '.article_block', 'tomorrowmakersshow', 'printarticle'];
        skipErrorFlag = 1;
        $.each(skipError, function (k, v) {
            if(errorMsgLower.indexOf(v) != -1) {
                skipErrorFlag = 0;
            }
        });
        if(objCommon.isLive == 1 && !errorSent && skipErrorFlag && (url.indexOf('.cms') != -1 || url == window.location.href)) {
            errorSent = 1;
            if(navigator.userAgent) {
                errorMsg += " | navigator.userAgent : " + navigator.userAgent;
            }
            
            $.ajax({
                url:'//etx.indiatimes.com/error_save',
                data: {
                    url:wlh,
                    file: url,
                    line: lineNumber,
                    column: column,
                    error: errorMsg,
                    error_stack: errorObj && errorObj.stack ? errorObj.stack : '',
                    callback:'cb'
                },
                dataType:'script'
            });
        }
    }
})()
*/

            function getParameterByName(name) {
                if (name) {
                    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                            results = regex.exec(location.search);
                    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
                } else {
                    return '';
                }
            }
            
            function valExists(val) {
            	var ret = false;
            	if (val == null || val == '' || typeof val == 'undefined') {
            		ret = false;
            	} else {
            		ret = true;
            	}
            	return ret;
            }
            
            function validateEmail(a) {
            	var b = 0,
            	c = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z]{2,4})+$/;
            	if (a && a.indexOf(",") != -1) {
            		for (var a = a.split(","), d = 0, d = 0; d < a.length; d += 1)
            			c.test(a[d]) && (b += 1);
            		return d == b ? !0 : !1
            	} else
            		return c.test(a) ? !0 : !1
            }
            
            function loadScript(s, callback, force, defer) {
                if($('script[src*="' + s + '"]').length == 0 || force == 1) {
                   var script= document.createElement('script');
                   script.type= 'text/javascript';
                   script.src= s;
                   script.async = true;
                   if(typeof defer != 'undefined' && defer) {script.defer = true;}
                   if(typeof callback == 'function') {script.onload = function () {callback()}}
                   document.body.appendChild(script);
                } else {
                    _log('script already loaded', s);
                    if(typeof callback == 'function') { callback() }
                }
            }
            
            //Log Function
            _log = function(a,b){
                if(typeof console!='undefined' && typeof console.log!='undefined' && (typeof showlog!='undefined' || objCommon.isLive == 0)){
                    var _console, caller = _log.caller;
                    (_console = console).log.apply(_console, ['%c _log ', 'background: #055f6b; color: #FFF'].concat(Array.prototype.slice.call(arguments)).concat({caller:caller}));
                }
            }
            
            function dateFormat(dt, format) {
                var format = format ? format : '%Y-%M-%d';
                var objD = (dt instanceof Date) ? dt : new Date(dt);
                shortMonthName = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                fullMonthName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                shortDaysName = ['Sun', 'Mon', 'Tue', 'Wed', 'Thur', 'Fri', 'Sat', 'Sun'];
                fullDaysName = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
                var newDate = '';
                if(objD != 'Invalid Date') {
                    var hour = objD.getHours();
                    var dList = {
                        '%ss': objD.getMilliseconds(),
                        '%Y': objD.getFullYear(),
                        '%y': objD.getFullYear().toString().substr(-2),
                        '%Mmm': shortMonthName[objD.getMonth()],
                        '%MMM': shortMonthName[objD.getMonth()].toUpperCase(),
                        '%MM': fullMonthName[objD.getMonth()],
                        '%M': objD.getMonth() + 1,
                        '%d': objD.getDate(),
                        '%h': (hour <= 12 ? hour : (hour - 12)),
                        '%H': hour,
                        '%m': objD.getMinutes(),
                        '%s': objD.getSeconds(),
                        '%DD': fullDaysName[objD.getDay()],
                        '%D': shortDaysName[objD.getDay()],
                        '%p': (objD.getHours() > 11 ? 'PM' : 'AM')
                    }
                    newDate = format;
                    for(var key in dList) {
                        var regEx = new RegExp(key, 'g');
                        newDate = newDate.replace(regEx, et.appendZero(dList[key]));
                    }
                }
                return newDate;
                }
            Date.prototype.format = function (format) {return dateFormat(this, format)}
            
            // objMktD == objMarkets Api Domain
            objMktD = (function (){
                var prefix = typeof api_prefix !="undefined" ? api_prefix : getParameterByName('api_prefix'),
                json = prefix == '' ? 'https://json.' : 'https://'+prefix,
                charting = prefix == '' ? 'https://marketgraphs.economictimes.' : 'https://'+prefix + 'marketgraphs.';
            
                prefix = 'https://'+prefix;
                var dList =  {
                    pflf: prefix + "pflivefeeds.indiatimes.com",
                    mobilelf: prefix + "mobilelivefeeds.indiatimes.com",
                    mcxlf: prefix + "mcxlivefeeds.indiatimes.com",
                    mfapps: prefix + "mfapps.indiatimes.com",
                    etsearch: prefix + 'etsearch.indiatimes.com',
                    bself: json + 'bselivefeeds.indiatimes.com',
                    etfeeds: prefix + 'etfeedscache.indiatimes.com',
                    etfcache: prefix + 'etfeedscache' + (prefix!= '' && prefix != '//' ? '' : 'cache') + '.indiatimes.com',
                    sas: prefix + 'sas.indiatimes.com',
                    etcharts: prefix + 'ettechcharts.indiatimes.com',
                    stockapps: prefix + 'stockapps.economictimes.indiatimes.com',
                    marketgraphs: prefix + 'marketgraphs.economictimes.indiatimes.com',
                    sparkline: charting + 'indiatimes.com',
                    nsparkline: prefix + 'marketcharts.indiatimes.com'
                };
                return dList;
            })();
            
            if(!etFlag.isLive) {
                // objMktD.etsearch = 'https://qcbselivefeeds.indiatimes.com'
            }
            
            // common service use accross the site
            objService = {
                tinyUrl: objMktD.etsearch+'/etspeeds/tiny.ep',
                mainSearch: objMktD.etsearch+'/etspeeds/etsearchMdata.ep',
                netCheck: '/internetcheck.cms?jscv='+jscommon_v,
                podcast: 'https://videoplayer.indiatimes.com/v2/et/sdk.js',
                subsUrl: (window.location.origin.indexOf('dev') == -1) ? 'https://economictimes.indiatimes.com' : 'https://etsub-qa.economictimes.indiatimes.com'
            }
            
            // User Data
            var _tp_data = {
            	isLogged : false,
            	isPrime : false,
            	isAdfree : false,
            	email : '',
            	mobile: '',
            	city :  '',
            	pic : (objDomain.img + '/photo/57910642.cms'),
            	thumb : null,
            	fname : '',
            	fullName : '',
            	badge : '',
            	points : 0,
            	profile : '',
            	uid : null,
            	ssouid: null,
            	portfolioUser : false,
            	permissions: [],
            	accessibleFeatures: []
            };
            
            /* Article Email Send Functionality Start Here */
            var emailSend = {
                init:function(msid){
                    window.emailMsid = msid ? msid : page.msid;
                   loadModule({module_name: 'js_mailsend', v: 8, callback: function () {
                        emailSend.init();
                    }});
                }
            }
            /* Article Email Send Functionality Here End */
            
            //GDPR Check
            objCookieUse = {
                init:function () {
                    // var chk = $.jStorage.get('jsc_cookie_notification');
                    var chk = $.cookie('et_concent2'), et_ccpa_consent = $.jStorage.get('et_ccpa_consent');
                    var ua = navigator && navigator.userAgent && navigator.userAgent.toLowerCase() || '';
                    var isBot = (ua.indexOf('bot') != -1);
                
                    if(window.allowGdpr == 0 && window.location.href.indexOf("gdpr_nlc") == -1 && !isBot) {
                        var ginfo = window.geoinfo || {}, 
                        isEU = geolocation && geolocation != 5 ? 0 : 1;
                        if(!chk && isEU) {
                            this.fetchConsent('gdpr');
                        } else if(etFlag.isCA && !et_ccpa_consent) {
                            this.fetchConsent('ccpa');
                        }
                    }
                },
                fetchConsent: function(type) {
                    type = type || '';
                    $.ajax({
                        url:'/gdpr_consent.cms?ref=web&type='+type,
                        success: function (html) {
                            $('body').append(html);
                            setTimeout('objCookieUse.showhide(1)', 2000);
                        }
                    });
                },
                showhide:function (i, type) {
                    var show = typeof i != 'undefined' ? i : 0;
                    if(show) {
                        $('body .du_consent').slideDown(1000);
                        //$('body').addClass('body_top_space');
                    } else {
                        $('body .du_consent').slideUp();
                        //$('body').removeClass('body_top_space');
                        if(type == 'ccpa') {
                            $.jStorage.set('et_ccpa_consent', 1);
                        }
                    }
                }
            }
            objGdpr = {
                rootDomain: 'indiatimes.com',
                skipCookies:['etupref', 'fpid', 'pfuuid', 'optout', 'ga-disable', '_ga', '_gid', '_gat', 'AMP_TOKEN', 'et_concent', 'optoutV2', 'ssoid', 'TicketId', 'et_interstitial_active', 'nsIstial_Cook', 'OTP', 'OID', 'OTR', 'etprc', 'et_concent2', '_col_ccds', 'peuuid', 'fpid', 'gdpr','OptanonConsent','OptanonAlertBoxClosed'],
                init: function () {
                    try {
                        if(objGdpr.allow() == 0) {
                            objGdpr.setCookies();
                            //objGdpr.removeOtherCookies();
                            if(!$('.skipEleRemove').length) {
                                objGdpr.removeElements();
                            }
                            $('.newTopBar .followUs').after('<div class="flr"><a href="/gdprform.cms" target="_blank">PRIVACY SETTING</a></div>');
                            $('#footer .bottomDiv ul:last').append('<li><a href="/gdprform.cms" target="_blank">Privacy Setting</a></li>');
                            objGdpr.getCcpaConsent();
                        } else {
                            $.each(['etupref', 'optout', 'ga-disable'], function (i, key) {
                                objGdpr.removeCookie(key);
                            });
                        }
                    } catch (e) {
                        console.log('Error: objGdpr.init', e);
                    }
                },
                allow: function () {
                    return window.allowGdpr ? 1 : 0;
                },
                gaOptout: function () {
                    document.cookie = 'ga-disable=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/'; window[disableStr] = true;
                },
                setCookies: function () {
                    $.cookie("etupref", 0, {
            			expires: 730,
            			path: '/',
            			domain: objGdpr.rootDomain
            		});
            		if(!$.cookie("optout") && window.geolocation == 5) {
            		    $.cookie("optout", 1, {
                			expires: 365,
                			path: '/',
                			domain: '.' + window.location.host
                		});
            		}
                },
                removeCookie: function(cookieName) {
                    $.removeCookie(cookieName);
                    $.removeCookie(cookieName, { path: '/', domain: '.indiatimes.com' });
                    $.removeCookie(cookieName, { path: '/', domain: 'economictimes.indiatimes.com' });
                    $.cookie(cookieName, '', {expires : -1});
                    $.cookie(cookieName, '', {expires : -1, path : "/"});
                    $.cookie(cookieName, '', {expires : -1, path : "/", domain: '.indiatimes.com'});
                    $.cookie(cookieName, '', {expires : -1, path : "/", domain: 'economictimes.indiatimes.com'});
                    $.cookie(cookieName, '', {expires : -1, path : "/", domain: window.location.host});
                },
                rmCkiInterval:0,
                removeOtherCookies: function () {
                    var cookiesList = document.cookie.split(';').map(function (k) {return $.trim(k.split('=')[0])});
                    
                    $.each(cookiesList, function (i, key) {
                        if(objGdpr.skipCookies.indexOf(key) == -1 && key.indexOf('jsso') == -1 && key.indexOf('lgc_') == -1) {
                            objGdpr.removeCookie(key);
                        }
                    });
                    clearTimeout(objGdpr.rmCkiInterval);
                    objGdpr.rmCkiInterval = setTimeout(function () {
                        objGdpr.removeOtherCookies();
                    }, 5000);
                },
                removeElements: function () {
                    var elemArray = ['.gdprEle', 'form', 'div.i_portfolio', '.HPPoll', '.pollData', '.widget-prelogin', '.post_container_ntlogedin', 
                         '.post_container_logedin', '.post_container_ntlogedin_container', '.myzone_container',
                         '#tpwidget-head', '#my_news', '.sentifi-widget', '.pollBox', '#stockTab .rightData', '#stockDataExpand .leftPart > div',
                         '#etBuzz .postContainer', '#etBuzz .trendLine', '.et-prime-link', '#bdgtNew', '.bizListingWrapper', '#rise_gstwidget',
                         '.subscribe.riseSubsc', '.prime_block', '.panacheSocal', '.riseSubsc', '#tjWidget', '#feedbackForm', '.goldAlert',
                         '.wrapper_mobile .input_no', '.poke_btn', '.sme_b', '.jobs_ind', '.cmtLinks', '.commentBoxContainer', '.chat_s', 
                         '#shareEmail', '.email_s', '.email', '.postComment', '#postCmtBox', '.cmnt-btns', '.print', '#getET', '#getMkt', '#getWealth',
                         '.downloadDiv', '.elem_login', '.sm.ib', '#webklipper-publisher-widget-container-content', '#calculatorWidget',
                         '#populatecomment', '#defaultCommentForm', 'a.save', '.articleLead .btn', '.article .btn', '.poke_btn', '.story_comment', '.pollBox',
                         '#cmtContainer', '.bookmark-icon', '.del_1', '#shareBar', '.shareDiv', '.shareBar', '.sharingBox', '.shareVert', 
                         '.p_block_v1', '.etpWidget', '#primeWidget', '.followUs', '#sharebar', '.videoBookmark', '#shareHorz', 
                         '.storyshare_icon', '.socialIcons', '.wealthsharebar', '#savedStories', '#etprime_list',
                         '#shareHorz', '.shareBar', '.ContentDiv .picIcon', '.page_social', '.socialLinks', '.twitter_share', '.socialIcon', 
                         '.shareicons', '.share', '.artShare', '.cmnts_wrapper', '.logo_bottom', '.subScribe'
                                     ];
                        // , 'a[href*="subscriptions"]' 'a[href*="subscription"]'       // Removed for EU region
                    $.each(elemArray, function (i, j) {
                        $(j).remove();
                    });
                    $('body').append('<style>' + (elemArray.join(',')) + ' {display:none !important;}</style>');
                    var specialElemArray = ["a:contains(' App'):contains('ET ')", "a:contains(' iPad'):contains('ET ')", "div.secSublinks:contains('ET APPS')"];
                    /* "a:contains('Newsletter')" */    // Removed for EU region
                    $.each(specialElemArray, function (i, j) {
                        $(j).remove();
                    });
                },
                getCcpaConsent: function () {
                    objUser.afterLoginCall(function () {
                        var _col_ccds = $.cookie("_col_ccds");
				        var headerData = {
                            'Authorization': "7a2e7de8- 95ad-44ad-80d1-af3eb9735439",
                            'Content-Type':'application/json'
                        }
                        if(etFlag.isCA && _tp_data.isLogged) {
                            if(!_col_ccds || _col_ccds == '0') {
                                //var url = 'https://etservices2.indiatimes.com/et/ccpaconsent';
                                var url = 'https://etservices2.indiatimes.com';
        				        if(objCommon.isLive == 0) {
        				            url = 'https://etmailstg.economictimes.com';
        				        }
        				        url += '/et/ccpaconsent/get';
        				        
        				        $.ajax({
        				            url: url,
        				            method: 'POST',
        				            headers: headerData,
        				            data: JSON.stringify({ssoid:objUser.info.ssoid}),
        				            success: function (response) {
        				                if(response && response.doNotSaleConsent) {
        				                    $.cookie("_col_ccds", response.doNotSaleConsent, {
                                    			expires: 365,
                                    			path: '/'
                                    		});
        				                }
        				                // console.log('response', response);
        				            }
        				        });
                            } else if (_col_ccds == "1") {
                                //var url = 'https://etservices2.indiatimes.com/et/ccpaconsent';
                                var url = 'https://etmailstg.economictimes.com/et/ccpaconsent';
        				        $.ajax({
        				            url: url,
        				            method: 'POST',
        				            headers: headerData,
        				            data: JSON.stringify({
        				                ssoid: objUser.info.ssoid,
        				                doNotSaleConsent: '1'
        				            }),
        				            success: function (response) {
        				                // console.log('response', response);
        				            }
        				        });
                            }
                        }
                    })
                }
            }
            
            // Common stuffs will be there within ths variable
            var et = {
            	dateFormat : function(sd, type) {
                    var timeStamp = "",
                    cd = new Date(),
                    months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
                    
                    sd = sd.replace(/-/gi, '/');
            
                    if (sd == "" || sd == null) { return; }
                    sd = new Date(sd);
                    if (cd.getTime() < sd.getTime()) { return; }
                    
                    var diff = Math.abs(cd.getTime() - sd.getTime());   // in milliseconds
                    diff = ((diff / 1000) / 60);    // in minutes
                    
                    if(type == 1){
                        if (diff < 1440) {
                            if (diff < 60) {
                                if (diff < 2) {
                                    timeStamp = parseInt(diff) + " Minute ago";
                                } else {
                                    timeStamp = parseInt(diff) + " Minutes ago";
                                }
                            } else if (diff < 1440) {
                                if (diff < 119) {
                                    timeStamp = Math.floor(diff / 60) + " Hour ago";
                                } else {
                                    timeStamp = Math.floor(diff / 60) + " Hours ago";
                                }
                            }
                        } else {
                            timeStamp = months[sd.getMonth()] + " " + sd.getDate() + ", " + sd.getFullYear();
                        }
                    } else if(type == 2){
                        if (diff < 60) {
                            timeStamp = parseInt(diff) + "m";
                        } else if (diff < 1440) {
                            timeStamp = Math.floor(diff / 60) + "h";
                        } else if (diff >= 1440) {
                            timeStamp = Math.floor(diff / (60 * 24)) + "d";
                        }
                    } else {
                        if (diff <= 28800) {
                            if (diff < 60) {
                                if (diff < 2) {
                                    timeStamp = parseInt(diff) + " Minute ago";
                                } else {
                                    timeStamp = parseInt(diff) + " Minutes ago";
                                }
                            } else if (diff < 1440) {
                                if (diff < 119) {
                                    timeStamp = Math.floor(diff / 60) + " Hour ago";
                                } else {
                                    timeStamp = Math.floor(diff / 60) + " Hours ago";
                                }
                            } else if (diff <= 28800) {
                                if (diff < 2880) {
                                    timeStamp = Math.floor(diff / (60 * 24)) + " Day ago";
                                } else {
                                    timeStamp = Math.floor(diff / (60 * 24)) + " Days ago";
                                }
                            }
                        } else {
                            timeStamp = months[sd.getMonth()] + " " + sd.getDate() + ", " + sd.getFullYear();
                        }
                    }
                    return timeStamp;
                },
            	getDecimalValue : function(pvalue){
            		var value = parseFloat(pvalue);
            		if (value > 9999999.99 || value < -9999999.99) {
            			value = value / 10000000;
            		} else if ((value > 99999.99 && value < 9999999.99) || (value > -9999999.99 && value < -99999.99)) {
            			value = value / 100000;
            		} else if ((value > 999.99 && value < 99999.99) || (value < -999.99 && value > -99999.99)) {
            			value = value / 1000;
            		} else if (value < 1000) {}
            		if (value < 0) {
            			value = -value;
            		}
            		return value;
            	},
            	getDecimalUnit : function (pvalue) {
            		var value = parseFloat(pvalue);
            		var format = " ";
            		if (value > 9999999.99 || value < -9999999.99) {
            			format = " Cr";
            		} else if ((value > 99999.99 && value < 9999999.99) || (value > -9999999.99 && value < -99999.99)) {
            			format = " Lac";
            		} else if ((value > 999.99 && value < 99999.99) || (value < -999.99 && value > -99999.99)) {
            			format = " K";
            		} else if (value < 1000) {
            			format = "";
            		}
            		return format;
            	},
            	addCommas : function(nStr, type) {
            	        if (!$.isNumeric(nStr)) return 'N.A.';
            			nStr += '';
            			var x = nStr.split('.');
            			if(type && type==='INR') {
            			    var dd = x.length > 1 ? '.' + x[1] : '';
            			    return new Intl.NumberFormat('en-IN').format(x[0]) + dd;
            			} else {
                			var x1 = x[0];
                			var x2 = x.length > 1 ? '.' + x[1] : '';
                			var rgx = /(\d+)(\d{3})/;
                			while (rgx.test(x1)) {
                				x1 = x1.replace(rgx, '$1' + ',' + '$2');
                			}
                			return x1 + x2;
			            }
            		},
            	appendZero: function (num) {return (num >= 0 && num < 10) ? '0' + num : num;}
            }
            
            // Get Current Language
            objLang = {
                maping : {'HIN' : 'hindi', 'GUJ' : 'gujarati', 'MAR' : 'marathi', 'BEN' : 'bengali', 'KAN' : 'kannada', 'ORI' : 'oriya', 'TEL' : 'telugu', 'TAM' : 'tamil'},
                absoluteUrl : {
                    'HIN' : 'https://hindi.economictimes.com',
    	            'BEN' : 'https://bengali.economictimes.com',
    	            'KAN' : 'https://kannada.economictimes.com',
    	            'MAR' : 'https://marathi.economictimes.com',
    	            'TAM' : 'https://tamil.economictimes.com',
    	            'TEL' : 'https://telugu.economictimes.com',
    	            'MAL' : 'https://malayalam.economictimes.com',
    	            'GUJ' : 'https://gujarati.economictimes.com',
    	            'ORI' : 'https://economictimes.indiatimes.com'
                }
            }
            objLang.currentLang = function(){
                var a = location.pathname.split("/")[1], pLang = getParameterByName('language'), currLang = '';
                for(var key in objLang.maping) {
                    if(a == objLang.maping[key])
                    currLang = key;
                }
                if(!currLang && typeof objLang.maping[pLang] != 'undefined') {
                    currLang = pLang;
                }
            	return currLang;
            };
            
            var niftyLink = '/markets/indices/nifty-50';
            var specialKeywords = {'sensex':'/markets/indices/bse-sensex', 'nifty': niftyLink, 'nifty50': niftyLink, 'nifty 50': niftyLink};
            var openKeywordPage = function (keyword) {
        		keyword = keyword.toLowerCase();
        		// Sending the GA Hit when the searchIcon was clicked
        		ga('send', 'event', 'Search Bar', location.href, keyword);
        		var loc = "/topic/" + escape(keyword).replace("%20", "-");
        		if(typeof specialKeywords[keyword] != 'undefined') {
        			loc = specialKeywords[keyword];
        			if(loc) {
        			    location.href = loc;
        			} else {
        			    saveLogs({'type': 'location_href_error', 'keyword': keyword});
        			}
        		}else{
        		    setTimeout(function(){ 
        		        $.ajax({
            		      //  url: '/jcms_search.cms?feedtype=etjson&keywords='+keyword,
            		        url: '/feed_topicredirect.cms?feedtype=etjson&keyword='+keyword,
            		        dataType : 'json',
            		        success: function (data) {
            		            if(data && data.url){
            		                loc = data.url;
            		                if(loc) {
                        			    location.href = loc;
                        			} else {
                        			    saveLogs({'type': 'location_href_error', 'jcms_search': data});
                        			}
            		            }
            		            else{
            		                if(loc) {
                        			    location.href = loc;
                        			} else {
                        			    saveLogs({'type': 'location_href_error', 'jcms_search': data});
                        			}
            		            }
            		        },
            		        error :function(error) {
            		            if(loc) {
                    			    location.href = loc;
                    			} else {
                    			    saveLogs({'type': 'location_href_error', 'error': error});
                    			}
                                //console.log('error', error);
                            }
            		    })
        		    },800);
        		}
        		
        	}
            
             /* New All Search Script Start Here */
            $.fn.etSearchAll = function (opts) {
            	var xhr,xhrdef,xhrnews,xhrrptr;
            	var settings = {
            		input : "input[type=text]",
            		message : "Search for News, Stock Quotes & NAV\'s",
            		activeClass : "active",
            		effect : "slide"
            	};
            	var placeHolder = $('.inputBox').attr('placeholder');
            	if(placeHolder) {
            	   // settings.message = placeHolder;
            		settings.message = '';
            	}
            	var records = {
            		compcount : 6,
            		coincount: 2,
            		mfcount: 2,
            		npscount: 2,
            		cmdtcount : 2,
            		inetcount : 2,
            		defcount : 2,
            		forexcount : 2,
            		indicescount : 2,
            		etfcount: 2,
            		nonlistcount:3
            	}
            	function makeBold(inputText, completeText) {   
            		var matchtext=new RegExp(inputText, "i");
            		if (completeText.toLowerCase().indexOf(inputText.toLowerCase()) >= 0){
            			matched = completeText.substr(completeText.search(matchtext),inputText.length);
            			return completeText.replace(matchtext,"<b>" + matched + "</b>");
            		}
            		else{
            			return completeText;
            		}
            	}
            
            	if (typeof opts == "object") {
            		if ($.isPlainObject(opts)) {
            			$.extend(settings, opts);
            		}
            	}
            	
            	return this.each(function () {
            		var obj = $(this),
            		input = $(settings.input, obj);
            		$("<div class='searchListAll'><ul></div>")
            		.css({
            			display : 'none',
            			'min-width' : input.outerWidth()-2,
            			top : input.position().top + input.outerHeight() + 5,
            			right: input.parent().is('#newband') ? 'auto' : input.position().left,
                        left: input.parent().is('#newband') ? input.position() : 'auto'
            		})
            		.appendTo(obj);
            
            		// If any of the links in searchListAll is clicked, fire a GA Hit
            		$(".searchListAll > ul", obj).on('click', 'li > a', function() {
            			var $this = $(this), history = $this.parent('li').hasClass('bg_f5') ? '/History' : '';
            			if ($this.parent().hasClass('head')) {
            				var searchQuery = $this.parent().find('span.flt').text() + " - " + $this.text();
            				ga('send', 'event', 'Search Bar' + history, location.href, searchQuery);
            			} else {
            				ga('send', 'event', 'Search Bar' + history, location.href, $this.text());
            			}
            		});
            		
            		$(".searchListAll > ul", obj).on('click', 'li > .st_options > span', function() {
            		    var $this = $(this), scrolltosec = $this.attr('data-scrollsection'), pageUrl = $this.parent('.st_options').attr('data-url');
            		    localStorage.setItem('windowScrollId', scrolltosec);
            		    window.open(pageUrl, '_blank')
            		    ga('send', 'event', 'Search Bar Stock Tabs', pageUrl, scrolltosec);
            		})
            
            		//For set or remove the default text in input box
            		input.bind("focus",function(){
            			if(input.val() == settings.message && settings.topsearch){
            				input.val("");
            				searchAutocomplete();
            			}
            		});
            		
            		function searchAutocomplete() {
            		    if (localStorage.lastViewCompanies != undefined) {
                            var lastviewedcompanies = !!localStorage.lastViewCompanies ? JSON.parse(localStorage.lastViewCompanies) : [];
                        }
                        
                        var serviceUrl;
            	        if (!!lastviewedcompanies) {
            	            var data = {
            	                pageno: 1,
            	                pagesize: 5
            	            }
            	            data.companies = lastviewedcompanies.reverse().slice(0, 5);
            	            serviceUrl = '/etsearch_autocomplete.cms?bodyparams=' + JSON.stringify(data)
            	        } else {
            	            serviceUrl = '/etsearch_autocomplete.cms'
            	        }
            	        $.ajax({
                            url: serviceUrl,
                            success: function (html) {
                                if($(obj).attr('id') == 'srch-overlay-content' || $(obj).parent().attr('id') == 'topSearch') { $(".srch-overlay-content").addClass('active') }
                                $(".searchListAll > ul", obj).html(html);
                                $(".searchListAll", obj).slideDown(300);
                            }
                        });
            		}
            		
            		function hideSearchbar() {
            			setTimeout(function () {
            				$(".searchListAll",obj).css("display" , "none");
            				$(obj).removeClass('active')
            			}, 200);
            		}
            		input.bind("blur",function(){
            			if(input.val() == "" || input.val() == null){
            				input.val(settings.message);
            				hideSearchbar();
            			}
            		});
            		
            		$(document).click("click",function(event){
            			if($(event.target).hasClass("searchIcon") && $(event.target).parent().is(obj)){
            			    var textSearch = input.val().trim();
            		        if(textSearch == ''){alert('Enter some text to search');}
            		        else {openKeywordPage(textSearch);}
            				
            			} else if(input.is(":focus")){
            				return false;
            			} else if($(event.target).hasClass("srch-close") || $(event.target).hasClass("close_search") || !($(event.target).parent().is(".srch-overlay-content",obj) || $(event.target).parent().is(".searchListAll",obj))){
            				input.val(settings.message);
            				hideSearchbar();
            			}
            		});
            		
            		input.bind("keyup", $.debounce(function (event) {
            			if (input.val().length) {
            				// When Press Enter Key
            				if (event.which == 13) {
            					if ($(".searchListAll > ul > li", obj).hasClass("active")) {
            						// Sending the GA Hit when Enter is pressed on a search query
            						ga('send', 'event', 'Search Bar', location.href, $(".searchListAll > ul > li.active > a", obj).text());
            						var loc = $(".searchListAll > ul > li.active", obj).attr("data-url");
            						if(loc) {
                        			    location.href = loc;
                        			} else {
                        			    saveLogs({'type': 'location_href_error', 'keyup': input.val()});
                        			}
            						input.val(settings.message);
            					} else {
            						openKeywordPage(input.val());
            						input.val(settings.message);
            					}
            				}
            				// When Press Down Arrow Key
            				else if (event.which == 40) {
            					if ($(".searchListAll > ul > li", obj).hasClass("active")) {
            						if ($(".searchListAll > ul > li.active", obj).next().hasClass("head")) {
            							$(".searchListAll > ul > li", obj).eq($(".searchListAll > ul > li.active", obj).next().index() + 1).addClass("active").siblings().removeClass("active");
            						} else {
            							if ($(".searchListAll > ul > li.active", obj).index() == $(".searchListAll > ul > li", obj).length - 1) {
            								$(".searchListAll > ul > li", obj).eq(1).addClass("active").siblings().removeClass("active");
            							} else {
            								$(".searchListAll > ul > li", obj).eq($(".searchListAll > ul > li.active", obj).next().index()).addClass("active").siblings().removeClass("active");
            							}
            						}
            					} else {
            						$(".searchListAll > ul > li", obj).eq(1).addClass("active");
            					}
            				}
            				// When Press UP Arrow
            				else if (event.which == 38) {
            					if ($(".searchListAll > ul > li", obj).hasClass("active")) {
            						if ($(".searchListAll > ul > li.active", obj).prev().hasClass("head")) {
            							$(".searchListAll > ul > li", obj).eq($(".searchListAll > ul > li.active", obj).prev().index() - 1).addClass("active").siblings().removeClass("active");
            						} else {
            							$(".searchListAll > ul > li", obj).eq($(".searchListAll > ul > li.active", obj).prev().index()).addClass("active").siblings().removeClass("active");
            						}
            					} else {
            						$(".searchListAll > ul > li", obj).eq($(".searchListAll > ul > li", obj).last().index()).addClass("active");
            					}
            				}
            				// Loading and assiging data as per relevent search
            				else {
            				// 	$(".searchIcon",obj).css("background", "url("+objDomain.img+"/photo/6288727.cms) no-repeat 0 0");
            				    if(settings.topsearch) {
            				        $(".close_search", obj).addClass("searchloader");
            				    } else {
            				        $(".searchIcon", obj).addClass("searchloader");
            				    }
            					
            					var ticker = escape($(this).val().replace(/[<>{}()'#=]/g, ''));
            					
            					var compcount = 0, coincount = 0, mfcount = 0, npscount = 0, cmdtcount = 0, inetcount = 0, apidatacount = 0, defcount = 0, pstoriescount = 0, newscount = 0, repcount = 0, forexcount = 0, indiciescount = 0, etfcount = 0, nonlistcount = 0;
            					
            					if(settings.topsearch) {
                					var com = "<li class='head companies'><span class='flt'><a target='_blank' href='/currentquote.cms?ticker=" + ticker + "'>COMPANIES </a></span><div class='clr'></div></li>";
                					var def = "<li class='head def'><span class='flt'><a target='_blank' href='/definition/" + ticker +"'>DEFINITIONS </a></span><div class='clr'></div></li>";
                					var searchPerson = "<li class='head speople'><span class='flt'><a class='flr' target='_blank' href='/panache/panache-people-101'>PEOPLE </a></span><div class='clr'></div></li>";
                					var news = "<li class='head news'><span class='flt'><a target='_blank' href='/topic/" + escape(ticker).replace("%20", "-") + "'>NEWS </a></span><div class='clr'></div></li>";
            					} else {
            				        var com = "<li class='head companies'><span class='flt'>COMPANIES</span><a class='flr' target='_blank' href='/currentquote.cms?ticker=" + ticker + "'>more</a><div class='clr'></div></li>";
            					    var def = "<li class='head def'><span class='flt'>DEFINITIONS</span><a class='flr' target='_blank' href='/definition/" + ticker +"'>more</a><div class='clr'></div></li>";
            					    var searchPerson = "<li class='head speople'><span class='flt'>PEOPLE</span><a class='flr' target='_blank' href='/panache/panache-people-101'>more</a><div class='clr'></div></li>";
            					    var news = "<li class='head news'><span class='flt'>NEWS</span><a class='flr' target='_blank' href='/topic/" + escape(ticker).replace("%20", "-") + "'>more</a><div class='clr'></div></li>";
            					}
            					var cmdt = "<li class='head cmdt'><span class='flt'>COMMODITY</span><div class='clr'></div></li>";
            					var coin = "<li class='head coin'><span class='flt'>CRYPTOCURRENCY</span><div class='clr'></div></li>";
            					var mf = "<li class='head mf'><span class='flt'>MUTUAL FUNDS</span><div class='clr'></div></li>";
            					var nps = "<li class='head nps'><span class='flt'>NPS</span><div class='clr'></div></li>";
            					var inet = "<li class='head etinside'><span class='flt'>BUSINESS LISTINGS</span><div class='clr'></div></li>";
            					var pstories = "<li class='head pstories'><span class='flt'>PRIME STORIES</span><div class='clr'></div></li>"; 
            					var reptr = "<li class='head reptr'><span class='flt'>REPORTERS</span><div class='clr'></div></li>";
            					var forex = "<li class='head reptr'><span class='flt'>FOREX</span><div class='clr'></div></li>";
            					var etfhtml = "<li class='head reptr'><span class='flt'>ETF</span><div class='clr'></div></li>";
            					var indices = "<li class='head reptr'><span class='flt'>INDICES</span><div class='clr'></div></li>";
            					var nonlist = "<li class='head reptr'><span class='flt'>UNLISTED COMPANIES</span><div class='clr'></div></li>";
            					if (xhr){
            						xhr.abort();
            					}
            					
            					var service_domain_solar = (location.port) ? '//etsmallbiz.indiatimes.com': '//etsmallbiz.indiatimes.com';
            					var searchUrlsme = service_domain_solar + '/smeapi/smesolrentity/searchbyname/mininal';
            					var currLanguage = objLang.currentLang();
            					if(currLanguage == '') {
            						/*$.ajax({
            							url: searchUrlsme,
            							data: 'keyname='+ticker+'&rows=3&distance=25&georangesearch=true',
            							dataType: 'json',
            							success: function (response) {
            								console.log('Got response');
            								for(var i=0; i <response.documentList.length; i++){
            									if(response.documentList[i].entityid.length == 0){
            									   inet = inet + "<li data-url='/params/smelisting/category-"+response.documentList[i].serviceseoname+"/serviceid-"+response.documentList[i].serviceid+"'> <a target='_blank' href='/params/smelisting/category-"+response.documentList[i].serviceseoname+"/serviceid-"+response.documentList[i].serviceid+"'>" + makeBold(input.val(), response.documentList[i].servicename) + "</a></li>"; 
            									   inetcount++;
            									}
            								}
            								for(var i=0; i <response.documentList.length; i++){
            									if(response.documentList[i].entityid.length >0){
            									   inet = inet + "<li data-url='/"+response.documentList[i].entityseoname+"/params/smecompany/entityid-'"+response.documentList[i].entityid+"'> <a target='_blank' href='/" + response.documentList[i].entityseoname+"/params/smecompany/entityid-"+response.documentList[i].entityid + "'>" + makeBold(input.val(), response.documentList[i].entityname) + "</a></li>"; 
            									   inetcount++;
            									}
            								}
            								 
            							}, error :function(e){
            								console.log(e.error());
            							}
            						});*/
            					}	
            					var data = {
            						'matchCompanyName':'true',
            						'realstate':'true',
            						'dvr':'true',
            						'idr':'true',
            						'trust':'true',
            						'mcx':'true',
            						'mf':'true',
            						'crypto': 'true',
            						'nps': currLanguage ? 'false' : 'true',
            						'insideet':'true',
            						'detail':'false',
            						'forex':'false',
            						'index':'true',
            						'mecklai':'true',
            						'etf':'true',
            						'nonList':'true',
            						'pagesize': records.compcount,
            						'language': currLanguage,
            						'outputtype':'json',
            						'callback': 'searchResultCallback'
            					};
            					var ticker = escape($(this).val().replace(/[<>{}()'#=]/g, ''));
            					
            					var searchUrl = objService.mainSearch + "?ticker=" + ticker;
            					if(objPage.searchRequest) clearTimeout(objPage.searchRequest);
            					
            					objPage.searchRequest = setTimeout(function () {
            						window.searchResultCallback = function (data) {
            							var langPrefix = objLang.maping[currLanguage], langSufix = ''; 
            							langPrefix = langPrefix ? langPrefix + '/' : '';
            							langSufix = currLanguage ? ',language-' + currLanguage : '';
            							apidatacount = data.length;
            							for (var i = 0; i < data.length; i++) {
            								if (((data[i].entityType == "company" && data[i].subType != 'NonList') || data[i].entityType == "dvr" || data[i].entityType == "pp" || data[i].entityType == "idr" || data[i].entityType == "ipo") && compcount < records.compcount) {
            									var companyType = data[i].subType ? data[i].subType : data[i].entityType;
            									var qsData = (data[i].entityType != 'company' || typeof data[i].subType != 'undefined') ? ('?companytype=' + companyType) : '',
            										compid = (data[i].entityType == "dvr" || data[i].entityType == "pp") ? data[i].tagId.substring(0,data[i].tagId.length - 4) : data[i].tagId,
            										page = data[i].entityType == "ipo" ? 'ipo' : 'stocks';
            									
            									if (obj.parent().find('#srch-overlay-content').length) {
            									    if (typeof data[i].lastTradedPrice != 'undefined' && !!data[i].lastTradedPrice) {
            									        var ltp = parseFloat(data[i].lastTradedPrice).toFixed(2), pchange = parseFloat(data[i].percentChange).toFixed(2), change = parseFloat(data[i].NetChange).toFixed(2), volume = data[i].volume > 0 ? +parseFloat(data[i].volume / 1000).toFixed(2) + "K" : data[i].volume, updatedatetime = dateFormat(data[i].DateTime, "%h:%m %p | %d %MMM %Y"), st_clsname = pchange < 0 ? "red" : "green";
            									        com = com + "<li class='st_comp' data-url='/" + langPrefix + escape(data[i].tagSeoName) + "/" + page + "/companyid-" + compid + ".cms" + qsData + "'><a target='_blank' href='/" + langPrefix + escape(data[i].tagSeoName) + "/stocks/companyid-" + compid + ".cms" + qsData + "'><div class='st_row'><div class='st_col'>" + makeBold(input.val(), data[i].tagName) + "</div><div class='st_col st_change cSprite_b "+ st_clsname +"'>"+ ltp +"</div><div class='st_col "+ st_clsname +"'>"+ change +"</div></div><div class='st_row st_last'><div class='st_col'>"+ updatedatetime +"</div><div class='st_col'>Vol. "+ volume +"</div><div class='st_col "+ st_clsname +"'>"+ pchange +"%</div></div></a><div class='st_options' data-url='/" + langPrefix + escape(data[i].tagSeoName) + "/stocks/companyid-" + compid + ".cms" + qsData + "'><span data-scrollsection='stockOverviewOffset'>Overview</span><span data-scrollsection='technicalInsightsOffset'>Technicals</span><span data-scrollsection='researchOffset'>Analysis</span><span data-scrollsection='forecastOffset'>Forecast</span><span data-scrollsection='recommendationsOffset'>Recos</span><span data-scrollsection='peerComparisonOffset'>Peers</span><span data-scrollsection='financialsOffset'>Financials</span><span data-scrollsection='newsAnalysisOffset'>News & Annoucnements</span><span data-scrollsection='shareholdingPatternOffset'>Shareholding</span><span data-scrollsection='corporateActionsOffset'>Corp Action</span><span data-scrollsection='stocksAboutOffset'>About</span></div></li>";
            									    } else {
            									        com = com + "<li class='st_comp' data-url='/" + langPrefix + escape(data[i].tagSeoName) + "/" + page + "/companyid-" + compid + ".cms" + qsData + "'><a target='_blank' href='/" + langPrefix + escape(data[i].tagSeoName) + "/stocks/companyid-" + compid + ".cms" + qsData + "'><div class='st_row'><div class='st_col'>" + makeBold(input.val(), data[i].tagName) + "</div></div></a><div class='st_options' data-url='/" + langPrefix + escape(data[i].tagSeoName) + "/stocks/companyid-" + compid + ".cms" + qsData + "'><span data-scrollsection='stockOverviewOffset'>Overview</span><span data-scrollsection='technicalInsightsOffset'>Technicals</span><span data-scrollsection='researchOffset'>Analysis</span><span data-scrollsection='forecastOffset'>Forecast</span><span data-scrollsection='recommendationsOffset'>Recos</span><span data-scrollsection='peerComparisonOffset'>Peers</span><span data-scrollsection='financialsOffset'>Financials</span><span data-scrollsection='newsAnalysisOffset'>News & Annoucnements</span><span data-scrollsection='shareholdingPatternOffset'>Shareholding</span><span data-scrollsection='corporateActionsOffset'>Corp Action</span><span data-scrollsection='stocksAboutOffset'>About</span></div></li>";
            									    }
        									    } else {
        									        com = com + "<li data-url='/" + langPrefix + escape(data[i].tagSeoName) + "/" + page + "/companyid-" + compid + ".cms" + qsData + "'> <a target='_blank' href='/" + langPrefix + escape(data[i].tagSeoName) + "/stocks/companyid-" + compid + ".cms" + qsData + "'>" + makeBold(input.val(), data[i].tagName) + "</a></li>";
        									    }
            									compcount++;
            								} else if (data[i].entityType == "crypto" && coincount < records.coincount) {
            									coin = coin + "<li data-url='/markets/cryptocurrency/" + escape(data[i].tagSeoName) + "/cryptodetail/symbol-" + data[i].tagId + ".cms'> <a target='_blank' href='/markets/cryptocurrency/" + escape(data[i].tagSeoName) + "/cryptodetail/symbol-" + data[i].tagId + ".cms'>" + makeBold(input.val(), data[i].tagName) + "</a></li>";
            									coincount++;
            								}
            								else if (data[i].entityType == "MutualFund" && mfcount < records.mfcount) {
            									mf = mf + "<li data-url='/" + escape(data[i].tagSeoName) + "/mffactsheet/schemeid-" + data[i].tagId + ".cms'> <a target='_blank' href='/" + escape(data[i].tagSeoName) + "/mffactsheet/schemeid-" + data[i].tagId + ".cms'>" + makeBold(input.val(), data[i].tagName) + "</a></li>";
            									mfcount++;
            								} else if (data[i].entityType == "NPS" && npscount < records.npscount) {
            									nps = nps + "<li data-url='/" + escape(data[i].tagSeoName) + "/nps/schemecode-" + data[i].tagId + ".cms'> <a target='_blank' href='/" + escape(data[i].tagSeoName) + "/nps/schemecode-" + data[i].tagId + ".cms'>" + makeBold(input.val(), data[i].SchemeName) + ( (data[i].SchemeName1 != '' && data[i].SchemeName1 != undefined) ? (' - ' + data[i].SchemeName1) : ('') ) + ( (data[i].SchemeName2 != '' && data[i].SchemeName2 != undefined) ? (' - ' + data[i].SchemeName2) : ('') ) + "</a></li>";
            									npscount++;
            								}
            								/*else if (data[i].entityType == "ET" && inetcount < records.inetcount) {
            									inet = inet + "<li data-url='" + data[i].url + "'> <a target='_blank' href='" + data[i].url + "'>" + makeBold(input.val(), data[i].key) + "</a></li>";
            									inetcount++;
            								}*/
            								else if (data[i].entityType == "commodity" && cmdtcount < records.cmdtcount) {
            									cmdt = cmdt + "<li data-url='/" + langPrefix + "commoditysummary/symbol-" + data[i].fno + langSufix + ".cms'> <a target='_blank' href='/" + langPrefix + "commoditysummary/symbol-" + data[i].fno + langSufix + ".cms'>" + makeBold(input.val(), data[i].tagName) + "</a></li>";
            									cmdtcount++;
            								} else if (data[i].entityType.toLowerCase() == "forex" && forexcount < records.forexcount) {
            									var url = '/forex_home.cms?amount=1&fromcur=' + data[i].fromCurrencyShort + '&tocur='  + data[i].toCurrencyShort;
            									var tagName = $.trim(data[i].tagName);
            									tagName = tagName.replace(tagName[0], tagName[0].toUpperCase());
            									tagName = makeBold(input.val(), tagName);
            									forex = forex + "<li data-url='" + url + "'> <a target='_blank' href='" + url + "'>" + tagName + "</a></li>";
            									forexcount++;
            								} else if (data[i].entityType.toLowerCase() == "etf" && etfcount < records.etfcount) {
            									var url = '/' + data[i].tagSeoName + '/mffactsheet/schemeid-' + data[i].tagId + '.cms';
            									var tagName = $.trim(data[i].tagName);
            									tagName = makeBold(input.val(), tagName);
            									etfhtml = etfhtml + "<li data-url='" + url + "'> <a target='_blank' href='" + url + "'>" + tagName + "</a></li>";
            									etfcount++;
            								} else if (data[i].entityType == "index" && indiciescount < records.indicescount) {
            									var tagId = data[i].tagId, exchange = data[i].exchange == 'BSE' ? 47 : 50;
            									var url = '/markets/indices/' + data[i].tagSeoName;
            									switch(tagId) {
            										case '2369' : url = '/markets/indices/nifty-50';break;
            										case '2365' : url = '/markets/indices/bse-sensex';break;
            									}
            									indices = indices + "<li data-url='" + url + "'> <a target='_blank' href='" + url + "'>" + makeBold(input.val(), data[i].tagName) + "</a></li>";
            									indiciescount++;
            								} else if (data[i].entityType.toLowerCase() == "company" && data[i].subType == 'NonList' && nonlistcount < records.nonlistcount) {
            									var url = '/company/' + data[i].tagSeoName + '/' + data[i].tagId;
            									var tagName = $.trim(data[i].tagName);
            									tagName = makeBold(input.val(), tagName);
            									nonlist = nonlist + "<li data-url='" + url + "'> <a target='_blank' href='" + url + "'>" + tagName + "</a></li>";
            									nonlistcount++;
            								}
            							}
            							// Assiging Data in List
            							(compcount == 0) ? com = "" : com = com;
            							(coincount == 0) ? coin = "" : coin = coin;
            							(mfcount == 0) ? mf = "" : mf = mf;
            							(npscount == 0) ? nps = "" : nps = nps;
            							(inetcount == 0) ? inet = "" : inet = inet;
            							(cmdtcount == 0) ? cmdt = "" : cmdt = cmdt; //(defcount == 0)? def = "" : def = def;
            							(forexcount == 0) ? forex = "" : forex = forex;
            							(indiciescount == 0) ? indices = "" : indices = indices;
            							(etfcount == 0) ? etfhtml = "" : etfhtml = etfhtml;
            							(nonlistcount == 0) ? nonlist = "" : nonlist = nonlist;
            							allapisearch = com + nonlist + coin + mf + nps + cmdt + forex + indices + inet + etfhtml;
            							// allapisearch = com + mf + cmdt + forex + indices;
            							
            							$(".searchListAll > ul", obj).html(allapisearch);
            
            							// Show Hide Drop Down
            							if (data.length) {
            								if($(obj).attr('id') == 'srch-overlay-content' || $(obj).parent().attr('id') == 'topSearch') { $(".srch-overlay-content").addClass('active') }
            								$(".searchListAll", obj).slideDown(300);
            							}
            							
            							if (xhrdef){
            								xhrdef.abort();
            							}
            							
            							xhrdef = $.ajax({
            									url : "/json_definitionsearch.cms?q=" + escape(input.val()),
            									success : function (response) {
            									    var defdata = response && response.definitions || [];
            									    var personData = response && response.person || [];
            								// 		$(".searchIcon",obj).removeAttr("style");
            								        $(".searchIcon", obj).removeClass("searchloader");
            								        $(".close_search", obj).removeClass("searchloader");
            										defcount = defdata.length;
            										for (var i = 0; i < defdata.length; i++) {
            											def = def + '<li data-url="/definition/' + defdata[i].seo + '"> <a target="_blank" href="/definition/' + defdata[i].seo + '">' + makeBold(input.val(), defdata[i].name) + '</a></li>';
            										}
            										def = (!defdata.length) ? "" : def;
            										
            										for (var i = 0; i < personData.length; i++) {
            											searchPerson = searchPerson + '<li data-url="/' + personData[i].seo + '"> <a target="_blank" href="/' + personData[i].seo + '">' + makeBold(input.val(), personData[i].name) + '</a></li>';
            										}
            										
            										def = personData.length ? searchPerson + def : def;
            										
            										if (defdata.length || personData.length) {
            											if($(obj).attr('id') == 'srch-overlay-content' || $(obj).parent().attr('id') == 'topSearch') { $(".srch-overlay-content").addClass('active') }
            											$(".searchListAll > ul", obj).html(allapisearch + def);
            											$(".searchListAll", obj).slideDown(300);
            										}
            										if((input.val().length > 2) || (apidatacount == 0 && defcount == 0)){
            											if (xhrnews){
            												xhrnews.abort();
            											}
            											xhrnews = $.ajax({
            												url : "/json_newssearch.cms?query=" + escape(input.val()),
            												success : function (newsdata,status,sxhr) {
            												    var primeStories =[], nonPrimeStories =[];
            													newsdata.forEach(function (ele) {
                                                                    if (ele.link.includes('/prime/')){
                                                                        primeStories.push(ele);
                                                                    } else {
                                                                        nonPrimeStories.push(ele);
                                                                    }
                                                                });
                                                                
            													for (var j = 0; j < ((primeStories.length >= 3) ? 3 : primeStories.length); j++) {
        													        pstoriescount++;
                													pstories = pstories + "<li data-url='" + primeStories[j].link + "'> <a target='_blank' href='" + primeStories[j].link + "'>" + makeBold(input.val(), primeStories[j].title) + "</a></li>"
            													}
            													
            													newscount = nonPrimeStories.length;
            													for (var i = 0; i < (((apidatacount + defcount) == 0) ? nonPrimeStories.length : (nonPrimeStories.length >=2) ? 2 : nonPrimeStories.length); i++) {
                											        news = news + "<li data-url='" + nonPrimeStories[i].link + "'> <a target='_blank' href='" + nonPrimeStories[i].link + "'>" + makeBold(input.val(), nonPrimeStories[i].title) + "</a></li>"
            													}
            													
            													news = (!nonPrimeStories.length) ? "" : news;
            													pstories = (!pstoriescount) ? "" : pstories;
            													if (nonPrimeStories.length) {
            														if($(obj).attr('id') == 'srch-overlay-content' || $(obj).parent().attr('id') == 'topSearch') { $(".srch-overlay-content").addClass('active') }
            														$(".searchListAll > ul", obj).html(allapisearch + def + news);
            														$(".searchListAll", obj).slideDown(300);
            													}
            													if (pstoriescount) {
            													    if($(obj).attr('id') == 'srch-overlay-content' || $(obj).parent().attr('id') == 'topSearch') { $(".srch-overlay-content").addClass('active') }
            													    $(".searchListAll > ul", obj).html(allapisearch + def + pstories + news);
            														$(".searchListAll", obj).slideDown(300);
            													}
            													if (xhrrptr){
            														xhrrptr.abort();
            													}
            													if(currLanguage == '') {
            														xhrrptr = $.ajax({
            															url : "/json_reportersearch.cms?keyword=" + escape(input.val()),
            															success : function (repdata) {
            																repcount = repdata.length;
            																for (var i = 0; i < repdata.length; i++) {
            																	reptr = reptr + "<li data-url='" + repdata[i].link + "'> <a target='_blank' href='" + repdata[i].link + "'>" + makeBold(input.val(), repdata[i].title) + "</a></li>"
            																}
            																reptr = (!repdata.length) ? "" : reptr;
            																if (repdata.length) {
            																	if($(obj).attr('id') == 'srch-overlay-content' || $(obj).parent().attr('id') == 'topSearch') { $(".srch-overlay-content").addClass('active') }
            																	$(".searchListAll > ul", obj).html(allapisearch + def + news + pstories + reptr);
            																	$(".searchListAll", obj).slideDown(300);
            																} else if (apidatacount == 0 && defcount == 0 && newscount == 0 && repcount == 0 && personData.length == 0) {						
            																	if($(obj).attr('id') == 'srch-overlay-content' || $(obj).parent().attr('id') == 'topSearch') { $(".srch-overlay-content").addClass('active') }
            																	$(".searchListAll > ul", obj).html("<div class='no-result'>No results found</div>");
            																	$(".searchListAll", obj).slideDown(300);
            																} else if(!$(".searchListAll > ul", obj).has("li")){
            																// 	$(".searchIcon", obj).removeAttr("style");
            																    $(".searchIcon", obj).removeClass("searchloader");
            																    $(".close_search", obj).removeClass("searchloader");
            																	$(".searchListAll",obj).slideUp(300);
            																	$(obj).removeClass('active')
            																}
            															}
            														});
            													}
            												}
            											});
            										}									
            									}								
            								});
            							
            							//}						
            							
            							
            
            						}
            						xhr = $.ajax({
            							url : searchUrl,
            							data : data,
            							dataType : "script",
            							cache: 'true',
            							success : function (data) {},
            							error : function(data){
            								//console.log(data);
            							}
            						});
            					}, 500);
            				}
            			} else {
            				if (xhr){
            					xhr.abort();
            					if(settings.topsearch) { searchAutocomplete(); } 
            				} else {
            				    $(".searchIcon", obj).removeClass("searchloader");
            				    $(".close_search", obj).removeClass("searchloader");
                				$(".searchListAll > ul", obj).empty();
                				if(settings.topsearch) { searchAutocomplete(); } 
            				}
            				
            			}
            		}, 300));
            		//eof: For set or remove the default text in input box
            	});
            }
            /* New All Search Script ends Here */
            
            /* ET Search */
        	$.fn.etSearch = function(opts){
        		var settings = {
        			input : "input[type=text]",
        			button : "input[type=submit],button",
        			ajax : {
        				url : "/stocksearch.cms",
        				key : "ticker"
        			},
        			buttonAction : "/currentquote.cms?ticker="
        		};
        		
        		if(typeof opts == "object"){
        			if($.isPlainObject(opts)){
        				$.extend(settings, opts);
        			}
        		}
        		
        		return this.each(function(){
        			var o = $(this),
        				input = $(settings.input, o),
        				btn = $(settings.button, o),
        				ajaxData = {},
        				keyword = "",
        				selected = -1;
        				
        			// setting CSS and elements
        			o.css({
        				position: "relative",
        				zIndex : "8"
        			});			
        			$("<div class='searchList searchListAll'><ul></div>")
        				.css({
        					background : '#FFF',
        					display : 'none',
        					position : 'absolute',
        					'min-width' : input.outerWidth(),
        					top : input.position().top + input.outerHeight() + 5,
        					left : input.position().left
        				})
        				.appendTo(o);
        				
        			if($.browser != undefined && $.browser.msie && $.browser.version < 9){
        				$(".searchList", o).addClass("searchListIE");
        			}
        			
        			//Active on mouseover
        			$(".searchList", o).find("li").off("mouseenter").on("mouseenter", function(){
        				$(this).addClass("active").siblings().removeClass("active");
        			});
        			
        			//Hiding Results
        			$(document).bind("mousedown.hideResults", function(event){
        				if(event.target != input[0] && event.target!= $(".searchList", o)[0] && !$(event.target).parents(".searchList", o).length > 0){
        					$(".searchList", o).slideUp(300, function(){
        						$(".searchList", o).empty();
        						$(".srch-overlay-content").removeClass('active')
        					});
        				}
        			});
        			
        			//Retrieve Data
        			input.bind("keyup", function(event){
        				var KeyID = window.event ? event.keyCode : event.which;
        				
        				switch (KeyID){
        					case 13: // Enter
        					     if($(".searchListAll > ul > li").hasClass("active")) {
        						    // Sending the GA Hit when Enter is pressed on a search query
        				            ga('send', 'event', 'Search Bar', location.href, $(".searchListAll > ul > li.active > a").text());
        							var loc = $(".searchListAll > ul > li.active a").attr("href");
        							if(loc) {
                        			    location.href = loc;
                        			} else {
                        			    saveLogs({'type': 'location_href_error', 'keyup': input.val()});
                        			}
        							input.val(settings.message);
        						}
        						
        					//	btn.trigger("click");
        						break;
        					case 38: // Up
        						selected = $(".searchList", o).find("li.active").index();
        						if(selected <= 0){
        							$(".searchList", o).find("li").last().addClass("active").siblings().removeClass("active");
        							selected = $(".searchList", o).find("li").length-1;
        						} else {
        							$(".searchList", o).find("li").eq(selected).prev().addClass("active").siblings().removeClass("active");
        							selected--;
        						}
        						break;
        					case 40: // Down
        						selected = $(".searchList", o).find("li.active").index();
        						if(selected < 0 || selected >= $(".searchList", o).find("li").length-1){
        							$(".searchList", o).find("li").first().addClass("active").siblings().removeClass("active");
        							selected = 0;
        						} else {
        							$(".searchList", o).find("li").eq(selected).next().addClass("active").siblings().removeClass("active");
        							selected++;
        						}
        						break;
        					default :
        						if($.trim(input.val()) != ""){
        							ajaxData[settings.ajax.key] = $.trim(input.val());				
        							$.ajax({
        								url : settings.ajax.url,
        								dataType : 'html',
        								data : ajaxData,
        								success : function(data){
        									$(".searchList", o).html(data).slideDown();
        									selected = -1;
        								}
        							});
        						}
        						break;
        				}
        			});
        			
        			//Closing Other Open results in the page
        			input.bind("focus", function(){
        				$("ul.searchList").filter(function(){
        					return $(this).not(input.siblings());
        				}).slideUp(300, function(){
        					$(this).empty();
        					$(".srch-overlay-content").removeClass('active')
        				});
        			});
        			
        			//Preventing Submit Form
        			if(o.is("form")){
        				o.bind("submit", function(event){
        					event.preventDefault();
        				});
        			}
        			
        			//Button Action
        			btn.bind("click", function(){
        				if($.trim(input.val()) != ""){
        					selected = $(".searchList", o).find("li.active").index();
        					window.open(selected >= 0 ? $(".searchList", o).find("li.active a").attr('href') : settings.buttonAction + input.val());
        				}
        			});
        		});
        	}
        	/* endof ET Search */
        	
        	/* GALLERY : News in Pics */
        	$.fn.etGallery = function(opts){
        		var settings = {
        			content	: "> ul > li",
        			countText : ".nav .count",
        			next : ".nav .next",
        			prev : ".nav .prev",
        			play : ".nav .go",
        			speed : 500,
        			auto : true,
        			pauseOnHover : true,
        			interval : 10000,
        			width : 315
        		};
        		
        		if(typeof opts == "object"){
        			if($.isPlainObject(opts)){
        				$.extend(settings, opts);
        			}
        		}
        		
        		return this.each(function(){
        			var o = $(this),
        				totalCount = $(settings.content, o).length,
        				curIndex = $(settings.content, o).parent().find(".default").index(),
        				target;
        			curIndex = curIndex == -1 ? 0 : curIndex;
        			// Setting Class for Play-Pause Btn
        			if(settings.auto){
        				$(settings.play, o).attr("class", "btn go").attr("title", "Stop Auto Play");
        			} else {
        				$(settings.play, o).attr("class", "btn go play").attr("title", "Auto Play");
        			}
        			
        			var autoInterval;
        			
        			function setAuto(){
        				clearInterval(autoInterval);
        				autoInterval = setInterval(function(){
        					goNext();
        				}, settings.interval);
        			}
        			
        			if(settings.auto){
        				setAuto();
        			}
        			
        			if (settings.pauseOnHover && settings.auto) {
        				$(settings.content, o).bind("mouseenter", function () {
        					clearInterval(autoInterval);
        				}).bind("mouseleave", function () {
        					setAuto();
        				});
        			}
        			
        			//Play-Pause
        			$(settings.play, o).on("click", function(event){
        				if(settings.auto){
        					clearInterval(autoInterval);
        					$(settings.play, o).addClass("play").attr("title", "Auto Play");
        					settings.auto = false;
        				} else {
        					setAuto();
        					$(settings.play, o).removeClass("play").attr("title", "Stop Auto Play");
        					settings.auto = true;
        				}
        			});
        			
        			//Next
        			function goNext(){
        				if(settings.auto){
        					clearInterval(autoInterval);
        				}
        				curIndex = (curIndex < totalCount-1) ? curIndex+1 : 0;
        				target = $(settings.content, o).eq(curIndex);
        				$(settings.countText, o).text(curIndex+1 + "/" +  totalCount);
        				if(target.find("img").attr("data-original")){
        					target.find("img").attr("src", target.find("img").attr("data-original")).removeAttr("data-original");
        				}
        				target.animate({opacity: 'show', width: settings.width}, settings.speed, function(){
        					if(settings.auto){
        						setAuto();
        					}
        				}).siblings().animate({opacity: 'hide', width:0}, settings.speed);
        			}
        			$(settings.next, o).on("click", function(event){
        				goNext();
        				event.preventDefault();
        			});
        			//Prev
        			$(settings.prev, o).on("click", function(event){
        				if(settings.auto){
        					clearInterval(autoInterval);
        				}
        				curIndex = (curIndex <= 0) ? totalCount-1 : curIndex-1;
        				target = $(settings.content, o).eq(curIndex);
        				$(settings.countText, o).text(curIndex+1 + "/" +  totalCount);
        				if(target.find("img").attr("data-original")){
        					target.find("img").attr("src", target.find("img").attr("data-original")).removeAttr("data-original");
        				}
        				target.animate({opacity: 'show', width: settings.width}, settings.speed, function(){
        					if(settings.auto){
        						setAuto();
        					}
        				}).siblings().animate({opacity: 'hide', width:0}, settings.speed);				
        				event.preventDefault();
        			});
        			
        			
        			// Fix for Flickering on back from long Focus out of the tab or window
        			$(window).bind("focus.fixFlickering", function(){
        				$(settings.content, o).clearQueue();
        			});
        		});
        	}
        	/* endof GALLERY : News in Pics */
        	
            /* ET Slider */
            $.fn.etSlider = function(opts) {
                var slideContainer = opts.slideContainer ? opts.slideContainer : '.slides';
            	var settings = {
            		visible : 3,
            		perSlide : 3,
            		speed : 800,
            		auto : true,
            		pauseOnHover : true,
            		interval : 8000,
            		easing : 'swing',
            		pagination : ".pagination",
            		slideContainer : slideContainer,
            		slides : slideContainer + ' > ul > li',
            		nextprevBtn : false,
            		nextprevClass : '.nextprev-parent',
            		setPagination: 1
            	}
            	
            	if(typeof opts == "object"){
            		if($.isPlainObject(opts)){
            			$.extend(settings, opts);
            		}
            	}
            	
            	return this.each(function(){
            	    var o = $(this),
            			slide = $(settings.slides, this).first(),
            			slideTarget = slide.parent(),
            			slideWidth = slide.outerWidth(true),
            			slideMargin = parseInt(slide.css('margin-left')),
            			slidesCount = $(settings.slides, this).length,
            			pagings = $(settings.pagination, this).find("li"),
            			totalPagings = (slidesCount%settings.perSlide == 0) ? slidesCount/settings.perSlide : Math.ceil(slidesCount/settings.perSlide),
            			parentEle = $(settings.slideContainer, this).parent(),
            			nextBtn = $(settings.nextprevClass + ' .next-btn', this),
            			prevBtn = $(settings.nextprevClass + ' .prev-btn', this),
            			animationArea = 0,
            			mouseflag = true,
            			autoInterval;
            		
            		// Setting Width of container
            		var slideWidth = slideWidth + slideMargin, totalWidth = slideWidth * slidesCount, parentElement = $(settings.slides, this).first().parent();
            		
            		parentElement.width(totalWidth);
            		if(totalPagings <= 1 || (totalWidth <= parentElement.parent().width())) {
            		    $(settings.nextprevClass, this).hide();
            		    $(settings.pagination, this).addClass("hide");
            		}
            		
            		// Adjusting Pagings
            		if(settings.setPagination) {
            		    if($(settings.pagination, this).find("ul").length == 0) {
            		        $(settings.pagination, this).append("<ul></ul>");
            		    }
            		    $(settings.pagination, this).find("ul").empty();
                		for(var i = 0; i < totalPagings; i++){
                			if(i == 0){
                				$(settings.pagination, this).find("ul").append("<li class='active'><span>1</span></li>");
                			} else {
                				$(settings.pagination, this).find("ul").append("<li><span>" + (i+1) + "</span></li>");
                			}
            		    }
            		}
            		
            		// Re-Getting the Pagings
            		pagings = $(settings.pagination, this).find("li");
            		
            		//Loading All Visible Images
            		$.each(
            			$(settings.slides, o).filter(function(){
            				return $(this).index() < settings.visible;
            			}),
            			function(){
            				$(settings.slides, o).find("img").each(function(i,v){
            				   if($(this).attr("data-original")){
            						$(this).attr("src", $(this).attr("data-original")).removeAttr("data-original");
            					} 
            				});
            			}
            		);
            		
            		// Pause on MouseOver
            		if (settings.pauseOnHover && settings.auto) {
            			$(o).on("mouseenter", function () {
            				mouseflag = false;
            				clearInterval(autoInterval);
            			}).on("mouseleave", function () {
            				mouseflag = true;
            				setAuto();
            			});
            		}
            		
            		// Sliding
            		function goSlide(indx){
            			var curIndex = indx;
            			
            			if(settings.auto){
            				clearInterval(autoInterval);
            			}
            				
            			if(settings.nextprevBtn) {
            				if(curIndex == 0) {
            					parentEle.find(prevBtn).addClass('disable');
            					parentEle.find(nextBtn).removeClass('disable');
            				} else if(curIndex + 1 == pagings.length) {
            					parentEle.find(nextBtn).addClass('disable');
            					parentEle.find(prevBtn).removeClass('disable');
            				} else {
            					parentEle.find(nextBtn).removeClass('disable');
                				parentEle.find(prevBtn).removeClass('disable');
            				}
            			}
            			
            			// Setting Animation Area
            			animationArea = slideWidth * (-1);
            			animationArea = animationArea * settings.perSlide * curIndex;
            			
            			// Animation
            			slideTarget.stop().animate({
            				'margin-left' : animationArea
            			}, settings.speed, settings.easing, function(){
            				if(settings.auto && mouseflag){
            					setAuto();
            				}
            				if(typeof settings.nextPrevCallback == 'function') {
            				    settings.nextPrevCallback(indx, settings);
            				}
            			});
            			pagings.eq(indx).addClass("active").siblings().removeClass("active");
            			
            			// Loading Images on being visible
            			var allVisibles = settings.visible * curIndex,
            				targetSlides = $(settings.slides, o).filter(function(){
            					return ($(this).index() > allVisibles-1) && ($(this).index() < allVisibles + settings.perSlide);
            				});
            				
            			$.each(targetSlides, function(){
            				if($(this).find("img").attr("data-original")){
            					$(this).find("img").attr("src", $(this).find("img").attr("data-original")).removeAttr("data-original");
            				}
            			});
            		}
            		
            		//Clicking on Paginations
            		pagings.on("click", function(){
            			goSlide($(this).index());
            		});
            		
            		if(settings.nextprevBtn) {		
            			$(nextBtn).on('click', function(){
            				if(!$(this).hasClass('disable')) {
            				    // Re-Getting the Pagings
            		            if(tpName == 'wealth_edition') pagings = $(settings.pagination).find("li");
            					var current = pagings.filter('.active');
            					goSlide(current.index() + 1);
            				}
            			});
            			
            			$(prevBtn).on('click', function(){
            				if(!$(this).hasClass('disable')) {
            					var current = pagings.filter('.active');
            					goSlide(current.index() - 1);
            				}
            			});
            		}
            		
            		// Auto
            		function setAuto(){
            			clearInterval(autoInterval);
            			autoInterval = setInterval(function(){
            				var current = pagings.filter('.active');				
            				if(current.index() >= current.siblings().length){
            					goSlide(0);					
            				} else {					
            					goSlide(current.index() + 1);
            				}
            			}, settings.interval);
            		}
            		
            		if(settings.auto){
            			setAuto();
            		}
            	});
            }
            /*endof ET Slider */
        	
        	/* Budget Slider Plugin */
        	$.fn.budgetslider = function(options){
        		var settings = $.extend({
                    // These are the defaults.
                    autoslide: false,
        			autoslideInterval : 1000,
        			slideInterval : 1000
                }, options );
                return this.each(function(){
                    if(!$(this).hasClass('active-slider')){
                        $(this).addClass('active-slider');
                        var autoslide = '',scope = $(this),
            			liLength = scope.find('.slide > .slideBox').length,
                        liWidth = scope.find('.slide > .slideBox').outerWidth(true),
                        totalWidth = liLength * liWidth,
                        flag = true;
                        scope.find('ul.slide').width(totalWidth);
            			if(liLength == 1){
                           scope.find('.bx-prev').addClass('hidden');
                           scope.find('.bx-next').addClass('hidden');
                        }
            			
            			var setAutoSider = function(check){
            				if(settings.autoslide){
            					if(check == 'clear'){
            						clearInterval(autoslide);
            					}else{
            						autoslide = setInterval(function(){
            							scope.find('.bx-next').trigger('click');
            						}, settings.autoslideInterval);
            					}	
            				}				
            			}	
            			
            			var activeSec = function(){
            				if(scope.hasClass('autoView')){
            					var activeSec = scope.find('.slide > .slideBox:first-child .slidbgBox > span').text();
            					scope.find('.head span').text(activeSec);							
            				}
            			}
            
            			setAutoSider('set');
            			
            			scope.mouseenter(function(){
            			    setAutoSider('clear');    
            			}).mouseleave(function(){
            			    setAutoSider('set');
            			});
            			
            			scope.find('.bx-prev').click(function(){
                            if(flag == true){
                                flag = false;
                                var lastLi = scope.find('.slide > .slideBox:last-child').detach();
                                scope.find('.slide').prepend(lastLi);
                                scope.find('.slide').css('marginLeft' , '-'+ liWidth +'px');
                                scope.find('.slide').animate({
                                    marginLeft : '0'
                                },settings.slideInterval, function(){
                                    flag = true;
            						activeSec();
                                });
                            }
                            return false;
                        });
                        scope.find('.bx-next').click(function(){
                            if(flag == true){
                                flag = false;					
                                scope.find('.slide').animate({
                                    marginLeft : '-'+ liWidth +'px'
                                },settings.slideInterval, function(){
                                    var firstLi = scope.find('.slide > .slideBox:first-child').detach();
                                    scope.find('.slide').append(firstLi);
                                    scope.find('.slide').css('marginLeft' , 0);
                                    flag = true;
            						activeSec();
                                });
                            }
                            return false;
                        });			
            			    
                    }
                });
            }
            /* End of Budget Slider Plugin */
            
            // Market Time Check
            var _mkt = {
            	isOpen : true,
            	status : $.cookie("mkt_onoff_status"),
            	curTime : "", // must be in the format of 6 digits [like HHMMSS]
            	setVal : function(num){
            		return (num < 10) ? "0" + num : num.toString();
            	},
            	checkMkt : function(){
            	    try{
                		if((_mkt.curTime != "") && (_mkt.curTime.length == 6) && !isNaN(_mkt.curTime)){
                			if(_mkt.status == "OFF"){
                				_mkt.isOpen = false;
                			} else {
                				if(_mkt.status == "ERROR"){
                					_mkt.isOpen = true;
                				} else {
                					var startTime = _mkt.status.split("_")[0],
                						endTime = _mkt.status.split("_")[1];
                						
                					//console.log()
                					
                					if(_mkt.curTime > startTime && _mkt.curTime < endTime){
                						_mkt.isOpen = true;
                					} else {
                						_mkt.isOpen = false;
                					}
                				}
                			}
                		}
                	}catch(e){console.log("error in checkMkt", e);}
            	},
            	getMktTime : function(){
            		$.getJSON(objMktD.bself+"/ET_Community/holidaylist?instrumentid=1&callback=?", function(data){
            			var startTime,
            				endTime,
            				cookieTime = new Date().getTime() + 8 * 60 * 60 * 1000; // 8 Hours from Now
            			
            			if(data.marketStatus == "ON"){
            				startTime = new Date(data.tradingStartTime);
            				startTime = _mkt.setVal(startTime.getHours()) + _mkt.setVal(startTime.getMinutes()) + _mkt.setVal(startTime.getSeconds());
            				
            				endTime = new Date(data.tradingEndTime);
            				endTime = _mkt.setVal(endTime.getHours()) + _mkt.setVal(endTime.getMinutes()) + _mkt.setVal(endTime.getSeconds());
            				
            				_mkt.status = startTime + "_" + endTime;
            				
            				if(objGdpr.allow()) {
            				    $.cookie("mkt_onoff_status", _mkt.status, {expires : cookieTime, path : "/"});
            				}
            			} else {
            			    if(objGdpr.allow()) {
            				    $.cookie("mkt_onoff_status", "OFF", {expires : cookieTime, path : "/"});
            			    }
            			}
            			
            			_mkt.checkMkt();
            		});
            	},
            	init : function(){
            		if(_mkt.status == undefined){
            			_mkt.getMktTime();
            		} else {
            			_mkt.checkMkt();
            		}
            	}
            }
            // endof Market Time Check
            
            // Market Band 
            var objMarketBand = {
                activeGetData: 0,
                forceLoad: 1,
                flipDuration: {1: 8000, 2: 4000},
                service: objMktD.bself + '/marketband.json',
                cryptoApi: (function () {
                    return objMktD.bself + '/cryptocurrency.json'
                })(),
                cryptoData: {},
                bandData : {},
                timeoutRef: {getBandData: 0, chartDataCacheing: 0, renderWidget: 0, timer: 0},
                flipFlag: 1,
                timerDone: 0,
                timerInprocess: 0,
                init: function () {
                    _log('version objMarketBand', '1');
                    // console.log($('.band, .bm_wrapper').length, 'Items');
                    if($('.band, .bm_wrapper').length) {
                        objMarketBand.getBandData(function () {
                            objMarketBand.renderWidget();
                            objMarketBand.forceLoad = 0;
                        });
                        objMarketBand.bindEvents();
                    }
                    $(window).one('mousemove scroll', function(event) {
                        objMarketBand.activeGetData = 1;
                    });
                },
                bindEvents: function () {
                    // Load Stats Menu
                    $(".stats_btn").mouseenter(function () {
                        console.log($(".stats_list").is(':empty'), 'Inside Hover');
                		if ($(".stats_list").is(':empty')) {
                		    $.ajax({
                		        url: '/market_ddmenu.cms?arrow_inside=1&language='+objLang.currentLang(),
                		        success: function (ddHtml) {
                		            $('.stats_list').html(ddHtml);
                		        }
                		    });
                		} 
                	});
                	
                    $('#newband').on('click', '.viewMoreMercuryFeatures', function (e) {
                        e.stopPropagation(); // Prevents the click event from bubbling up to the document
                        $('.moreMercuryFeatures').toggle(); // Toggle visibility of .moreMercuryFeatures
                    });
                
                    $(document).on('click', function (e) {
                        if (!$(e.target).closest('.moreMercuryFeatures, .viewMoreMercuryFeatures').length) {
                            $('.moreMercuryFeatures').hide();
                        }
                    });
                	
                	$('.band').on('click', '.band-content a', function () {
            			var $this = $(this), href =  $this.attr('href'), a_text = $this.text(), bandPosition = ($this.parents('.band-items').index() + 1); // + '-' + $this.attr('data-index');
            			ga('send','event','Market Band','Web _ ENG', 'Bandlink ' + bandPosition + ' _ ' + tmplName + ' _ ' + a_text + ' _ '+ href);
            		});
            		
            		$(".stats_btn").on("click", "li a", function (event) {
                	    event.stopPropagation();
            			var $this = $(this), href =  $this.attr('href');
            			if(href.indexOf('#') == -1) {
            			    var pArray = [];
                            $this.parents('.level_3, .level_2, .level_1, .level_0').each(function () {
                            	pArray.push($(this).find('>a').text())
                            });
                            var pText = pArray.reverse().join(' - ')
            		        ga('send','event','Market Band','Web _ ENG', 'Bandlink 4 _ ' + tmplName + ' _ '  + pText + ' _ ' + href);
            		    }
            		    $(this).parent().addClass("active").siblings().removeClass("active");
            			if ($(this).siblings("ul").is(":hidden")) {
            				$(this).siblings("ul").slideDown().parent().siblings().find(">ul").slideUp();
            			} else {
            				$(this).siblings("ul").slideUp().parent().removeClass("active");
            			}
            			if ($(this).siblings("ul").length) {
            				event.preventDefault();
            			}
            		});
            		
            		$(window).focus(function() {
                        objMarketBand.renderWidget();
                        objMarketBand.getBandData();
                    });
                },
                renderWidget: function(flipFlag) { 
                        var flipDuration = objMarketBand.flipFlag == 1 ? objMarketBand.flipDuration[1] : objMarketBand.flipDuration[2];
                
                        clearTimeout(objMarketBand.timeoutRef.renderWidget);
                        objMarketBand.timeoutRef.renderWidget = setTimeout(function () {
                            objMarketBand.renderWidget();
                        }, flipDuration);
                        
                    
                        
                        if($.fn.visible && $('.band').visible(true) && (document.hasFocus() || winActive == 1 || objMarketBand.forceLoad == 1)) {
                            objMarketBand.prepareWidget(1);
                            
                            var status = objMarketBand.bandData && 
                                         objMarketBand.bandData.common && 
                                         objMarketBand.bandData.common.currentMarketStatus || '';
                            
                            objMarketBand.prepareWidget(4);
                            objSchemeFlip.init();
                            objMarketBand.flipFlag = (objMarketBand.flipFlag + 1) % 2;
                        }
                    
                    
                },
                getBandData: function(cb) {
                    if((objMarketBand.activeGetData || cb) && ($('.band, .bm_wrapper').visible(true) && (document.hasFocus() || winActive == 1 || objMarketBand.forceLoad == 1)) || (typeof objVc != "undefined" && objVc.global_cube=="1")) {
                        // console.log('ajax getband data');
                        window['marketlivedata'] = function (response) {
                            if(response && response.marketBandList) {
                                $.each(response.marketBandList, function (k, v) {
                                    objMarketBand.bandData[v.sectionName] = v.bandServiceMetas;
                                });
                                objMarketBand.bandData['common'] = response.marketStatus;
                                if(response.marketStatus.currentMarketStatus == 'LIVE') {
                                    _mkt.isOpen = true;
                                }
                            }
                            if(typeof cb == 'function') {
                                cb();
                            }
                        }
                        $.ajax({
                            url: objMarketBand.service,
                            cache:true,
                            dataType:'script'
                        });
                        /*
                        $.ajax({
                            url: objMarketBand.service,
                            cache:true,
                            dataType:'jsonp',
                            jsonpCallback: 'marketlivedata',
                            jsonp: false,
                            success: function (response) {
                                if(response && response.marketBandList) {
                                    $.each(response.marketBandList, function (k, v) {
                                        objMarketBand.bandData[v.sectionName] = v.bandServiceMetas;
                                    });
                                    objMarketBand.bandData['common'] = response.marketStatus;
                                    if(response.marketStatus.currentMarketStatus == 'LIVE') {
                                        _mkt.isOpen = true;
                                    }
                                }
                                
                                if(typeof cb == 'function') {
                                    cb();
                                }
                            }
                        });
                        */
                    }
                    
                    clearTimeout(objMarketBand.timeoutRef.getBandData);
                    var hitTime = 12e3;
                    objMarketBand.timeoutRef.getBandData = setTimeout(function() {
                        objMarketBand.getBandData();
                    }, hitTime);
                },
                timer: function (seconds) {
                    if(seconds) {
                        var time = et.appendZero(parseInt(seconds / 60)) + ':' + et.appendZero(seconds % 60);
                        $('.mkt_o_clock > div').eq(0).text(time);
                        clearTimeout(objMarketBand.timeoutRef.timer);
                        objMarketBand.timeoutRef.timer = setTimeout(function () {
                            objMarketBand.timer(seconds - 1);
                        }, 1000);
                    } else {
                        objMarketBand.timerInprocess = 0;
                        objMarketBand.timerDone = 1;
                        objMarketBand.forceLoad = 1;
                        objMarketBand.getBandData(function () {
                            objMarketBand.renderWidget();
                            objMarketBand.forceLoad = 0;
                        });
                    }
                },
                prepareWidget: function(widgetIndex) {
                    var sectionName = 'S' + widgetIndex, boxElem = $('#' + sectionName + '_box'), dataIndex = boxElem.attr('data-index');
                    dataIndex = dataIndex ? dataIndex : 0;
                    if(objMarketBand.bandData[sectionName] && (boxElem.text() == '' || !$('#' + sectionName + '_box:hover').length || objMarketBand.forceLoad == 1)) {
                        
                        var widgetDataSet = objMarketBand.bandData[sectionName];
                        
                        var currItem = widgetDataSet[dataIndex]; 
                        if(currItem) {
                            dataIndex++;
                        } else {
                            currItem = widgetDataSet[0];
                            dataIndex = 1;
                        }
                        boxElem.attr('data-index', dataIndex);
                        
                        var widgetData = currItem;
                        
                        widgetData.widgetIndex = widgetIndex;
                        
                        widgetData.marketBandId = sectionName + '_box';
                        widgetData.itemLink = currItem.landingPageUrl;
                        
                        if(widgetIndex == 1) {
                            widgetData.widgetName = 'Benchmarks';
                            widgetData.title = currItem.serviceName;
                            widgetData.type = 'index';
                            if(widgetData.exchangeID == 50) {
                                widgetData.itemLink = '/markets/indices/nifty-50';
                            } else {
                                widgetData.itemLink = '/markets/indices/bse-sensex';
                            }
                        } else if (widgetIndex == 2) {
                            widgetData.widgetName = (currItem.exchangeID == 47 ? ' BSE' : ' NSE') + ' ' + currItem.serviceName + '-Large Cap';
                            widgetData.title = currItem.companyShortName;
                            widgetData.itemLink = currItem.companytype == 'equity' ? '/' + currItem.seoName + '/stocks/companyid-' + currItem.companyId + '.cms' : '/' + currItem.seoName + '/stocks/companyid-' + currItem.companyId + '.cms?companytype='+currItem.companytype.toLowerCase();
                            widgetData.type = 'company';
                            widgetData.chartData = currItem.technicalChartQuery;
                            
                        } else if (widgetIndex == 4) {
                            widgetData.title = currItem.serviceName;
                            if (currItem.serviceType == 'MCX') {
                                widgetData.widgetName = 'Precious Metal';
                                widgetData.type = 'commodity';
                                widgetData.title += " (" + currItem.serviceType + ") (Rs/10g.)";
                                if(currItem.symbol.toLowerCase() == 'gold') {widgetData.itemLink = '/commoditysummary/symbol-GOLD.cms';}
                            } else if(currItem.serviceType == 'FOREX') {
                                widgetData.type = 'forex';
                                widgetData.widgetName = 'Forex';
                            }
                        }
                        if($('#' + widgetData.marketBandId).length) {
                            objMarketBand.renderMarketBand(widgetData);
                        }
                    }
                },
                getChartLink: function (widgetData) {
                    var symbol = widgetData.scripCode ? widgetData.scripCode : widgetData.symbol;
                    var exchange = widgetData.exchangeID == 50 ? 'NSE' : 'BSE';
                    
                    var params = 'symbol=' + symbol + '&exchange=' + exchange + '&entity=' + widgetData.type + '&periodicity=1';
                    if(widgetData.type == 'commodity') {
                        params = 'symbol=' + symbol + '&entity=' + widgetData.type + '&periodicity=15';
                    } else if(widgetData.type == 'forex') {
                        params = 'entity=forex&createdby=Mecklai&pairnameparent=USD%2FINR&currencypairname=USD%2FINR&periodicity=15';
                    }
                    return '/markets/technical-charts?' + params;
                },
                renderMarketBand: function(widgetData) {
                    function emptyCheck(val) {return val ? val : ''}
                    
                    var bandHtml = '', toolTip = '', netChange = (emptyCheck(widgetData.netChange) && parseFloat(widgetData.netChange).toFixed(2));
                    var cls = netChange ? (netChange < 0 ? 'red' : 'green') : '',
                    status = objMarketBand && objMarketBand.bandData && objMarketBand.bandData.common && objMarketBand.bandData.common.currentMarketStatus && objMarketBand.bandData.common.currentMarketStatus != '' ? objMarketBand.bandData.common.currentMarketStatus : '';
                    status  = status && status != '' ? status.toLowerCase() : '';
                    if(objMarketBand.timerInprocess == 1) {
                        status = 'PRE MKT';
                    }
                    var liveIcon = widgetData.widgetIndex == 1 ? '<span class="status ' + status + '">' + status + '</span>' : '';
                    
                    
                    toolTip = '<div class="item_tooltip">' +
                              '<div class="tt_data"></div>' +
                              '<div  class="chart_link"><a target="_blank" href="' + objMarketBand.getChartLink(widgetData) + '">View Full Chart <span class="r_arrow"></span></a></div>' +
                              '</div>';
                              
                    bandHtml = '<div class="band-item">' +
            	        '<div class="band-content">' +
            	            '<div class="head"><a href="' + emptyCheck(widgetData.landingPageUrl) + '" target="_blank">'+ emptyCheck(widgetData.widgetName) +'</a>'  + liveIcon + '</div>' +
            	            '<div class="values">' +
            	                '<a class="wname" href="' + emptyCheck(widgetData.itemLink) + '" target="_blank" title="' + emptyCheck(widgetData.title) + '">'+ emptyCheck(widgetData.title) + '</a>' +
            	                '<span class="num">' + (emptyCheck(widgetData.current) && et.addCommas(parseFloat(widgetData.current).toFixed(2))) + '</span>' +
            	                '<span class="per cSprite_b ' + cls +'">'+ netChange +'</span>' +
            	            '</div>' +
            	        '</div>' +
                    '</div>';
                    
                    var elem = $('#' + widgetData.marketBandId), curIndex = elem.attr('data-index');
                    
                    // for qa automation only
                    elem.attr('data-item_' + curIndex, widgetData.title + ' ~ ' + widgetData.current);
                    // for qa automation only
                    
                    elem.append(bandHtml);
                    var bandItem = $('#' + widgetData.marketBandId + ' .band-item');
                    
                    var bd = objMarketBand.bandData;
                    var marketLiveFlag = bd.common && bd.common.currentMarketStatus == 'LIVE' ? 1 : 0;
                    
                    
                    bandItem.eq(1).finish().animate({top: -1 * (bandItem.height())}, 'slow', function () {
                        bandItem.eq(1).css({top: 0}).siblings().remove();
                    });
                },
                processData: function (data) {
                    var dataArray = [];
                    if(data && data.query && data.query.results && data.query.results.quote) {
                        $.each(data.query.results.quote, function (i, v) {
                            var val = v.Adj_Close || v.adj_Close;
                            if(val) {
                                val = parseFloat(val);
                                var dt = new Date((v.date || v.Date).replace(/-/g, '/')).getTime();
                                if(!dt) {
                                    console.log('date error ', v.date);
                                }
                                dataArray.push([dt, val]);
                            }
                        });
                    }
                    return dataArray.reverse();
                }
            }
            // End Of Market Band 
            
            /* Market Band MF_scheme flip logic*/
            objSchemeFlip = {
                rot_scheme_time: null,
                flipFlag: 1, 
                animateCss : function(){
                    try{
                        $.fn.extend({
                            animateCss: function (animationName, callback) {
                                var animationEnd = (function (el) {
                                    var animations = {
                                        animation: 'animationend',
                                        OAnimation: 'oAnimationEnd',
                                        MozAnimation: 'mozAnimationEnd',
                                        WebkitAnimation: 'webkitAnimationEnd',
                                    };
            
                                    for (var t in animations) {
                                        if (el.style[t] !== undefined) {
                                            return animations[t];
                                        }
                                    }
                                })(document.createElement('div'));
            
                                this.addClass('animated ' + animationName).one(animationEnd, function () {
                                    $(this).removeClass('animated ' + animationName);
            
                                    if (typeof callback === 'function') callback();
                                });
            
                                return this;
                            },
                        });
                    }catch(e){
                        console.log("Error : "+ e);
                    } 
                },
                scheme_rot: function () {
                    try {
                        var s5len = $('#S5_box a').length;
                        if ($('#S5_box:hover').length != 1 && s5len > 1) {
                            $('#S5_box').finish().animate({'top': '-35px'}, 'slow', function(){
                                $('#S5_box a').eq(0).insertAfter($('#S5_box a').eq(s5len - 1));
                                $('#S5_box').css('top', '0');
                            });
                        }
                    } catch (e) {
                        console.log("Buy Direct scheme rotation fn :" + e)
                    }
                }, 
                init: function() {
                    // this.animateCss();
                    setTimeout(function(){
                         objSchemeFlip.scheme_rot();
                    }, 5000)
                   
                }
            };
            
            //Load Other JS
            loadModule = (function (paramObj) {
                var loadedModules = [];
                return function (paramObj) {
                    var callback = typeof paramObj.callback == 'function' && paramObj.callback || function () {}
                    var refName = paramObj.ref || '-';
                    var skipPopup = $('.skip_popup').length || objVc.skipPopup == 1;
                    if(paramObj.type == 'popup' && skipPopup) {
                        callback({error: 'popup skipped'})
                        _log('Module skipped: type popup', paramObj);
                    } else if($('.skip_'+refName).length || objVc['skip'+refName] == 1) {
                        callback({error: 'module skipped'})
                        _log('Module skipped:', $('.skip_'+refName).length, objVc['skip'+refName]);
                    } else if(loadedModules.indexOf(paramObj.module_name) == -1) {
                        loadedModules.push(paramObj.module_name);
                        var m = objCommon.isLive ? 1 : 0;
                        var v = paramObj.v ? paramObj.v : (typeof jscommon_v != 'undefined' && jscommon_v ? jscommon_v  : 1);
                        if(typeof objVc != 'undefined' && objVc[paramObj.module_name]) {
                            v = objVc[paramObj.module_name];
                        }
                        var domain = paramObj.domain ? paramObj.domain : (objCommon.isPP ? '' : objCommon.isLive ? objDomain.js : '')
                        var src = domain + '/' + paramObj.module_name + '/v-' + v + ',minify-' + m + '.cms';
                        var script = document.createElement('script');
                        script.onload = callback;
                        script.src = src;
                        document.head.appendChild(script);
                        _log('Module Loaded: ', paramObj);
                    } else {
                        _log('Module Already Loaded', paramObj);
                        callback();
                    }
                }
            })();
            
            if (window.modulesList) {
                modulesList.forEach(function (module, i) {
                    loadModule(module);
                });
            }
            
            //User Related
            function signOut() {
                objUser.logOut();
            }
            
            objUser = {
                info: ($.jStorage.get('userInfo') ? $.jStorage.get('userInfo') : {}),
                channel:'et',
                mode:'web',
                testInterval: 0,
                subscriptionProfile: {},
                init: function () {
                    var loginFlag = 0;
                    if(objUser.info.ssoid && ($.cookie('ssoid') || $.cookie('tksec'))) {
                        if(typeof skipTPDataDefault == 'undefined' || skipTPDataDefault != 1) {
                            objUser.setTpData();
                        }
                        objUser.loadSsoApi(objUser.verifyLogin);
                        loginFlag = 1;
                    } else {
                        objUser.loadSsoApi(objUser.verifyLogin);
                    }
                    
                    objUser.afterLoginCall(function () {
                        if(_tp_data.isLogged) {
                            objUser.isPrimeUser();
                            if(window.allowGdpr == 0 && (objUser.info.shareDataAllowed == "n" || objUser.info.termsAccepted == "n")) {
                                objUser.ssoConsent();
                            }
                        } else {
                            objUser.afterPrimeCheckProcess();
                        }
                        /*if(typeof tpName!="undefined" && !(tpName == "livetvnew" || tpName == "bgtvplayer" || tpName == "slideshow_v1" || tpName == "basetemplateangularjs" || tpName == "nogacall" || tpName == "articleshow_gcm" || tpName == "ifsccode" || tpName == "stocks" || tpName == "slideshow")){
                            loadModule({module_name: 'js_socialdatacapture_min'});
                        }*/
                    })
                    objUser.afterPrimeCheckCall(function () {
                        objUser.activeDayEvent();
                    })
                },
                ssoLoginWidgetSdk: function(){
                    var ssoWidgetSdk = objVc.sso_loginwidget;
                    if(typeof ssoWidgetSdk == 'undefined') {
                        ssoWidgetSdk = (objCommon.isLive ? 'https://jssocdn.indiatimes.com/crosswalk/40/widget/main.bundle.min.js' : 'https://jssocdnstg.indiatimes.com/crosswalk/155/widget/main.bundle.js');
                    }
                    return ssoWidgetSdk;
                },
                ssoLoginWidget: function(){
                    var scriptExists = !!document.querySelector('script#ssologinwidget');
                    if(!scriptExists) {
                        (function(w,s,el){
                            var sc = document.createElement("script");
                            w[el]= w[el] || function(){
                                w[el]=w[el] || {};
                                w[el].ev=w[el].ev || [];
                                w[el].ev.push(arguments)
                            }
                            sc.type = "text/javascript";
                            sc.id = "ssologinwidget";
                            sc.onload = objUser.loadSSOWidget();
                            sc.defer=1;
                            sc.src = s;
                            document.getElementsByTagName("head")[0].appendChild(sc);
                        })(window, objUser.ssoLoginWidgetSdk(),"ssoWidget")
                    } else {
                        objUser.loadSSOWidget();
                    }
                    
                },
                initSSOWidget: function() {
                    objUser.ssoLoginWidget();
                },
                loadSSOWidget: function() {
                    var centralSSOObj = {
                        channelName: 'et',
                        element: "ssoLogin",
                        resendOtpTimer: 160,
                        channelLogo: "https://economictimes.indiatimes.com/photo/103927173.cms",
                        recaptcha: {
                            required: false
                        },
                        closeIcon: !0,
                        defaultSelected: !0,
                        socialLoginRu: (window.location.protocol + '//' + window.location.host + '/login_code.cms'),
                        nonSocialLogin: {
                            loginVia: ["email","mobile"],
                            loginWith: ["Password", "otp"]
                        },
                        socialLogin: [
                            {
                               	type:"Google",
                               	logoUrl:"",
                               	label:"",
                               	clientId: "936221589938.apps.googleusercontent.com"
                           },
                           {
                               	type:"Facebook",
                               	label:"",
                               	logoUrl:"",
                               	clientId:"424450167700259"
                           },
                           {
                   				type:"Apple",
                   				clientId:'com.economictimes.login'
                   			}
               			],
                        gaChannelName: 'et',
                        last_clicked_lob: 'ET',
                        signInCallback: function(){
                            localStorage.setItem("primeUserLoginMap_check", "1");
                            objUser.verifyLogin();
                            setTimeout(function(){
                                $(".ssoLoginWrap").addClass("hide");
                                $("#ssoLogin").empty();
            					window.location.reload();
            				}, 100);
                        },
                        signupForm:{
                            defaultFirstName: "Guest",
                            signUpFields: {
                                "Email": {
                                    placeholder: "enter email",
                                    required: true
                                },
                                "MobileNumber": {
                                    placeholder: "enter mobile number",
                                    required: true
                                },
                                "firstName": {
                                    placeholder: "enter first name",
                                    required: true
                                }
                            },
                            signupVia: ["Password"],
                            MandatoryVerifyVia: ["emailormobile"],
                        },
                        termsConditionLink: '/terms-conditions',
                        privacyPolicyLink: '/privacypolicy.cms',
                        defaultSelected:true,
                        closeCallBack: function(){
                            console.log('Central SSO closeCallBack');
                            $('body').removeClass('bodydisable');
                            $(".ssoLoginWrap").addClass("hide");
                            $("#ssoLogin").html('');
                        }
                    };
                    
                    if($('#ssoLogin').length == 0) {
                        var ssoLoginHtml = '<div class="ssoLoginWrap" style="position: fixed;top: 0;left: 0;right: 0;bottom: 0;z-index: 99999;background-color: rgba(0,0,0,.8);overflow: auto;">\
                                <div id="ssoLogin" class="ssoLoginElm" style="position: relative;top: 25px;bottom: 0;left: 0;right: 0;margin: auto;display: flex;justify-content: center;overflow: auto;999999" />\
                            </div>';
                        $('body').append(ssoLoginHtml)
                    } else {
                        $(".ssoLoginWrap").removeClass("hide"); 
                        $('body').addClass('bodydisable');
                    }
                    
                    ssoWidget("init",centralSSOObj);
                    grxEvent("cdp_event", {event_nature: "click", event_category: 'direct_login', event_name: "login_page_loaded"});
                },
                activeDayEvent: function () {
                    var checkFlag = $.jStorage.get('et_activeDayEvent');
                    var currentDate = dateFormat(new Date(), '%d-%M-%Y');
                    if(checkFlag != currentDate) {
                        grxEvent('event', {'event_category': 'Active Day', 'event_action': '1', 'event_label': window.location.href});
                        $.jStorage.set('et_activeDayEvent', currentDate);
                    }
                },
                login: function (identifier, ru, type) {
                    $.jStorage.deleteKey('userlogin_ru');
                    identifier = identifier ? identifier : 'Top';
                    type = type ? type : 'Sign in button';
                    // if(objGdpr.allow()) {
                        if(window.location.port == '') {
                            ga('send', 'event', 'ET Login', type, identifier + ' - ' + window.location.href);
                        }
                        if(ru) {
                            $.jStorage.set('userlogin_ru', ru);
                        }
                        if(identifier === "Top") {
                            $.jStorage.set('directLogin', true);
                        }
                        $.jStorage.set('userlogin_galabel', identifier);
                        objUser.initSSOWidget();
                        //var dom = window.localStorage && (localStorage.getItem('et_dev_livesso') || localStorage.getItem('et_dev_pp')) && 'https://economictimes.indiatimes.com' || '';
                        //window.location.href = dom + '/login.cms';
                    // }
                },
                loadSsoApi: function (callback) {
                    callback = callback ? callback : function () {};
                    if($('script[src*="jsso_crosswalk"]').length == 0) {
                        
                        var crossWalkApi = objDomain.et +"/js_feed/jsso_crosswalk_legacy_min.cms?v=13";
                        if(!objCommon.isLive) {
                        	crossWalkApi = "https://jssocdnstg.indiatimes.com/crosswalk_sdk/sdk/jsso_crosswalk_legacy_0.7.9.min.js"
                        }
                        var script = document.createElement('script');
                        script.onload = callback;
                        script.onerror = callback;
                        
                        script.src = crossWalkApi;
                        document.head.appendChild(script);
                    } else {
                        callback();
                    }
                },
                verifyLogin: function () {
                    try {
                        var loginFailFlag = 0;
                        var jsso = new JssoCrosswalk(objUser.channel, objUser.mode);
                        jsso.getValidLoggedInUser(function (response) {
                            if(response.status == 'SUCCESS') {
                                if(response.data.ticketId == objUser.info.ticketId) {
                                    objUser.loginProcess('success');
                                    objUser.afterLoginProcess();
                                } else {
                                    objUser.setUserData(response);
                                }
                            } else {
                                if(!loginFailFlag) {
                                    loginFailFlag = 1;
                                    objUser.loginProcess('fail');
                                    $('.signInLink').fadeIn();
                                    $('.header .subScribe').show();
                                    objUser.afterLoginProcess();
                                    window.localStorage && localStorage.removeItem('et_logintype');
                                    if(sessionStorage.getItem("openLogin_popup") == 'true') {
                                        objUser.ssoLoginWidget();
                                        sessionStorage.removeItem("openLogin_popup");
                                    }
                                }
                            }
                        });
                    } catch(e){
                        objUser.afterLoginProcess();
                    }
                },
                verifyOldLogin: function () {
                    var jsso = new JssoCrosswalk(objUser.channel, objUser.mode);
                    // validate url token id will come in this request
                    jsso.getValidLoggedInUser(function (response) {
                        if(response.status == 'SUCCESS') {
                            objUser.setUserData(response);
                        } else {
                            objUser.loginProcess('fail');
                            $('.signInLink').fadeIn();
                            $('.header .subScribe').show();
                            objUser.afterLoginProcess();
                        }
                    });
                },
                setUserData: function (response) {
                    var jsso = new JssoCrosswalk(objUser.channel, objUser.mode);
                    jsso.getUserDetails(function (responseDetails) {
                        if(responseDetails.status == 'SUCCESS') {
                            
                            var data = responseDetails.data;
                            var email = data.primaryEmail ? data.primaryEmail : (isNaN(response.data.identifier) ? response.data.identifier : '');
                            var mobile = data.mobileData && data.mobileData.Verified && data.mobileData.Verified.mobile && (data.mobileData.Verified.code  + '-' + data.mobileData.Verified.mobile) || '';
                            var emailIdStatus = data.emailList && data.emailList[email];
                            
                            _log('responseDetails', data);
                            var userInfo = {
                                isLogged: true,
                                email: email,
                                emailIdStatus: emailIdStatus,
                                mobile: mobile,
                                ssoid:data.ssoid,
                                ssouid:data.ssoid,
                                city:data.city ? data.city : '',
                                fname: data.firstName,
                                fullName: (data.firstName + (data.lastName ? ' ' + data.lastName : '')),
                                ticketId: response.data.ticketId,
                                identifier: response.data.identifier,
                                shareDataAllowed: data.shareDataAllowed,
                                termsAccepted: data.termsAccepted,
                                createdDate: data.createdDate,
                                tpName: window.tpName || '-',
                                loginTime: new Date().toString()
                            };
                            $.jStorage.set('userInfo', userInfo);
                            if(!$.cookie("ssoid")) {
                                $.cookie("ssoid", data.ssoid);
                            }
                            objUser.info = userInfo;
                            objUser.loginProcess('success');
                            objUser.afterLoginProcess();
                        } else {
                            objUser.loginProcess('fail');
                            $('.signInLink').fadeIn();
                            $('.header .subScribe').show();
                            objUser.afterLoginProcess();
                        }
            
                    });
                },
                loginProcess: function (type) {
                    $('.subSign a.subScribe').attr('href', 'javascript://');
                    $('.subSign a.subScribe').click(function(e){
                        e.preventDefault();
                        goToPlan({
                            dim49: 'ATF', 
                            cdp: true, 
                            ctaText: "Subscribe",
	                        item_category4: "Subscribe",
	                        item_category: "atf_offer_cta", 
	                        item_brand: "product_interventions",
	                        item_id: "atf",
	                        item_name: "atf_"+tpName, 
	                        item_category2: window.secname, 
	                        item_category3: "atf_cta"
                        });
                    })
                    _log('user login', type);
                    if(type == 'success') {
                        objUser.setTpData();
                        objUser.setLoginBar();
                        if(!$.cookie('TicketId')) {
                            $.cookie('TicketId', objUser.info.ticketId, {domain:'.indiatimes.com', path: '/'});
                        }
                    } else {
                        _tp_data['isLogged'] = false;
                        _tp_data['email'] = "";
                        _tp_data['ssoid'] = "";
                        _tp_data['ssouid'] = "";
                        $.jStorage.deleteKey('userInfo');
                        // objAdFreeExp.pGatewayDroppedUsers();
                    }
                    $('.header .subSign').css('opacity', 1);
                    //objUser.TPWidgetLoad();
                },
                setTpData: function () {
                    _tp_data = typeof _tp_data != 'undefined' ? _tp_data : {};
                    jQuery.extend(_tp_data, objUser.info);
                    _tp_data['isLogged'] = true;
                    var subPro = $.jStorage.get('et_subscription_profile');
                    if(subPro) {
                        objUser.subscriptionProfile = subPro;
                    }
                    typeof objMonetize!="undefined" && typeof objMonetize.sendDataToDMP != "undefined" && objMonetize.sendDataToDMP("personaldata", [_tp_data]);
                    typeof objMonetize!="undefined" && typeof objMonetize.sendDataToDMP != "undefined" && typeof objUser != "undefined" && objMonetize.sendDataToDMP("subscriptionProfile", [objUser.subscriptionProfile]);
                },
                afterLoginStack: [],
                afterLoginCall:function(cb) {
                    if(typeof cb == 'function') {
                        objUser.afterLoginStack.push(cb);
                         if(objUser.afterLoginProcessDone == 1) {
                            cb();
                        }
                    }
                },
                afterLoginProcessDone:0,
                afterLoginProcess: function () {
                    clearTimeout(objUser.testInterval);
                    objUser.afterLoginProcessDone = 1;
                    $.each(objUser.afterLoginStack, function (i, afterLoginCB) {
                        if(typeof afterLoginCB == 'function') {
                            afterLoginCB();
                        }
                    });
                },
                isPrimeUser: function() {
                    _log('isPrime');
                    var tId = objUser.info.ticketId; 
                    
                    var checkPrime = $.jStorage.get('prime_' + tId), docRef = document.referrer, 
                        refreshFlag = window.localStorage && localStorage.getItem("etsub_refreshTokenFlag"),
                        isTokenDataExist = $.jStorage.get('tokenDataExist'),
                        otrCookieExist = $.cookie('OTR');
                        
                    if(docRef.indexOf('/plans_success') > -1 || docRef.indexOf('?transcode') > -1 || docRef.indexOf('buy.indiatimes.com/') > -1 || 
                        refreshFlag == 'true' || getParameterByName('fromsrc') == 'etprime' || !otrCookieExist ||
                        !checkPrime || !checkPrime.permissions || checkPrime.permissions.length == 0) {
            		    objUser.primeCheckReq(objUser.afterPrimeCheckProcess, 'refresh_token');
            		    localStorage.removeItem("etsub_refreshTokenFlag");
            		    $.jStorage.deleteKey('et_profilelog'); // to reinitiate grx profile log
                    } else if(!!checkPrime && !!checkPrime.tId) {
                        if(checkPrime.tId == tId) {
                            if($.inArray("subscribed", checkPrime.permissions) > -1) {
                                _tp_data['isPrime'] = true;
                            } 
                            if($.inArray("etadfree_subscribed", checkPrime.permissions) > -1) {
                                _tp_data['isAdfree'] = true; 
                            }
                            _tp_data['permissions'] = checkPrime.permissions ? checkPrime.permissions : [];
                            _tp_data['accessibleFeatures'] = checkPrime.accessibleFeatures ? checkPrime.accessibleFeatures : [];
                            _tp_data['subscriptionDetails'] = checkPrime.subscriptionDetails ? checkPrime.subscriptionDetails : [];
                        }
                        objUser.afterPrimeCheckProcess();
                        if(!isTokenDataExist) {
                            objUser.primeCheckReq(objUser.afterPrimeCheckProcess);
                        }
                    } else {
                        if(!isTokenDataExist) {
                            objUser.primeCheckReq(objUser.afterPrimeCheckProcess);
                        }
                    }
                },
                primeCheckReq: function (cb, grantToken) {
                    var localCb = function (error, data) {
                        if(error) {
                            objUser.primeCheckReq2(cb);
                        } else {
                            if(typeof cb == 'function') {
                                cb(data);
                            }
                        }
                    }

                    /*
                        objUser.primeCheckReq function is used to check users permission for prime any plan subscriptions
                        Pass token only if grant_type needs to get refresh
                    */
                    
                    var baseEP = window.location.host.indexOf('-pp') != -1 ? 'oauth-pp' : objCommon.isLive ? 'oauth2' : 'qa-oauth';
                    var oauthApi = 'https://' + (objCommon.isLive ? 'oauth2' : 'qa-oauth') + '.economictimes.indiatimes.com/oauth/api/merchant/ET/token?ref=desktop',
                        clientId = objCommon.isLive ? 'b2a8e883ec676f417520f422068a4742' : 'w2a8e883ec676f417520f422068a4741';
                        
                    var xhr = new XMLHttpRequest();
                    var ticketId = _tp_data.ticketId || $.cookie('TicketId'), deviceId = $.cookie('_grx');
                    var params = JSON.stringify({grantType: 'refresh_token', "ticketId": ticketId, "deviceDetail": objCommon.getDeviceName(),"allMerchant" : true});
                    xhr.open('POST', oauthApi);
                    xhr.responseType = 'json';
                    xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
                    xhr.setRequestHeader('x-client-id', clientId);
                    xhr.setRequestHeader('x-device-id', deviceId);
                    xhr.setRequestHeader('x-sso-id', _tp_data.ssoid);
                    xhr.setRequestHeader('x-site-app-code', window.objVc && objVc.xAppCode);

                    xhr.withCredentials = true;
                    //xhr.timeout = objCommon.isLive ? 5000 : 20000;
                    function onError(e) {
                        try {
                            saveLogs({'type': 'refresh_token', origin: 'primeCheckReq', 'api_response': e, 'data': 'primeCheckReq Service Error - ' + oauthApi, 'error': e.message, email: _tp_data.email, ssoid: _tp_data.ssoid});
                        } catch(t_error) {}
                        
                        localCb('onerror', {'error': 'Ajax error function triggered'});
                    }
                    xhr.error = onError;
                    xhr.addEventListener('error', onError);
                    xhr.ontimeout = function (e) {
                        try {
                            saveLogs({'type': 'refresh_token', origin: 'primeCheckReq', 'api_response': e, 'data': 'primeCheckReq Service Timeout Error - ' + oauthApi, 'error': e.message, email: _tp_data.email, ssoid: _tp_data.ssoid});
                        } catch(t_error) {}
                        
                        localCb('timeout', {'error': 'Ajax ontimeout function triggered'});
                    };
                    
                    xhr.onload = function() {
                    	if (xhr.status === 200 && xhr.response && xhr.response.code !== "400") {
                    	    var thresholdLimit = xhr.response.thresholdBreach || getParameterByName('thresholdLimit');
                    	    var isOTPFlowPassed = $.jStorage.get('isOTPFlowPassed');
                    	    var isSubscribed = xhr.response.data.isSubscribed;
                    	    var isTCPage = window.location.pathname.includes('terms-conditions');

                            if(thresholdLimit && isSubscribed && !isOTPFlowPassed && !isTCPage) {
                                loadModule({module_name: 'js_concurrentloginflow', v: 1,});
                            } else {
                        	    $.jStorage.deleteKey('etbenefits_data'); // to reinitiate vouchers data
                        	    console.log('xhr.response', typeof xhr.response, xhr.response);
                        	    $.jStorage.set('prime_' + _tp_data.ticketId, xhr.response && xhr.response.data || {}, {TTL: 2*60*60*1000});
                        	    objUser.primeCheckSuccess(xhr.response);
                        	    
                        	    saveLogs({'type': 'refresh_token', 'api_response': xhr.response, 'OTR': $.cookie('OTR'), origin: 'primeCheckReq - ' + oauthApi + '#' + objVc.lib_login});
                            }
                            
                            var isSubscribed = xhr.response && xhr.response.data && xhr.response.data && xhr.response.data.isSubscribed || 0;
                            $.jStorage.set('tokenDataExist', 1, {TTL: isSubscribed ? 2*60*60*1000 : 5*60*1000});
            			} else {
            			    saveLogs({'type': 'refresh_token', status: xhr.status, 'api_response': xhr.response, 'OTR': $.cookie('OTR'), origin: 'primeCheckReq - ' + oauthApi + '#' + objVc.lib_login});
            			    objUser.primeCheckSuccess();
            			}
                    	localCb(null, xhr.response);
                    };
                    xhr.send(params);
                },
                primeCheckReq2: function (cb) {
                    var baseEP = window.location.host.indexOf('-pp') != -1 ? 'oauth-pp' : objCommon.isLive ? 'oauth2' : 'qa-oauth';
                    var oauthUrl = 'https://' + (objCommon.isLive ? 'oauth2' : 'qa-oauth') + '.economictimes.indiatimes.com/oauth/api/merchant/ET/token?wh=1',
                        clientId = objCommon.isLive ? 'b2a8e883ec676f417520f422068a4742' : 'w2a8e883ec676f417520f422068a4741',
                        deviceId = $.cookie('_grx');

                        var ticketId = _tp_data.ticketId || $.cookie('TicketId');
                        var dataObj = JSON.stringify({grantType: 'refresh_token', "ticketId": ticketId, "deviceDetail": objCommon.getDeviceName(), "allMerchant" : true});
                        var headers = {'Content-Type': 'application/json;charset=UTF-8', 'x-client-id': clientId, 'x-device-id': deviceId, 'x-site-app-code': window.objVc && objVc.xAppCode, 'x-sso-id': _tp_data.ssoid}

                        $.ajax({
                            url: oauthUrl,
                            method: 'POST',
                            headers:headers,
                            data: dataObj,
                            success: function (data) {
                                console.log('success', data);
                            },
                            error: function (error) {
                                console.log('error', error);
                                saveLogs({'type': 'refresh_token with header error - primeCheckReq2', 'data': 'Service Error - ' + oauthUrl, 'error': error, email: _tp_data.email, ssoid: _tp_data.ssoid, headers: headers, reqBody: dataObj});
                            },
                            complete: function (responseData) {
                                var data = responseData.responseJSON || {};
                                saveLogs({'type': 'refresh_token with header', 'api_response': responseData, 'api': oauthUrl +'#'+objVc.lib_login, 'headers':headers});
                                if (data.code == 200) {
                            	    $.jStorage.deleteKey('etbenefits_data'); // to reinitiate vouchers data
                            	    var cookieConfig = {
                            			expires:  new Date(new Date().getTime() + (30 * 24 * 60 * 60 * 1000)),
                            			path: '/',
                            			domain: '.indiatimes.com'
                            		}
                            		if(data && data.data && data.data.token) {
                                        $.cookie("OTR", data.data.token, cookieConfig);
                            		}
                            	    objUser.primeCheckSuccess(data);
                    			} else {
                    			    saveLogs({'type': 'refresh_token', status: data.code, 'api_response': data, 'OTR': $.cookie('OTR'), origin: 'primeCheckReq2', url: objVc.lib_login, headers: headers, reqBody: dataObj});
                    			    objUser.primeCheckSuccess();
                    			}
                                if(typeof cb == 'function') {
                                    cb(data);
                                }
                            }
                        })
                },
                primeCheckSuccess: function(res) {
                    try{
                        console.log('res',res);
                        var primeFlag = 'nonPrime', tId = objUser.info.ticketId;
                        if (!!res) {
                            primeFlag = res.data;
                            primeFlag['tId'] = tId;
                            if($.inArray("subscribed", primeFlag.permissions) > -1) {
                                _tp_data['isPrime'] = true;
                            }
                            
                            var isPrime = primeFlag && primeFlag.permissions && primeFlag.permissions.indexOf('subscribed') != -1;
                            var primeUserLoginMap_check = localStorage.getItem("primeUserLoginMap_check");
                    	    if(primeUserLoginMap_check == 1){
                    	        objPLoginMap.userMappingData(primeFlag, isPrime);
                    	        objAdFreeExp.adFreeElgibilty(primeFlag);
                    	        localStorage.removeItem("primeUserLoginMap_check");
                    	    }
                            
                            if($.inArray("etadfree_subscribed", primeFlag.permissions) > -1) {
                                _tp_data['isAdfree'] = true; 
                            }
                            _tp_data['permissions'] = primeFlag.permissions;
                            _tp_data['accessibleFeatures'] = primeFlag.accessibleFeatures;
                        }
                        $.jStorage.set('prime_' + tId, primeFlag, {TTL: 2*60*60*1000});
                    }catch(e){
                        console.log("Error - "+ e);
                    }
                },
                afterPrimeStack: [],
                afterPrimeCheckDone: 0,
                afterPrimeCheckCall: function(cb) {
                    if(typeof cb == 'function') {
                        objUser.afterPrimeStack.push(cb);
                         if(objUser.afterPrimeCheckDone == 1) {
                            cb();
                        }
                    }
                },
                afterPrimeCheckProcess: function () {
                    objUser.afterPrimeCheckDone = 1;
                    if(objUser.afterPrimeStack.length) {
                        $.each(objUser.afterPrimeStack, function (i, afterPrimeCB) {
                            if(typeof afterPrimeCB == 'function') {
                                afterPrimeCB();
                            }
                        });
                    }
                },
                logOut: function (url) {
                    if(objCommon.isLive) {
                        ga('send', 'event', 'SignOut', window.location.href);
                        grxEvent('event', {'event_category': 'User', 'event_action': 'SignOut', 'event_label': window.location.href});
                    }
                    grxEvent('cdp_event', {'event_category': 'log_out', 'event_name': 'log_out', 'event_nature': 'click'});
                    try {
                        var currentDate = new Date();
                        var a = new Date();
                        currentDate.addDays(1);
                        var b  = new Date(currentDate.toDateString());
                        var pendingTo12Pm = (b.getTime() - a.getTime());
                        //  current date 12 PM.
                        $.jStorage.set('c_oneTapLogin', 1, {TTL: pendingTo12Pm});

                        window.google && google.accounts && google.accounts.id && google.accounts.id.disableAutoSelect && google.accounts.id.disableAutoSelect();
                    } catch (e) {}
                    var tId = $.cookie('TicketId') || _tp_data.ticketId;

                    window.localStorage && localStorage.removeItem('et_logintype');
                    $.jStorage.deleteKey('et_profilelog'); // to reinitiate grx profile log
                    $.jStorage.deleteKey('et_subscription_profile');
                    $.jStorage.deleteKey('et_member_data');
                    $.jStorage.deleteKey('accessPassData');
                    $.jStorage.deleteKey('userAcquisitionCode');
                    $.jStorage.deleteKey('tokenDataExist');
                    $.jStorage.deleteKey('etbenefits_data'); // to reinitiate vouchers data
                    sessionStorage.removeItem("buy_customDimension");
                    sessionStorage.removeItem("epaper_customDimension");
                    sessionStorage.removeItem("grxMapping");
                    sessionStorage.removeItem("loginEventCheck");
                    sessionStorage.removeItem("grxUserData");
                    sessionStorage.removeItem("updateGAEvents");
                    sessionStorage.removeItem("updateCSEvents");
                    sessionStorage.removeItem("ga4Obj");
                    sessionStorage.removeItem("ga4LoginData");
                    sessionStorage.removeItem("et_plans_selectedPlan");
                    localStorage.removeItem("planparams");
                    objUser.loadSsoApi(function () {
                        var jsso = new JssoCrosswalk(objUser.channel, objUser.mode);
                        jsso.signOutUser(function (response) {
                            if(response.status) {
                                localStorage.removeItem('et_logintype');
                                $.jStorage.deleteKey('userInfo');
                                objUser.removeCookies();
                                
                                try {
                                    var arrKeys = $.jStorage.index().filter(function (i) {return i.indexOf('prime_') == -1 ? 0 : 1});
                                    arrKeys.forEach(function (key, i) {
                                        $.jStorage.deleteKey(key);
                                    });
                                    var lsKeys = Object.keys(localStorage).filter(function (i) {return i.indexOf('et_user') == -1 ? 0 : 1})
                                    lsKeys.forEach(function (key, i) {
                                        localStorage.removeItem(key);
                                    });
                                } catch (e) {}
                                var clientId = objCommon.isLive ? 'b2a8e883ec676f417520f422068a4742' : 'w2a8e883ec676f417520f422068a4741',
                                deviceId = $.cookie('_grx'),
                                params = JSON.stringify({ticketId: tId});
                                $.ajax({
                                    url:'https://' + objVc.oauth + '.economictimes.indiatimes.com/oauth/api/merchant/ET/token/logout',
                                    headers: {          
                                        Accept: "application/json",
                                        'X-CLIENT-ID': clientId,
                                        'X-DEVICE-ID': deviceId,
                                        'x-sso-id': _tp_data.ssoid
                                    },
                                    data: params,
                                    contentType: 'application/json; charset=UTF-8;',
                                    method:'POST',
                                    timeout: 2000,
                                    complete: function () {
                                        if (url && url.indexOf('login.cms') !== -1) {
                                            sessionStorage.setItem("openLogin_popup",true);
                                            window.location.reload();
                                        } else {
                                            document.location.href = url ? url : document.location.href;  
                                        }
                                    }
                                });
                            } else {
                                objUser.loginProcess('fail');
                            }
                        });
                    });
                },
                setLoginBar: function () {
                    var userDetails = objUser.info;
                    var ssoid = userDetails.ssoid ? userDetails.ssoid : '';
                    if(ssoid) {
                       var jssoDomain = objCommon.isLive == 0 ? 'jssostg' : 'jsso';
                        $('.signInOut').html('<span class="dd" title="' + (_tp_data.email || '') + '">'+ _tp_data.fname +'</span><div class="signMenu"/>').removeClass('signIn').addClass('signOut');
                        var mysubscription = 'https://'+(objCommon.isLive ? 'buy' : 'dev-buy')+'.indiatimes.com/ET/mysubscription';
                        var primePref = '<a href="/prime_preferences.cms" rel="nofollow" target="_blank" class="mypref cSprite_b">My Preferences</a>';
                        var watchlist = '<a href="/marketstats/pageno-1,pid-501.cms" target="_blank" class="wthlist cSprite_b">My Watchlist</a>';
                        var streamlist = '<a href="" target="_blank" class="cSprite_b streamIcon jsStreamIcon hide"></a>';
                        var referEarn = '<a data-ga-onclick="Referral Discovery#click#prime_dropdown_menu" href="/referrals" rel="nofollow" target="_blank" class="refer cSprite_b">Refer & Earn <img src="'+ objDomain.img +'/photo/107514300.cms" width="36" height="17" class="new_badge" alt="New Feature" /></a>';
                            
                            if ($('.mercuryHeader').length) {
                                    $('.signInOut').html('<div class="userProfile freeUserDetails"><img width="34" height="34" class="thumbImg" src="https://mytimes.indiatimes.com/image/thumb/0/default"></div><div class="userProfile primeUserDeatils" style="display:none;"><i class="navIcon primeLogo userPrime"></i><div class="userDeatils"><p class="userPrime">ETPrime Member</p><p class="userName">'+ _tp_data.fullName +'</p></div><i class="navIcon dropDown"></i></div><div class="signMenu"/>').removeClass('signIn').addClass('signOut');
                            $('.signInOut .signMenu').html('<div class="outer_container"><div class="userDetails"><span class="userName">Hi, '+ _tp_data.fname +'</span><div class="primeIconafter" style="display:none;"><img width="72" src="https://img.etimg.com/photo/105086027.cms"></div></div><p class="userId">'+_tp_data.email+'</p><div class="bgWhite"><a href="/userprofile.cms" target="_blank" class="edit cSprite_b profileTab" onclick="objUser.resetInfo()">Edit Profile<span class="incomplete_badge hidden">INCOMPLETE<span>!</span></span></a>' + streamlist + '<a href="' + mysubscription + '?fornav=1" rel="nofollow" target="_blank" class="subscribe cSprite_b">My Subscriptions</a>' + primePref + '<a href="/et_benefits.cms" target="_blank" class="etBenefits cSprite_b">Redeem Benefits</a><a href="/subscription" target="_blank" class="newsltr cSprite_b">Manage Newsletters</a>' + watchlist + '<a href="/bookmarkslist" id="savedStories" class="cSprite_b">Saved Stories</a><a href="javascript:;" class="cSprite_b rdm_tab eu_hide" onclick="return objRedeem.popupShow();">Redeem Voucher</a><a href="/contactus.cms" target="_blank" class="contactus cSprite_b">Contact Us</a><a href="javascript:;" onclick="objUser.logOut()" class="cSprite_b logOut">Logout</a></div></div>');
                        } else {
                            $('.signInOut .signMenu').html('<div class="outer_container"><p class="email_lbl">'+_tp_data.email+'</p><div class="bgWhite"><a href="/userprofile.cms" target="_blank" class="edit cSprite_b profileTab" onclick="objUser.resetInfo()">Edit Profile<span class="incomplete_badge hidden">INCOMPLETE<span>!</span></span></a>' + streamlist + '<a href="' + mysubscription + '?fornav=1" rel="nofollow" target="_blank" class="subscribe cSprite_b">My Subscriptions</a>' + primePref + referEarn + '<a href="/et_benefits.cms" target="_blank" class="etBenefits cSprite_b">Redeem Benefits</a><a href="/subscription" target="_blank" class="newsltr cSprite_b">Manage Newsletters</a>' + watchlist + '<a href="/bookmarkslist" id="savedStories" class="cSprite_b">Saved Stories</a><a href="javascript:;" class="cSprite_b rdm_tab eu_hide" onclick="return objRedeem.popupShow();">Redeem Voucher</a><a href="/contactus.cms" target="_blank" class="contactus cSprite_b">Contact Us</a><a href="javascript:;" onclick="objUser.logOut()" class="cSprite_b logOut">Logout</a></div></div>');    
                            
                        }
                        if(tpName =='timesepaper'){
                            objEpaperCommon.updateLoginbar();
                        }
                        objUser.checkStreamPermission();
                        objUser.afterPrimeCheckCall(function () {
                            if(_tp_data.permissions &&  _tp_data.permissions.indexOf('subscribed') != -1) {
                                $('.header .subScribe').siblings('span').remove().end().remove();
                                var ic_cls =  $('.hdr_spcl_ofr.top_c_us').is(":visible") ? "mgl57" : "";
                                $('.signOut').after('<span class="cSprite icon_pp '+ ic_cls +'"></span>');
                            } else {
                                $('.header .subScribe').show();
                                $('.signOut').siblings('span.cSprite.icon_pp').remove(); 
                            }
                            
                            var isExpiredUser = _tp_data.permissions.indexOf("expired_subscription") !== -1;
                            if(isExpiredUser) {
                                objAdFreeExp.init();
                            }
                        });
                    }
                },
                TPWidgetLoad: function () {
                    if($('#tpwidget-head').length) {
                        var userDetails = objUser.info;
                        var ssoId =  userDetails.ssoid ? userDetails.ssoid : '';
                        var email =  userDetails.primaryEmail ? userDetails.primaryEmail : (userDetails.email ? userDetails.email : '');
                        
                        var bodyEle = document.body;
                        if (bodyEle.addEventListener) {
                            bodyEle.addEventListener('tpwidget-ready', function() {
                                TPWidget.init({
                                    widgets: [{
                                        'ele': 'tpwidget-head',
                                        'widgetType': 'tpwidget-one'
                                    }],
                                    userLoginInfo: {
                                        "host": "ET",
                                        "channel": "News",
                                        "URL": location.href,
                                        "userId": ssoId,
                                        "oid": "",
                                        "email": email
                                    }
                                })
                            });
                        }
                        else {
                            bodyEle.attachEvent('tpwidget-ready', function() {
                                TPWidget.init({
                                    widgets: [{
                                        'ele': 'tpwidget-head',
                                        'widgetType': 'tpwidget-one'
                                    }],
                                    userLoginInfo: {
                                        "host": "ET",
                                        "channel": "News",
                                        "URL": location.href,
                                        "userId": ssoId,
                                        "oid": "",
                                        "email": email
                                    }
                                })
                            });
                        }
                        
                        if(objGdpr.allow()) {
                            if(typeof skip.timespoints_main == 'undefined') {
                                if($(document).find('script[src*="//image.timespoints.iimg.in/tpwidgets/static/dist/js/main.js"]').length == 0) {
                                    // Load the times-point script asynchronously
                                    (function(d, s, id){
                                     var js, fjs = d.getElementsByTagName(s)[0];
                                     if (d.getElementById(id)) {return;}
                                     js = d.createElement(s); js.id = id;js.async = true;
                                     js.src = "//image.timespoints.iimg.in/tpwidgets/static/dist/js/main.js";
                                     fjs.parentNode.insertBefore(js, fjs);
                                    }(document, 'script', 'times-point'));
                                }
                            }
                        }
                        
                        $('body').append('<style>.tpwidget img{max-width:60%;} .tpwidget .tpwidget-inline{background-color:initial;}\
                            .tpwidget .widget-prelogin{margin-top:-2px;padding:0;}\
                            .tpwidget .widget-postlogin{padding:1px 0 0 0;margin-top:-1px;height:21px;}\
                            .tpwidget .widget-postlogin:hover{border:1px solid #D8E9EF;}\
                            .tpwidget .widget-postlogin .hover-state{background-color:#D8E9EF;margin-top:-2px;}\
                            .tpwidget .widget-postlogin:hover .normal-state:after{border-bottom-color:#D8E9EF;}\
                            .tpwidget .widget-postlogin .widget-text, .tpwidget .widget-prelogin .widget-text{padding-top:0;line-height:22px;color:#000;}\
                            .tpwidget .widget-postlogin .normal-state{margin-top:-1px;}\
                            .tpwidget .widget-postlogin .tp-btn{font-size:11px;line-height:14px;height:12px;}\
                            .tpwidget .widget-prelogin .tp-btn{font-size:11px;text-transform:uppercase;line-height:14px;font-weight:400;text-decoration:underline;color:#000;background-color:initial;padding:0;}\
                            .tpwidget .widget-prelogin .tp-btn:hover{background-color:initial;}\
                            .tpwidget .widget-prelogin .widget-text{font-size:11px;text-transform:uppercase;}\
                        </style>');
                    }
                },
                removeCookies: function () {
                    var sessionCookies = [
                        "fpid", "isTicketIdValid", "jssoldapid", "lgc_deviceid", "lgc_ssoid", "mobileVerified", "pfLang", "usr",
			            "FBOOK_ID", "FBOOK_NAME", "FBOOK_EMAIL", "FBOOK_LOCATION", "FBOOK_IMAGE","TWEET_ID", "TWEET_NAME", "TWEET_LOCATION", "TWEET_IMAGE",
                		"articleid", "txtmsg", "tflocation", "tfemail", "setfocus", "fbcheck", "twtcheck","usercomt", "ifrmval", "frmbtm", 
                		"FaceBookEmail", "Fbimage", "Fboauthid", "Fbsecuritykey","Twimage", "TwitterUserName", "Twoauthid", "Twsecuritykey",
                		"ssoid","Fbsecuritykey","fbookname","CommLogP","CommLogU","FaceBookEmail","Fbimage","fbooklocation",
                		"Fboauthid","fbname","fbLocation","fbimage","fbOAuthId","MSCSAuth","MSCSAuthDetail","MSCSAuthDetails","Twimage","TwitterUserName",
                		"Fboauthid","Twoauthid","Twsecuritykey","ssosigninsuccess","ssoid","MSCSAuthDetail","articleid",
                		"txtmsg","tflocation","tfemail","setfocus","fbookname","CommLogP","CommLogU","FaceBookEmail",
                		"Fbimage","fbooklocation","Fboauthid","Fbsecuritykey","fbname","fbLocation",
                		"fbimage","fbOAuthId","MSCSAuth","MSCSAuthDetail","MSCSAuthDetails","ssosigninsuccess",
                		"Twimage","TwitterUserName","Twoauthid","Twsecuritykey", "peuuid", "pfuuid", "ticket", "ssoid", "MSCSAuthID", "et_subs", "TicketId", "OTR", "OID", "OTP", "etprc", "etipr",
                		"LoginType","ssologintype","ipr","prc","gdpr","csut","ssoid","MSCSAuthNew","MSCSAuthDetail","MSCSAuthDetails","VisitedSites","MSCSAuthID","VisitedSites","LoginType","TicketId","ticket","CMSSSO","CommLogP","CommLogU","mobileverified","sso_ep","texp","lgc_TicketId","lgc_ssoid","gauid","tksec","lgc_tksec","ssec","lgc_ssec","lgc_prc","ru","ipr","jsso_crosswalk_tksec_et","jsso_crosswalk_csrfToken_et","jsso_crosswalk_daily_et","jsso_crosswalk_login_et","jsso_crosswalk_ssec_","csut","gdpr","epaper_token"
                		];
                		
                	$.each(sessionCookies, function(c, obj){
                		$.removeCookie(obj);
                		$.removeCookie(obj, { path: '/', domain: '.indiatimes.com' });
                	});
                },
                gpOneTapLogin: function (token, callback) {
                    objUser.loadSsoApi(function () {
                        var jsso = new JssoCrosswalk(objUser.channel, objUser.mode);
                        jsso.gpOneTapLogin(token, callback);
                    });
                },
                checkPermission: function (type) {
                    var permissionFlag = 0, permissions = window._tp_data && _tp_data.permissions || [];
                    if(typeof type == "string") {
                        if(type == 'adfree') {
                            if(permissions.indexOf('etadfree_subscribed') != -1) {
                                permissionFlag = 1;
                            }
                        } else {
                            if(permissions.indexOf(type) != -1) {
                                permissionFlag = 1;
                            }
                        }
                    } else {
                        for(var i = 0; i < type.length; i++) {
                            if (permissions.indexOf(type[i]) != -1) {
                                permissionFlag = 1;
                                break;
                            }
                        }
                    }
                    return permissionFlag
                },
                resetInfo: function () {
                    $.jStorage.deleteKey('userInfo');
                },
                ssoConsent: function () {
                    $.ajax({
                        url: '/static_sso_consent.cms',
                        success: function (html) {
                            $('body').append(html);
                            $('.sc_concent .sc_cb').change(function () {
                                if($('.sc_concent .sc_cb:checked').length == 2) {
                                    $('.sc_concent .sc_btn').addClass('active');
                                } else {
                                    $('.sc_concent .sc_btn').removeClass('active');
                                }
                            })
                            $('.sc_concent .sc_btn').click(function() {
                                if($(this).hasClass('active')) {
                                    var jsso = new JssoCrosswalk(objUser.channel, objUser.mode);
                                    var timesPoints = window.geolocation == 1 ? "1" : "0";
                                    jsso.updateUserPermissions("1", "1", timesPoints, function (response) {
                                        if(response && response.status == 'SUCCESS') {
                                            $('.sso_consent_box').remove();
                                            $.jStorage.deleteKey('userInfo');
                                        } else {
                                            var resString = '';
                                            try {
                                                resString = JSON.stringify(response);
                                            } catch (e) {}
                                            grxEvent('event', {
                                                'event_category' : 'ET Login',
                                                'event_action' : 'Error',
                                                'event_label' : 'Updating Consent - ' + resString
                                            });
                                            alert('Error while updating consent.');
                                        }
                                    });
                                }
                            });
                            $('.sso_consent_box .sc_close').click(function() {
                                objUser.logOut();
                            })
                        }
                    })
                },
                checkStreamPermission: function(){
                    var checkUserList = $.jStorage.get('et_host') || [];
                    var _arrayOfList = checkUserList;
                    var userEncode = window.btoa(_tp_data.email);
                    if(checkUserList && checkUserList.length == 0){
                        var liveUrl = objMktD.bself;
                        if(objCommon.isLive==1){
                           liveUrl =  'https://etwebcast.indiatimes.com';
                        }
                        var finelUrl = liveUrl + '/ET_WebCast/getexpertssolist';
                        var _url = finelUrl;
                        $.ajax({
            	            url: _url,
            	            method: 'get',
            	            success: function (res) {
            	                console.log('checkStreamPermission', res);
            	                if(res && res.datainfo && res.datainfo.expertSsoMaster){
            	                    var et_hostInfo = res.datainfo.expertSsoMaster || [];
            	                    $.jStorage.set('et_host', et_hostInfo);
                                    $.jStorage.setTTL("et_host", 3600000);
                                    _arrayOfList =  et_hostInfo;
                                    objUser.setStreamMenu(_arrayOfList,userEncode);
            	                }
            	            },
            	            error: function(e) {
            	               console.log('checkStreamPermission error',e);
                            }
            	        });
                    }else{
                        objUser.setStreamMenu(_arrayOfList,userEncode);
                    }
                },
                setStreamMenu: function(_arrayOfList,userEncode){
                    var _checkUserFound = '';
                    _arrayOfList.find(function(item){
                        if(item == userEncode){
                            _checkUserFound = item;
                        }    
                    })
                    if(_checkUserFound == userEncode){
                        $('.jsStreamIcon').attr('href', '/livestream-expertpanel');
                        $('.jsStreamIcon').html('Live Stream Panel');
                        $('.jsStreamIcon').removeClass('hide');
                    }
                }
            }
            
            /* Breaking News */
            objBreakingNews = {
                	interval: 0,
                	bnewsIntv: 0,
                	viewedNews:[],
                	pageTickerService:'',
                	newsRotationTime:1e4, // used to set timeout value from default or custom 
                	defaultRotationTime: 1e4,
                	customRotationTime:1e4, // custom on page specific ticker,
                	init : function(){
                		if($("#breakingNews").length){ // Get Breaking News
                			objBreakingNews.getNews();
                			objBreakingNews.bindEvents();
                			
                			$(window).focus(function () {			
                    			objBreakingNews.checkNews();
                    		}).blur(function () {
                    			clearInterval(objBreakingNews.interval);
                    		});
                		}
                	},
                	bindEvents : function() {
                		//Breaking News Next Prev
                		$("#breakingNews .prev").unbind("click").bind("click",function(){
                			var curNews=$("#breakingNews .bnews li.active"), nextNews = $("#breakingNews .bnews li.active").prev();
                			if(curNews.index() == 0){
                				curNews=$("#breakingNews .bnews li:first"); 
                				nextNews = $("#breakingNews .bnews li:last");
                			}
                			curNews.removeClass("active");
                			nextNews.addClass("active");
                			objBreakingNews.newsImpression($("#breakingNews .bnews li").length, $("#breakingNews .bnews li.active a").text());
                		});
                		
                		$("#breakingNews .next").unbind("click").bind("click",function(){
                			var curNews=$("#breakingNews .bnews li.active"), nextNews = $("#breakingNews .bnews li.active").next();
                			if(curNews.index() == $("#breakingNews .bnews li").length -1){
                				curNews=$("#breakingNews .bnews li:last"); 
                				nextNews = $("#breakingNews .bnews li:first");
                			}
                			curNews.removeClass("active");
                			nextNews.addClass("active");
                			objBreakingNews.newsImpression($("#breakingNews .bnews li").length, $("#breakingNews .bnews li.active").text());
                		});
                	},
                	getNews : function () {
                        objBreakingNews.newsRotationTime = objBreakingNews.defaultRotationTime;
                		$.ajax({url:"//economictimes.indiatimes.com/etstatic/breakingnews/etjson_bnews.html",dataType:"script",cache:true});
                		//$.ajax({url:"/json_bnews1.cms",dataType:"script",cache:true});
                    },
                	animation : function(data){
                		clearInterval(objBreakingNews.bnewsIntv);
                		objBreakingNews.bnewsIntv = setInterval(function(){
                			var curNews=$("#breakingNews .bnews li.active"), nextNews = $("#breakingNews .bnews li.active").next();
                			if(curNews.index() == data.length-1){
                				curNews=$("#breakingNews .bnews li:last"); 
                				nextNews = $("#breakingNews .bnews li:first");
                				setTimeout(function(){
                					objBreakingNews.getNews();
                				},8e3);
                			}
                			curNews.removeClass("active");//
                			nextNews.addClass("active");//
                			objBreakingNews.newsImpression(data.length, $("#breakingNews .bnews li.active").text());
                		}, objBreakingNews.newsRotationTime);
                	},
                	checkNews : function(){
                		clearInterval(objBreakingNews.interval);		
                		objBreakingNews.interval = setInterval(function(){
                			objBreakingNews.getNews();
                		}, 3e4);
                	},
                	lastPageTickerHit:0,
                    pageTickerInit:function () {
                        var curDate = new Date(), curTime = parseInt(curDate.getTime() / 1000);
                	    if(objBreakingNews.pageTickerService != '' && curTime - objBreakingNews.lastPageTickerHit > 30 && objLang.currentLang() == '') {
                	        objBreakingNews.lastPageTickerHit = curTime;
                	        objBreakingNews.newsRotationTime = objBreakingNews.customRotationTime;
                	        $.ajax({url:objBreakingNews.pageTickerService, dataType:"script", cache:true});
                	    }
                	},
                	newsImpression:function(dataLen, heading) {
                	    if(dataLen > objBreakingNews.viewedNews.length && $("#breakingNews").visible() && $.inArray( heading, objBreakingNews.viewedNews ) == -1 && objGdpr.allow()) {
                    	    var title='', lnk = '';
                    	    if($("#breakingNews .bnews li.active a").length) {
                    	        var $activeNews = $("#breakingNews .bnews li.active a");
                    	        title = $activeNews.text();
                    	        lnk = $activeNews.attr('href');
                    	    } else {
                    	          title = $("#breakingNews .bnews li.active .head span").text();
                    	    }
                    	    var title = $("#breakingNews .bnews li.active").text();
                		    objBreakingNews.viewedNews.push(title);
                		}
                	}
                }
                
            function breakingnews(data){	
            	try {
            		clearInterval(objBreakingNews.bnewsIntv);
            		var val = "";
            		if(typeof data.stry == 'object') {
                	    if(typeof data.stry.title != 'undefined') {
                	        data = [data.stry];
                	    } else {
                	        data = data.stry;
                	    }
                	    
                	}
            		
            		if (data.length > 0) {
            		  //  if(typeof tpName!="undefined" && tpName == "default"){
            		  //      $("#div-gpt-ad-1000-et-breakingnews-widget-ad") && $("#div-gpt-ad-1000-et-breakingnews-widget-ad").length > 0 && $("#div-gpt-ad-1000-et-breakingnews-widget-ad").remove();
            		  //  }
            		    
            			clearInterval(objBreakingNews.interval);
            			if(tpName == 'default_prime') {
            			    $('.soWrapper').remove();
            			}
            			var titleArr = {10 : 'Alert', 11 : 'News Flash', 12 : 'News Just In', 13 : 'What\'s New', 0: 'Breaking News'};
                		var title = 'BREAKING NEWS';
            			var trackerName = typeof objBreakingNews.trackerName != 'undefined' ? objBreakingNews.trackerName : 'CompanyPages';
            			var animateClr = (tpName == 'default_prime' ? '#FFFFFF' : '#ED193B');
            			
            			var svgHtml = '<span class="svg-container">\
                          <svg xmlns="http://www.w3.org/2000/svg" width="50" height="40" viewBox="0 0 50 40" fill="none">\
                            <g id="node_1_0">\
                              <path id="third" fill-rule="evenodd" clip-rule="evenodd" d="M0 0H3.76004L20 19.8974L3.76004 40H0L15.9563 19.8974L0 0Z" fill="'+ animateClr +'"></path>\
                              <path id="second" fill-rule="evenodd" clip-rule="evenodd" d="M0 0H3.76004L20 19.8974L3.76004 40H0L15.9563 19.8974L0 0Z" fill="'+ animateClr +'"></path>\
                              <path id="first" fill-rule="evenodd" clip-rule="evenodd" d="M0 0H3.76004L20 19.8974L3.76004 40H0L15.9563 19.8974L0 0Z" fill="'+ animateClr +'"></path>\
                              <path id="white" fill-rule="evenodd" clip-rule="evenodd" d="M0 0 L 6 0 L22 20 L6 40 L 0 40 L 0 0 Z" fill="#FFFFFF"></path>\
                            </g>\
                          </svg>\
                        </span>';
            			for(var i=0; i < data.length; i++){
            				if(data[i].title) {
            					if(typeof titleArr[data[i].type] != 'undefined') { title = titleArr[data[i].type]; }
            					if(data[i].title.indexOf('###')!=-1){
                		            var _d = data[i].title.split('###');
                		            title = $.trim(_d[0]);
                		            data[i].title = $.trim(_d[1]);
                		        }
            					var linkstr = "", linkend = "";
                                if(data[i].link != "") {
                                	linkstr = '<a href=" ' + data[i].link + '" target="_blank">',
                                	linkend = "</a>";
                                }
            					
            					if(data[i].type =="12"){
                		            var href = data[i].seolocation+'/articleshow/'+data[i].msid+'.cms';
                		            var clickTracker = "ga('send', 'event', '" + trackerName + "', 'News Just In', '" + href + "')";
                		            val += '<li class="' + ((i==0) ? "active" : "")+ '" onclick="ga(\'send\',\'event\',\'Breaking News\',\'Click\',\''+href+'\')"><span class="lb-icon"></span><span class="head">' + title + '</span>'+ svgHtml +'<span class="title"><a href="' + href + '" target="_blank" onclick="' + clickTracker + '">' + data[i].title + '</a></span></li>';
                		        } else if(data[i].type =="13"){
                		            var href = data[i].url;
                		            var clickTracker = "ga('send', 'event', '" + trackerName + "', 'Whats New', '" + href + "')";
                		            if(href) {
                		                txt = '<span class="title"><a href="' + href + '" target="_blank" onclick="' + clickTracker + '">' + data[i].title + '</a></span>';
                		            }
                		            val += '<li class="' + ((i==0) ? "active" : "")+ '" onclick="ga(\'send\',\'event\',\'Breaking News\',\'Click\',\''+href+'\')"><span class="lb-icon"></span><span class="head">' + title + '</span>'+ svgHtml + '<span class="title">'+ data[i].title + '</span></li>';
                		        } else {
                		            val += '<li class="' + ((i==0) ? "active" : "")+ '" onclick="ga(\'send\',\'event\',\'Breaking News\',\'Click\',\''+data[i].link+'\')"><span class="lb-icon"></span><span class="head">' + title + '</span>'+ svgHtml + '<span class="title">' + linkstr + data[i].title + linkend + '</span>' +'</span></li>';
                		        }
            				}
            				
            				if(val.length > 15) {
            					$("#breakingNews .bnews").html(val);
            					$("#breakingNews").slideDown();
            					if(data.length > 1){
            						objBreakingNews.animation(data);
            						$(window).focus(function () {				
            							objBreakingNews.animation(data);
            						}).blur(function () {
            							clearInterval(objBreakingNews.bnewsIntv);
            						});
            						$("#breakingNews .nextPrev").show("fast");
            						$("#breakingNews").unbind("mouseenter").bind("mouseenter",function(){
            							clearInterval(objBreakingNews.bnewsIntv);
            						}).unbind("mouseleave").bind("mouseleave",function(){
            							objBreakingNews.animation(data);
            						});
            					} else {
            						$("#breakingNews .nextPrev").hide("fast");
            					}
            					
            					if($("#breakingNews .bnews li.active a").length) {
            						objBreakingNews.newsImpression(data.length, $("#breakingNews .bnews li.active a").text());
            					} else {
            						objBreakingNews.newsImpression(data.length, $("#breakingNews .bnews li.active").text());
            					}
            				} else {
            					$("#breakingNews").slideUp();
            					objBreakingNews.pageTickerInit();
            				}
            			}
            		} else {
            		  //if(typeof tpName!="undefined" && tpName == "default" && typeof _tp_data !="undefined" && _tp_data.isPrime == false && _tp_data.isAdfree == false){
            		  //  typeof objAd!="undefined" && objAd.renderBreakingNewsAd && objAd.renderBreakingNewsAd();
            		  //}
                		$("#breakingNews").slideUp();
                		objBreakingNews.checkNews();		
                		
                		objBreakingNews.pageTickerInit();
                	}		
            	} catch(e) {
            		console.log('Exception in breakingNews', e);
            	}
            }
            
            //Nav JS
            objNav = {
            	init: function() {
            		objNav.bindEvents();
            		objNav.openSideMenu();
            		var wrapper = $('.sbnv_wrapper');
            		if(wrapper.length && $('#subnav a.current').length) {
            		    wrapper.scrollLeft(($('#subnav a.current').offset().left - wrapper.offset().left));
            		}
            	},
            	bindEvents: function() {
            		try {
            		    $("#topnav > div.moreNav .morenavTab").mouseenter(function(){
            		        var checkMenu = $('#topnav > div.moreNav .jsMoreSecNavSport').length;
            		        if(checkMenu == '1'){
            		          objNav.createMoreMenu();
            		          
            		        }
            		    })
            		    $("#topnav > div.moreNav .morenavTabItem").mouseenter(function(){
            		        var checkMenu = $('#topnav > div.moreNav .jsMoreSecNav').length;
            		        if(checkMenu == '0'){
            		          objNav.createMoreMenuItem();
            		        }
            		    })
            			$("#topnav > div").mouseenter(function () {
            				var selector = "#subsec" + $(this).attr("data-id"),
            					selId = $(this).attr("data-id"),
            					subsecval = $(this).attr('data-subsec');
            				if ($(this).hasClass('moreNav')) {
                			    var $lazyImgs = $('.moreNav img');
                			    $.each($lazyImgs, function (i, v) {
                			        if (typeof $(v).attr("data-original") != "undefined") {
                        				$(v).attr("src", $(v).attr("data-original")).removeAttr("data-original");
                        			}
                			    });
                			}
                			if($(this).children('div.comnav').length > 0) {
                			    objNav.commodityNewsLoad();
                			}
            				if ($(this).attr("data-id") && $(selector).is(":empty")) {
            					$(selector).html("<div class='loading'>Loading...</div>").slideDown();
            					if ($(this).attr("data-id") == 'et-prime') {
                					$(selector).load("/etprime.cms");
                				} else if ($(this).attr("data-id") == '13357270') {
                					$(selector).load("/etsubsecnav.cms?msid=" + $(this).attr("data-id"));
                				} else {
                					$(selector).load("/etsubsecnav.cms?msid=" + $(this).attr("data-id"), function () {
                						if(!subsecval) {
                							var len = $(selector).children().length
                								percol = ((selId == '13352306') || (selId == '1715249553') || (selId == '2147477890') || (selId == 837555174)) ? (selId == '1715249553') ? Math.ceil($(selector).children().length / 3) : Math.ceil($(selector).children().length / 4) : Math.ceil($(selector).children().length / 2),
                								L1 = L2 = L3 = L4 = "",
                								isL1 = isL2 = isL3 = isL4 = 0;
                								percol = (selId == 837555174) ? 16 : percol;
                								percol = (selId == 359241701) ? 9 : percol;
                								percol = (selId == 94909228) ? 6 : percol;
                								
                							$(selector).children().each(function (i, val) {
                								if (i < percol) {
                									L1 += $(val).html();
                									$(this).remove();
                								} else if ((i >= percol) && i < (percol * 2)) {
                									if ($(this).attr("data-sec") == "L1") {
                										isL1 = 1;
                									};
                									if (isL1 == 0) {
                										L1 += $(val).html();
                										$(this).remove();
                									} else {
                										L2 += $(val).html();
                										$(this).remove();
                									}
                								} else if ((i >= (percol * 2)) && i < (percol * 3)) {
                									if ($(this).attr("data-sec") == "L1") {
                										isL2 = 1;
                									};
                									if (isL2 == 0) {
                										L2 += $(val).html();
                										$(this).remove();
                									} else {
                										L3 += $(val).html();
                										$(this).remove();
                									}
                								} else {
                									if ($(this).attr("data-sec") == "L1") {
                										isL3 = 1;
                									};
                									if (isL3 == 0) {
                										L3 += $(val).html();
                										$(this).remove();
                									} else {
                										L4 += $(val).html();
                										$(this).remove();
                									}
                								}
                							});
                							if ((selId == '359241701')) {
                								$(selector).append("<div class='flt'>" + L1 + "</div><div class='flt'>" + L2 + "</div><div class='flt'>" + L3 + "</div><div class='clr'></div>");							
                							} else if ((selId == '13352306') || (selId == '2147477890') || (selId == 837555174) || (selId == '1715249553')) {
                								$(selector).append("<div class='flt'>" + L1 + "</div><div class='flt'>" + L2 + "</div><div class='flt'>" + L3 + "</div><div class='flt'>" + L4 + "</div><div class='clr'></div>");							
                							} else {
                								$(selector).append("<div class='flt'>" + L1 + "</div><div class='flt'>" + L2 + "</div><div class='clr'></div>");
                							}
                							
                							if(objAd.type == 'adfree') {
                                        	    objAd.removeAd();
                                        	}
                						}
                					});
                				}
            				}
            			});
            			
            			$("#subnav > div.commodSublevel").mouseenter(function () {
            			    if($(this).children('div.comnav').length > 0) {
                			    objNav.commodityNewsLoad();
                			}
            			});
            			
            			$('#sideMenu.sections').on('click', function () {
            			    if($(this).hasClass('closeMenu')) {
            				    ga('send','event','ET-TopNav','Click - Sections','Section Close');
            				    grxEvent('event', {'event_category': 'ET-TopNav', 'event_action': 'Click - Sections', 'event_label': 'Section Close'});
            				} else {
            				    ga('send','event','ET-TopNav','Click - Sections','Section');
            				    grxEvent('event', {'event_category': 'ET-TopNav', 'event_action': 'Click - Sections', 'event_label': 'Section'});
            				}
            				
            				if($('#sideBarNav').is(':empty')) {
            					objNav.openSideMenu();
            				}
            				$(this).find('#sideBarNav').toggle();
            				$(this).toggleClass("closeMenu");
            			});
            			
        			    $('html').click(function(e) {
                          if (e.target.id != 'sideMenu' && $(e.target).parents('#sideMenu').length == 0 && $('#sideMenu.sections').hasClass('closeMenu')) {
                            $('#sideMenu.sections').removeClass('closeMenu');
                            $('#sideMenu.sections').find('#sideBarNav').hide();
                          }
                        });
                        
                        $(document).on('mouseover', 'div[data-id="13357270"] a.subsec1', function () {
                			var ref_class = $(this).attr('data-rel-class');
                			if (!$('div[data-id="13357270"] .mLast').find('.div_' + ref_class).length) {
                				$('div[data-id="13357270"] .mLast').append('<div class="div_' + ref_class + '"></div>');
                				$('div[data-id="13357270"] .mLast .div_' + ref_class).html('Loading...').load('/technav.cms?layout=new&msid=' + $(this).attr('data-rel-id'), function () {
                				    objCommon.loadImg($('div[data-id="13357270"] .mLast'));
                				}).show().siblings().hide();
                				
                			} else {
                				$('div[data-id="13357270"] .mLast .div_' + ref_class).show().siblings().hide();
                			}
                
                			$(this).addClass('active').siblings('.subsec1,h2').removeClass('active');
                		});
                		
                		$(document).on('mouseover','div[data-id="13357270"] h2',function () {
                			$(this).addClass("active").siblings("a").removeClass("active");
                			$('div[data-id="13357270"] .mLast div:first').show().siblings().hide();
                		});
                        
                        $(".panacheNav div").off().mouseenter(function() {
                            if ($(this).find("a") && $(this).is("[data-msid]")) {
                                var a = $(this).attr("data-msid"), top = $(this).offset().top - $(window).scrollTop();
                                if (!$(this).find("div").hasClass("pnss") && a != 63894515) {
                                    $(this).find("a").after("<div class='pnss' ><div style='width:310px;padding:5px 0;text-align:center;'>Loading...</div></div>");
                                    $(this).find(".pnss").load("/panachenav.cms?msid=" + a)
                                }
                                $(this).find(".pnss").show().css('top', top);
                                $(this).siblings().find(".pnss").hide()
                            }
                        }).mouseleave(function() {
                            $(".panacheNav .pnss:visible").hide()
                        })
                        
            		} catch(e) {
            			console.log('Exception in nav mouse enter ' , e);
            		}
            	},
            	createSubMenu: function(data) {
            		var str = '<ul class="L1">';
            		str += '<li><a href="' + data.link + '">' + data.nm + '</a></li>';
            		$.each(data.sec, function(i, v) {
            			str += '<li>';
            			if (v.sec) {
            				var sclass = (i > 7) ? " botAlign" : "";
            				str += '<a href="' + v.link + '"><span class="cSprite menuRtArrow"></span>' + v.nm + '</a><ul class="L2' + sclass + '" data-msid="' + v.msid + '"><li class="subMenuTitle">' + v.nm + '</li>';
            				$.each(v.sec, function(i1, v1) {
            					str += '<li>';
            					if (v1.sec) {
            						str += '<a href="' + v1.link + '"><span class="cSprite menuRtArrow"></span>' + v1.nm + '</a><ul class="L3" data-msid="' + v1.msid + '"><li class="subMenuTitle">' + v1.nm + '</li>';
            						$.each(v1.sec, function(i2, v2) {
            							str += '<li><a href="' + v2.link + '">' + v2.nm + '</a></li>';
            						});
            						str += '</ul>';
            					} else {
            						str += '<a href="' + v1.link + '">' + v1.nm + '</a>';
            					}
            					str += '</li>';
            				});
            				str += '</ul>';
            			} else {
            				str += (v.msid == '18255004' || v.nm == 'ET Portfolio') ? '<a href="' + v.link + '" rel="nofollow">' : '<a href="' + v.link + '">';
            				str += v.nm + '</a>';
            			}
            			str += '</li>';
            		});
            		str += '</ul>';
            		return str;
            	},
            	openSideMenu: function() {
            		$('#sideMenu.sections').on('mouseenter', function () {
            			var $this = $(this);
            			
            			if($this.find('#sideBarNav').is(':empty')){
            				objNav.getSideMenu(function (data) {
            				    var strHTML = objNav.createSubMenu(data);
        						$this.find('#sideBarNav').html(strHTML);
        						$("#sideBarNav .L1 > li, #sideBarNav .L2 > li").on("mouseenter", function () {
        							$(this).find("> a").addClass("active");
        							$(this).siblings("li").find("> a").removeClass("active");
        						}).on("mouseleave", function () {
        							$(this).find("> a").removeClass("active");
        						});
            				});
            			}
            		});
            	},
            	navData: {},
            	getSideMenu: function (cb) {
            	    if(Object.keys(objNav.navData).length) {
            	        if(typeof cb == 'function') {
						    cb(objNav.navData);
						}
            	    } else {
            	        var data = {}, currLang = objLang.currentLang();
            			if(currLang) {
            				data.language = currLang;
            			} else if(language != '') {
            			    data.language = language;
            			}
                	    $.ajax({
        					url : '/etwapmenu.cms?feedtype=etjson',
        					data: data,
        					dataType : 'json',
        					success : function (data) {
        					    objNav.navData = data;
        						if(typeof cb == 'function') {
        						    cb(data);
        						}
        					}
        				});
            	    }
            	},
            	cNewsLoaded: 0,
            	commodityNewsLoad: function () {
                    if(!objNav.cNewsLoaded) {
                        $('.comnav .comnavc > a').each(function (i, j) {
                	        $(this).after('<div class="cn_list' + (i+1) + '">Loading...</div>');
                	    });
                	    
                        objNav.commodityNews(50991765, 1);
                	    objNav.commodityNews(50991753, 2);
                	    
                	    $('.navElement .commodities').css('width', '550px').find('.firstset').css('width', '200px');
                	    objNav.cNewsLoaded = 1;
                    }
                },
                commodityNews: function (msid, pos) {
                    var listcount = pos == 1 ? 1 : 5;
                    $.ajax({
                        url: '/feed_sectionnews.cms?feedtype=sjson&listcount=' + listcount + '&msid=' + msid,
                        dataType: 'json',
                        success: function (data) {
                            var html = '<div class="commodity_news" style="overflow:hidden;font-size: 13px;">';
                            $.each(data, function (i, j) {
                                if(pos == 1) {
                                    html += '<a style="padding: 5px;float: left;" href="/' + j.seolocation + '/articleshow/' + j.msid + '.cms">\
                                    <img height="60" width="60" src="' + objDomain.img + '/thumb/msid-' + j.msid + ',width-60,height-60/' + j.seolocation + '.jpg" alt="">\
                                    </a>';
                                }
                                var width = pos == 1 ? 'width: 120px;' : '';
                                html += '<a style="' + width + '" href="/' + j.seolocation + '/articleshow/' + j.msid + '.cms">' + j.stname + '</a>';
                            });
                            html += '</div>';
                            // _log(data);
                            $('.comnav .comnavc .cn_list' + pos).html(html);
                            
                        }
                    });
                
                },
                createMoreMenu: function(){
                    $.ajax({
                        url: '/more_nav_new.cms?msid=99034116',
                        cache: true,
                        success: function (response) {
                            $('.js_morenav').html(response);
                            var $lazyImgs = $('.moreNav img');
            			    $.each($lazyImgs, function (i, v) {
            			        if (typeof $(v).attr("data-original") != "undefined") {
                    				$(v).attr("src", $(v).attr("data-original")).removeAttr("data-original");
                    			}
            			    });
                            if($(".DPslider").length && !($(".DPslider").hasClass('initiated'))) {
                                $(".DPslider").addClass("initiated").etSlider({
                                    visible : 1,
                                    perSlide : 1,
                                    auto : false,
                                    slides : '#Edition_carouselOne ul > li',
                                    pagination : ".ts-dots",
                                    slideContainer : '#Edition_carouselOne',
                                    interval : 10000,
                                    nextprevBtn : true,
                                    nextprevClass : '.nextprev-btn'
                                });
                            }
                                
                            if($(".DPslider_inno").length && !($(".DPslider_inno").hasClass('initiated'))) {
                                $(".DPslider_inno").addClass("initiated").etSlider({
                                    visible : 1,
                                    perSlide : 1,
                                    auto : false,
                                    slides : '#Edition_carouseltwo > ul > li',
                                    pagination : ".ts-dots",
                                    slideContainer : '#Edition_carouseltwo',
                                    interval : 10000,
                                    nextprevBtn : true,
                                    nextprevClass : '.nextprev-btn'
                                });
                            }
                        }
                        
                    });

                },
                createMoreMenuItem: function(){
                    $.ajax({
                        url: '/more_nav.cms',
                        cache: true,
                        success: function (response) {
                            $('.js_moreitem').html(response);
                            var $lazyImgs = $('.moreNav img');
            			    $.each($lazyImgs, function (i, v) {
            			        if (typeof $(v).attr("data-original") != "undefined") {
                    				$(v).attr("src", $(v).attr("data-original")).removeAttr("data-original");
                    			}
            			    });
                        }
                        
                    });

                }
            }
           
           window.fbAsyncInit = function() {
                // init the FB JS SDK
                FB.init({appId: '117787264903013',oauth:true, status: true, cookie: true, xfbml: true});
            	
            	FB.Event.subscribe('edge.create', function(href, widget){
            	    if(widget.className.indexOf('fbLSTrackAS') >= 0) {
            	        var gaHitParams = widget.getAttribute('data-ga').split(',');
            	        ga('send', 'event', gaHitParams[0], gaHitParams[1], gaHitParams[2]);
            	    } else {
                		ga('send', {
                			'hitType' : 'social',
                			'socialNetwork' : 'Facebook',
                			'socialAction' : 'Like',
                			'socialTarget' : href,
                			'page' : href.replace('http://economictimes.indiatimes.com', '')
                		});
            	    }
            	});
            	FB.Event.subscribe('message.send', function(href, widget){						
            		ga('send', {
            			'hitType' : 'social',
            			'socialNetwork' : 'Facebook',
            			'socialAction' : 'Send',
            			'socialTarget' : href,
            			'page' : href.replace('http://economictimes.indiatimes.com', '')
            		});
            	});
            	FB.Event.subscribe('edge.remove', function (href, widget) {
            	    if(widget.className.indexOf('fbLSTrackAS') >= 0) {
            	        var gaHitParams = widget.getAttribute('data-ga').split(',');
            	        ga('send', 'event', gaHitParams[0], gaHitParams[1], gaHitParams[2]);
            	    } else {
                		ga('send', {
                			'hitType' : 'social',
                			'socialNetwork' : 'Facebook',
                			'socialAction' : 'Unlike',
                			'socialTarget' : href,
                			'page' : href.replace('http://economictimes.indiatimes.com', '')
                		});
            	    }
            	});				
            	
            	setTimeout(function(){
            		FB.getLoginStatus(function (response) {
            			loginFbSts = response.status;
            			if (response.authResponse) {
            				usersessionkey = response.authResponse.accessToken;
            			}
            			if (usersessionkey != '' && $.cookie('autologin') == null && $.cookie('MSCSAuth') == null) {
            				fbAutoLoginStatusProceed = false;
            				$.cookie("autologin", "1", 0, "/", ".indiatimes.com", "");
            			} else {
            				fbAutoLoginStatusProceed = true;
            			}
            		});
            	}, 2000);
            };
            
            objNote = {
                init: function(){
                    var textFound = 'We are upgrading our systems due to which there can be intermittent issues with data updates on website, we regret the inconvenience caused.';
                    var foundIn = $('#netspidersosh div:contains('+textFound+')');
                    if( foundIn.text() == '' && window.location.pathname != '/' && window.location.pathname.indexOf('/default.cms') == -1 && window.location.pathname.indexOf('/index.cms') == -1){
                        $('#netspidersosh .band_wrapper').append('<div style="border: 1px solid #CCC;padding: 5px 20px;margin-bottom: 5px;font-size: 14px;box-shadow: 0px 0px 2px 0px #CCC;color: #555; display: inline-block; margin: 0 0px 8px 25px;">'+textFound+'</div>');
                    }
                }
            };
            var no_of_clicked_tasks=0;
            // auto page reload object
            // sample call objRefreshPage.init({'refreshTime':50000, 'preCheckTime':5000, 'adonRefreshTime':10000});
            
            /*
              timeSlide : logincal | fixed | forced (logical check for defined time that users active or not in last few min refresh time get slide | in fix after last activity + refresh time page will get refresh | forcefully refresh weather user is active or not)
              refreshTime : after how much time page should get refresh
              preCheckTime : used for logicalTimeslide (logical)  
              adonRefreshTime : time slide in logicalTimeslide (logical)
             */
             
            objRefreshPage = {
                interval:0,
                lastAccessTime:0,
            	timeSlide : 'logical',
                refreshTime:18e4, // 3 min
                preCheckTime:6e4, // 1 min
                adonRefreshTime:12e4, // 2 min
                init:function(obj) {
                    if(typeof geoinfo !="undefined" && !(geoinfo.geolocation=="5" && geoinfo.CountryCode == "GB")){
                        _log('pagerefresh', 'objRefreshPage.init');
                        obj = typeof obj == 'undefined' ? {} : obj;
                        
                        if(typeof obj.timeSlide != 'undefined') {
                            objRefreshPage.timeSlide = obj.timeSlide;
                        };
                		if(typeof obj.refreshTime != 'undefined') {
                            objRefreshPage.refreshTime = obj.refreshTime;
                        };
                        if(typeof obj.preCheckTime != 'undefined') {
                            objRefreshPage.preCheckTime = obj.preCheckTime;
                        };
                        if(typeof obj.adonRefreshTime != 'undefined') {
                            objRefreshPage.adonRefreshTime = obj.adonRefreshTime;
                        };
                        
                        objRefreshPage.setRefresh();
                        if(objRefreshPage.timeSlide == 'fixed') {
                            $('body').mousemove(function () { objRefreshPage.setRefresh();});
                        } else if(objRefreshPage.timeSlide == 'logical') {
                			$(window).scroll(function () {
                				var d = new Date(); 
                				objRefreshPage.lastAccessTime = parseInt(d.getTime() / 1000); 
                				//_log('pagerefresh', 'scroll, objRefreshPage.lastAccessTime ' + objRefreshPage.lastAccessTime); 
                			});
                			$('body').keyup(function () { 
                				var d = new Date(); 
                				objRefreshPage.lastAccessTime = parseInt(d.getTime() / 1000); 
                				//_log('pagerefresh', 'keyup, objRefreshPage.lastAccessTime ' + objRefreshPage.lastAccessTime); 
                			}).mousemove(function () {
                			    var d = new Date(); 
                				objRefreshPage.lastAccessTime = parseInt(d.getTime() / 1000); 
                				//_log('pagerefresh', 'mousemove, objRefreshPage.lastAccessTime ' + objRefreshPage.lastAccessTime); 
                			});
                		}
                        setTimeout(function () {
                            if(typeof sessionStorage != 'undefined') {
                                sessionStorage.removeItem('pageReload');
                            }
                        }, 5000);
                    }
                },
                setRefresh: function() {
                    if(objCommon.isLive == 1) {
                        _log('pagerefresh', 'objRefreshPage.setRefresh');
                        clearTimeout(objRefreshPage.interval);
                        objRefreshPage.interval = setTimeout(function () {
                            if(window.liveTv && (liveTv.state == 'paused' || liveTv.mute == true)) { // if live tv is paused or in mute state on than page can reload.
                    			if(objRefreshPage.timeSlide == 'logical') {
                    				var now = new Date();
                    				_log('pagerefresh', 'last move before' + ((parseInt(now.getTime() / 1000)) - objRefreshPage.lastAccessTime));
                    				if(((parseInt(now.getTime() / 1000)) - objRefreshPage.lastAccessTime) > (objRefreshPage.preCheckTime / 1000)) {
                    					objRefreshPage.reloadPage();
                    				} else {
                    					objRefreshPage.refreshTime = objRefreshPage.adonRefreshTime;
                    					objRefreshPage.setRefresh();
                    				}
                    			} else {
                    				objRefreshPage.reloadPage();
                    			}
                            } else {
                                _log('video is playing with volume', window.liveTv);
                                objRefreshPage.refreshTime = objRefreshPage.adonRefreshTime;
                    			objRefreshPage.setRefresh();
                            }
                        }, objRefreshPage.refreshTime);
                    }
                },
            	reloadPage: function() {
            		_log('pagerefresh', 'objRefreshPage.reloadPage');
            		if (typeof video == "undefined" && (objVideo.isPlay != 1)) {
            		    var _ifOnline = function () {
            		        var curDT = new Date();
        					var expTime = new Date().getTime() + 120000; // 2 minutes
        					if($.cookie) {
        						$.cookie("popout_autorefresh_open", 'true', {
        							expires: expTime,
        							path: '/',
        							domain: '.indiatimes.com'
        						});
        						$.cookie("rw_default", 'true', {
        							expires: expTime,
        							path: '/',
        							domain: '.indiatimes.com'
        						});
        					}
        					//ga('send','event','autorefresh',location.pathname,'');
        					var grxRefreshData = Object.assign({'event_category': 'autorefresh', 'event_action': location.pathname, 'event_label': ''}, window.grxDimension || {});
        					var isOldGrxAllowed = window.objVc && objVc.OldGrxSwitch === '1';
        					if(isOldGrxAllowed) {
        					    grx('track', 'event', grxRefreshData);
        					}
        					if(typeof sessionStorage != 'undefined') {
        					    sessionStorage.pageReload = 1;
        					}
        					console.log('Page Reload at', curDT);
        					window.location.reload();
            		    }
            		    
            		    if(window.navigator && navigator.onLine) {
            		        _ifOnline();
            		    } else {
                    		$.ajax({
                    			url: objService.netCheck,
                    			cache: false,
                    			success: function (data, status) {
                    			    _ifOnline();
                    			},
                    			error: function (request, status, error) {
                    			    if(status == 'error') {
                    			        setTimeout("objRefreshPage.reloadPage()", 30000);
                    			    }
                    			}
                    		});
            		    }
            		} else {
            		    _log('pagerefresh', 'not reload becuase of liveTV');
    				    setTimeout(objRefreshPage.reloadPage, 30000);
    				}
            	}
            }
            
            //Load Lazy Widget
            objLazyWidget = {
                init: function (onLoadVal) {
                    onLoad = !!onLoadVal ? onLoadVal : 0;
                    $('.lazyWidget').each(function () {
                        try {
                            var $this = $(this);
                            // _log('objLazyWidget init1', onLoad, $this.visible(true), !onLoad)
                            if((onLoad && $this.visible(true)) || !onLoad) {
                                var geoLoc = $this.attr('data-geoloc');
                                if(typeof geoLoc != 'undefined' && geolocation != geoLoc) {
                                    $this.remove();
                                } else if($this.html() == '' && !$this.hasClass("load_done")) {
                                    $this.html('<span/>');
                                    // _log('Lazy Load Widget', $this.attr('data-url'));
                                    var onLoadCB = $this.attr('data-onload');
                                    if(onLoadCB && typeof window[onLoadCB] == 'function') {
                                        window[onLoadCB]();
                                    } else {
                                        objLazyWidget.load($this, $this.attr('data-url'), $this.attr('data-callback'));
                                    }
                                }
                            }
                        } catch (e) {
                            _log('Error objLazyWidget', e);
                        }
                    });
                },
                load: function (elem, url, callback) {
                    var _load = function () {
                        elem.load(url, function(res, status, xhr) {
                    	    if(status == "success") {
                    	        elem.addClass("load_done");
                    	        var isAllowGdpr = window.allowGDPR && allowGDPR() || window.objGdpr && objGdpr.allow && objGdpr.allow() || 0;
                                if(!isAllowGdpr) {
                                    $('.gdpr_show').show();
                                }
                    	        if(etFlag.isCA) {
                                    $('.ca_show').show();
                                }
                    	        $("img.lazy").lazyload({effect: "fadeIn"});
                    	        if(typeof callback == 'function') {
                    		        callback();
                    	        } else if(typeof window[callback] == 'function') {
                    		        window[callback]();
                    	        }
                    	    } else {
                    	        _log('Error objLazyWidget loading', res);
                    	    }
                    	});
                    }
                    var skipPermissions = elem.attr('class') && elem.attr('class').split(' ').filter(function (e) {return e.indexOf('skip_') == 0}) || [];
                    
                    if(!skipPermissions.length) {
                        _load();
                    } else {
                        objUser.afterPrimeCheckCall(function () {
                            var skipFlag = 0;
                            skipPermissions.forEach(function (k) {
                                var permission = k.replace('skip_', '');
                                if(objUser.checkPermission(permission)) {
                                    skipFlag = 1;
                                }
                            })
                            if(!skipFlag) {
                                _load();
                            } else {
                                elem.addClass('load_skipped');
                            }
                        });
                    }
                }
            }
            
            objContentlock = {
                init : function(){
                    objContentlock.lockProcess();     
                    objContentlock.bind(); 
                },
                lockProcess : function(){
                    if($("a[data-conttype='200']").length > 0 && !_tp_data.isLogged){
                        $("a[data-conttype='200']").each(function(){
                        // 	if($(this).text() && $(this).find(".lock-tooltip").length == 0 && $(this).attr('data-hostid') != '318'){
                            if($(this).text() && $(this).find(".lock-tooltip").length == 0){
                        	    $(this).append('<div class="lock-tooltip"><span class="cSprite lock-icon"></span><span class="tooltiptext">SIGN-IN TO READ</span></div>');
                        	}
                        });
                    }
                    if($("a[data-conttype='100']").length > 0){
                        $("a[data-conttype='100']").each(function(){
                            // if($(this).text() && $(this).find(".lock-tooltip").length == 0 && $(this).attr('data-hostid') != '318'){
                        	if($(this).text() && $(this).find(".lock-tooltip").length == 0){
                        	    if(location.href.indexOf('/topic/') != -1 && $(this).find('h2, h3').length > 0){
                        	        $(this).find('h2, h3').append('<div class="lock-tooltip"><span class="cSprite lock-icon"></span></div>');
                        	    } else {
                        	        $(this).append('<div class="lock-tooltip"><span class="cSprite lock-icon"></span></div>');
                        	    }
                        	}
                        });
                    } 
                    $('.lock-tooltip').attr('style', 'display:inline-block !important')
                },
                bind : function(){
                    $( document ).ajaxComplete(function() {
                    // 	_log("ajax hit================================");
                        if(getParameterByName('showprimelogo') == 'yes') {
                            objContentlock.lockProcess();
                        }
                    	if(objAd.type == 'adfree') {
                    	    objAd.removeAd();
                    	}
                    });
                    
                    $('.pageHolder').on('mouseenter', '.lock-tooltip', function(){
                        var $this = $(this).find('.lock-icon'),
                            offset = $this.offset();
                        if($this.siblings('.tooltiptext').css("position") === "fixed") {
                            $this.siblings('.tooltiptext').css({
                                top : offset.top - $(window).scrollTop() - 30,
                                left : offset.left + 5
                            })
                        }
                    })
                }
            }
            
            objDev = {
                start:function (email) {
                    localStorage.setItem('devTool', 1);
                    if(email) {
                        localStorage.setItem('devEmailId', email);
                    }
                    objDev.init();
                },
                init:function () {
                    window.dev = function (email) {objDev.start(email)}
                    if(getParameterByName('devtool') == 1) {
                        localStorage.setItem('devTool', 1);
                    }
                    try {
                        if(localStorage.getItem('devTool')) {
                            loadModule({'module_name': 'js_devtool', v: 1});
                        }
                    } catch (e) {console.log('Error Dev : ', e);}
                }
            }
            
            objScore = {
                start:function () {
                    this.init();
                },
                init:function () {
                    try {
                        if(getParameterByName('score') == 1) {
                            $.ajax({
                                // url: 'http://localhost:8080/local.js',
                                url: '/js_storyscore.cms',
                                dataType:'script',
                                cache:true
                            })
                        }
                    } catch (e) {console.log('Error Dev : ', e);}
                }
            }
            
            // 	Manage Polls
        	objPage.poll = {
                color:function (num) {
                    var colorArray = ["#5ae8f4","#2196F3", "#ff008a", "#19d900", "#d700d9", "#ffba00", "#630bbc", "#ffc000", "#48bfa5", "#2f691d"];
                    return colorArray[num%10];
                },
                inProcess : 0,
                submitPoll:function(btnElement) {
                    var parentElement = $(btnElement).parents(".pollWidget, .pollBox");
                    var voteId = parentElement.find('[name="PRadio"]:checked').val();
            		if(!voteId){
            			alert("Please select an Option to participate in the poll");
            			return false;
            		} else if(objPage.poll.inProcess){
            			alert("Please wait vote submission is in process.");
            			return false;
            		} else {
            		    var pollId = parentElement.find('.txtPolliD').val();
            		    objPage.poll.inProcess = 1;
            		    parentElement.find('.btn').text('Processing...');
            		    $.ajax({
            		        url:'/vote_result_json.cms', // ?PRadio=3&mathuserans2=&txtPolliD=51771242&feedtype=sjson
            		        data : {
            		            feedtype:'sjson',
            		            txtPolliD : pollId,
            		            PRadio : voteId
            		        },
            		        method : 'POST',
            		        success:function (data) {
            		            objPage.poll.inProcess = 0;
            	                if(parentElement.hasClass('etnow')) {
            	                    var html = '<div class="status">You have ' + data.result + ' cast your vote</div>';
            	                    if(typeof data.option != 'undefined') {
                	                    var dWidth = (data.option.length > 0) ? parseInt(100/data.option.length) - 3 : 100;
                	                    html += '<table width="100%"><tr>';
                			            $.each(data.option, function (i, j) {
                			                var color = objPage.poll.color(i);
                			                html += '<tr>\
                                                        <td align="center" width="30%"><span class="normtxt">' + j.optiondesc + '</span></td>\
                                                        <td align="center" width="15%"><span class="normtxt">' + j.optionperc + '%</span></td>\
                                                        <td align="left" width="55%"><div class="perb" style="background-color:' + color + ';width: ' + j.optionperc + '%;"></div></td>\
                                                    </tr>';
                			            });
                			            html += '</tr></table>';
            	                    }
            	                }else if(parentElement.hasClass('market')) {
            	                    var html = '<div class="status">You have ' + data.result + ' cast your vote</div>';
            	                    if(typeof data.option != 'undefined') {
                	                    var dWidth = (data.option.length > 0) ? parseInt(100/data.option.length) - 3 : 100;
                	                    html += '<table width="100%"><tr>';
                			            $.each(data.option, function (i, j) {
                			                var color = objPage.poll.color(i);
                			                html += '<tr>\
                                                        <td align="left" width="30%"><span class="normtxt">' + j.optiondesc + '</span></td>\
                                                        <td align="left" width="15%"><span class="normtxt">' + j.optionperc + '%</span></td>\
                                                        <td align="left" width="55%"><div class="perb" style="background-color:' + color + ';width: ' + j.optionperc + '%;"></div></td>\
                                                    </tr>';
                			            });
                			            html += '</tr></table>';
            	                    }
            	                } else if(parentElement.hasClass('horizontal')) {
            	                    var html = '<div class="status">You have ' + data.result + ' cast your vote</div>';
            	                    if(typeof data.option != 'undefined') {
                	                    var dWidth = (data.option.length > 0) ? parseInt(100/data.option.length) - 3 : 100;
                	                    html += '<table width="100%"><tr>';
                			            $.each(data.option, function (i, j) {
                			                var color = objPage.poll.color(i);
                			                var border  = i > 0 ? 'bdrlft' : '';
                			                html += '<td align="left" class="' + border + '" width="70"><span class="normtxt">' + j.optiondesc + '</span></td><td align="left" width="35"><span class="normtxt">' + j.optionperc + '%</span></td><td align="left" width="100"><div class="perb" style="background-color:' + color + ';width: ' + j.optionperc + '%;"></div></td>';
                			            });
                			            html += '</tr></table>';
            	                    }
            	                } else if(parentElement.hasClass('horizontalnew')) {
            	                    $('.pollImg').hide();
            	                    $(".poll h2").css("padding","0 13px");
            	                    var html = '<div class="status">You have ' + data.result + ' cast your vote</div>';
            	                    if(typeof data.option != 'undefined') {
                	                    var dWidth = (data.option.length > 0) ? parseInt(100/data.option.length) - 3 : 100;
                	                    html += '<div class="voting">';
                			            $.each(data.option, function (i, j) {
                			                var color = objPage.poll.color(i);
                			                var border  = i > 0 ? 'bdrlft' : '';
                			                 html +='<div class="resultBox"><p>' + j.optiondesc + '</p><div><div class="resultValue" style="background-color:' + color +';width: ' + j.optionperc + '%;"></div></div><span>' + j.optionperc + '%</span></div>'  
                			            });
                			            html += '</div>';
            	                    }
            	                } else {
            			            var html = '<div class="status">You have ' + data.result + ' cast your vote</div>';
            			            if(typeof data.option != 'undefined') {
                			            $.each(data.option, function (i, j) {
                			                var color = objPage.poll.color(i);
                			                html += '<div class="rList normtxt">\
                			                <div class="pres" style="background-color:' + color + ';width: ' + j.optionperc + '%;"></div>\
                			                <div class="res"><span class="ans">' + j.optiondesc + '</span><span class="per">' + j.optionperc + '%</span></div>\
                			                </div>';
                			            });
            			            }
            	                }
            		            parentElement.find('.result').html(html).slideDown(500).siblings('.options').slideUp();
            		        }
            		    });
            		}
                }
            }
            // Manage polls end
            
            gainerBlockDefault = { // Gainers Block in RHS
                data: {},
                slideInterval: 5000,
                slideIndex: 0,
                widget: ".gainerData",
                interval:0,
                init: function () {
                    if($(gainerBlockDefault.widget).length > 0) {
                        gainerBlockDefault.getData();
                    }
                },
                service: objMktD.bself+"/ET_Community/Gain",
                getDataCallback: function  (data) {
                    gainerBlockDefault.data = data;
                    if(gainerBlockDefault.data !="undefined" && !!data.searchresult){
                        gainerBlockDefault.slide(0);
                        $(gainerBlockDefault.widget).slideDown();
                    }
                    else{
                        $(gainerBlockDefault.widget).hide();
                    }
                },
                getData: function () {
                    $.ajax({
                        url: gainerBlockDefault.service,
                        dataType: "script",
                        cache: true,
                        data:{
                            pagesize: 5,
                            sortby: "percentchange",
                            sortorder: "desc",
                            callback: "gainerBlockDefault.getDataCallback",
                            sort: "intraday"
                        }
                    });
                },
                slide: function (i) {
                        var result = gainerBlockDefault.data.searchresult, color_class = "noChange";
                        gainerBlockDefault.prepareHTML(i, result);
                        clearTimeout(gainerBlockDefault.interval);
            			gainerBlockDefault.interval = setTimeout(function () {
            				$(gainerBlockDefault.widget +" .gainerText, "+ gainerBlockDefault.widget +" .gainerVal, "+ gainerBlockDefault.widget +" .graph").fadeOut("500",
            					function () {
            					gainerBlockDefault.slide(gainerBlockDefault.slideIndex);
            				});
            			}, gainerBlockDefault.slideInterval);
            			$(window).focus(function () {
            				clearTimeout(gainerBlockDefault.interval);
            				gainerBlockDefault.interval = setTimeout(function () {
            					$(gainerBlockDefault.widget +" .gainerText, "+ gainerBlockDefault.widget +" .gainerVal, "+ gainerBlockDefault.widget +" .graph").fadeOut("500",
            						function () {
            						gainerBlockDefault.slide(gainerBlockDefault.slideIndex);
            					});
            				}, gainerBlockDefault.slideInterval);
            			}).blur(function () {
                             clearTimeout(gainerBlockDefault.interval);
                        });
                },
                prepareHTML: function (i, result) {
                    try{
                        color_class = result[i].absolutechange > 0 ? "green" : "red";
                        $('.gainerData .gainerText a').text(result[i].companyName2).attr("href", result[i].seoname+"/stocks/companyid-"+result[i].companyid+".cms");
                        $('.gainerData .gainerVal .gainerLtp').text(result[i].current);
                        $('.gainerData .gainerVal .gainerNetChg').text(result[i].absolutechange).removeClass('noChange green red').addClass(color_class);
                        $('.gainerData .gainerVal .gainerPerChg').text(result[i].percentChange).removeClass('noChange green red').addClass(color_class);
                        $('.gainerData .graph img').attr("src", result[i].sparklineURL.replace('http:', 'https:'));
                        $('.gainerData .graph .low').text(result[i].low);
                        $('.gainerData .graph .high').text(result[i].high);
                        
                        var gainerTextHref = $('.gainerText').find('a').attr('href');
                        $('.gainerData .gainerText a').click(function() {
                            if(gainerTextHref) {
                			    location.href = gainerTextHref;
                			} else {
                			    saveLogs({'type': 'location_href_error', 'gainerTextHref': gainerTextHref});
                			}
                        });

                        $(gainerBlockDefault.widget +" .gainerText, "+ gainerBlockDefault.widget +" .gainerVal, "+ gainerBlockDefault.widget +" .graph").fadeIn("500",
                            function () {
                                if(gainerBlockDefault.slideIndex == result.length -1){
                                    gainerBlockDefault.slideIndex = 0;
                                }
                                else{
                                    gainerBlockDefault.slideIndex++;
                                }
                            });  
                    }catch(e){_log("error", e)}
                        
                }
            }
            
            var balanceSecHight = { // For blancing left right widgets height
                init:function (lelm,relm,rhid,gap) {
                    var len = $(rhid).length;
            		if (gap === undefined) {
            			  gap = 0;
            		} 
                    var i = 0;
                    do{
                        var lsh = $(lelm).outerHeight(), lrh = $(relm).outerHeight();
                        
                        if(i < len && lsh > (lrh + gap)) {
                            $(rhid).eq(i).show();
                            /*$(rhid).eq(i).removeClass('hidden');*/
                        } else {
                            break;
                        }
                        i++;
                    } while(1);
                }
            }
            
            //Not to be missed
            var loadSideWidgetsNTBM = {
            	flag: true,
            	load: function(){
            		var target = $("#mostPopular");
            		if ((target.visible(true) || $(window).scrollTop() >= target.offset().top) && target.is(":empty") && loadSideWidgetsNTBM.flag) {
            		    loadSideWidgetsNTBM.flag = false;
            		    objLazyWidget.load(target, target.attr("data-url"), function () {
            		      $("#mostPopular img.lazy").lazyload({effect: "fadeIn"});
                			gainerBlockDefault.init();
                			if(target.find("[data-adsSlot]").length > 0 && tpName == 'liveblog') {
                			    objAd.loadAds();
                			}
            		    });
            		}
            	}
            }
            //Not to be missed end
            
            // New Hook Integreated code start here 
            newsHooksFn = {
                load: function (hookId) {
                   try {
                        $.ajax({
                            url:(objCommon.isLive ? objDomain.js : '') + '/js_ethooks.cms?v=6',
                            dataType:'script',
                            cache:true,
                            success: function () {
                                if(hookOverLayCall == true){
                                    if($('#profLayerContainer .profLayerBox:visible').length == 0){
                                        // newsHooksFn.init(hookId);
                                    }
                                }else{
                                    if(typeof(newsLetterApp) != 'undefined') {
                                        newsLetterApp.init();
                                    }
                                }
                            }
                        });
                        
                    } catch (e) {console.log('Error : newsHooksFn', e);}
               }
            }
            // New Hook Integreated code end here
            
            objSharing = {
                checkCount : 3,
                delay : 2000,
                constants: {
            		icon: {
            			fb: '.fb[data-share-url]',
            			twt: '.twt',
            			gp: '.gp',
            			lin: '.in',
            			whatsapp: '.wa',
            			pinit: '.pint',
            			reddit : '.reddit',
            			flipboard : '.flipboard'
            		},
            		url: {
            			base: 'https://economictimes.indiatimes.com',
            			fb: 'https://www.facebook.com/sharer.php',
            			twt: 'https://twitter.com/share?',
            			gp: 'https://plus.google.com/share?url=',
            			lin: 'https://www.linkedin.com/cws/share?url=',
            			whatsapp: 'https://api.whatsapp.com//send?text=',
            			pinit: 'https://pinterest.com/pin/create/button/?url=',
            			reddit : 'http://reddit.com/submit?url=',
            			flipboard : 'https://share.flipboard.com/bookmarklet/popout?ext=sharethis&url='
            		},
            		baseHost: 'economictimes.indiatimes.com',
            		openerName: 'sharer',
            		popUpSettings: 'toolbar=0,status=0,width=626,height=436'
            	},
            	getShareUrl: function (frm) {
            		var host = this.constants.baseHost;
            		var url = window.location.protocol + '//' + host + location.pathname.replace('slideshow_new','slideshow');
            		return url;
            		
            	},
            	openDialog: function (config) {
            		var settings = config.settings ? config.settings : this.constants.popUpSettings;
            		window.open(config.url, config.name, settings);
            		
            	},
            	getShareTitle: function () {
            		var ogTitleEle = $('meta[property="og:title"]');
            		if (ogTitleEle) {
            			var shareTitle = ogTitleEle.attr('content');
            			if (shareTitle) {
            				return shareTitle;
            			}
            		}
            		return document.title;
            	},
            	share: function (input, info, share_title,via,wa_text) {
            		var shareUrl = (info != "" && info != undefined) ? info : this.getShareUrl(input.replace('.', ''));
            		var shareTitle = (share_title != "" && share_title != undefined) ? share_title : this.getShareTitle();
            		switch (input) {
            			case this.constants.icon.fb:
            				var fbUrl = '';
            				if(info !='' && info != undefined ){
            					fbUrl = this.constants.url.fb + '?u=' + info;
            				}else{
            					fbUrl = this.constants.url.fb + '?u=' + encodeURIComponent(shareUrl) + '&t=' + encodeURIComponent(shareTitle);
            				}
            				_log('fbUrl',fbUrl);
            				this.openDialog({url: fbUrl, name: this.constants.openerName});
            				return false;
            				break;
            			case this.constants.icon.twt:
            				shareTitle = shareTitle.replace(' - The Economic Times on Mobile', '');
            				shareTitle = (shareTitle.length <= 110) ? shareTitle : shareTitle.substring(0,107)+"...";
            				var reqObj = {
            					text: encodeURIComponent(shareTitle.replace('|','-')),
            					url: encodeURIComponent(info)
            				};
            				shareUrl = this.constants.url.twt + decodeURIComponent($.param(reqObj)) + '&via=' + via;
            				this.openDialog({url: shareUrl, name: this.constants.openerName});
            				break;
            			case this.constants.icon.gp:
            				if(info !='' && info != undefined ){
            					shareUrl = this.constants.url.gp + info;
            				}else{
            					shareUrl = this.constants.url.gp + shareUrl;
            				}
            				this.openDialog({url: shareUrl, name: this.constants.openerName});
            				return false;
            				break;
            			case this.constants.icon.lin:
            				if(info !='' && info != undefined ){
            					shareUrl = this.constants.url.lin + info ;
            				}else{
            					shareUrl = this.constants.url.lin + shareUrl;
            				}
            				this.openDialog({url: shareUrl, name: this.constants.openerName});
            				return false;
            				break;
            			case this.constants.icon.whatsapp:
            				var titletoshare = (share_title !='') ? share_title : shareTitle;
            				shareUrl = this.constants.url.whatsapp + wa_text  + encodeURIComponent(titletoshare) + ' - ' + info;
            				window.open(shareUrl,'_blank','');
            				break;
            			case this.constants.icon.pinit:
            				var titletoshare = (share_title !='') ? share_title : shareTitle;
            				shareUrl = this.constants.url.pinit + info + '&description=' + encodeURIComponent(titletoshare);
            				this.openDialog({url: shareUrl, name: this.constants.openerName});
            				return false;
            				break;
            			case this.constants.icon.reddit:
            				var titletoshare = (share_title !='') ? share_title : shareTitle;
            				shareUrl = this.constants.url.reddit + info + ' - ' + encodeURIComponent(titletoshare);
            				this.openDialog({url: shareUrl, name: this.constants.openerName});
            				return false;
            				break;
            			case this.constants.icon.flipboard:
            				var titletoshare = (share_title !='') ? share_title : shareTitle;
            				shareUrl = this.constants.url.flipboard + info + '&title=' + encodeURIComponent(titletoshare);
            				this.openDialog({url: shareUrl, name: this.constants.openerName});
            				return false;
            				break;
            		}
            	},
            	onClick: function () {
            		$.each(this.constants.icon, function (i, v) {
            			$('.pageHolder').on('click',v,function (event) {
            				var cls = '.' + $(this).attr('class').split(' ')[0] + ($(this).attr('class').split(' ')[0] == 'fb'?'[data-share-url]':'');
            				var share_url = ($(this).attr('data-share-url') !="" && $(this).attr('data-share-url') != undefined) ? $(this).attr('data-share-url') : $(this).attr('data-src');
            				var share_title = ($(this).attr('data-share-title') !="" && $(this).attr("data-share-title") != undefined) ? $(this).attr("data-share-title") : '';
            				var via_text = ($(this).attr('data-via') !="" && $(this).attr("data-via") != undefined) ? $(this).attr("data-via") : 'economictimes';
            				var wa_text = ($(this).attr('data-watext') !="" && $(this).attr("data-watext") != undefined) ? $(this).attr("data-watext") : '';
            				_log('click',cls, share_url,share_title,via_text,wa_text);
            				objSharing.share(cls, share_url,share_title,via_text,wa_text);
            			});
            		});
            	},
                init : function() {
                    try {
                        this.onClick();
                        if (typeof $.jStorage !='undefined' && $.jStorage.get('log') == 1) {
                           // _log('objSharing init done');
                        }
                        objSharing.checkSkinning(); //setTimeout("objSharing.checkSkinning()", objSharing.delay);
                        objSharing.resizeBind();
                    } catch (e) {
                        if (typeof $.jStorage !='undefined' && $.jStorage.get('log') == 1) {
                            _log('Error : objSharing.init - ', e);
                        }
                    }
                },
                checkSkinning : function() {
                    try {
                        var innovElements = $('div[data-size*="[160, 600]"], div[data-size*="[125, 600]"] ,div[data-size*="[120,600]"]');
                        if((typeof skinningExist != 'undefined' && skinningExist == true) || $(window).width() <= 1153 || $('body.bgImg').length || (innovElements.length && !(innovElements.is(":empty")))) {
                            objSharing.innerSharingShow();
                            if(!$('body.bgImg').length){
                                $( "body" ).addClass("bgImg");
                            }
                        } else if(objSharing.checkCount > 0) {
                            setTimeout("objSharing.checkSkinning()", objSharing.delay);
                            objSharing.checkCount--;
                        }
                    } catch (e) {
                        if (typeof $.jStorage !='undefined' && $.jStorage.get('log') == 1) {
                            _log('Error : objSharing.checkSkinning - ', e);
                        }
                    }
                },
                innerSharingShow : function() {
                    $("#shareHorz").show();
            	    $("#shareVertHolder, #shareHolder,#sharerHolder").hide();
                },
                outerSharingShow : function() {
                    $("#shareHorz").hide();
            	    $("#shareVertHolder,#shareHolder,#sharerHolder").show();
                },
                resizeBind : function () {
                    $(window).resize(function(){
                        var innovElements = $('div[data-size*="[160, 600]"], div[data-size*="[125, 600]"], div[data-size*="[120,600]"]');
                		if((typeof skinningExist != 'undefined' && skinningExist == true) || $(window).width() <= 1153 || $('body.bgImg').length || (innovElements.length && !(innovElements.is(":empty")))) {
                		    objSharing.innerSharingShow();
                		    $("#topnavBlk").addClass("skinningExist");
                		} else if ($(window).width() > 1153){
                		     objSharing.outerSharingShow();
                		}
                	});
                }
            }
            
            function changeParamInUrl(url, obj, delParams) {
            	try {
            	    
            		var path = '',finalUrl = url, qStringObj = {}, baseUrl = '';
            		if(url.indexOf('?') != -1) {
            		    path = url.substr(0, url.indexOf('?'));
            		    url = url.substr(url.indexOf('?') + 1, url.length - 1);
            		} else if(url.indexOf('http:') != -1 || url.indexOf('https:') != -1 ){
            			path = finalUrl;
            		}
            		
            		var match, re;
            		re = /\??(.*?)=([^\&]*)&?/gi;
            		while (match = re.exec(url)) {
            		  qStringObj[match[1]] = match[2];
            		}
            		
            		if(typeof obj == 'object') {
            			$.each(obj, function (i, v) {
            				var exist = 0;
            				$.each(qStringObj, function (index, value) {
            					if (i == index) {
            						qStringObj[index] = v;
            						exist = 1;
            					}
            				});
            				if (!exist && v !="") {
            					qStringObj[i] =  v;
            				}
            			});
            		}
            		if(typeof delParams == 'object') {
            			$.each(delParams, function (i, v) {
            				delete qStringObj[v];
            			});
            		}
            		var newUrl = '';
            		$.each(qStringObj, function (k, v) {
            			if(newUrl == '') {
            				newUrl += k + '=' + v;
            			} else {
            				newUrl += '&' + k + '=' + v;
            			}
            		});
            		if(newUrl) {
            			finalUrl = path ? path + '?' + newUrl : newUrl;
            		}
            	} catch (e) {
            		_log('Error modifyUrl: ', e);
            	}
            	return finalUrl;
            }
            
            objPoints = {
                data: {
                    uid: '',
                    uemail: '',
                    aname: '',
                    platform: 'WEB',
                    txnId: new Date().getTime(),
                    pcode: 'ET',
                    scode: 'ET'
                },
                service: '/timespoints.cms',
                init: function () {
                    var data = objPoints.data;
                    data.uemail = _tp_data.email;
                    data.uid = _tp_data.ssouid;
                },
                add: function (aname, txnId) {
                    if(typeof txnId !== 'undefined') {
                        this.data.txnId = txnId;
                    }
                    objPoints.data.aname = $.trim(aname);
                    if(objPoints.data.uid != '' && objPoints.data.uid != null && objPoints.data.aname != '') {
                        $.ajax({
                            url: objPoints.service,
                            method: 'POST',
                            data: objPoints.data,
                            success: function () {
                                _log('times points response');
                            }
                        });
                    }
                }
            }
           
 objAd = (function () {
    var objAdLocal = {
        google_lazyad_enabled_tp: typeof objVc!="undefined" &&  objVc.google_lazyad_enabled_tp && JSON.parse(objVc.google_lazyad_enabled_tp) || [],
        aud_flag:"null",
        isFirstLoad:0,
        atf300_sticky: 0,
        adRefreshInterval:20000,
        allRenderedAds:[],
        currentViewPortAds:[],
        offViewPortAds:[],
        skinningAd:[],
        int_duration:10,
        PPID:'',
        loaded:0,
        type: 'all',
        oopAds: [],
        oopAdsIds: [],
        nonOopAds: [],
        nonOopAdsIds: [],
        loadedAdCode: [],
        amazonTam:[],
        adDivIds:[],
        init : function() {
            var urlParams = window.location.search || "";
            _log('ads: init', window.skipAds);
            objAdLocal && objAdLocal.dfpAdDetector && objAdLocal.dfpAdDetector();
            if(typeof msid!="undefined" && msid == "13352306" && urlParams.indexOf("skip_refresh=1") == -1){
             typeof objMonetize!="undefined" && objMonetize.viewableImpressionDfp();
             //typeof objMonetize!="undefined" && objMonetize.visibilityChangedListner();
             typeof objMonetize!="undefined" && objMonetize.adcodeScannerForRefresh();
            }
            objAdLocal.PPID = objAdLocal.returnPPID();
            if(getParameterByName('removetopad') == 1) {
                $('#topAd').remove();
            }
           	_log('ads: init', window.skipAds);
            var isAdFreeExpRef = typeof $.jStorage != "undefined" && $.jStorage.get('adFreeCampign_' + (objUser.info.ssoid || _tp_data.ssoid || $.cookie('_grx')));
            if(_tp_data.isPrime || _tp_data.isAdfree || window.skipAds == 1 || (isAdFreeExpRef && Number(isAdFreeExpRef.eligible))) {
                objAdLocal.type = 'adfree';
                objAdLocal.removeAd();
                $(window).scroll(function () {
                    objAdLocal.removeLazyAd();
                });
            } 
            
            if(!objAdLocal.loaded && ($("[data-adsSlot]").length > 0) && (getParameterByName('opt') != '1')) {
                objAdLocal.loaded = 1;
                var callback = objAdLocal.initLoadAds;
                _log('logged',_tp_data);
                if(_tp_data.isLogged) {
                    callback = function () {
                        objAdLocal.checkSubscription(objAdLocal.initLoadAds);
                    };
                }
                 //if(typeof subsec2_common != "undefined" && subsec2_common !='82519373'){ //cryptocurrency
                     objAdLocal.loadAdScript(callback);
                 //}
            }
        },
        loadGoogleVignette:function(){
            try{
                if(typeof objVc!="undefined" && objVc.googlevignette_web == "1" && typeof geoinfo!="undefined" && geoinfo.geolocation!="1"){
                    var isExist = document.querySelector("script[src*='https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1902173858658913']");
                    if(!isExist && typeof objMonetize!="undefined" && objMonetize.loadAssets){
                        objMonetize.loadAssets("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1902173858658913", "js", "async", "head",  function() { window.__isGooglevignette__ = 1; }, {"crossorigin":"anonymous"});

                    }
                    
                }
                
            }catch(e){}
        },
        loadAdShield:function(){
            try{
                  var isExist = document.querySelector("script[src*='https://html-load.com/loader.min.js']");
                  if(!isExist){
                      var script = document.createElement('script');
                      script.type = 'text/javascript';
                      script.setAttribute('onload', "let l=!1,k=Math.random().toString(),a='html-load.com';window.addEventListener('message',e=>{e.data===k+'_as_res'&&(l=!0)}),window.postMessage(k+'_as_req','*'),new Promise(e=>{let t=Math.random().toString(),r=Math.random().toString();window.addEventListener('message',e=>e.data===t&&window.postMessage(r,'*')),window.addEventListener('message',t=>t.data===r&&e()),window.postMessage(t,'*')}).then(()=>{window.setTimeout(()=>{if(!l){setInterval(()=>document.querySelectorAll('link,style').forEach((e)=>e.remove()),100);let e=atob('RmFpbGVkIHRvIGxvYWQgd2Vic2l0ZSBwcm9wZXJseSBzaW5jZSA')+a+atob('IGlzIGJsb2NrZWQuIFBsZWFzZSBhbGxvdyA')+a;throw alert(e),fetch('https://error-report.com/report?type=loader_light&url='+btoa(location.href)+'&error='+btoa(e),{method:'POST'}).then(e=>e.text()).then(t=>{let r=document.createElement('iframe');r.src='https://report.error-report.com/modal?eventId='+t+'&error='+btoa(e)+'&domain='+a,r.setAttribute('style','width: 100vw; height: 100vh; z-index: 2147483647; position: fixed; left: 0; top: 0;'),document.body.appendChild(r);let o=e=>{'close-error-report'===e.data&&(r.remove(),window.removeEventListener('message',o))};window.addEventListener('message',o)}).catch(e=>{confirm(navigator.language.toLowerCase().startsWith('ko')?decodeURIComponent(escape(atob('7J6Y66q765CcIOyVoOuTnOu4lOuhnSDtlYTthLDroZwg7Ju57Y6Y7J207KeAIOuhnOuUqeyXkCDsi6TtjKjtlZjsmIDsirXri4jri6QuIOyVoOuTnOu4lOuhneydhCDruYTtmZzshLHtmZTtlZwg7ZuEIOybueyCrOydtO2KuOulvCDsnbTsmqntlbTso7zshLjsmpQuICjsnpDshLjtlZwg64K07Jqp7J2AICftmZXsnbgnIOuyhO2KvOydhCDriIzrn6wg7ZmV7J247ZW07KO87IS47JqUKQ'))):atob('VGhpcyBwYWdlIGNvdWxkIG5vdCBiZSBsb2FkZWQgcHJvcGVybHkgZHVlIHRvIGluY29ycmVjdCAvIGJhZCBmaWx0ZXJpbmcgcnVsZShzKSBvZiBhZGJsb2NrZXJzIGluIHVzZS4gUGxlYXNlIGRpc2FibGUgYWxsIGFkYmxvY2tlcnMgdG8gY29udGludWUgdXNpbmcgdGhlIHdlYnNpdGUuIChjbGljayBPSyBpZiB5b3UnZCBsaWtlIHRvIGxlYXJuIG1vcmUp'))?location.href='https://report.error-report.com/modal?eventId=&error='+btoa(e.toString())+'&domain='+a:location.reload()}),Error(e)}},1e3)});", );
                      script.setAttribute('onerror', "let e=document.getElementById('DEWQnTTgxDI'),t=document.createElement('script');for(let r=0;r<e.attributes.length;r++)t.setAttribute(e.attributes[r].name,e.attributes[r].value);let s=new window.URL(e.src),a=['html-load.com','fb.html-load.com','content-loader.com','fb.content-loader.com'];if(void 0===window.as_retry&&(window.as_retry=0),window.as_retry>=a.length){setInterval(()=>document.querySelectorAll('link,style').forEach((e)=>e.remove()),100);let o=atob('RmFpbGVkIHRvIGxvYWQgd2Vic2l0ZSBwcm9wZXJseSBzaW5jZSA')+a[0]+atob('IGlzIGJsb2NrZWQuIFBsZWFzZSBhbGxvdyA')+a[0];throw alert(o),fetch('https://error-report.com/report?type=loader_light&url='+btoa(location.href)+'&error='+btoa(o),{method:'POST'}).then(e=>e.text()).then(e=>{let r=document.createElement('iframe');r.src='https://report.error-report.com/modal?eventId='+e+'&error='+btoa(o)+'&domain='+a[0],r.setAttribute('style','width: 100vw; height: 100vh; z-index: 2147483647; position: fixed; left: 0; top: 0;'),document.body.appendChild(r);let f=e=>{'close-error-report'===e.data&&(r.remove(),window.removeEventListener('message',f))};window.addEventListener('message',f)}).catch(o=>{let l=navigator.language.toLowerCase().startsWith('ko')?decodeURIComponent(escape(atob('7J6Y66q765CcIOyVoOuTnOu4lOuhnSDtlYTthLDroZwg7Ju57Y6Y7J207KeAIOuhnOuUqeyXkCDsi6TtjKjtlZjsmIDsirXri4jri6QuIOyVoOuTnOu4lOuhneydhCDruYTtmZzshLHtmZTtlZwg7ZuEIOybueyCrOydtO2KuOulvCDsnbTsmqntlbTso7zshLjsmpQuICjsnpDshLjtlZwg64K07Jqp7J2AICftmZXsnbgnIOuyhO2KvOydhCDriIzrn6wg7ZmV7J247ZW07KO87IS47JqUKQ'))):atob('VGhpcyBwYWdlIGNvdWxkIG5vdCBiZSBsb2FkZWQgcHJvcGVybHkgZHVlIHRvIGluY29ycmVjdCAvIGJhZCBmaWx0ZXJpbmcgcnVsZShzKSBvZiBhZGJsb2NrZXJzIGluIHVzZS4gUGxlYXNlIGRpc2FibGUgYWxsIGFkYmxvY2tlcnMgdG8gY29udGludWUgdXNpbmcgdGhlIHdlYnNpdGUuIChjbGljayBPSyBpZiB5b3UnZCBsaWtlIHRvIGxlYXJuIG1vcmUp');confirm(l)?location.href='https://report.error-report.com/modal?eventId=&error='+btoa(o.toString())+'&domain='+a[0]:location.reload()}),Error(o)}s.host=a[window.as_retry++],t.setAttribute('src',s.href),t.setAttribute('as-async','true'),e.setAttribute('id', e.getAttribute('id')+'_'),e.parentNode.insertBefore(t,e),e.remove();", );
                      script.src = 'https://html-load.com/loader.min.js';
                      script.data = 'ithc1r8q8e878b8v808e1p8efy81108k3e8iy28y8e808784y8i801m8i8i878y8e387848r8i28y8e878i8g8712z80808y8e31me8i728y8e8bk8j0871pky8b108k8y8e8sf12y81108k8s8e1z89';
                      script.id = 'DEWQnTTgxDI';
                      script.setAttribute('data-sdk', '1.0.5');
                      script.setAttribute('data-cfasync', 'false');
                      document.body.appendChild(script);
                  }
            }catch(e){}
        },
        loadAmazonTamScript:function(){
            try{
                objMonetize.loadAssets("https://c.amazon-adsystem.com/aax2/apstag.js", "js", "async", "body",  function() { window.__isTAMLoaded__ = 1; }, {});
               	!function(a9,a,p,s,t,A,g){if(a[a9])return;function q(c,r){a[a9]._Q.push([c,r])}a[a9]={init:function(){q("i",arguments)},fetchBids:function(){q("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]};A=p.createElement(s);A.async=!0;A.src=t;g=p.getElementsByTagName(s)[0];g.parentNode.insertBefore(A,g)}("apstag",window,document,"script","https://c.amazon-adsystem.com/aax2/apstag.js");
                    // initialize apstag with global settings
                    apstag.init({"pubID":"5025","adServer":"googletag"});
                 
            }catch(e){}
        },
        getKeyValueFromUrl:function(key){
            try{
                var obj_url = window.URLSearchParams && new URLSearchParams(window.location.search);
                var key_value = obj_url.get && obj_url.get(key);
                return key_value;
            }catch(e){}
        },
        generatePPID: function (length) {
            try{
                var result  = '';
                var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'+ new Date().getTime() +'abcdefghijklmnopqrstuvwxyz';
                var charactersLength = characters.length;
                for ( var i = 0; i < length; i++ ) {
                  result += characters.charAt(Math.floor(Math.random() * charactersLength));
               }
               typeof ga != "undefined" && ga('set', 'dimension116', result);
               return result;
            }catch(e){}
        },
        returnPPID:function(){
            try{
                var ppid ='';
                if(typeof $.jStorage !='undefined'){
                    ppid =  objAd.readCookie('_col_uuid') ?  objAd.readCookie('_col_uuid') : $.jStorage.get("col_ppid") ? $.jStorage.get("col_ppid"):'';
                    !$.jStorage.get("col_ppid") ?  $.jStorage.set("col_ppid", ppid) : '';
                }
                return ppid;
            }catch(e){}
        },
        readCookie : function(name) {
        	var nameEQ = name + "=";
        	var ca = document.cookie.split(';');
        	for (var i = 0; i < ca.length; i++) {
        		var c = ca[i];
        		while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        		if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
        	}
        	return null;
        },
        dfpAdDetector:function(){
            try{
                window.googletag = window.googletag || {}; googletag.cmd = googletag.cmd || [];
                 googletag.cmd.push(function() {
                     googletag.pubads().addEventListener('slotRenderEnded', function(event) {
                         if (event && event.slot && !event.isEmpty) { 
                             objAd.adBlocker = 0;
                         }
                     })
                 });

            }catch(e){}
        },
        loadAdScript: function (callback) {
            if(typeof _tp_data !="undefined" && _tp_data.isPrime == false && _tp_data.isAdfree == false && location.href.indexOf("opt=1") == -1){
                if(typeof objMonetize!="undefined" && objMonetize.loadTaboolaScript){
                    objMonetize.loadTaboolaScript(objAd.executeTaboolaAd);
                }
                var isExist = document.querySelector("script[src*='https://assets.toiimg.com/js/til_prebid.js']");
                if(!isExist && typeof objMonetize!="undefined" && objMonetize.loadAssets && typeof tpName != undefined && tpName == "default"){
                    objVc.magnite_hb = 0;
                    objMonetize.loadAssets("https://assets.toiimg.com/js/til_prebid.js?v=14", "js", "async", "body",  function() { window.__isPrebidLoaded__ = 1; }, {});
                    typeof objAd!="undefined" && objAd.loadAmazonTamScript &&  objAd.loadAmazonTamScript();
                }
                typeof objAd!="undefined" && objAd.loadGoogleVignette();
            }
            //  if(objMonetize.loadIndexExchangeScript && typeof tpName!="undefined" && !(tpName == 'stocks') && !$('.skip_ads').length){
            //     objMonetize.loadIndexExchangeScript();
            //     //objMonetize.loadBrowsiScript();
            // }
            /*if(typeof objMonetize !="undefined"){
                objMonetize.loadLinkedinScript();
            }*/
            _log('ads: loadAdScript');
            // global variable declaration of googletag.
            
            window.googletag = window.googletag || {}; googletag.cmd = googletag.cmd || [];
            var urlParams =window.location.search ? window.location.search : "";
            (function() {
                function gptInit() {
                    if(typeof callback == 'function') {
                        callback();
                    }
                    if(objCommon.isAutoReload) {
                        $(window).scroll(function() {
                            objAdLocal.initLoadAds();
                        });
                    } else {
                        if(window.sessionStorage && window.sessionStorage.removeItem) {
                            window.sessionStorage.removeItem('networkAdsList');
                        }
                    }
                }
                if(typeof tpName != undefined && tpName=="default"){
                        objAdLocal.callCustomPrebid();
                        
                    }else{
                    if($(document).find('script[src*="//securepubads.g.doubleclick.net/tag/js/gpt.js"]').length) {
                        objAdLocal.defineAdslot();
                        gptInit();
                    } else {
                        if(typeof(tpName) != undefined && !$('.skip_ads').length){
                            if(typeof objVc!="undefined" && objVc.magnite_hb && objVc.magnite_hb == "1" && location.href.indexOf("opt=1") == -1){
                                var isExist = document.querySelector("script[src*='https://micro.rubiconproject.com/prebid/dynamic/4642.js']");
                                var exclude_templates =typeof objVc!="undefined" &&  objVc.magnite_exclude_tp && JSON.parse(objVc.magnite_exclude_tp);
                                if(!isExist && typeof objMonetize!="undefined" && objMonetize.loadAssets && exclude_templates.indexOf(tpName) == -1){
                                    objMonetize.loadAssets("https://micro.rubiconproject.com/prebid/dynamic/4642.js", "js", "async", "head",  function() { window.__isMagniteScript__ = 1; }, {});
                                }
                            }
    
                            var gads = document.createElement('script');
                            gads.async = true;
                            gads.type = 'text/javascript';
                            gads.src = 'https://securepubads.g.doubleclick.net/tag/js/gpt.js?network-code=7176';
                            gads.onload = function () {
                               if(typeof tpName != undefined && tpName!="default"){
                                    objAdLocal.defineAdslot();
                                    gptInit();
                                }
                            };
                            
                            var node = document.getElementsByTagName('head')[0];
                           // node.parentNode.insertBefore(gads, node);
                            node.appendChild(gads);
                        }
                    }
                }
            })();
        },
        loadColombia: function() {
            var ss1 = window.subsec1_common;
            if(typeof colombia == 'undefined' && !($('script[src*="colombia_v2"]').length)) {
                var colombia = colombia || {};
                colombia.fns = colombia.fns || [];
                (function () {
                    var cads = document.createElement("script");
                    cads.async = true;
                    cads.type = "text/javascript";
                    
                    if(typeof tmplName !="undefined" && tmplName =="articleshow_main_colombiatest"){
                        cads.src = "https://static.clmbtech.com/ad/commons/js/colombia_test.js";
                    }else{
                        cads.src = "https://static.clmbtech.com/ad/commons/js/2308/colombia_v2.js";
                    }
                    /*if((typeof subsec1_common !="undefined" && subsec1_common == '1977021501') || window.location.search.indexOf("gpt=1") > -1) {
                        var dt = dateFormat(new Date(), '%Y%M%d');
                        cads.src = objDomain.js + '/js_colombia_v2.cms?v=' + dt;
                    }*/
                    if(window.location.search.indexOf("colombia_test=1") > -1){
                        cads.src = "https://static.clmbtech.com/ad/commons/js/colombia_test.js";
                    }
                    var node = document.getElementsByTagName("script")[0];
                    node.parentNode.insertBefore(cads, node);
                })();
            }
        },
        initLoadAds: function () {
            if(objCommon.isAutoReload == 0){
                objAdLocal.loadAds($('body'), 1, 0);
            }else{
                $("[data-adsSlot]").each(function() {
                    var $this = $(this);
                    var networkAds = window.sessionStorage && window.sessionStorage.networkAdsList || '';
                    if($this.visible(true) || networkAds.indexOf($this.attr('id')) == -1) {
                    // if($this.visible(true)) {
                        /*if($this.attr('data-adsSlot').toLowerCase().indexOf("innov") > -1){
                            $this.wrap("<div style='width:0px; height:0px;'></div>");
                        }else{
                           $this.wrap("<div></div>");
                        }*/
                        objAdLocal.loadAds($this.parent(), '', 0);    
                    }
                }); 
            }
            
        },
        pushNewAdSize:function(adssize, addOnSize){
            try{
                if(addOnSize.length > 0){
               if(adssize[0] && adssize[0].constructor !== Array){
                    var eArr = [];
                    eArr.push(adssize);
                    adssize = eArr;    
                }
                 adssize.push(addOnSize);
                 var newSize = JSON.stringify(adssize);
                 return newSize;             
             }   
            }catch(e){}
        },
        demandManagerRequest:function(slotsToRefresh) {
          var sendAdServerRequest = failsafeHandler(slotsToRefresh, function(slots){
            googletag.cmd.push(function() {
              googletag.pubads().refresh(slots);
            });
          });
    
          pbjs.que.push(function() {
            pbjs.rp.requestBids({
              callback: sendAdServerRequest,
              gptSlotObjects: slotsToRefresh
            });
          });
    
          setTimeout(sendAdServerRequest, 1500);
    
          function failsafeHandler(initialSlots, callback) {
            var adserverRequestSent = false;
             objAd.nonOopAds=[];
             objAd.oopAds=[];
            return function(bidsBackSlots) {
              if (adserverRequestSent) return;
              adserverRequestSent = true;
              callback(bidsBackSlots || initialSlots);
            };
          };

        },
        callCustomPrebid:function(ele){
            try{
                 //window._dfpObj.primeSlots = ["masthead","mrec","bottomoverlay","atf","gutter"];
                 var arrDfpAds = [];
                 var urlParams = window.location.search || "";
                 if(objMonetize.fetchAdsForAffUser && urlParams.indexOf("utm_medium=display_aff") > -1){
                    objMonetize.fetchAdsForAffUser();
                 }
                 window.googletag = window.googletag || {}; googletag.cmd = googletag.cmd || [];
                 ele  = ele ? ele : $('body');
                 ele.find("[data-adsSlot]").each(function() {
                    if(_tp_data.isPrime) {
                        if(typeof $(this).attr('data-user') == 'undefined') {
                            $(this).remove()
                        }
                        
                    } else {
                        if(typeof $(this).attr('data-user') != 'undefined' && $(this).attr('data-user') == 'subscribed') {
                            $(this).remove()
                        }
                    }
                    
                    if(typeof adSlotOverride == 'function') {
                        adSlotOverride();
                    }
                    if(typeof objMonetize !='undefined' && objMonetize && typeof objMonetize.replaceAdsForAffUser !="undefined"){
                        objMonetize.replaceAdsForAffUser($(this));
                    }
                    if(typeof objMonetize !='undefined' && objMonetize && objMonetize.replaceAdsFromFeed && typeof subsec1_common!="undefined" && subsec1_common=="13357270"){
                        objMonetize.replaceAdsFromFeed($(this));
                    }
                        var objPageAds={};
                        var divId = $(this).attr('id');
                        var adsSlot = $(this).attr('data-adsSlot');
                        if(adsSlot && adsSlot.toLowerCase().indexOf("innov") > -1){
                            $(this).attr('data-adsSlot', 'ET_ROS_NW/ET_ROS_Skin_RHS_AS_125');
                            adsSlot = 'ET_ROS_NW/ET_ROS_Skin_RHS_AS_125';
                        }
                            var isOOPAd = $(this).attr('data-oop');
                            var adsLoc = $(this).attr('data-loc');
                            adsLoc = adsLoc ? adsLoc.toString().toLowerCase() : '';
                            adsLoc = adsLoc != 'all' ? adsLoc : '';
                            var curGeoLocation = typeof geoinfo != 'undefined' ? geoinfo.geolocation : geolocation;
                            if(typeof geoinfo == "undefined" && typeof geolocation == "undefined"){
                                curGeoLocation = "1"; // default India
                            }
                            if (!(adsSlot.match(/^7176/)) && !(adsSlot.match(/^\/7176/))) {
                                adsSlot = "/7176/Economictimes/" + adsSlot;
                            }
                            var adssize = ($(this).attr('data-size')) ? JSON.parse($(this).attr('data-size')) : undefined;
                            var isFallback = $(this).attr('data-fallback') =="1" ? true : false; 
                            if(((adsSlot && adsSlot.toUpperCase().indexOf("_ATF_") > -1 && adsSlot.toUpperCase().indexOf("_300") > -1) || ((adsSlot.toUpperCase().indexOf("_MREC") > -1) && (adsSlot.toUpperCase().indexOf("_CEN") == -1))) && tpName && !(tpName=='ifsccode' || tpName=='markets' || tpName=='stocks' || tpName=='electionlisting' || tpName=='assemblyelection')){
                                 var newSize = objAdLocal.pushNewAdSize(adssize, [300, 292]);
                                     newSize = objAdLocal.pushNewAdSize(adssize, [300, 600]);
                                 $(this).attr("data-size", newSize);
                            }
                             if(!isFallback){
                                // adsLoc == 100 for out of india in case of 100 skip in india
                                if(adsLoc == '' || adsLoc == curGeoLocation || (adsLoc == 100 && curGeoLocation != 1)) {
                                    if(adsSlot && divId && adssize){
                                        var adName = objAdLocal.getAdName(adsSlot);
                                        objPageAds.adCode = adsSlot;
                                        objPageAds.divId = divId;
                                        objPageAds.size = adssize;
                                        objPageAds.name = adName;
                                        //objPageAds.skipLazy = 1;
                                        arrDfpAds.push(objPageAds);
                                        //adName!="" && window._dfpObj && window._dfpObj.primeSlots  && window._dfpObj.primeSlots.push(adName);
                                    }
                                }
                             }

                 });
                 if(googletag && googletag.apiReady == true){
                    googletag.cmd.push(function() {
                        var _HDL = '';
                        var _ARC1 = '';
                        var _Hyp1 = (typeof spHyp1 != 'undefined') ? spHyp1 : '';
                        var _article = '';
                        var _Bl = typeof _BL_pg !== 'undefined' ? _BL_pg : 0; 
                        var _tval = function(v) {
                            if (typeof(v) == 'undefined') return '';
                            if (v.length > 100) return v.substr(0, 100);
                            return v;
                        }
                         var targetingKeyword = window.Keyword || '';
                         window._auds = window._auds || JSON.parse(localStorage.getItem("audienceData"));
                         var urlParams =window.location.search ? window.location.search : "";
                         var extUrl = new URL(document.URL);
                         var extCamp_value = objAd.readCookie("display_ext") ? objAd.readCookie("display_ext") : extUrl.searchParams.get("utm_source");
                         if(urlParams.indexOf("utm_medium=display_ext") > -1 || extCamp_value || urlParams.indexOf("utm_medium=display_aff") > -1){
                             googletag.pubads().setTargeting('ref', extCamp_value);
                         }
                         if(typeof competitionClients !="undefined"){
                             googletag.pubads().setTargeting('competitionClients', competitionClients);
                         }
                         if(typeof objSec!="undefined" && objSec.secNames){
                             var subSec1Name =  objSec.secNames[0] ?  objSec.secNames[0]:"";
                             var subSec2Name =  objSec.secNames[1] ?  objSec.secNames[1]:"";
                             var subSec3Name =  objSec.secNames[2] ?  objSec.secNames[2]:"";
                             googletag.pubads().setTargeting('SCN', subSec1Name).setTargeting("SubSCN", subSec2Name).setTargeting("LastSubSCN", subSec3Name);
                         }
                         if(urlParams.indexOf("et_dfp_test") > -1){
                            var key_value = objAd.getKeyValueFromUrl("et_dfp_test");
                            googletag.pubads().setTargeting('et_dfp_test', key_value);
                         } 
                         
                          _auds = _auds? _auds : ''; 
                         if(_auds){
                             googletag.pubads().setTargeting('sg', _auds);
                         }
                         var metaKeywords = document.querySelector('meta[name="keywords"]') && document.querySelector('meta[name="keywords"]').content!="" ? document.querySelector('meta[name="keywords"]').content : "";
                         if(metaKeywords){
                              googletag.pubads().setTargeting('Meta_Keywords', metaKeywords);
                         }
                         objAd.PPID ? objAd.aud_flag = "true" : objAd.aud_flag = "false";
                         var articleId = typeof crrArtId !="undefined" ? crrArtId : '';
                         _Hyp1 = objAd.handleHyp1Value();
                         googletag.pubads().setTargeting('HDL', _tval(_HDL)).setTargeting('ARC1', _tval(_ARC1)).setTargeting('Hyp1', _tval(_Hyp1)).setTargeting('article', _tval(_article)).setTargeting('BL', _tval(_Bl) + '').setTargeting('Keyword', targetingKeyword).setTargeting('ArticleID', articleId).setTargeting("aud_flag", objAd.aud_flag);
                         if(typeof _tp_data !="undefined" && (_tp_data.isPrime == true || _tp_data.isAdfree == true)){
                             googletag.pubads().collapseEmptyDivs();
                         }
                        //  if(typeof geolocation!="undefined" && geolocation != 1 && objMonetize.isNonPersonalizedAds && objMonetize.isNonPersonalizedAds() == true){
                        //   googletag.pubads().setRequestNonPersonalizedAds(1);
                        //   }
                          googletag.pubads().setPublisherProvidedId(objAd.PPID);
                          googletag.pubads().enableSingleRequest();
                          googletag.enableServices();  
                 });
                 }
                 typeof displayAllAdsInArray !="undefined" &&  arrDfpAds && arrDfpAds.length > 0 && window.displayAllAdsInArray(arrDfpAds);
            }catch(e){}
        },
        getAdName:function(slot){
            try{
                var adName = "";
                if(slot && slot.toLowerCase().indexOf("_atf") > -1){
                    adName="atf";
                }else if(slot && slot.toLowerCase().indexOf("_skin") > -1){
                    adName="gutter";
                }else if(slot && slot.toLowerCase().indexOf("_mrec") > -1){
                     adName="mrec";
                }else if(slot && slot.toLowerCase().indexOf("_masthead") > -1){
                     adName="masthead";
                }else if(slot && slot.toLowerCase().indexOf("_bottomoverlay") > -1){
                     adName="bottomoverlay";
                }else{
                    adName="bottom";
                }
                return adName;
                
            }catch(e){}
        },
        defineAdslot: function(ele){
            try{
                 var urlParams = window.location.search || "";
                 var deviceWidth = $(window).width() ? $(window).width() : 1280;
                 if(objMonetize.fetchAdsForAffUser && urlParams.indexOf("utm_medium=display_aff") > -1){
                    objMonetize.fetchAdsForAffUser();
                 }
                 window.googletag = window.googletag || {}; googletag.cmd = googletag.cmd || [];
                 ele  = ele ? ele : $('body');
                 ele.find("[data-adsSlot]").each(function() {
                    if(_tp_data.isPrime) {
                        if(typeof $(this).attr('data-user') == 'undefined') {
                            $(this).remove()
                        }
                    } else {
                        if(typeof $(this).attr('data-user') != 'undefined' && $(this).attr('data-user') == 'subscribed') {
                            $(this).remove()
                        }
                    }
                 });
                  googletag.cmd.push(function() {
                       var _HDL = '';
                        var _ARC1 = '';
                        var _Hyp1 = (typeof spHyp1 != 'undefined') ? spHyp1 : '';
                        var _article = '';
                        //var _Bl = (typeof _BL_pg !== 'undefined' && _BL_pg.length > 0) ? 1 :0; 
                         var _Bl = typeof _BL_pg !== 'undefined' ? _BL_pg : 0; 
                       
                        
                        var _tval = function(v) {
                            if (typeof(v) == 'undefined') return '';
                            if (v.length > 100) return v.substr(0, 100);
                            return v;
                        }
                        var addedId = [];
                        var ss1 = window.subsec1_common;
                        ele.find("[data-adsSlot]").each(function() {
                            /*if($(this).attr('data-adsSlot').indexOf("ET_BGT_HP_ATF_300") > -1){
                                objAdLocal.overWriteAdCountrySpecific($(this), "/7176/Economictimes/Budget/Slug_Home/ET_BGT_HP_International_ATF_300",["2", "5", "6"]);
                            }*/
                            if(typeof adSlotOverride == 'function') {
                                adSlotOverride();
                            }
                            if(typeof objMonetize !='undefined' && objMonetize && typeof objMonetize.replaceAdsForAffUser !="undefined"){
                                objMonetize.replaceAdsForAffUser($(this));
                            }
                            if(typeof objMonetize !='undefined' && objMonetize && objMonetize.replaceAdsFromFeed && typeof subsec1_common!="undefined" && subsec1_common=="13357270"){
                                objMonetize.replaceAdsFromFeed($(this));
                            }
                            var adsid = $(this).attr('id');
                            var adsSlot = $(this).attr('data-adsSlot');
                            if(adsSlot && adsSlot.toLowerCase().indexOf("innov") > -1){
                                $(this).attr('data-adsSlot', 'ET_ROS_NW/ET_ROS_Skin_RHS_AS_125');
                                adsSlot = 'ET_ROS_NW/ET_ROS_Skin_RHS_AS_125';
                            }
                           //if(!(deviceWidth < 1280 &&  $(this).attr('data-adsSlot').toLowerCase().indexOf("_skin_") > -1) || deviceWidth >= 1280){
                            var isOOPAd = $(this).attr('data-oop');
                            var adsLoc = $(this).attr('data-loc');
                            adsLoc = adsLoc ? adsLoc.toString().toLowerCase() : '';
                            adsLoc = adsLoc != 'all' ? adsLoc : '';
                            var curGeoLocation = typeof geoinfo != 'undefined' ? geoinfo.geolocation : geolocation;
                            if(typeof geoinfo == "undefined" && typeof geolocation == "undefined"){
                                curGeoLocation = "1"; // default India
                            }
                            if (!(adsSlot.match(/^7176/)) && !(adsSlot.match(/^\/7176/))) {
                                adsSlot = "/7176/Economictimes/" + adsSlot;
                            }

                            
                            var adssize = ($(this).attr('data-size')) ? JSON.parse($(this).attr('data-size')) : undefined;
                            var isFallback = $(this).attr('data-fallback') =="1" ? true : false; 
                            /*if(geolocation != 1 && ($(this).parents("#topAd").length > 0 || $(this).hasClass("topArtAd")) && typeof adssize !== "undefined"){
                                var newSize = objAdLocal.pushNewAdSize(adssize, [970, 250]);
                                $(this).attr("data-size", newSize);
                            }*/
                            if(((adsSlot && adsSlot.toUpperCase().indexOf("_ATF_") > -1 && adsSlot.toUpperCase().indexOf("_300") > -1) || ((adsSlot.toUpperCase().indexOf("_MREC") > -1) && (adsSlot.toUpperCase().indexOf("_CEN") == -1))) && tpName && !(tpName=='ifsccode' || tpName=='markets' || tpName=='stocks' || tpName=='electionlisting' || tpName=='assemblyelection')){
                                 var newSize = objAdLocal.pushNewAdSize(adssize, [300, 292]);
                                     newSize = objAdLocal.pushNewAdSize(adssize, [300, 600]);
                                 $(this).attr("data-size", newSize);
                            }
                             /*if(adsSlot && adsSlot.toUpperCase().indexOf("_ATF_") > -1 && adsSlot.toUpperCase().indexOf("_728") > -1){
                                 var newSize = objAdLocal.pushNewAdSize(adssize, [980, 200]);
                                 $(this).attr("data-size", newSize);
                            }*/
                            if(adsSlot && adsSlot.toUpperCase().indexOf("_SKIN_") == -1 && adsSlot.toUpperCase().indexOf("_INNOV") == -1){
                                var addOnSize = objAdLocal.pushNewAdSize(adssize, 'fluid');
                                 $(this).attr("data-size", addOnSize);
                            }
                            if(!isFallback){
                            // adsLoc == 100 for out of india in case of 100 skip in india
                            if(adsLoc == '' || adsLoc == curGeoLocation || (adsLoc == 100 && curGeoLocation != 1)) {
                                if(addedId.indexOf(adsid) == -1) {
                                    addedId.push(adsid);
                                    objAdLocal.loadedAdCode.push(adsSlot);
                                    if (adssize) {
                                        if(isOOPAd == '1') {
                                            objAdLocal.oopAds.push(googletag.defineSlot(adsSlot, adssize, adsid).addService(googletag.pubads()));
                                            objAdLocal.oopAdsIds.push(adsid);
                                        } else {
                                            if($(this).attr('data-refresh') && objMonetize.ad_refresh){ //temp for 1 week
                                                var ref_refresh = googletag.defineSlot(adsSlot, adssize, adsid).addService(googletag.pubads());
                                                objMonetize.ad_refresh.push({'ref':ref_refresh,'interval':$(this).attr('data-refresh')?$(this).attr('data-refresh'):30000});
                                                objAdLocal.nonOopAds.push(ref_refresh);
                                                objAdLocal.nonOopAdsIds.push(adsid);
                                            }else{
                                                 if(adsSlot && adsSlot.toUpperCase().indexOf("_SKIN_") > -1 && adsSlot.toUpperCase().indexOf("_125") > -1){
                                                 objAd.skining_ref = googletag.defineSlot(adsSlot, adssize, adsid);
                                                 objAd.skining_id = adsid;
                                                 objAd.skining_ref && objAdLocal.nonOopAds.push(objAd.skining_ref.addService(googletag.pubads()));
                                                }else{
                                                 objAdLocal.nonOopAds.push(googletag.defineSlot(adsSlot, adssize, adsid).addService(googletag.pubads()));
                                                }
                                                objAdLocal.nonOopAdsIds.push(adsid);
                                            }
                                        }
                                    } else {
                                        if(isOOPAd == '1') {
                                            objAdLocal.oopAds.push(googletag.defineOutOfPageSlot(adsSlot, adsid).addService(googletag.pubads()));
                                        } else {
                                            objAdLocal.nonOopAds.push(googletag.defineOutOfPageSlot(adsSlot, adsid).addService(googletag.pubads()));
                                        }
                                    }
                                } else {
                                    console.warn('%c Info : duplicate div id ', 'background: #02465B; color: #FFF', 'id - ' + adsid + ' adsSlot - ' + adsSlot); 
                                    if(!isFallback){
                                        $(this).remove();
                                    }
                                }
                            } else {
                                console.warn('%c Info : location skip ', 'background: #02465B; color: #FFF', 'id - ' + adsid + ' adsSlot - ' + adsSlot);
                                if(!isFallback){
                                    $(this).remove();
                                }
                             }
                            }  //if not fallback
                          // } // device width
                        });
                    
                         var targetingKeyword = window.Keyword || '';
                         window._auds = window._auds || JSON.parse(localStorage.getItem("audienceData"));
                        var urlParams =window.location.search ? window.location.search : "";
                        var extUrl = new URL(document.URL);
                        var extCamp_value = objAd.readCookie("display_ext") ? objAd.readCookie("display_ext") : extUrl.searchParams.get("utm_source");
                        if(urlParams.indexOf("utm_medium=display_ext") > -1 || extCamp_value || urlParams.indexOf("utm_medium=display_aff") > -1){
                            googletag.pubads().setTargeting('ref', extCamp_value);
                        }
                        if(typeof competitionClients !="undefined"){
                            googletag.pubads().setTargeting('competitionClients', competitionClients);
                        }
                        if(typeof objSec!="undefined" && objSec.secNames){
                            var subSec1Name =  objSec.secNames[0] ?  objSec.secNames[0]:"";
                            var subSec2Name =  objSec.secNames[1] ?  objSec.secNames[1]:"";
                            var subSec3Name =  objSec.secNames[2] ?  objSec.secNames[2]:"";
                            googletag.pubads().setTargeting('SCN', subSec1Name).setTargeting("SubSCN", subSec2Name).setTargeting("LastSubSCN", subSec3Name);
                        }
                        if(urlParams.indexOf("et_dfp_test") > -1){
                           var key_value = objAd.getKeyValueFromUrl("et_dfp_test");
                           googletag.pubads().setTargeting('et_dfp_test', key_value);
                        } 
                        
                         _auds = _auds? _auds : ''; 
                        if(_auds){
                            googletag.pubads().setTargeting('sg', _auds);
                        }
                        var metaKeywords = document.querySelector('meta[name="keywords"]') && document.querySelector('meta[name="keywords"]').content!="" ? document.querySelector('meta[name="keywords"]').content : "";
                        if(metaKeywords){
                             googletag.pubads().setTargeting('Meta_Keywords', metaKeywords);
                        }
                        objAd.PPID ? objAd.aud_flag = "true" : objAd.aud_flag = "false";
                        var articleId = typeof crrArtId !="undefined" ? crrArtId : '';
                        _Hyp1 = objAd.handleHyp1Value();
                        googletag.pubads().setTargeting('HDL', _tval(_HDL)).setTargeting('ARC1', _tval(_ARC1)).setTargeting('Hyp1', _tval(_Hyp1)).setTargeting('article', _tval(_article)).setTargeting('BL', _tval(_Bl) + '').setTargeting('Keyword', targetingKeyword).setTargeting('ArticleID', articleId).setTargeting("aud_flag", objAd.aud_flag);
                        if(typeof _tp_data !="undefined" && (_tp_data.isPrime == true || _tp_data.isAdfree == true)){
                            googletag.pubads().collapseEmptyDivs();
                        }
                        // if(typeof geolocation!="undefined" && geolocation != 1 && objMonetize.isNonPersonalizedAds && objMonetize.isNonPersonalizedAds() == true){
                        //   googletag.pubads().setRequestNonPersonalizedAds(1);
                        //  }
                         googletag.pubads().setPublisherProvidedId(objAd.PPID);
                         if(typeof tpName !="undefined" && typeof objAd!="undefined" && objAd.google_lazyad_enabled_tp && objAd.google_lazyad_enabled_tp.length > 0 && objAd.google_lazyad_enabled_tp.indexOf(tpName) > -1){
                           googletag.pubads().enableLazyLoad({
                              fetchMarginPercent: 10,
                              renderMarginPercent: 10
                           });
                         }else{
                            googletag.pubads().enableSingleRequest();
                         }
                         if(typeof pbjs!="undefined" && pbjs.que && typeof objVc!="undefined" && objVc.magnite_hb && objVc.magnite_hb == "1"){
                             googletag.pubads().setTargeting('hb_wrapper', 'rubicon');
                             googletag.pubads().setTargeting('hb_pb', '');
                             googletag.pubads().disableInitialLoad();
                         }
                         googletag.enableServices();
                       var allGptSlots = objAdLocal.nonOopAds.concat(objAdLocal.oopAds);
                       if(typeof pbjs!="undefined" && pbjs.que && typeof objVc!="undefined" && objVc.magnite_hb && objVc.magnite_hb == "1" && allGptSlots.length > 0){
                        objAd.demandManagerRequest(allGptSlots);
                       }
                      
                  });
                 
            }catch(e){}
        },
        handleHyp1Value:function(){
            try{
                if(typeof subsec1_common!="undefined" && typeof tpName!="undefined" && subsec1_common == "13357270"  && (tpName =="techhome" || tpName =="articleshow_main" || tpName == "primearticleshow" || tpName == "articleshow_exclusive" || tpName == "articleshow_exclusive2" || tpName == "tech_articlelist")){
                     _Hyp1 = "Budget_2024"; 
                    return _Hyp1;
                }
                if(typeof subsec1_common!="undefined" && typeof tpName!="undefined" && subsec1_common == "837555174"  && (tpName =="personalfinance" || tpName =="articleshow_main" || tpName == "primearticleshow" || tpName == "articleshow_exclusive" || tpName == "articleshow_exclusive2" || tpName == "wealthlist")){
                     _Hyp1 = "Budget_2024"; 
                    return _Hyp1;
                }
            
                if(typeof subsec2_common!="undefined" && typeof tpName!="undefined" && (subsec2_common == "640246854" || subsec2_common == "13358259" || subsec2_common == "13359412" || subsec2_common == '47119917')  && (tpName =="articlelist" || tpName =="articleshow_main" || tpName == "primearticleshow" || tpName == "articleshow_exclusive" || tpName == "articleshow_exclusive2" || tpName =="magazinelist" )){
                     _Hyp1 = "Budget_2024"; 
                    return _Hyp1;
                }
                if(typeof subsec3_common!="undefined" && typeof tpName!="undefined" && (subsec3_common == "13356984" || subsec3_common == "13357019" || subsec3_common == "58456919")  && (tpName =="articlelist" || tpName =="articleshow_main" || tpName == "primearticleshow" || tpName == "articleshow_exclusive" || tpName == "articleshow_exclusive2")){
                     _Hyp1 = "Budget_2024"; 
                    return _Hyp1;
                }
                if(typeof subsec1_common!="undefined" && typeof tpName!="undefined" && subsec1_common == "5575607"  && (tpName =="articlelist" || tpName =="articleshow_main" || tpName == "primearticleshow" || tpName == "articleshow_exclusive" || tpName == "articleshow_exclusive2")){
                     _Hyp1 = "Budget_2024"; 
                    return _Hyp1;
                }
               
               return _Hyp1; 
            }catch(e){}
        },
        removeTabollaCTNContainer: function(){
            try{
             Array.from( document.querySelectorAll('[data-taboola^="taboola_"]')).forEach(
                    function(ele) {
                      ele.querySelector('.rvtbl') && ele.querySelector('.rvtbl').remove();
                    }
                );
            }catch(e){}
        },
        removeTaboolaContainer: function(){
            try{
            if(typeof geoinfo!="undefined" && geoinfo.geolocation =="1"){    
                Array.from(document.getElementsByClassName("wdt-taboola")).forEach(
                    function(e){
                         var loc = e.getAttribute("loc") ? e.getAttribute("loc") : "";
                         if(loc!="all"){    
                          e.remove();
                         }
                    }
                )
            }
            }catch(e){}
        },
        tabollaAd:function(){
            try{
                if(typeof TRC === 'undefined') return;
                  var isTrue = true;
                  window._taboola = window._taboola || [];
                var placement = 1;
                if(tpName!="undefined" && tpName == "articleshow_main" && $(".article_block") && $(".article_block").length > 2) {
                    placement = ($(".article_block").length);
                    
                }else if(tpName!="undefined" && tpName == "slideshow" && $(".slideshowPackage")){
                    placement = ($(".slideshowPackage").length);
                }
                Array.from(document.getElementsByClassName("wdt-taboola")).forEach(
                    function(e) {
                        var _mode = e.getAttribute('data-mode');
                        var _container = e.getAttribute('id');
                        var _target_type = e.getAttribute('data-target_type');
                        var _placement = e.getAttribute('data-placement');
                        if(tpName!="undefined" && (tpName == "articleshow_main" || tpName == "slideshow")){
                            _placement = _placement + " "+ placement;
                        }
                        if(isTrue) {
                            if(window.ga){ ga('send', 'event','taboola_ad_widget', 1, 1, 1,{'nonInteraction': 1});}
                            var type = 'article';
                            if(tpName!="undefined" && tpName == "default"){
                                type = 'home';
                            }else if(tpName!="undefined" &&  tpName == "videoshow"){
                                type = 'video';
                            }else if(tpName!="undefined" &&  tpName == "slideshow"){
                                type = 'photo';
                            }else if(tpName!="undefined" && tpName != "articleshow_main"){
                                type = 'category';
                            }
                             var _tabObj = {url:window.location.href};
                            _tabObj[type] = 'auto';
                            _taboola.push(_tabObj);
                            
                        }
                        isTrue = false;
                        _taboola.push({
                            mode: _mode,
                            container: _container,
                            placement: _placement,
                            target_type: _target_type
                        });
                        e.classList.remove("wdt-taboola");
                    }
                );
               
        
            }catch(e){}
        },
        executeTaboolaAd:function(){
            try{
               var placement =   $(".article_block") ?  $(".article_block").length : 0 ; 
             if(typeof tpName!="undefined" && placement == 2 && (tpName == "articleshow_main")){ //Ex India
                     Array.from(document.getElementsByClassName("wdt-taboola")).forEach(
                        function(e){
                            e.remove();
                        }
                    )
                }else if(document.getElementsByClassName("wdt-taboola").length > 0){
                    if(tpName == "slideshow"){
                        setTimeout(function(){
                            objAd.removeTaboolaContainer();
                            objAd.removeTabollaCTNContainer();
                            objAd.tabollaAd();
                        },1000)
                    }else{
                        objAd.removeTaboolaContainer();
                        objAd.removeTabollaCTNContainer();
                        objAd.tabollaAd();
                    }
                }
                
            }catch(e){}
        },
        loadAds: function (ele, storeAdsTypeFlag, defineslot) {
            var firstLoad = typeof defineslot == "undefined" ? 0  : 1;
            var deviceWidth = $(window).width() ? $(window).width() : 1280;
            if(firstLoad == 0){
                objAdLocal.defineAdslot(ele);
            }
            if(objAdLocal.type == 'all') {
            //   if(typeof geoinfo != "undefined" && geoinfo.geolocation != "1" && typeof tpName!="undefined" && (tpName == "articleshow_main" || tpName == "default" || tpName == "newshome")){ //Ex India
            //     setTimeout(function(){
            //         objAd.removeTabollaCTNContainer();
            //         objAd.tabollaAd();
            //     },1000)
                 
            //     }else{
            //         objAd.removeTaboolaContainer();
            //     }
                //if(!(tpName == 'stocks')) objAd.loadColombia();
            }
            //if(typeof geoinfo != "undefined" && !(geoinfo.geolocation == "2" && (geoinfo.region_code && geoinfo.region_code.toLowerCase() == "ca"))){
            ele  = ele ? ele : $('body');
            _log('ads: loadAds', objAdLocal.type);
            objAdLocal.checkAd(ele);
            
            /*if(objLang.currentLang() != '' && tpName != 'default_language') {
                ele.find("[data-adsSlot]").remove();
                _log('Ads Skipped in language ' + objLang.currentLang());
            }*/ 
            if ((ele.find("[data-adsSlot]").length > 0) && (getParameterByName('opt') != '1')) {
                /*if(typeof adSlotOverride == 'function') {
                    adSlotOverride();
                }*/
                googletag.cmd.push(function() {
                    try {
                       
                        var adsid = '';
                       //prebidAdArr = [];
                        var isFallbackExecuted = false; //Be sure fallback executed only once
                        ele.find("[data-adsSlot]").each(function() {
                            var adsLoc = $(this).attr('data-loc');
                            adsLoc = adsLoc ? adsLoc.toString().toLowerCase() : '';
                            adsLoc = adsLoc != 'all' ? adsLoc : '';
                            var curGeoLocation = typeof geoinfo != 'undefined' ? geoinfo.geolocation : geolocation;
                            if(typeof geoinfo == "undefined" && typeof geolocation == "undefined"){
                                curGeoLocation = "1"; // default India
                            }
                            adsid = $(this).attr('id');
                            var $this = $(this);
                            var isInnovAd = $(this).attr('data-innov')? $(this).attr('data-innov'):"";
                            var isFallback = $this.attr('data-fallback') =="1" ? true : false; 
                       
                        // adsLoc == 100 for out of india in case of 100 skip in india
                         if(adsLoc == '' || adsLoc == curGeoLocation || (adsLoc == 100 && curGeoLocation != 1)) {
                            if(!isFallback){
                                var ss1 = window.subsec1_common;
                                // GPT
                                 if(typeof geoinfo!="undefined" && geoinfo.geolocation == 2 && typeof objVc !="undefined" && objVc.amazon_tam_web == "1"){ // US only Amazon TAM
                                      var checkAndBeyond = ($this.attr('data-adsSlot')).toLowerCase().includes("andbeyond");
                                      var checkSticky = ($this.attr('data-adsSlot')).includes("ET_ROS_Sticky_160");
                                      if(!(checkAndBeyond || checkSticky)){
                                          if( $this.attr('id') && $this.attr('data-size') && $this.attr('data-adsSlot')){
                                            var adsSlot = $this.attr('data-adsSlot')
                                           if (!(adsSlot.match(/^7176/)) && !(adsSlot.match(/^\/7176/))) {
                                              adsSlot = "/7176/Economictimes/" + adsSlot;
                                            }
                                            objAd.amazonTam.push({
                                                slotID: $this.attr('id'),
                                                sizes: $this.attr('data-size') ? (new Function("return [" + $this.attr('data-size')+ "];")())[0]: [],
                                                slotName: adsSlot
                                            });
                                                      
                                    }
                                      }
                                 }else{
                                  //if(!(deviceWidth < 1280 &&  $(this).attr('data-adsSlot').toLowerCase().indexOf("_skin_") > -1) || deviceWidth >= 1280){ // device width less than 1280
                                    googletag.cmd.push(function() {
                                     googletag.display(adsid);
                                     //objAd.adcodeGATracker($this.attr('data-adsSlot'));
                                    if(($this.attr('data-adsSlot') && $this.attr('data-adsSlot').toLowerCase().indexOf("innov") > -1) || ($this.attr('data-adsSlot') && adsid.indexOf("web_interstatial") > -1) || ($this.attr('data-adsSlot') && $this.attr('data-adsSlot').toLowerCase().indexOf("_skin_") > -1)){
                                    //if (isInnovAd == "1") {
                                        googletag.pubads().addEventListener('slotRenderEnded', function(event) {
                                           if (event && event.slot) {
                                            var slotId = event.slot.getSlotId().getName().toLowerCase();
                                            var divId = event.slot.getSlotElementId() ? event.slot.getSlotElementId():'' ;
                                            if(divId == "web_interstatial"){
                                              if (!event.isEmpty && $("#interstatial_layer").length > 0) {
                                                 objAd.handleInterstatial();
                                                 //console.log("Interstatial Loaded.."); 
                                              }
                                            }
                                            if(slotId && slotId.toUpperCase().indexOf("_ATF_") > -1 && slotId.toUpperCase().indexOf("_300") > -1 && event.size && event.size[1] && event.size[1] < 600){
                                                objAd.atf300_sticky =1;
                                            }
                                            if (event && event.slot) {
                                                if(event.isEmpty && slotId!="" && (objAd.adDivIds).indexOf(divId) == -1){
                                                         objAdLocal.adcodeGATracker(slotId, 'fail'); //fail case 
                                                         if(divId){(objAd.adDivIds).push(divId);}
                                                }else {
                                                    //objAdLocal.adcodeGATracker(slotId, 'success'); // success
                                                }
                                            }
                                            if(slotId.indexOf('_skin_') > -1){
                                               objAd.skinningLeftOndemand();
                                                $("body").on("click", "#SkinningContainer #closeDiv", function(){
                                                    if($("div#feedbackForm").length > 0){
                                                        $("div#feedbackForm").show();
                                                    }
                                                });
                                                if (event.isEmpty && slotId.indexOf('_rhs_') > -1) {
                                                    $("div#feedbackForm").show();
                                                 }
                                                  //getting skinning details
                                                  var objDetails ={};
                                                  var time = Date.now();
                                                  var arrSize = event.slot.getSizes();
                                                  var slotSize =[];
                                                  arrSize.length > 0 && arrSize.forEach(function(size){var arr =[];arr.push(size.width);arr.push(size.height);slotSize.push(arr);});
                                                  objDetails.slot = event.slot.getSlotId().getName();
                                                  objDetails.divid = event.slot.getSlotElementId();
                                                  objDetails.size = slotSize;
                                                  objDetails.time = time;
                                                  var isduplicate = true;
                                                   if(event.slot.getHtml().indexOf("<!--NO_REFRESH-->") > -1){
                                                     var elm = objDetails.divid && document.getElementById(objDetails.divid);
                                                     elm && elm.setAttribute("data-norefresh", "1");
                                                   }
                                                  isduplicate = objAd.currentViewPortAds && objAd.currentViewPortAds.length >0 && objAd.currentViewPortAds.find(function(obj){if(obj && obj.slot && obj.slot == objDetails.slot){return true;}});
                                                  !isduplicate && objAd.skinningAd.push(objDetails);
                                             }
                                            if (slotId.indexOf('innov') > -1 && isFallbackExecuted == false) {
                                                if(event.isEmpty){
                                                   var fallbackEle = $("#ROS_Sticky_160_Fallback");
                                                //$('#ROS_Sticky_160_Fallback').remove();
                                                var pageWidth = $(".pageHolder").length > 0 ? $(".pageHolder").width():0;
                                                if(fallbackEle.length > 0 && pageWidth < 1100){
                                                 var adsSlot = fallbackEle.attr('data-adsSlot')? fallbackEle.attr('data-adsSlot'): "";   
                                                 var adssize = (fallbackEle.attr('data-size')) ? JSON.parse(fallbackEle.attr('data-size')) : undefined;
                                                 var adsid = 'ROS_Sticky_160_Fallback';
                                                 objAdLocal.oopAds.push(googletag.defineSlot(adsSlot, adssize, adsid).addService(googletag.pubads()));
                                                 typeof addedId!="undefined" && addedId.push(adsid);
                                                 googletag.display('ROS_Sticky_160_Fallback');
                                                 if($('#topnavBlk').length > 0 && $('#topnav').length > 0 ){
                                                     $('#topnavBlk').addClass("skinningExist");
                                                     $('#topnav').addClass("skinningExist");
                                                 }
                                                }
                                               
                                                }else{
                                                  googletag.destroySlots(['/7176/Economictimes/ET_ROS_Sticky_160']);
                                                  $('#ROS_Sticky_160_Fallback').remove();
                                                }
                                                
                                                isFallbackExecuted = true;
                                            }
                                            typeof objAnalytics != "undefined" ? objAnalytics.url404track("dfp_ad", event.creativeId) : "";
                                           }
                                        });
                                    }
                                });
                                 //}
                                 }
                                $(this).removeAttr('data-adsSlot');
                            
                              
                              
                            }
                         }
                        });

                    } catch (e) {
                        _log('Error in Ad Code Div : ', e );
                    }
                    
                });
                
            }
            
         //}
        },
        skinningLeftOndemand:function(){
            try{
             var fallbackEle = $("#skinningleft_backup");
             var adsid = 'skinningleft_backup';
             var adsSlot = fallbackEle.attr('data-adsSlot')? fallbackEle.attr('data-adsSlot'): "";   
             var adssize = (fallbackEle.attr('data-size')) ? JSON.parse(fallbackEle.attr('data-size')) : undefined;
            if(typeof googletag!="undefined" && adsSlot && adssize && fallbackEle.length > 0 && _tp_data && _tp_data.isPrime == false && _tp_data.isAdfree == false && typeof geoinfo!="undefined" && geoinfo.geolocation != "1"  &&  $('body.exIndia').length == 0){
              //if(typeof googletag!="undefined" && adsSlot && adssize && fallbackEle.length > 0 && _tp_data && _tp_data.isPrime == false && _tp_data.isAdfree == false && typeof geoinfo!="undefined" &&  $('body.exIndia').length == 0){
               if (!(adsSlot.match(/^7176/)) && !(adsSlot.match(/^\/7176/))) {
                  adsSlot = "/7176/Economictimes/" + adsSlot;
                }
              googletag.cmd.push(function () {
        		   var slot = googletag.defineSlot(adsSlot, adssize, adsid);
                    slot.addService(googletag.pubads());
                googletag.enableServices();
                if(typeof pbjs!="undefined" && pbjs.que && typeof objVc!="undefined" && objVc.magnite_hb && objVc.magnite_hb == "1"){
                    objAd.demandManagerRequest([slot]);
                }else{
                    googletag.pubads().refresh([slot]);  
                }
                googletag.display(adsid);
              });
              fallbackEle.removeAttr('data-adsSlot');
             }else{
                 if(adsSlot){
                    fallbackEle.length > 0 ? fallbackEle.remove() : "";
                 }
             }
            }catch(e){}
        },
        renderAdOnscroll: function(){
            try{
        if(typeof $ !="undefined"){
            var scrollTop = $(document).scrollTop();
            var ele = $('body');
            ele.find("[data-adsSlot-lazy-scroll]").each(function() {
            var adsSlot = $(this).attr('data-adsSlot-lazy-scroll');
            var divId = $(this).attr('id');
            var objId = divId && document.getElementById(divId);
            var isInViewport = objMonetize.isVisible(objId, 900);
            if(adsSlot && scrollTop > 200 && isInViewport || (typeof $!="undefined" && $('#'+divId).visible(true))){
            var adsLoc = $(this).attr('data-loc');
            adsLoc = adsLoc ? adsLoc.toString().toLowerCase() : '';
            adsLoc = adsLoc != 'all' ? adsLoc : '';
            if (!(adsSlot.match(/^7176/)) && !(adsSlot.match(/^\/7176/))) {
                adsSlot = "/7176/Economictimes/" + adsSlot;
            }
            var adsid = $(this).attr('id');
            var adssize = ($(this).attr('data-size')) ? JSON.parse($(this).attr('data-size')) : undefined;
            if(adsSlot && adsSlot.toUpperCase().indexOf("_SKIN_") == -1 && adsSlot.toUpperCase().indexOf("_INNOV") == -1){
                var addOnSize = objAdLocal.pushNewAdSize(adssize, 'fluid');
                 adssize = JSON.parse(addOnSize);
                 $(this).attr("data-size", addOnSize);
            }
            var adRef = [];
             if(typeof googletag !="undefined" && googletag.apiReady){
                googletag.cmd.push(function() {
                var ref = googletag.defineSlot(adsSlot, adssize, adsid).addService(googletag.pubads());
                adRef.push(ref);
                 if(typeof tpName !="undefined" && typeof objAd!="undefined" && objAd.google_lazyad_enabled_tp && objAd.google_lazyad_enabled_tp.length > 0 && objAd.google_lazyad_enabled_tp.indexOf(tpName) > -1){
                   googletag.pubads().enableLazyLoad({
                      fetchMarginPercent: 10,
                      renderMarginPercent: 10
                   });
                 }else{
                    googletag.pubads().enableSingleRequest();
                 }
                googletag.enableServices();
                    if(typeof pbjs!="undefined" && pbjs.que && typeof objVc!="undefined" && objVc.magnite_hb && objVc.magnite_hb == "1"){
                        objAd.demandManagerRequest(adRef);
                     }else{
                         googletag.pubads().refresh(adRef);  
                     }
                });
                  //var urlParams =window.location.search ? window.location.search : "";
                //   if(typeof objAd != "unddefined" && objAd.sendRequestToPrebid){
                //         pbjs.adserverCalled = false;
                //         objAd.sendRequestToPrebid(adRef);
                //   }
                googletag.cmd.push(function() {
                    googletag.display(adsid); 
                 });
                 $(this).removeAttr("data-adsSlot-lazy-scroll");
             }
            }
            });
    }
    }catch(e){}
        },
        renderAdOnDemand: function(){
            try{
        if(typeof $ !="undefined"){
            var scrollTop = $(document).scrollTop();
            var ele = $('body');
            ele.find("[data-adsSlot-lazy]").each(function() {
            var adsSlot = $(this).attr('data-adsSlot-lazy');
            var divId = $(this).attr('id');
            //var objId = divId && document.getElementById(divId);
            //var isInViewport = objMonetize.isVisible(objId, 900);
            //if(adsSlot && scrollTop > 200 && isInViewport || (typeof $!="undefined" && $('#'+divId).visible(true))){
            var adsLoc = $(this).attr('data-loc');
            adsLoc = adsLoc ? adsLoc.toString().toLowerCase() : '';
            adsLoc = adsLoc != 'all' ? adsLoc : '';
            if (!(adsSlot.match(/^7176/)) && !(adsSlot.match(/^\/7176/))) {
                adsSlot = "/7176/Economictimes/" + adsSlot;
            }
            var adsid = $(this).attr('id');
            var adssize = ($(this).attr('data-size')) ? JSON.parse($(this).attr('data-size')) : undefined;
            if(adsSlot && adsSlot.toUpperCase().indexOf("_SKIN_") == -1 && adsSlot.toUpperCase().indexOf("_INNOV") == -1){
                var addOnSize = objAdLocal.pushNewAdSize(adssize, 'fluid');
                adssize = JSON.parse(addOnSize);
                $(this).attr("data-size", addOnSize);
            }
            var adRef = [];
             if(typeof googletag !="undefined" && googletag.apiReady){
                googletag.cmd.push(function() {
                var ref = googletag.defineSlot(adsSlot, adssize, adsid).addService(googletag.pubads());
                adRef.push(ref);
                 if(typeof tpName !="undefined" && typeof objAd!="undefined" && objAd.google_lazyad_enabled_tp && objAd.google_lazyad_enabled_tp.length > 0 && objAd.google_lazyad_enabled_tp.indexOf(tpName) > -1){
                   googletag.pubads().enableLazyLoad({
                      fetchMarginPercent: 10,
                      renderMarginPercent: 10
                   });
                 }else{
                    googletag.pubads().enableSingleRequest();
                 }
                googletag.enableServices();
                    if(typeof pbjs!="undefined" && pbjs.que && typeof objVc!="undefined" && objVc.magnite_hb && objVc.magnite_hb == "1"){
                        objAd.demandManagerRequest(adRef);
                     }else{
                         googletag.pubads().refresh(adRef);  
                     }
                });
                  //var urlParams =window.location.search ? window.location.search : "";
                //   if(typeof objAd != "unddefined" && objAd.sendRequestToPrebid){
                //         pbjs.adserverCalled = false;
                //         objAd.sendRequestToPrebid(adRef);
                //   }
                googletag.cmd.push(function() {
                    googletag.display(adsid); 
                 });
                 $(this).removeAttr("data-adsslot-lazy");
             }
            //}
            });
    }
    }catch(e){}
        },
        renderBreakingNewsAd: function(){
        try{
            if(typeof $ !="undefined"){
            var adsid = "div-gpt-ad-1000-et-breakingnews-widget-ad";
            var adsSlot = "/7176/Economictimes/ET_Home/ET_Home_Home/ET_HP_Widget_1003x40";
            var adsLoc = "All";
            var adssize = [[1003, 40]];
            var adRef = [];
             if(typeof googletag !="undefined" && googletag.apiReady){
                googletag.cmd.push(function() {
                var ref = googletag.defineSlot(adsSlot, adssize, adsid).addService(googletag.pubads());
                adRef.push(ref);
                googletag.pubads().enableSingleRequest();
                googletag.enableServices();
                googletag.display(adsid); 
                googletag.pubads().refresh(adRef);  
                });
                // googletag.cmd.push(function() {
                //     googletag.display(adsid); 
                //  });
                $("#div-gpt-ad-1000-et-breakingnews-widget-ad").slideDown();
             }
           
            }
        }catch(e){}
        }, 
        adcodeStatus:function(adSlot, status, type){
            try{
                var today = new Date();
                var tdate = today.getDate()+ "" + (today.getMonth()+1) +"" +today.getFullYear();
                window.objVc && objVc.logAdsStatus == 1 && 
                $.ajax({ url:'//etx.indiatimes.com/error_save?ref=ad',
                    data: {
                        url:'ad',
                        file: "Ad_Slot-"+tdate,
                        line: adSlot,
                        column: status,
                        error: window.location.href,
                        error_stack: type,
                        callback:'cb'
                    }
                }); 
            }catch(e){
                
            }    
        },
        adcodeGATracker:function(adcode, status){
            try{
                var slotId = adcode ? adcode.toLowerCase(): "";
                if(window.tmplName) {
                    var type = '';
                    if(tmplName=="default") {
                        type = 'HP';
                    }else if(tmplName=="articleshow_main"){
                        type = 'Articleshow';
                    }else{
                         type = window.tmplName;
                    }
                    //if(type) {
                        //ga('send', 'event', type + " ATF Impressions", "AD request Initiated ", adcode, {nonInteraction: 1});
                        objAd.adcodeStatus(adcode, status, type);
                        //_log(type +" ATF executed");   
                    //}
                }
                
            }catch(e){}
            
        },
        storeAdsType: function () {
            try {
                var arrNetworkAdsList = [];
                $("iframe[id*='google_ads_iframe']").each(function () {
                    var $this = $(this);
                    if ($this && $this.attr("id").match(/google_ads_iframe.*/)) {
    					//_log($this.contents().find('body').html().toUpperCase().indexOf('NO_REFRESH'), $this.parent().parent().attr('id'))
    					// only direct add pushed in the session storage
    					var ruleAllowForIds = ['div-gpt-ad-1456138430524-0', 'div-gpt-ad-1389610933954-0'];
    					var adContainerId = $this.parent().parent().attr('id');
    					var networkAdFlag = $this.contents().find('body').html().toUpperCase().indexOf('NO_REFRESH') != -1 ? 0 : 1;
    					
    					// if networkAdFlag exist or if ad id not exist in ruleAllowForIds
    					_log('Ads type - ', networkAdFlag, adContainerId);
    					if(networkAdFlag && ruleAllowForIds.indexOf(adContainerId) != -1) {
    					    arrNetworkAdsList.push(adContainerId);
    					}
                    }
                });
                if(window.sessionStorage && !window.sessionStorage.networkAdsList) {
                    window.sessionStorage['networkAdsList'] = arrNetworkAdsList;
                }
            } catch (e) {
                _log('Error', e);
            }
        },
        overWriteAdCountrySpecific: function (element, newAdCode, arrLocations){
            try{
                //console.log("Hello", element);
               
                if(arrLocations.indexOf(geolocation) > -1){
                    element.attr("data-adsSlot", "");
                    element.attr("data-adsSlot", newAdCode);
                }
            }catch(e){
                _log('Error', e);
            }
        },
        reloadAds: function (ele) {  // refreshAds
            ele  = ele ? ele : $('body');
            ele.find('*[id^="div-gpt"]').not(':empty').each(function () {
                var $this  = $(this), id = $this.attr('id'), adsIndex = objAdLocal.nonOopAdsIds.indexOf(id);
                var adsArray = [];
                if(adsIndex > -1) {
                    _log('Ad Refreshed for - ', id);
                    adsArray.push(objAdLocal.nonOopAds[adsIndex]);
                }
                if(adsArray) {
                    googletag.pubads().refresh(adsArray);
                }
            });
            if(typeof objAdLocal.oopAds !== 'undefined' && objAdLocal.oopAds.length > 0){
                googletag.pubads().refresh(objAdLocal.oopAds);
            }
        },
        // to refresh a perticular ad pass the id of ads div e.g. objAd.refreshAd('div-gpt-ad-1456138430524-0')
        refreshAd: function (id) {
            if(id) {
    	        var adId = objAdLocal.nonOopAds[$.inArray(id, objAdLocal.nonOopAdsIds)];
    	        if(typeof googletag != 'undefined') {googletag.pubads().refresh([adId], {changeCorrelator: false});}
            }
        },
        checkSubscription: function(callback) { // subscribe
            _log('checkSubscription',_tp_data.permissions);
            if($.inArray("subscribed", _tp_data.permissions) != -1) {
                objAdLocal.type = 'lite';
            }
            
            if($.inArray("etadfree_subscribed", _tp_data.permissions) != -1) {
                showAd = 0;
                objAdLocal.type = 'adfree';
                objAd.adFiller();
            }
            
            if(objAdLocal.type == 'lite' || objAdLocal.type == 'adfree') {
                objAdLocal.removeAd();
                $(window).scroll(function () {
                    objAdLocal.removeLazyAd();
                });
            }
            
            if(objAdLocal.type == 'lite') {
                objEtPrimeLayer.init();
            }
            
            if(typeof callback == 'function') {
                callback();
            }
            _log(objAdLocal.type)
        },
        checkAd: function (ele) {
            ele  = ele ? ele : $('body');
            
            if(objAdLocal.type != 'all') {
                objAdLocal.removeAd(ele);
            }
        },
        adFiller : function() {
            if(tmplName === 'stocks') {
              $('#sideBar').prepend('<div id="stockImgBanner"><a href="https://play.google.com/store/apps/details?id=com.et.market&hl=en_IN" target="_blank"><img src="'+ objDomain.img +'/photo/70751824.cms" width="300" height="250" alt="Track Live Stocks" /></a></div>');
              $('#etBuzzAds, .mob_ban').remove();
            } else if(tmplName === 'slideshow') {
              var totalHeight = 0;

                $("#mostViewedSlides .mostViewedSlide").children().each(function(){
                    totalHeight = totalHeight + $(this).outerHeight(true);
                });
              var mostSlideHt = ($(window).height() < totalHeight) ? ($(window).height() - 100) : 'auto';
              $('#mostViewedSlides .mostViewedSlide').css({'height' : mostSlideHt})
            }
        },
        removeAd: function (ele) {
            ele  = ele ? ele : $('body');
            if(objAdLocal.type == 'adfree' || _tp_data.isPrime) {
                var skipRemove = !_tp_data.isPrime ? '.prime_ads,#topAd,.topAd' : '';
                ele.find('*[id^="div-gpt"]').not(skipRemove).parent('.adsbg300').remove();
                ele.find('*[id^="div-gpt"]').not(skipRemove).remove();
                ele.find('#sliderAD, #csrWidget, .custom_ad, .colombiaAd, .quiz-ctn-ads, .mutualFundIcici, .loadPrimeWidget, .primeDW, #feedbackForm, #nWsHook, .hook-section, #switchBar, #frameHolder, .adsbg300, #ROS_Sticky_160_Fallback, .rmfp, .wdt-taboola').not(skipRemove).remove(); //rmfp -> Remove For Prime
                ele.find('.adFillerSlot').removeClass('hidden');
                if(tmplName == 'articleshow') {
                    ele.find('.widgetSEO.ent_wdt').css({'border-bottom':'none'})
                }
            } else if(objAdLocal.type == 'lite') { // retain on ATF ad
                ele.find('*[id^="div-gpt"]:empty').not('*[data-adsSlot*="ATF"]').remove();
                ele.find('*[data-adsSlot*="ATF"]').each(function () {
                    var $this = $(this), size =  $this.attr('data-size');;
                    if($this.width() > 400 || size.indexOf('728') != -1 || size.indexOf('970') != -1 || size.indexOf('1003') != -1) {
                        $this.remove();
                    }
                });
                ele.find('*[data-adsSlot*="ATF"]:empty').not(':first').remove();
                ele.find('*[id^="div-clmb-ctn"]').remove();
                _log('ads: only Lite Ads');
            } else {
                _log('ads: all Ads');
            }
        },
        removeLazyAdInterval:0,
        removeLazyAd: function () {
            clearTimeout(this.removeLazyAdInterval);
            objAdLocal.removeLazyAdInterval = setTimeout(function () {
                if(window.location.href.indexOf('/articleshow/') == -1) {
                    _log('ads: removeLazyAd');
                    objAdLocal.checkAd();
                }
                if($('.lazyLoadAd').length) {
                    $('.lazyLoadAd').each(function () {
                        $(this).parent().remove();
                    });
                }
            }, 200);
        },
        typeFn: function () {
            return objAdLocal.type;
        },
        handleInterstatial: function(){
            try{
                var urlParams =window.location.search ? window.location.search : "";
                var aff_param_check = urlParams.indexOf("utm_medium=display_aff") == -1 ;
                var objVc = window.objVc || {};
                var interstitialFlag = objVc.interstitial_web == 1 ? 1 : 0;
                if(window.location.search.indexOf('ints=0') != -1) {
                    interstitialFlag = 0;
                }
                 if(objVc && objVc.googlevignette_web && objVc.googlevignette_web == "1" && window.geoinfo && geoinfo.geolocation && geoinfo.geolocation!="1"){
                    interstitialFlag = 0;
                 }
                if(interstitialFlag && aff_param_check) {
                        var tId = getCookie('TicketId'); 
                        var checkPrime = objAd.getOauthJStorage(tId);
                        var permissions = checkPrime && checkPrime.permissions || [],
                            isSubscribed = permissions.indexOf("subscribed") == -1 || permissions.indexOf("etadfree_subscribed") == -1 || permissions.length == 0 || 0;
                        var ssoid = $.cookie('ssoid') || $.cookie('MSCSAuthID');
                if(!ssoid || ssoid && !isSubscribed) {  
            		var intsCountryChk = objVc.int_countrychk_web ? parseInt(objVc.int_countrychk_web) : 1;
            		var intsAllowedCountry = objVc.int_allowedcountry_web;
            		intsAllowedCountry = intsAllowedCountry && intsAllowedCountry.split ? intsAllowedCountry.split(',') : ["1"];
            		var intsFequencyCap = objVc.int_fequencycap_web ? parseInt(objVc.int_fequencycap_web) : 3;
            		var current = new Date();
                    var currHrs = current. getHours();
                    if(typeof objVc !="undefined" && objVc.extended_fcap_hrs_web!=0 && currHrs >= objVc.extended_fcap_hrs_web){
                        intsFequencyCap = intsFequencyCap + 1;
                    }
                    var chkMdr =/(\?|&)?(from=mdr)/, wl = window.location;
                    var ua = navigator && navigator.userAgent && navigator.userAgent.toLowerCase() || '',
                    isBot = (ua.indexOf('bot') != -1),
                    isLighthouse = (ua.indexOf('lighthouse') != -1),
                    isSpeedInsight = (ua.indexOf('speed insights') != -1),
                    isWebPageTest = (ua.indexOf('ptst_x/') != -1);
                    var fcap = $.cookie("int_fcapcount") || 0;
                    var nextInterstitial = $.cookie("et_interstitial_active");
                    var geolocation = window.geoinfo && geoinfo.geolocation || '1';
                    var countryCheck = intsAllowedCountry.indexOf(geolocation) ;
                     if(!chkMdr.test(wl.href) && !isBot && !isLighthouse && !isWebPageTest && !isSpeedInsight && !nextInterstitial && fcap < intsFequencyCap  && (intsCountryChk == 0 || countryCheck != -1)) {
                        objMonetize.setCookieToSpecificTime &&
                        objMonetize.setCookieToSpecificTime("et_interstitial_active",'true', '', 40);
                        var new_fcap = parseInt(fcap) + 1;
                        if(new_fcap <= intsFequencyCap){
                            objMonetize.setCookieToSpecificTime &&
                            objMonetize.setCookieToSpecificTime('int_fcapcount', new_fcap, '23:59:59');
                        }
                          var timer = document.getElementById('timer')
                         if(timer){
                             timer.innerHTML = objAd.int_duration;
                             objAd.intsStartTimer();
                         }
                          $("#interstatial_layer").show();
                          $("#interstatial_layer").on("click", function(){
                			 objAd.intsCloseAd();
                		  });
                          //refreshCounter();
                          ga('send', 'pageview');
                         var wlh = window.location.href;
                         
            			//return false;
                     }
                }     
             }       
            }catch(e){
                window.errorLogs && errorLogs({href:JSON.stringify(objVc), localName:'interstitial_error', attributes:''}, 1);
            }
            
        },
        intsStartTimer: function(){
         var timer = document.getElementById('timer');
         var intTestTimer = 0;
         if(typeof sessionStorage !="undefined"){
             intTestTimer = sessionStorage.getItem("int_testtimer");
         }
         if(parseInt(intTestTimer) > 0 ){
             timer.innerHTML = intTestTimer;
         }
         var ref_timer = setInterval(function(){ 
             var current_val = parseInt(timer.innerHTML);
             current_val = current_val - 1;
             timer.innerHTML = current_val;
             if(current_val == 0){
                 clearInterval(ref_timer);
                 objAd.intsCloseAd();
             }
         }, 1000);
     },
        intsCloseAd:function(){
             if ($("#interstatial_layer").length > 0) {
                $("#interstatial_layer").hide();
             }
             return false;
        },
        getOauthJStorage: function(tId) {
         try{
            jStorageData = window.localStorage && localStorage.jStorage ? JSON.parse(localStorage.jStorage) : {};
            return jStorageData['prime_'+tId];
         }catch(e){}
        }
    }
    // return {init: objAdLocal.init, type: objAdLocal.typeFn, loadAds: objAdLocal.loadAds, reloadAds: objAdLocal.reloadAds, checkAd: objAdLocal.checkAd, refreshAd:objAdLocal.refreshAd};
    return objAdLocal;
})();
            var loadScreenerWidget = {
            	load: function() {
            	    loadScreenerWidget.bindEvents();
            	    if($('.stock_screener_widget .ss_top_area .ss_widgets li').length > 1)  {
            	        loadScreenerWidget.enableSlider();
            	    }
            	},
            	bindEvents: function() {
            	    $('.stock_screener_widget').on('click', '.bottom_area', function(e){
            	        e.preventDefault();
            	        e.stopPropagation();
            	        if($('.stock_screener_widget .ss_top_area #ss_widgets li').length) {
            	            var activeIndex = $(this).parents('.stock_screener_widget').find('.ss-dots li.active').index() + 1;
                            activeIndex = !!activeIndex ? activeIndex : 1;
                            var key = $(this).parents('.stock_screener_widget').find('.ss_widgets li:nth-child('+activeIndex+') .title').data('key');
                            var activeKey = !!key ? key : 'GARP';
            	        }
            	        var inSidebar = $(this).parents('.newRHSSideBar');
            	        
            	        var btnTxt = $(this).find('.cta').text();
            	        if(inSidebar.length){
            	            ga('send', 'event','RHS Widget','ET Stock Screener Click');
            	        } else{
            	            ga('send', 'event','Market Screenerss Distributions Widget - Clicks','Screeners Widget Clicks - '+btnTxt+'',''+btnTxt+' - ' + window.location.href);
            	        }
                        window.open('/stock_screener/predefKey-' + activeKey + '.cms'  , '_blank');
                    });
            	},
            	enableSlider: function() {
            	    $(".stock_screener_widget").etSlider({
                        visible: 1,
                        perSlide: 1,
                        auto: true,
                        pagination: ".ss-dots",
                        interval: 5000,
                        nextprevBtn: false
                    });
                    $('.stock_screener_widget').addClass('active');
            	}
            }
objPT = {  
    expiryTimePopup: 1296000000,// 1296000000 - 15days # 900000 - 15mins
    init: function (checkNLShow) {
        if(objVc.primeTargeting) {
            objPT.loadPT(checkNLShow)
        }
    },
    setSegment: function (segmentName) {
        if(segmentName) {
            var segmentPriority = ['other', 'paywall', 'plan'];
            var currentConfig = $.jStorage.get('pt_segmentDetails'), savedSegName = currentConfig && currentConfig.name, lastVis = currentConfig && currentConfig.lastVisible;
            if(savedSegName != segmentName) {
                if(segmentPriority.indexOf(segmentName) > segmentPriority.indexOf(savedSegName)) {
                    var newSegment = {'name': segmentName, 'segmentdate': new Date().getTime(), 'lastVisible':lastVis};
                    $.jStorage.set('pt_segmentDetails', newSegment)
                }
            }
        }
        if (localStorage.getItem("etmain_planvisited") && (new Date().getTime() - localStorage.getItem("etmain_planvisited") > objPT.expiryTimePopup)) {
            localStorage.removeItem("etmain_planvisited")
        }
        if ($.jStorage.get('pt_segmentDetails') && (new Date().getTime() - $.jStorage.get('pt_segmentDetails').segmentdate > objPT.expiryTimePopup)) {
            $.jStorage.deleteKey('pt_segmentDetails')
        }
    },
    primeTargetingStorageCall: function () {
        var primeCheckArr = ['primearticleshow', 'articleshow_exclusive', 'articleshow_exclusive2'];
        if(localStorage.getItem("etmain_planvisited")) {
            objPT.setSegment('plan');
        } else if($('.blocker_wrap, .prime_paywall').length || window.isAdaptive == 1 || primeCheckArr.indexOf(window.tpName) != -1) {
            objPT.setSegment('paywall');
        } else {
            objPT.setSegment('other');
        }
    },
    loadPT: function(checkNLShow) {
        $(window).one('scroll', function(event) {
            setTimeout(function() {
                if(checkNLShow && !$('.adblocker_popup').length) {
                    var nltrShow30minFlag= $.jStorage.get('nltrShow30minFlag');
                    if (!nltrShow30minFlag && !$('.skip_popup').length){
                        /* var accessPassObj = $.jStorage.get('access_pass_flow');
                        var isAccessPassEnabled = accessPassObj && accessPassObj.enabled && !!!accessPassObj.blocked && !_tp_data.isPrime;
                        if(isAccessPassEnabled){
                            loadModule({module_name: "js_prime_access_functions", callback:function(){
                                objAccessPassFlow.createPopUp();
                            }});
                        } */
                        loadModule({module_name: 'js_primetargeting_popup', type:'popup', ref:'primeTargeting'})
                    }
                } else {
                    if(!$('.skip_popup').length  && !$('.adblocker_popup').length){
                        loadModule({module_name: 'js_primetargeting_popup', type:'popup', ref:'primeTargeting'})
                    }
                }
            },35000)
        })
    }
}
    // stream Athena Live Bootom Banner Code here  
objStreamLiveBand = {
    init: function(){
        var skip_template = ['athenalive', 'expert-bio', 'streams', 'streamsrecorded'];
        var checkSession = sessionStorage.getItem('streamband');
        if((skip_template.indexOf(window.tpName) == -1) && (!checkSession) && (subsec1_common == '1977021501')){
            objStreamLiveBand.loadJsBtmBanner();
        }
    },
    loadJsBtmBanner: function() {
       // loadModule({'module_name': 'js_streamstickyband', v: 4});
    }
}
            objCommon = {
                isLive: etFlag.isLive,
                isPP: window.location.host.indexOf('-pp') !== -1,
                isBot: (function () {
                    var ua = navigator && navigator.userAgent && navigator.userAgent.toLowerCase() || '';
        		    return (ua.indexOf('bot') != -1) ? 1 : 0;
                })(),
            	init : function() {
            	    try {
            	        if(window.localStorage && (localStorage.getItem('et_dev_livesso') == 1 || localStorage.getItem('et_dev_pp') == 1)) {
            	            objCommon.isLive = 1;
            	        }
            	        objGdpr.init();
            	        objCommon.backScript();
            	        /* if($('.skipBackScript').length == 0) {
            	            objCommon.backScript();
            	        } */
            	        objCommon.bindEvents();
                        objUser.init();
                        objUser.afterLoginCall(objCommon.getpeUuid);
                        if(objGdpr.allow()) {
                            objPoints.init();
                        }
                        objCommon.oneTapLogin();
                        objUser.afterPrimeCheckCall(function () {
                		    if(objUser.checkPermission('subscribed')) {
                		        $('html').removeClass('free_user').addClass('prime_user prime_header');
                		    }
                		    localStorage.setItem('dmpStorage', JSON.stringify({userType: checkUserType()}));
                		    
            		        var isETEPPREligible =  typeof(_tp_data.accessibleFeatures) != "undefined" && _tp_data.accessibleFeatures.indexOf('ETPRED') !== -1;
            		        $('html').attr('data-etpred', isETEPPREligible ? 1 : 0);
            		        
            		        var isWEElegible = typeof(_tp_data.accessibleFeatures) != "undefined" && _tp_data.accessibleFeatures.indexOf('ETWEED') !== -1;
            		        $('html').attr('data-etweed', isWEElegible ? 1 : 0);
                
                		    var userData = $.jStorage.get('prime_' + (objUser.info && objUser.info.ticketId));
                		    if(!_tp_data.isLogged) {
                		        _log('otr removed in case of non login')
                		        $.removeCookie('OTR', {domain:'indiatimes.com', path:'/'});
                		    } else if(!userData) {
                		        objUser.primeCheckReq("", 'refresh_token');
                		    }
                        });
                        objCommon.ga_cdHit();
                		objNav.init();
                		objMarketBand.init();
                		if($('.grandmaster_widget').length > 0 || $('#grandMasters').length > 0 || $('#grandmasters').length > 0) objGrandmaster.init();
                //		objEpaperCoachMark.init();
                		
                		/* remove few popup for new user percentage based - ET-22346 */
                		var firstDateOnET = $.jStorage.get('et_first_date'),
                		    newExpUserExist = localStorage.getItem('new_user_exp');
                	    
                		if(!firstDateOnET || newExpUserExist) {
                            
                            objCommon.forRandomUsers(5, function () {
                		        if(!newExpUserExist) {
                    		        localStorage.setItem('new_user_exp', true);
                    		    }
                            },function(){
                            })
                		}
                		
                // 		objSchemeFlip.init();
                		// objVideo.liveTvStory();
                		//FCM one-step Load
                		if($('#liveStrmDistribution').length && geolocation == 1) {
                		    loadModule({module_name: 'js_athena_distribution'});
                		} else {
                		    $('#liveStrmDistribution').remove();
                		}
                		if($('#election_2024_result').length){
                		    loadModule({module_name: 'js_widget_electionresult' ,v: 6});
                		}
                		if($('#election_2024_exit').length){
                		    loadModule({module_name: 'js_widget_exitpolls' ,v: 5});
                		}
                        /*if(window.location.href.indexOf('/articleshow_gcm') == -1 && (window.parent === window.self) ) {
                            loadModule({module_name: 'js_push'});
                        }*/
                        function initAdFunc() {
                            if(!$('.skip_ads').length) {
                                var searchUrl = window.location.search;
                                if((objCommon.isLive == 0 || searchUrl.indexOf("js_adcode=1") > -1) && searchUrl.indexOf("js_common_new=1") == -1 && window.location.href.indexOf("etstg.indiatimes.com") == -1) {
                                    var url = new URL(window.location.href ? window.location.href : "");
                                    var ver = url.searchParams.get("ad_vs");
                                    ver = ver ? ver : '166';
                                    // /js_adcode.cms
                                    loadModule({'module_name': 'js_adcode', 'v': ver});
                                } else {
                                    objAd.init();
                                }
                            } else {
                                objAd.removeAd();
                                // do not remove this used for removing prime user ad in case of skipad class is added
                                $('#primeuser_topad').remove();
                            }
                        }
                        if(window.isAdaptive && window.objAdaptive && objAdaptive.afterCheckCall) {
                            objAdaptive.afterCheckCall(function () {
                                objUser.afterPrimeCheckCall(initAdFunc);
                            })
                        } else {
                            objUser.afterPrimeCheckCall(initAdFunc);
                        }
                		//objUser.afterPrimeCheckCall(objAd.init);
                		objUser.afterPrimeCheckCall(function () {
                		    if((tmplName == 'default' || tmplName == 'primehome') && _tp_data.permissions.indexOf('subscribed') != -1) {
                                loadModule({module_name: 'js_subscription_renewal', 'v': 3, ref:'renewal'});
                            }

                            objPT.primeTargetingStorageCall();
                            var primeLoginMap = $.jStorage.get('primeUserLoginMap') || localStorage.getItem("primeUserLoginMap");
                            var tempArr = ["personalfinance", "mutual_funds", "techhome", "opinionshome", "nri", "panache", "videohome", "subscription", "newslist", "uselection2020", "features", "sundayet", "politicsnation", "election", "articlelist", "newshome",  "markets", "ipohome", "nifty_50_companies", "ifsccode", "npshome", "headlines", "itr_filing", "primehome", "stocks", "default", "primearticlelist"];
                            if(!primeLoginMap) {
                                if(tempArr.indexOf(tmplName) != -1 && !$('.skip_popup').length){
                                    loadModule({module_name: 'js_onboarding_popup_sh', type:'popup', ref:'onboarding', callback: function () {
                                        loadModule({module_name: 'js_newsltrpopup', type:'popup', ref:'nlpopup', callback: function(){
                                            objPT.init('checkNLShow')
                                        }})
                                    }});
                                } else {
                                    objPT.init()
                                }
                            }
                            
                            /*if(!$.jStorage.get("bandTvPlayState") && typeof $.cookie('OTR') != "undefined" && $.cookie('OTR') != "null" && _tp_data.email && _tp_data.emailIdStatus != "Unverified" && (_tp_data.isPrime || objUser.checkPermission("expired_subscription") || objUser.checkPermission("cancelled_subscription"))){
                                    loadModule({module_name: "js_inappmsg", ref:"inappmsg"});  
                            }*/
                            
                            if($('#playerContainer').length > 0) {
                    		    loadModule({'module_name': 'js_slikeplayernew'});
                            }
                    		
                            
                    		var articleTemp = ['primearticleshow', 'articleshow_exclusive', 'articleshow_exclusive2', 'articleshow_main'];
            	            objUser.afterPrimeCheckCall(function(){
                	            if(!_tp_data.isPrime){
                	                if(articleTemp.indexOf(tmplName) != -1 && subsec2_common != '93076384' && subsec1_common != '91745395' && _tp_data.isPrime && objVc.article_recommendations && (objVc.skiparticle_recommendations_rhs || objVc.skiparticle_recommendations_in)){
                    	                objCommon.forRandomUsers(objVc.article_recommendations, function(){
                            		        loadModule({'module_name': 'js_article_recommendations', 'v': '8'});      
                            		    });
                    	            }
                	            }   
                	        });
                		});
                        if($('.js_mostSearchedStocks').length > 0) objStockMore.init();
                		objCommon.marketModule();
                		footerReadMore.init();
                		var _oneEventTrack = 0;
                		objLazyWidget.init(1);
                		if(tpName == 'newshome' || tpName == 'politicsnation' || tpName == 'default'){
        			        objElectionWidget.init();
        			    }
        			    else if(tpName == 'articleshow_main'){
        			        objElectionWidget.init(window.msid);
        			    }
                		$(window).one('mousemove touchstart scroll click', function(event) {
                		    if(!_oneEventTrack) {
            			        _oneEventTrack = 1;
            			        //objMonetize.loadAssets("/css_main_delay.cms", "css", "async", "body",  function() {}, {});
            			        setTimeout(function(){
                                    var isRetryPaymentBand = $('.appayment_band').length;
            			            if(!isRetryPaymentBand) {
                                        objBreakingNews.init();
            			            }
                            	}, 2000);
            			        objSrPopUpFn.init();
                                objCryptoPopUpFn.init();
                                //objCommon.loadFbScript();
            			        objLazyWidget.init();
                                objAnalytics.init();
                                //objCookieUse.init();
                                if(objVc.skipPopup != 1) {
                                    objStreamLiveBand.init();
                                }
                                objUserSubscriptions.init();
                                
                                var excludedtList = ['topics_default', 'topics_news', 'topics_videos'];
                                var isTmpleTExcluded = excludedtList.indexOf(tmplName) !== -1;
                                var href = window.location.href;
                                if (!isTmpleTExcluded && $(".mfwidget,#mostPopular,[data-clientlist]").length > 0 || 
                                    href.indexOf("/marketstats/") != -1 || 
                                    href.indexOf("/editionlist/") != -1 || 
                                    href.indexOf("/etwealth") != -1) {
                                        loadModule({module_name: "js_common_buydirect"})
                                }
                                
                                objUser.afterPrimeCheckCall(function () {
                                    if(_tp_data.isPrime) {
                                        if(geolocation == 1) {
                                            loadModule({module_name: 'js_widgetlivestream'});
                                        }
                                        objAdBlockerCheck.init();
                                        
                                        var validPages=["default_prime", "articleshow_main", "primearticleshow", "articleshow_exclusive2", "primehome"].includes(tpName);
                                        var code = _tp_data.subscriptionDetails && _tp_data.subscriptionDetails[0].sponsorPartnerCode;
                                        if(validPages && code) {
                                            loadModule({'module_name': 'js_sponserbanner'});
                                        }
                                    } else {
                                        communicationViaCohortObj.init();
                    			        objUser.afterPrimeCheckCall(function () {
                    			            objPLoginMap.init();
                    			            objAdBlockerCheck.init(); 
                    			        })
                                    }
                                })

                			    if($('.slideBookmark').length > 0 && tpName === 'slideshow' ) {
                        		    loadModule({'module_name': 'js_bookmark'});
                                }
            			    }
                		    if(_tp_data.isPrime && $.jStorage.get('accessPassData')){
                		        $('head').append('<link rel="stylesheet" type="text/css" href="/css_access_prime_pass/v-1.cms">');
                    			loadModule({module_name: "js_access_prime_pass",callback:function(){
                    			     if(objUser.checkPermission("group_subscription") && !localStorage.getItem('accessGroupPassoneTime') ){
                    			        objOnboardJourney.groupPop()
                                        localStorage.setItem('accessGroupPassoneTime',true);
                    			     }
                                }});
            		        }
            		        loadModule({'module_name': 'js_userprofile_dynamic'});
                        });
                		
                		$("img.lazy").lazyload({effect: "fadeIn"});
                		$("time.date-format").each(function(){
                		    if(typeof $(this).attr("data-time") !== 'undefined' && $(this).attr("data-time") !== false){
                		        $(this).text(et.dateFormat($(this).attr("data-time").replace(/IST/gi, "")));
                		    }
                    	});
                    	if(objGdpr.allow()) {
                            objUser.afterPrimeCheckCall(function () {
                                if (_tp_data.isLogged) {
                                    if(!_tp_data.isPrime) {
                                       callGcmNewsLayer.init();
                                    }
                                } else {
                                    callGcmNewsLayer.init();
                                }
                            });
                        }  
                    	
                    	if(typeof objSharing !='undefined'){
                    	    objSharing.init();
                        }
                        
                        // content sign-in lock icon.  
                        if(getParameterByName('showprimelogo') == 'yes') {
                            objContentlock.init();
                        }
                        if(objCommon.isLive == 0 && objVc.paywall_icon && (tpName === 'default' || tpName === 'markets' )) {
                            objCommon.forRandomUsers(objVc.paywall_icon, function () {
                                ga('set', {
                                  'dimension110': 'Yes'
                                });
                                customDimension.dimension110 = 'Yes';
                                $('body').addClass('primeHighlight')
                                objContentlock.init();
                                $('#etPrime').find('.lock-tooltip').remove()
                            }, function(){
                                ga('set', {
                                  'dimension110': 'No'
                                });
                                customDimension.dimension110 = 'No';
                                
                            });
                        }
                        
                        if($('.stock_screener_widget').not('.active').length) {
                        	loadScreenerWidget.load();
                        }
                        
                        if ($('.mf_screener_widget').not('.active').length) {
                            $(".mf_screener_widget").etSlider({
                                visible: 1,
                                perSlide: 1,
                                auto: false,
                                pagination: ".mf_nav_dots",
                                interval: 3000,
                                nextprevBtn: true
                            });
                            $('.mf_screener_widget').addClass('active');
                        }
                    	
                    	if($("#mostPopular").length){
                        	loadSideWidgetsNTBM.load();	
                        	$(document).scroll(function() {
                        		loadSideWidgetsNTBM.load();			
                        		if(($(window).height() + $(window).scrollTop()) >= ($("#mostPopular").offset().top + $("#mostPopular").outerHeight())){
                        			balanceSecHight.init("#pageContent","#sideBar","#mostPopular > div.hidden",90);
                        		}
                        		objCommon.bindPlugin();
                            });
                        }
                        objCommon.bindPlugin();
                        
                        if($('#srch-overlay-content ul').length < 1) {
                    		$('#srch-overlay-content').etSearchAll({topsearch: true});
                    	}
                		$(".btmSearch", ".bottomBar").etSearchAll({topsearch: false});
                		objUser.afterPrimeCheckCall(function () {
                		    if(geolocation == 2 && $.jStorage.get('us_subs_closed') === null) {
                		        // UI Broken
                                // loadModule({'module_name': 'js_ussubscription', 'v' : '4'});
                            }
                            var skipCubeAdsTemplate = ['newsletterlist', 'editionshow'];
                            var cryptoPage_ss = window.subsec2_common;
                            if(wl && wl.href && wl.href.indexOf("budget_cube=1") > -1) {
                                objVc.global_cube =1;
                            } 
                            var cube_secs = objVc && objVc.global_cube_secs && objVc.global_cube_secs.length > 0 && JSON.parse(objVc.global_cube_secs) || [];
                            var pathname =	window.location.pathname;
                            var cube_sec_check = ((objVc.global_cube_sec_chk == '1' && cube_secs.length > 0 && cube_secs.some(function(v) { return pathname.indexOf(v) > -1})) || (objVc.global_cube_sec_chk == '1' && cube_secs.indexOf(window.tpName) > -1)); 
                            if (((objVc.global_cube == '1' && geolocation == "1") || cube_sec_check || (objVc.global_cube_cty_chk == '1' && objVc.global_cube_cty_include.length > 0 && geoinfo.city && objVc.global_cube_cty_include.toUpperCase().indexOf(geoinfo.city.toUpperCase()) > -1)) && objLang.currentLang() == "" && window.navigator.userAgent.indexOf('MSIE ') < 0 && window.navigator.userAgent.indexOf('Trident/') < 0 && !_tp_data.isAdfree && !_tp_data.isPrime && $(".skip_cube").length == 0 && window.skipAds != 1 && objMonetize.checkNoAdsInArticleBlock && objMonetize.checkNoAdsInArticleBlock() && skipCubeAdsTemplate.indexOf(window.tpName) == -1 && (cryptoPage_ss != 'undefined' && cryptoPage_ss != '82519373')) {
                                if((geolocation == "1" && geoinfo.city && objVc.global_cube_cty_exclude.toUpperCase().indexOf(geoinfo.city.toUpperCase()) == -1) || objVc.global_cube_sec_chk == '1'){
                                    loadModule({'module_name': 'js_budget_cube', 'v': '44'});
                                    $('head').append('<link rel="stylesheet" type="text/css" href="/css_budget_cube/v-19.cms">');
                                }
                            }  
                                
                        });
                        
                        objCommon.loginCookieExpiry();
                        objScore.init();
                        objUser.afterLoginCall(objDev.init);
                        topsearchslider.init();
                        
                        // Main Spotlight
                        if($("#splightMain, #splightMain_mf").length) {
                            $(window).one('mousemove', function(event) {
                                try {
                                    $("#splightMain, #splightMain_mf").etSpotlight({
                                        speed: 300,
                                        easing: "easeOutQuad",
                                        interval: 15000
                                    });
                                } catch (e) {
                                    _log('Error', e);
                                }
                            });
                        }
                        swapBannertop();
                        
                        // load js for side nav header on pages newsletter edit profile pages
                        if($('.newHeader').length){
                            loadModule({module_name: 'js_sidenav_header'});
                        }
                        
                        
                        // write onboard code access here
                         objUser.afterPrimeCheckCall(function() {
                            objProfile.init();
                            
                            setTimeout(function(){
                                var accessPassData = $.jStorage.get('accessPassData');
                                var freeExperince = !$('.prime_header').length && !_tp_data.isPrime;
                                if(accessPassData){
                                    var dateDiff = new Date(objProfile.subDetails.expiryDate) - new Date(objProfile.subDetails.purchaseDate);
                                    // 172800000 = 2 days
                                    if(objProfile.subDetails.daysLeft > -1 && dateDiff < 172800000){
                                        objAccessPassPaymentBnr.init();
                                    } else {
                                        // setTimeout(function(){
                                           
                                        $(window).one('scroll',function() {
                                            if(!objBreakingNews.viewedNews.length || sessionStorage.getItem('introOnboard') ){
                                                $('head').append('<link rel="stylesheet" type="text/css" href="/css_access_prime_pass/v-1.cms">');
                                                loadModule({module_name: "js_access_prime_pass",callback:function(){
                                                    if(typeof objOnboardJourney != 'undefined' && typeof objOnboardJourney['toFetchOnboardScreen'] != 'undefined') {
                                                        objOnboardJourney.toFetchOnboardScreen()
                                                    }
                                                }});
                                            }
                                        });
                                            
                                        // },4000)    
                                    }
                                } else if(freeExperince){
                                    objSpecialOffer.init();
                                }
                            },1000)
                            //place the condition here.
                            // objSpecialOffer.init();
                        })
                            
                        $(window).on("load", function() {
                            if(objCommon.isLive == 0 && objGdpr.allow() && window.tpName && (tpName == "primehome" || tpName == "primearticlelist" || tpName == "primearticleshow")) {
                                loadScript('//static.clmbtech.com/ase/65311/2596/aa.js');
                            }
                            if(typeof objMonetize.onPageLoad == "function"){
                               objMonetize.onPageLoad(); 
                            }
                            if(typeof _tp_data !="undefined" && _tp_data.isPrime == false && _tp_data.isAdfree == false && location.href.indexOf("opt=1") == -1){
                                setTimeout(function(){
                                    typeof objAd !="undefined" && objAd.renderAdOnDemand && objAd.renderAdOnDemand();
                                }, 1000);
                                //typeof objAd !="undefined" && objAd.executeTaboolaAd(); // Execute Taboola Ad
                            }
                            if (window._dfpObj && typeof window._dfpObj.hash === 'function') {
                                if(typeof _tp_data !="undefined" && _tp_data.email){ window._dfpObj.hash('email', _tp_data.email);}
                                if(typeof _tp_data !="undefined" && _tp_data.mobile){
                                    var CountryCode = typeof userData !="undefined" && userData.countryCode ? userData.countryCode : '';
                                    window._dfpObj.hash('phone', _tp_data.mobile , CountryCode);
                                    
                                }
                            
                            }
                            /* var accessPassTraffic = window.objVc.accessPassTraffic || 0;
                            objCommon.forRandomUsers(Number(accessPassTraffic), function(){
                                var accessPassObj = $.jStorage.get('access_pass_flow');
                                var isInValidUser = false;
                                if(_tp_data.isLogged) {
                                    var isPrimeUser = _tp_data.isPrime;
                                    isExpiredUser = _tp_data.permissions.indexOf("expired_subscription") !== -1,
                                    isCancelled = _tp_data.permissions.indexOf("cancelled_subscription") !== -1,
                                    isSubscriber = _tp_data.permissions.indexOf("subscriber") !== -1,
                                    isInValidUser = isPrimeUser || isExpiredUser || isCancelled || isSubscriber;
                                }
                                
                                if((accessPassObj && !!!accessPassObj.blocked) || !accessPassObj || isInValidUser) {
                                    $.jStorage.set('access_pass_flow', {enabled: true}, {TTL: 7200000});
                                }
                            }); */
                        });
                        if(objVc.ajaxError == 1) {
                            $.ajaxSetup({
                                error: function (x, status, error) {
                                    if(status != 'error') {
                                        grxEvent('event', {'event_category': 'Service Error - ' + (window.jscommon_v || ''), 'event_action': this.url, 'event_label': x.status + ' - ' + status + ' - ' + error});
                                        console.log('Ajax Error: ', this.url, x.status, status, error);
                                    }
                                }
                            });
                	    }
                	    try {
                	        var agent = navigator.userAgent;
                	        function isIncognito(status) {
                	            grxEvent('event', {'event_category': 'isIncognito', 'event_action': status, 'event_label': ''});
                	            //var logData = {'event_category': 'isIncognito', 'event_action': status, userAgent: agent};
                	            //saveLogs(logData);
                	        }
                	        if(agent.indexOf('bot') == -1) {
                                if (navigator && navigator.storage && navigator.storage.estimate) {
                                  navigator.storage.estimate().then(function (data) {
                                    if(data.quota < 120000000){
                                        isIncognito('true')
                                    }
                                  })
                                } else {
                                    isIncognito('Can not detect')
                                }
                	        }
                        } catch (e) {}
                        /*loadModule({module_name: 'js_newyearsale'});*/
                        objVideo.init();
                        // show in CA only
                        var isAllowGdpr = window.allowGDPR && allowGDPR() || window.objGdpr && objGdpr.allow && objGdpr.allow() || 0;
                        if(!isAllowGdpr) {
                            $('.gdpr_show').show();
                        }
                        if(etFlag.isCA) {
                            $('.ca_show').show();
                        }
                        objUser.afterPrimeCheckCall(function() {
                            if(etFlag.isEU) {
                                $('.eu_hide').hide();
                            }  
                        })
                        // geoinfo missing
                        if(!window.geoinfo) {
                            saveLogs({'type': 'geoinfo data missing', 'page': window.location.href});
                        }
                        objAnalytics.onLoad();
                        
                        if($('#askTheCrypto').length == 1 && tpName != 'nri'){
                            loadModule({'module_name': 'js_ask_the_expert_crypto'});
                        }
                        objRedeem.init();
                        gainerBlockDefault.init();
                        /* var accessPassObj = $.jStorage.get('access_pass_flow');
                        var isAccessPassEnabled = accessPassObj && accessPassObj.enabled && !!!accessPassObj.blocked && !_tp_data.isPrime;
                        if(isAccessPassEnabled){
                            loadModule({module_name: "js_prime_access_functions",callback:function(){
                                objAccessPassFlow.init();
                                objAccessPassFlow.createBand();
                            }});  
                        } */ 
                        objMarketYellowBand.init();
                        objPrimeMbrBanner.init();
                        objPrimeOffers.init();
                        objClosePopup.init();
                        // objCommon.setObjVcLS();
                        if(typeof sessionStorage != 'undefined' && sessionStorage.getItem('pageRedirectToCan')) {
                	        saveLogs({'pageRedirectToCan' : sessionStorage.getItem('pageRedirectToCan')})
                	    sessionStorage.removeItem('pageRedirectToCan');
                	    }
            	        // check main_container class is exit or not tpname
            	        var excludeTemplate = ['ifsccode','articleshow_exclusive2','printprimiumarticle','userprofile','technical_charts','bankholidays','taxcalculator','opinionlisting'];
            	        if(!$('.main_container').length && (excludeTemplate.indexOf(tpName) === -1)){
                            saveLogs({tpName: tpName,main_container:'notFound_main_containerClass'});
                        }
                        objCommon.privacyConsent();
            	    } catch(e) {
            	        _log('exception in common var', e);
            	    }
            	},
            	privacyConsent:function(){
            	    try{
            	        var counter = 0;
            	        if(typeof objGdpr!="undefined" && objGdpr.allow && objGdpr.allow() == 0){
            	          var intervalRef = setInterval(function () {
            	              if($("#onetrust-accept-btn-handler") && $("#onetrust-accept-btn-handler").length > 0){
            	                  $("#onetrust-accept-btn-handler, #accept-recommended-btn-handler").on("click", function(){
            	                      console.log("Here");
            	                      	$.cookie("optout", 0, {
                                			expires: 365,
                                			path: '/',
                                			domain: '.' + window.location.host
                                		});
            	                  });
            	                  clearInterval(intervalRef);

            	              }
            	              counter++;
            	              if(counter >= 20){
            	                  clearInterval(intervalRef);
            	              }
            	            }, 1000);

            	        }
            	    }catch(e){}
            	},
            	getpeUuid: function() {
            	    if(_tp_data.isLogged && $.cookie('peuuid') == null) {
            	        var uuidApi = (objCommon.isLive ? 'https://idm.economictimes.indiatimes.com/personalisation' : 'https://etua-stg.economictimes.indiatimes.com/users/api') + '/logdata/uuid/resolve?type=0&source=0';
            	        
            	        $.ajax({
                            url: uuidApi,
                            method: 'GET',
                            contentType: "application/json; charset=utf-8",
                            xhrFields: {
                                withCredentials: true
                            },
                            success: function (response) {
                                if(response.status && response.status =='success'){
                                    console.log('getpeUuid response', response);
                                    var cVal = response.id;
                                    $.cookie('peuuid', cVal, {expires : (3650 * 24 * 60 * 60 * 1000), path : '/', domain : '.indiatimes.com'});   
                                }
                            },
                            error: function(e) {
                                console.log('getpeUuid error', e);
                            }
                        });
            	    }
            	},
            	setObjVcLS: function () {
            	    try {
                	    var lsData = localStorage.getItem('objVc'), now = new Date();
                	    function _loadVC() {
                    	    !objCommon.isBot && loadScript('https://etx.indiatimes.com/main/version_control?dev=' + (objCommon.isLive ? 0 : 1) + '&v=1&lsupdate=1', function () {
                    	        objVc.lsTime = dateFormat(now, '%Y/%M/%d %H:%m:%s');
                    	        localStorage.setItem('objVc', JSON.stringify(objVc));
                    	    })
                	    
                	    }
                	    if(lsData) {
                	        var lsDataJson = JSON.parse(lsData);
                	        var lsTime = new Date(lsDataJson.lsTime);
                	        var diffInMin = (now - lsTime) / 60000;
                    	    var maxCacheTime = objVc.vcLScacheTime || 10;
                    	    if(diffInMin >= maxCacheTime && window.localStorage && localStorage.setItem) {
                    	        _loadVC();
                    	    }
                	    } else {
                	        _loadVC();
                	    }
            	    } catch (e){}
            	    
            	},
            	ga_cdHit : function() {
                	objUser.afterPrimeCheckCall(function () {
                	    var subsStatus = '';
                	    if(localStorage.getItem('et_logintype') != null) {
                	        var loginType = localStorage.getItem('et_logintype');
                            ga('set', 'dimension22', loginType);
                            customDimension.dimension22 = loginType;
                        }
                        if (_tp_data.isLogged) {
                            if($.jStorage.get('accessPassData')){
                                subsStatus = 'Free Access '+new Date($.jStorage.get('accessPassData').startDate).toLocaleDateString();
                            }
                            else if($.inArray("expired_subscription", _tp_data.permissions) > -1) {
                                subsStatus = 'Expired User';
            		        } else if ($.inArray("subscribed", _tp_data.permissions) > -1 && $.inArray("cancelled_subscription", _tp_data.permissions) > -1 && $.inArray("can_buy_subscription", _tp_data.permissions) > -1) {
            		            subsStatus = 'Paid User - In Trial';
            		        } else if($.inArray("subscribed", _tp_data.permissions) > -1) {
            		            subsStatus = 'Paid User';
            		        } else if($.inArray("etadfree_subscribed", _tp_data.permissions) > -1) {
            		            subsStatus = 'Ad Free User';
            		        } else if(_tp_data.permissions.length == 0) {
            		            subsStatus = '-';
            		        } else {
            		            subsStatus = 'Free User';
            		        }
                                ga('set', {
                                  'dimension3': 'LOGGEDIN',
                                  'dimension10': 'LOGGEDIN',
                                  'dimension37': subsStatus,
                                  'userId': _tp_data.ssouid
                                });    
                            customDimension.dimension3 = 'LOGGEDIN';
                            customDimension.dimension10 = 'LOGGEDIN';
                            customDimension.dimension37 = subsStatus;
                            //grxEvent('page_view', {'user_login_status': 'LOGGEDIN', 'user_subscription_status': subsStatus, 'userId': _tp_data.ssouid });
                            
                        } else {
                                ga('set', {
                                  'dimension3': 'NONLOGGEDIN',
                                  'dimension10': 'NONLOGGEDIN',
                                  'dimension37': 'Free User'
                                });    
                            customDimension.dimension3 = 'NONLOGGEDIN';
                            customDimension.dimension10 = 'NONLOGGEDIN';
                            customDimension.dimension37 = 'Free User';
                            //grxEvent('page_view', { 'user_login_status': 'NONLOGGEDIN', 'user_subscription_status': subsStatus });
                        }
                        
                    });  
            	},
            	bindPlugin: function () {
                    $('.ntbcarousel:not(.initiated)').addClass("initiated").each(function(){
            	        if($(this).visible(true) || $("#sportlight_mf").length > 0){
                	        $(this).budgetslider({
                        		autoslide : true,
                        		autoslideInterval : 3000,
                        		slideInterval : 500
                        	});	    
                	    }
            	    });
            	    $('.byd-spotli:not(.initiated), .ntbcarousel:not(.initiated)').addClass("initiated").budgetslider({
                		autoslide : true,
                		autoslideInterval : 3000,
                		slideInterval : 500
                	});	
                	if($(".calculatorwrap.clcWgtSldr:not(.initiated)").length && $("#widgetCalc").length){
                        $("#widgetCalc").addClass("initiated").etSlider({
                        	visible : 1,
                        	perSlide : 1,
                        	auto : true,
                        	slides : '.calclist > ul > li',
                        	pagination : ".ts-dots",
                        	slideContainer : '.calclist',
                        	interval : 3000,
                        	nextprevBtn : true,
                        	nextprevClass : '.nextprev-btn'
                        });
                    }
                    if($("#widgetSEO").length){
                        $("#widgetSEO").addClass("initiated").etSlider({
                        	visible : 1,
                        	perSlide : 1,
                        	auto : true,
                        	slides : '#slides_SEO > ul > li',
                        	pagination : ".ts-dots",
                        	slideContainer : '#slides_SEO',
                        	interval : 10000,
                        	nextprevBtn : true,
                        	nextprevClass : '.nextprev-btn'
                        });
                    }
                    if($('#defWidget').length){
                        $('#defWidget').on('click','#container #tabs li',function(){
                                _this =$(this).index()+1;
                                var txt = $(this).text();
                                if($('#container').find('#tab-'+_this).find('li').length ==0){
                                    $('#container').find('#tab-'+_this +' #listOfDef').load('/wealthdef_categorylist.cms?keywords='+txt);
                                }
                                $(this).addClass('current').siblings().removeClass('current');
                                $('#container').find('#tab-'+_this).addClass('current').siblings('.tab-content').removeClass('current');
                        });
                    }
                },
            	bindEvents : function() {
            		$("#searchBar").click(function(){
				        $("#topSearch").slideToggle();
				        var scrollTop = $(document).scrollTop();
				        if(scrollTop > 40) {
				            var scrollUpto = $('.header').length ? $('.header').offset().top - 20 : 40;
				            $("body, html").animate({scrollTop: scrollUpto}, function () {
				                $('#topSearch').slideDown();
                                $('input[name="ticker_newsearch"]').focus();
                            });
				        } else {
				            $('input[name="ticker_newsearch"]').focus();
				        }
				        
				        if($('#topSearch .srch-overlay-content ul').length < 1) {
                    		$(".srch-overlay-content", "#topSearch").etSearchAll({topsearch: false});
                    	}
				    });
				    
				    $(".srch-close").click(function(){
				        $("#topSearch").slideToggle();        
				    });
				    
				    $('#topSearch .srch-btn').click(function(){
				        var txtInput = $('.srch-overlay-content input');
				        var textSearch = txtInput.val().trim();
                		if(textSearch == ''){alert('Enter some text to search');
                		txtInput.focus();}
                		else{
            				openKeywordPage(textSearch);
            				txtInput.val('');
            				$("ul.searchListAll",'#topSearch').css("display" , "none");
            			}
				    });
				    // reset Permissions 
				    $(document).on('click','.resetToken, a[href*="etsub-qa.economictimes"], a[href*="prime.economictimes"], a[href*="prime-qa.economictimes"], a[href*="prime-dev.economictimes"], a[href*="plans"], a[href*="dev-buy.indiatimes"], a[href*="buy.indiatimes"]', function(){
                        $.jStorage.deleteKey('prime_' + objUser.info.ticketId);
                        // $.removeCookie('OTR', {domain:'indiatimes.com', path:'/'});
                    });
                    
                    $(document).on('click','span[href], div[href]', function () {
                        if($(this).attr('target') == '_blank') {
                            window.open($(this).attr('href'), '_blank');
                        } else {
                            window.location = $(this).attr('href')
                        }
                    });
				    
				    $(document).on('click','[data-ga-onclick], [data-grx-onclick]', function () {
                       var $this = $(this), onlyGRX = (typeof($this.attr('data-grx-onclick')) !== 'undefined') ? true : false;
                       
                       if(onlyGRX) {
                            var trackVal = $this.attr('data-grx-onclick').split('#');
                        } else {
                            var trackVal = $this.attr('data-ga-onclick').split('#');   
                        }
                       
                       if(trackVal.length == 1) {
                    	   var gaCategory = $this.parents('[data-ga-category]').attr('data-ga-category'),
                    		   gaAction = $this.parents('[data-ga-action]').attr('data-ga-action'),
                    		   gaLabel = trackVal[0];
                    
                    	   if(gaCategory) {
                    		   trackVal[0] = gaCategory;
                    	   }
                    	   if(gaAction) {
                    		   trackVal[1] = gaAction;
                    	   }
                    	   if(gaCategory && gaAction) {
                    			trackVal[2] = gaLabel;
                    	   }
                       }
                       var track2 = trackVal[2];
                       track2 = track2 ? track2 : '';
                       
                       var href = $(this).attr('href') || '';
                       if(!href) {
                    	   href = $(this).find('a[href]').attr('href') || '';
                       }
                       track2 = track2.indexOf('href') != -1 ? (track2.replace('href', href)) : track2;
                       track2 = track2.indexOf('url') != -1 ? (track2.replace('url', window.location.href)) : track2;
                       
                       if(trackVal.length > 1) {
                           var etProductItem = href.indexOf('primearticleshow') != -1 ? 'Prime' : '';
                           if(!etProductItem && href.indexOf('articleshow') != -1) {
                               etProductItem = $this.attr('data-conttype') == 100 ? 'ET Premium' : 'ET Free';
                           }
                           if(etProductItem != '' && !customDimension.dimension58) {
                               customDimension.dimension58 = etProductItem;
                           }
                           if(!onlyGRX) {
                        	   ga('send', 'event', trackVal[0], trackVal[1], track2, window.customDimension);
                        	   if($this.hasClass('etpt')) {
                        		   ga('ETPTracker.send', 'event', trackVal[0], trackVal[1], track2);
                        	   }
                           }
                    	   // Growth RX Event
                    	   grxEvent('event', {'event_category': trackVal[0], 'event_action': trackVal[1], 'event_label': track2});
                    	   if(etProductItem != '') {
                              delete customDimension.dimension58;
                           }
                       } else {
                    	   _log('GA Event not fired')
                       }
                    });
                    
                    $(document).on('click','[data-ga-onshare]', function () {
                	   var $this = $(this), trackVal = $this.attr('data-ga-onshare').split('#');
                	   var isLoggedInUser = _tp_data.isLogged?'User Logged In':'User Not Logged in', isSubscribedUser = _tp_data.isPrime?'Subscribed User':'Not Subscribed user';
                	   var dimensions = {'d38': isSubscribedUser};
                	   
                	   if($this.attr('data-dimension')=='1' && $this.parents('[data-dimension]').attr('data-dimension')){
                	       var customParameters = JSON.parse($this.parents('[data-dimension]').attr('data-dimension'));
                	       //ga('set','dimension38',isSubscribedUser);
                	       dimensions['d48'] = customParameters.msid;
                	       dimensions['d26'] = customParameters.subsec1;
                	       dimensions['d9'] = customParameters.subsec2;
                	       dimensions['d4'] = customParameters.agency;
                	       dimensions['d107'] = new Date;
                	       dimensions['d41'] = _tp_data.email;
                	       dimensions['d5'] = $this.parents('[data-ibeat_author]').attr('data-ibeat_author');
                	       dimensions['d12'] = $this.parents('[data-ibeat_tag]').attr('data-ibeat_tag');
                	       
                	       
                	       
                	       //ga('set','dimension48',customParameters.msid);
                    	   //ga('set','dimension26',customParameters.subsec1);
                    	   //ga('set','dimension9',customParameters.subsec2);
                    	   //ga('set','dimension4',customParameters.agency);
                    	   //ga('set','dimension107', new Date);
                    	   //ga('set','dimension41',_tp_data.email);
                    	   //ga('set','dimension5',$this.parents('[data-ibeat_author]').attr('data-ibeat_author'));
                    	   //ga('set','dimension12',$this.parents('[data-ibeat_tag]').attr('data-ibeat_tag'));	
                	   }
                	   $.each(dimensions, function (key, value) {
                	       var id = key.substr(1), dimensionId = 'dimension' + id;
                	       ga('set', dimensionId, value);
                	       customDimension[dimensionId] = value; // for growthRx
                	   })
                	   
                	   if(trackVal.length > 1){
                	       ga("send", {hitType: "social", socialNetwork: trackVal[0], socialAction: trackVal[1], socialTarget: trackVal[2], page: trackVal[3]})
                	       grxEvent('socialshare', { socialnetwork: trackVal[0], socialaction: trackVal[1], socialtarget: trackVal[2], page: trackVal[3] });
                	   } else {
                	       _log('GA Share Event not fired')
                	   }
                	});
                    
                    if(!$("#scrollTop, .skip_btt").length) {
                        $('body').append('<div id="scrollTop"><span></span>BACK TO TOP</div>');
                    }
                    $("#scrollTop").click(function() {
                        grxEvent('event', {'event_category': 'Back to Top', 'event_action': 'click', 'event_label': location.href});
                        $("body, html").animate({scrollTop: 0});
                    });
                    
                    // Fixing Menu on Scroll
                    $(window).scroll(function(){
                         var ss1 = window.subsec1_common;
                         /*if(window.location.search.indexOf("dfptest=1") == -1 && $("[data-type=dfp]").length > 0 && ss1 != 1466318837){ // temp for 2 days hitesh 
                          if((typeof tmplName !="undefined" && tmplName =="articleshow_main" && (ss1 == '7771250' || ss1 == '107115' || ss1 == '13352306' || ss1 == '837555174' || ss1 == '13357270'))){
                            $("[data-type=dfp]").removeAttr("data-dfpslot");
                            $("[data-type=dfp]").removeAttr("data-dfpsize");
                            $("[data-type=dfp]").removeAttr("data-type");
                          }
                        }*/
                		// Set and remove new nav fixed postion on scroll
                		var topNavPos = $(".navFixRef").length ? $(".navFixRef").offset().top : 200;
                		var scrollTop = $(window).scrollTop(), navHeight = $("#topnavBlk").height();
                 		// console.log(scrollTop, topNavPos);
                		if(location.href.indexOf('/articleshow') == -1 && location.href.indexOf('/stocks/companyid-') == -1 && location.href.indexOf('/mffactsheet/schemeid-') == -1) {
                    		if (($("#topnavBlk").length > 0) && (scrollTop > topNavPos)) {
                                $("#topnavBlk, .topUserInfoBand").addClass("fixedNav");
                                $(".navFixRef").css('height', navHeight);
                                var isStickyBandExist = $('.topUserInfoBand').length;
                                if(isStickyBandExist) {
                                    $("#topnavBlk").css("top", $('.topUserInfoBand').innerHeight());
                                }
                            } else {
                                $("#topnavBlk, .topUserInfoBand").removeClass("fixedNav");
                                $(".navFixRef").css('height', 0);
                                $("#topnavBlk").css("top", "0");
                            }
                		}
                        
                    	/* ET Prime Widget on Scroll */
                    	
                    	/*if($('.loadPrimeWidget').length && !$('.loadPrimeWidget').hasClass('loaded') && objAd.type != 'adfree') {
                    		$('.loadPrimeWidget').addClass('loaded');
                    		objUser.afterPrimeCheckCall(function(){
                    			// objPrimeWidget.init();
                    		});
                    	}*/
                    	
                    	//ga impression for visible items
                    	$('[data-impression-ga]').each(function(){
                    		var $this = $(this);
                    		try {
                    			if($this.visible(true) && $this.attr('data-impression-ga') != ''){
                    				var gaData = $this.attr('data-impression-ga').split('#');
                    				gaData[2] = typeof(gaData[2]) != 'undefined' && gaData[2] != ''?( gaData[2] == 'url'?window.location.href: gaData[2]):'';
                    				if(gaData.length > 2){
                    				    // ga('send', 'event', gaData[0], gaData[1], gaData[2]);
                    				    // Growth RX Event
                                        grxEvent('event', {'event_category': gaData[0], 'event_action': gaData[1], 'event_label': gaData[2]}, 1, 1);
                    				}
                    				$this.removeAttr('data-impression-ga');
                    			}
                    		} catch (err) {_log('Error GA Impression!', err.message);}
                    	});
                    	
                    	// latest code for ga impression data-ga-impression
                	    $('[data-ga-impression]').each(function(){
                	        var $this = $(this);
                	        try {
                	            if($this.visible(true) && $this.attr('data-ga-impression') != ''){
                    	            var gaData = $this.attr('data-ga-impression').split('#');
                    	            gaData[2] = typeof(gaData[2]) != 'undefined' && gaData[2] != ''?( gaData[2] == 'url'? window.location.href: gaData[2]):'';
                    	            var href = $(this).attr('href');
                    	            if(href) {
                    	                gaData[2] = gaData[2].replace('href', href);
                    	            }
                                    gaData[2] = gaData[2].replace('url', window.location.href);
                    	            if(gaData.length > 2){
                                        // Growth RX and GA Event
                                        grxEvent('event', {'event_category': gaData[0], 'event_action': gaData[1], 'event_label': gaData[2]}, 1, 1);
                    	            }
                    	            $this.removeAttr('data-ga-impression');
                        	    }
                	        } catch (err) {_log('Error GA Impression!', err.message);}
                	    });
                	    
                	    // latest code for grx only impression data-grx-impression
                	    $('[data-grx-impression]').each(function(){
                	        var $this = $(this);
                	        try {
                	            if($this.visible(true) && $this.attr('data-grx-impression') != ''){
                    	            var grxData = $this.attr('data-grx-impression').split('#');
                    	            grxData[2] = typeof(grxData[2]) != 'undefined' && grxData[2] != ''?( grxData[2] == 'url'? window.location.href: grxData[2]):'';
                    	            var href = $(this).attr('href');
                    	            if(href) {
                    	                grxData[2] = grxData[2].replace('href', href);
                    	            }
                                    grxData[2] = grxData[2].replace('url', window.location.href);
                    	            if(grxData.length > 2){
                                        // Growth RX Event
                                        grxEvent('event', {'event_category': grxData[0], 'event_action': grxData[1], 'event_label': grxData[2]}, 0, 1);
                    	            }
                    	            $this.removeAttr('data-grx-impression');
                        	    }
                	        } catch (err) {_log('Error GRX Impression!', err.message);}
                	    });
                    	
                    	if($('.lazyIframe').length > 0){
                            objCommon.lazyLoadIframe();
                        }
                        // Show hide scroll top button
                        if ($("#scrollTop").length) {
                            var docHeight = $(document).height();
                            if (docHeight - (docHeight - $(document).scrollTop()) > 800 && !skinningExist && $(window).width() > 1215) {
                                $("#scrollTop").fadeIn("slow");
                            } else {
                                $("#scrollTop").fadeOut("slow");
                            }
                        }
                        objAnalytics.scrollDepth();
                    });
                    
                    $(document).on("click", ".tabsBtn li, .tabVertical .tabs li", function(){
                        var tb_index = $(this).index(),
                            tbc_link = $(this).attr("data-url"),
                            target = $(this).closest('.tabsView').find(".tabsContent > ul"),
                            parentScope = $(this).parents(".tabsView");
                        if($(target).find(" > li:eq("+ tb_index +")").is(":empty") && typeof(tbc_link) != 'undefined'){
                            $(target).find(" > li:eq("+ tb_index +")").html('<div class="clr loadingDiv">Loading...</div>').load(tbc_link)    
                        }
                        
                        $(this).addClass("active").siblings().removeClass("active");
                        
                        $(target).find("> li:eq("+ tb_index +")").slideDown(300).siblings().slideUp(300);
                        
                        parentScope.find(".tabsBtn li").removeClass("hd_after");
                        if(tb_index == 2) $(this).prev().addClass("hd_after");
                    });
                    
                    //election
                    $(document).on("click", ".etabsBtn li, .etabVertical li, .elecNews li , .ele_tabs li", function(){
                        var tb_index = $(this).index(),
                            tbc_link = $(this).attr("data-url"),
                            _msidLi = $(this).attr('data-msid'),
                            target = $(this).closest('.etabsView').find(".etabsContent > ul, .ele_content > ul"),
                            parentScope = $(this).parents(".etabsView");
                        if($(target).find(" > li:eq("+ tb_index +")").is(":empty") && typeof(tbc_link) != 'undefined'){
                            $(target).find(" > li:eq("+ tb_index +")").html('<div class="clr loadingDiv">Loading...</div>').load(tbc_link)    
                        }
                        
                        $(this).addClass("active").siblings().removeClass("active");
                        $(target).find("> li:eq("+ tb_index +")").slideDown(300).siblings().slideUp(300);
                        originalImg = $(target).find("> li:eq("+ tb_index +")").find("img");
            			originalImg.each(function(i,v){
            				var _this = $(this);
            				if (typeof _this.attr("data-original") != "undefined") {
            					_this.attr("src", _this.attr("data-original")).removeAttr("data-original");
            				}
            			});
                        
                        parentScope.find(".etabsBtn li, .ele_tabs li").removeClass("hd_after");
                        if(tb_index == 2) $(this).prev().addClass("hd_after");
                        
                        var _textMore = '';
                        var _textLinkMore = '';
                        if(_msidLi == '66164132'){
                          _textMore  = 'More From Mizoram';
                          _textLinkMore = '/news/elections/mizoram-assembly-elections-news-updates';
                        }else if(_msidLi == '65869835'){
                            _textMore  = 'More From Madhya Pradesh';
                          _textLinkMore = '/news/madhya-pradesh-assembly-elections-news-updates';
                        }else if(_msidLi == '65869844'){
                            _textMore  = 'More From Rajasthan';
                          _textLinkMore = '/news/rajasthan-assembly-elections-news-updates';
                        }else if(_msidLi == '65869846'){
                            _textMore  = 'More From Telangana';
                          _textLinkMore = '/news/telangana-assembly-elections-news-updates';
                        }else if(_msidLi == '65871041'){
                            _textMore  = 'More From Chhattisgarh';
                          _textLinkMore = '/news/chhattisgarh-assembly-elections-news-updates';
                        }else{
                            _textMore  = 'Assembly Election News';
                          _textLinkMore = '/news/elections/assembly';
                        }
                        var _moreHtml = '<a href="'+_textLinkMore+'" target="_blank">'+_textMore+'</a>';
                        $(this).parents('.ele_distribution').find('.assembly_distribution .topSec a.news_redirection').html(_moreHtml);
                    });
                    
                    $('a[href="#"]').click(function (e) {e.preventDefault();})
                    
                    $("#newsInPics, #sideBar, #newsInDefence").etGallery({
                        interval: 10000
                    });
                    $('.copyright').click(function () {
                        var i = $(this).data('count');
                        i = i || 0;
                        $(this).data('count', i + 1);
                        if(i >= 4) {
                            objDev.start();
                        }
                    });
                    
                    $('.authInf li').not('.eventDone').addClass('eventDone').on('mouseover mouseenter', function () {
                        var $this = $(this), 
                        author_name = $.trim($this.find('div.auth a').attr('data-auname')), 
                        author_id = $.trim($this.find('div.auth a').attr('data-authid')), 
                        author_box = $this.find('.author_detail_box');
                        var type = $this.attr('data-type');
                        if(author_box.html() == "") {
                            $.ajax({
                                url: '/author_popup.cms',
                                data: {authorid: author_id,type:type},
                                cache: true,
                                success: function (response) {
                                    author_box.html(response);
                                }
                            });
                        }
                    });
                    // author box commented, handled by CSS
            	},
            	backScript: function () { // back track, back click
                    (function(window, location) {
                        try{
                            _log('backscript', 'init');
                            _log("document.referrer", document.referrer);
                            /* _log('backscript', 'init')
                            var referrer = document.referrer;
                            var homePages = ["https://etdev8243.indiatimes.com/", "https://economictimes.indiatimes.com/"];
                            var currentURL = location.href;
                            var isDetailedPage = 0;
                            if(homePages.indexOf(currentURL) == -1) {
                                isDetailedPage = 1;
                            }
                            
                            if(typeof history != 'undefined' && isDetailedPage) {
                                if(referrer.search(/indiatimes|economictimes/) != -1){
                                     return;
                                } 
                                var stateObj = {"type": "back_script"}; //Just want to change the current history 
                    
                                var goToHomeURL = location.origin;
                                var isHindi = location.pathname.indexOf('/hindi') == 0;
                                if(isHindi) {
                                    goToHomeURL = location.origin + '/hindi';
                                }
                                
                                _log('backscript', 'bind done');
                                // history.pushState(stateObj, document.title, currentURL);
                                history.pushState(null, null, document.URL);
                                // grxEvent('event', {'event_category': 'Back Track', 'event_action': 'Web_Proceed to homepage', 'event_label': currentURL}, 1);
                                window.addEventListener("popstate", function(e) {
                                    if(window.location.href.indexOf('#') == -1) {
                                        window.location.href = '/?back=1';
                                    }
                                }, false);
                            } */
                            
                            //for back from google
                            var referrer = (document.referrer != "")? document.referrer.match(/:\/\/(.[^/]+)/)[1] : document.referrer;
                            if(referrer.search(/economictimes.indiatimes\.com|etdev8243.indiatimes\.com|defaultinterstitial/) != -1){
                                 return;
                            } 
                            var stateObj = {}; //Just want to change the current history 
                            var goToHomeURL = location.origin + '/?back=1';
                            history.pushState(stateObj, document.title, location.href);
                            var currTmpl = window.tmplName;
                            
                            if (currTmpl !='fixeddeposit' && currTmpl !='nrilist') {
                                window.addEventListener("popstate", function(event) {
                                  saveLogs({'type': 'location_href1', 'currPage': location.href});
                                  location.replace(goToHomeURL);
                                  event.stopImmediatePropagation();
                                });
                            }
                            /*window.onpopstate = function(event){
                                saveLogs({'type': 'location_href1', 'currPage': location.href});
                                location.replace(goToHomeURL); 
                                event.stopImmediatePropagation();    
                            };*/
                            saveLogs({'type': 'location_href2', 'currPage': location.href});    
                        }catch(err){
                            console.log("Back script Error: "+ err)
                        }
                    }(window, location));
                },
                oneTapLogin: function(){
                    function _oneTapLogin() {
                        try {
                            var check = $.jStorage.get('c_oneTapLogin');
                            if(!_tp_data.isLogged && !check) {
                                var activeOneTap = 1, experimentCookie = $.cookie('_gaexp');
                                if(window.tpName == 'articleshow' && experimentCookie) {
                                    function valCheck(val) {
                                        var active = 0;
                                        experimentCookie.split('!').forEach(function (name, j) {
                                            if(name.indexOf(val) != -1 && name.substr(-1) == 1) {
                                                active = 1;
                                            }
                                        });
                                        return active;
                                    }
                                    
                                    if(valCheck(objExp.mkt) == 1 && page.subsec1 == '1977021501') {
                                        activeOneTap = 0;
                                        _log('exp markets active');
                                    } else if(valCheck(objExp.old) == 1 && page.age >= 2 ) {
                                        activeOneTap = 0;
                                        _log('exp 48 hr active');
                                    } else if(valCheck(objExp.agen) == 1 && page.agency == 'et bureau') {
                                        activeOneTap = 0;
                                        _log('exp agency active');
                                    } else if (window.location.href.indexOf('plans') != -1) {
                                        activeOneTap = 0;
                                    } else if ($('.skip_googleonetap').length != 0) {
                                        activeOneTap = 0;
                                    }
                                }
                                if(activeOneTap) {
                                    var timeOut = window.tpName.indexOf('articleshow') != -1 ? 2000 : 0;
                                    setTimeout(function () {
                                        loadModule({'module_name': 'js_googlelogin', ref: 'oneTapLogin'});
                                    }, timeOut)
                                }
                            }
                        } catch (e) {}
                    }
                    objUser.afterLoginCall(_oneTapLogin);
                },
                marketModule: function () {
                    // this module will load the /js_common_markets.cms js in markets sections only
                    
                    var url = window.location.href, js_c = $('script[src*="js_common"]').attr('src'); js_ci = js_c.indexOf('v-') + 2, v = js_c.substr(js_ci, js_c.indexOf(',') - js_ci), m = objCommon.isLive ? 1 : 0;
                    v = v ? v : (js_c.substr(js_c.indexOf('v=') + 2));
                    if(url.indexOf('/markets') != -1 || url.indexOf('/indices/') != -1) {
                        loadModule({'module_name': 'js_common_markets', 'v': '456'});
                    }
                },
                getRandomInt: function (max) {
                    return Math.floor(Math.random() * max);
                },
                forSpecificUsers: function (percentage, callback) {
                    percentage = percentage ? percentage : 1;
                    var mode = parseFloat(100 / percentage).toFixed(4);
                    var pfuuid = $.cookie('peuuid') || $.cookie('pfuuid');
                    if(pfuuid != "undefined" && pfuuid){
                        var percentCheck = Math.floor(pfuuid % mode);
                        if(percentCheck == 0 && typeof callback == 'function') {
                            callback();
                        }
                    }  
                },
                forRandomUsers: function (percentageParam, callback, elsecallback) {
                    var percentage = percentageParam ? percentageParam : 1;
                    var mode = Math.floor(100 / percentage);
                    var et_randomid = $.jStorage.get('et_randomid');
                    if(et_randomid == null) {
                        et_randomid = objCommon.getRandomInt(99);
                        $.jStorage.set('et_randomid', et_randomid);
                    }
                    $.jStorage.setTTL('et_randomid', 3600000);
                    var flr = Math.floor(et_randomid % parseFloat(100 / percentageParam).toFixed(4));
                    var inUser = percentageParam && ((percentageParam > 50 && flr == 0) || (percentageParam <= 50 && flr == 1));
                    if(inUser) {
                        callback && callback();
                    } else {
                        elsecallback && elsecallback();
                    }
                },
                experiment: function (percentage) {
                    percentage = percentage ? percentage : 1;
                    var mode = parseFloat(100 / percentage).toFixed(4);
                    var pfuuid = $.cookie('peuuid') || $.cookie('pfuuid');
                    var inPercentage = 0;
                    if(pfuuid != "undefined" && pfuuid) {
                        var percentCheck = Math.floor(pfuuid % mode);
                        if(percentCheck == 0) {
                            inPercentage = 1;
                        }
                    }
                    return inPercentage;
                },
                lazyLoadIframe: function() {
                    var winBottom = $(window).scrollTop() + $(window).height();
                    $('.lazyIframe').each(function () {
                        var $this = $(this), elementTop = $this.offset().top, threshold = $this.data('threshold') || 50;
                        if($this.attr('src') == '' && elementTop < winBottom + threshold) {
                            var src = $this.attr('data-src');
                            $this.attr('src', src);
                        }
                    });
                },
                loadImg: function (elem) {
                    var elem = elem ? elem : $('body');
                    $('img[data-src]').each(function () {
                        var $this= $(this);
                        $this.attr('src', $this.attr('data-src')).removeAttr('data-src');
                    });
                },
                loadFbScript: function() {
                    if($(document).find('script[src*="//connect.facebook.net/en_US/all.js"]').length == 0 && typeof skip.facebook_js == 'undefined') {
                        // Load the SDK asynchronously
                        (function(d, s, id){
                         var js, fjs = d.getElementsByTagName(s)[0];
                         if (d.getElementById(id)) {return;}
                         js = d.createElement(s); js.id = id;js.async = true;
                         js.src = "//connect.facebook.net/en_US/all.js";
                         fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));
                    }
                },
                loginCookieExpiry : function(){
                    if($.cookie("ssoid") != undefined && $.cookie('isTicketIdValid') == undefined){		
                		var urlT= location.pathname =='/default_secheadtest.cms' ? "https://jsso1.indiatimes.com/sso/crossdomain/getTicket?version=v1" :"https://jsso.indiatimes.com/sso/crossdomain/getTicket?version=v1";
                		$.ajax({
                			url : urlT,
                			dataType : "script",
                			data: {
                			    callback:'objCommon.loginCookieExpiryCB'
                			}
                		})
                	}
                },
                loginCookieExpiryCB : function(data){
                    var ticketId = data.ticketId;
                	$.ajax({
                		url : "//socialappsintegrator.indiatimes.com/socialsite/v1validateTicket?channel=et&ticketId="+ticketId,
                		dataType : "script",
                		data: {
                		    callback:'objCommon.v1validateTicketCB'
                		}
                	})
                },
                v1validateTicketCB : function(d){
                    $.cookie('isTicketIdValid',1,{expires:1, path:'/', domain: ".indiatimes.com"});
                },
                event: function (category, action, label, dimensions) {
                    dimensions =  dimensions|| {};
                    ga('send', 'event', category, action, label, dimensions);
                    // Growth RX Event
                    grxEvent('event', {'event_category': category, 'event_action': action, 'event_label': label});
                },
                isIncognito: function (callback) {
                    if (navigator && navigator.storage && navigator.storage.estimate) {
                      navigator.storage.estimate().then(function (data) {
                        if(data.quota < 120000000) {
                            callback('incognito');
                        } else {
                            callback('normal');
                        }  
                      })
                    } else {
                        callback('not_detect');
                    }
                },
                getDeviceName: function() {
                    var deviceName = null;
                    try {
                        var ua = navigator.userAgent;
                        var arr = ua.match(/\(([^)]+)\)/)[1].split(';');
                            deviceName = arr[arr.length-1].trim();
                    } catch (e) {}
                    return deviceName;
                },
                getOS: function () {
                    var os = null;
                    try {
                        var userAgent = window.navigator.userAgent,
                          platform = window.navigator.platform;
                          
                        if (/mac/ig.test(platform)) {
                            os = 'Mac OS';
                        } else if (/win/ig.test(platform)) {
                            os = 'Windows';
                        } else if (/Android/.test(userAgent)) {
                            os = 'Android';
                        } else if (/linux/ig.test(platform)) {
                            os = 'Linux';
                        }
                    } catch (e) {}
                    return os;
                    
                },
                saveLogs: function (data) {
                    saveLogs(data);
                }
            }
            
            sso = {
                login: function (identifier, ru, type) {
                    $.jStorage.deleteKey('userlogin_ru');
                    identifier = identifier ? identifier : 'Top';
                    type = type ? type : 'Sign in button';
                    grxEvent('event', {'event_category': 'ET Login', 'event_action': type, 'event_label':  identifier + ' - ' + window.location.href}, 1);
                    if(ru) {
                        $.jStorage.set('userlogin_ru', ru);
                    }
                    $.jStorage.set('userlogin_galabel', identifier);
                    objUser.initSSOWidget();
                },
                signup: function (identifier, ru, type) {
                    sso.login(identifier, ru, type);
                },
                setPassword: function (actCode, name) {
                }
            }
            
            var etFeedback = {
                visible: true,
                pageName: 'Home Page',
                toggle: function() {
                    var target = $("#feedbackForm"),
                    hitPos = parseInt(target.css("right")) == 0 ? -423 : 0,
                    speed = parseInt(target.css("right")) == 0 ? 500 : 800;
                    target.stop().animate({
                        right: hitPos
                    }, speed, "easeOutQuart", function() {
                        if (!hitPos) {
                            var uid = _tp_data.email.indexOf("@indiatimes.com") != -1 ? "" : _tp_data.email;
                            $(".loading_feedback iframe", target).remove();
                            if($('#feedbackForm:visible').length) {
                                var iframeUrl = '/etfeedback.cms?pagename=' + etFeedback.pageName;
                                
                                if (_tp_data.isLogged) {
                                    iframeUrl += '&amp;name=' + _tp_data.fullName + '&amp;email=' + uid;
                                }
                                
                                $(".loading_feedback", target).append("<iframe src='" + iframeUrl + "' />");
                            }
                        } else {
                            $(".loading_feedback iframe", target).remove();
                        }
                    });
                },
                init: function(pageName) {
                    if(pageName) {
                        etFeedback.pageName = pageName;
                    }
            
                    etFeedback.prepareButton();
                    var isIpad = (navigator.userAgent.match(/iPad/i) != null);
                    if(isIpad) {
                        $('#feedbackForm').hide();
                    }
                    $("#feedbackForm .close").click(function (e) {
                        e.preventDefault();
                        if($("#feedbackForm").css('right') != '0px') {
                            $("#feedbackForm").hide();
                        }
                        else {
                            $("#feedbackForm").css('right', '-423px')
                        }
                    });
                    if (etFeedback.visible) {
                        var target = $("#feedbackForm");
                        $(".btn-wrapper", target).bind("click", function() {
                            etFeedback.toggle();
                            if($(".feedback_overlay").css('display') == 'block') {
                                $(".loading_feedback iframe", target).remove();
                                $("#feedbackForm").hide();
                                $('.feedback_overlay').css({'display':'none'});
                            }
                        });
                    }
                },
                prepareButton: function () {
                    if(!$('#feedbackForm').length) {
                        var btnHtml = '<div id="feedbackForm" style="display:none;"><div class="close">X</div><div class="btn-wrapper"><span class="ctaBtn__txt">Contact Us</span><span class="ctaBtn__icon"></span></div><div class="loading_feedback"><p>Loading<br/>Please wait...</p></div><div class="clr"></div></div>';
                        $('body').append(btnHtml);
                    }
                    
                }
            }
            
            var objEtPrimeLayer = {
                init: function(){
                    var email = _tp_data.email;
                    //var gcmDiv = $('#pushSec:visible').length;
                    //var gcmPopup = $('.et_notifi_frameT:visible').length;
                    
                    //if((objAd.type == 'lite' && email != '') && (!gcmDiv && !gcmPopup)){
                    if(objAd.type == 'lite' && email != ''){
                        objEtPrimeLayer.ruleAskToProfile(email);
                    }
                    
                },
                ruleAskToProfile : function(email){
                    var loadScriptFlag = 0;
                    if($.jStorage.get('_primeLayer') == null){
            	        loadScriptFlag = 1;
            	    }else{
                        var getKeyJSoreage = $.jStorage.get('_primeLayer');
                        if(($.inArray(email, getKeyJSoreage ) > -1) == false){
                            loadScriptFlag = 1;
                        }else{
                            callGcmNewsLayer.init();
                        }
                    }
                    
                    /*if(loadScriptFlag) {
                        loadModule({module_name: 'primepopup', v:3, callback: function () {
                            primePopUp.init();
                        }});
                    }*/
            	}
            }
            
            // GCM Newsletter layer function call here callGcmNewsLayer.init();
            var callGcmNewsLayer = {
                 callFun : function(){
                     if(objGdpr.allow() == 1) {
                        var scrollFlag = 0;
                        var newLetterInit = (function(){
                            var flag = 1;
                            return function(){
                                if(typeof subsec1_common != 'undefined' && flag){
                                    flag = 0;
                                    if(typeof(newsLetterApp) != 'undefined'){
                                        newsLetterApp.init();
                                    } else {
                                        newsHooksFn.load();
                                    }
                                }
                            }
                        })();
                        $(window).one('mousemove scroll', function(event) {
                            if(!_tp_data.isAdfree) {
                                newLetterInit();
                            }
                        });
                        $(window).scroll(function (event) {
                            var scroll = $(window).scrollTop();
                            var btmBanner = $('.afb:visible').length;
                            if (scroll > 500 && !btmBanner) {
                                //newLetterInit();
                                //$(window).off('scroll');
                                if(typeof(newHookId) !== 'undefined' && typeof(newsHooksFn) !== 'undefined' && scrollFlag == 0){
                                    scrollFlag = 1;
                                    $(window).on('scroll',function() {
                                        var gcmDiv = $('#pushSec:visible').length;
                                        var gcmPopup = $('.et_notifi_frameT:visible').length;
                                        if(!gcmDiv && !gcmPopup && hookFnCall && typeof($.cookie('_hookShow')) == 'undefined') { 
                                            if(typeof newsHooksFn != 'undefined' && typeof newsHooksFn.init != 'undefined'){
                                                hookOverLayCall = true;
                                                if($('#profLayerContainer .profLayerBox:visible').length == 0){
                                                    // newsHooksFn.init(newHookId);
                                                }
                                                hookFnCall = false;
                                            } else{
                                                newsHooksFn.load(newHookId);
                                            }
                                        }
                                    });
                                }
                            }
                        });
                        //newProfileFn.load();
                    }
                },
                init : function(){
                    var primeLayer = $('#primeSecLayer:visible').length;
                    if(!primeLayer && typeof objAd !== "undefined" && objAd.type != 'adfree'){
                        callGcmNewsLayer.callFun();
                    }
                }
            }
            // GCM Newsletter layer function call here end
            
            // services for Portfolio
            objPfsDomain = '//pffeeds.indiatimes.com/mobileservices';
            objPWatchlistDomain = '//pffeedswatchlist.indiatimes.com/mobileservices';
            if(objCommon.isLive == 0) {
                objPfsDomain = '//qcdevportfolio.indiatimes.com/mobileservices';
            }
            
            objPfs = {
                createPortfolioUser: objPfsDomain + '/ETNewRegistration.jsonp?source=web',
                getClosePrice: objPfsDomain + '/GetCompanyClosePrice.jsonp?source=web',
                createPortfolio: objPfsDomain + '/CreatePortfolio.jsonp?source=web',
                getPortfolioList: objPfsDomain + '/MobileDashBoard.jsonp?source=web',
                getPortfolioData: objPfsDomain + '/UserAssetClassDetails.jsonp?source=web',
                getAllTransactionInPortfolio: objPfsDomain + '/GetPortfolioCompanyDetails.jsonp?source=web',
                addStockToPortfolio: objPfsDomain + '/AddStockTransaction.jsonp?source=web',
                createWatchlist: objPfsDomain + '/AddWatchList.jsonp?source=web',
                editWatchlist: objPfsDomain + '/EditWatchList.jsonp?source=web',
                getWatchlist: objPfsDomain + '/getAllWatchListForUser.jsonp?source=web',
                getWatchlistCompany: objPfsDomain + '/getWatchAssetDetails.jsonp?source=web',
                // getWatchlistCompany: objPfsDomain + '/getWatchComapanyDetails.jsonp?source=web',
                addCompanyToWatchlist: objPfsDomain + '/AddWatchListAssets.jsonp?source=web',
                deleteCompanyFromWatchlist: objPfsDomain + '/DeleteMultipleAssetWatchList.jsonp?source=web',
                deleteWatchlist: objPfsDomain + '/DeleteWatchList.jsonp?source=web',
                getMarketStatus: objPfsDomain + '/MarketStatusData.jsonp?source=web',
                autoWatchlistForNewUser: objPfsDomain + '/AddAssetNWatchList.jsonp?source=web',
                getAllCompaniesFromAllWatchlists: objPWatchlistDomain + '/GetAllWatchListCompanies.jsonp?source=web'
            }

/* TABS plugin */
$.fn.etTabs = function(opts){
	var settings = {
		tabs	: ".tabsBtn > ul > li",
		content	: ".tabsContent > ul > li",
		activeClass : "active",
		speed : 500,
		event : "click",
		effect : "slide"
	};
	//election 2023
	var settings = {
		tabs	: ".ele_tabs > ul > li",
		content	: ".ele_content > ul > li",
		activeClass : "active",
		speed : 500,
		event : "click",
		effect : "slide"
	};
	
	//election
	var settings = {
		tabs	: ".etabsBtn > ul > li",
		content	: ".etabsContent > ul > li",
		activeClass : "active",
		speed : 500,
		event : "click",
		effect : "slide"
	};
	
	//election Widget
	var settings = {
		tabs	: ".elecNews > ul > li",
		content	: ".etabsContent > ul > li",
		activeClass : "active",
		speed : 100,
		event : "click",
		effect : "slide"
	};
	if(typeof opts == "object"){
		if($.isPlainObject(opts)){
			$.extend(settings, opts);
		}
	}
	
	// attaching NameSpace in event (optional)
	settings.event = settings.event + ".etTabs";
	
	return this.each(function(){
		var o = $(this);
		$(settings.tabs, o).on(settings.event, function(event){
			var tabIndex = $(this).index(),
				target = $(settings.content, o).eq(tabIndex);
			
			$(this).addClass(settings.activeClass).siblings().removeClass(settings.activeClass);
			switch(settings.effect){
				case "slide" :
					target.slideDown(settings.speed).siblings().slideUp(settings.speed);
					break;
				case "fade" :
					target.stop().fadeTo(settings.speed, 1).siblings().stop().fadeOut(settings.speed/2);
					event.stopPropagation();
					break;
				case "none" :
					target.show().siblings().hide();
					break;
			}
			event.preventDefault();
		});
	});
}

objLocation = {
    data:{},
    refreshAfter: (5 * 36e5),  // 5 hr delay
    init:function () {
        var et_location = $.jStorage.get('et_location');
        if(et_location){
            objLocation.data = et_location;
            objLocation.onSuccess();
        } else {
            $(window).one('mousemove', function(event) {
                objLocation.getData();
            });
        }
    },
    getData: function () {
        try {
            var date = new Date();
            $.jStorage.set('et_location', 0);
            $.jStorage.setTTL("et_location", objLocation.refreshAfter);
            var url = "//etsub4.economictimes.com/geolocation/geodetails";
            /*
            if(objCommon.isLive == 0) {
                url = '//etnstg.indiatimes.com/geolocation/geodetails';
            }
            */
            $.ajax({
                 url: url,
                 data: {'callback':'objLocation.getDataCallback'},
                 dataType:"script",
                 cache:true
            });
        } catch (e) {
            _log('error objLocation', e);
        }
    },
    getDataCallback: function (data) {
        var obj = {countryId:data.countryId, cityId:data.cityId, region:data.region, city:data.city, clientIp: ''};
        if(data.clientIp) {
            obj.clientIp = data.clientIp;
        }
        objLocation.data = obj;
        
        $.jStorage.set('et_location', obj);
        $.jStorage.setTTL("et_location", objLocation.refreshAfter);
        objLocation.onSuccess();
    },
    onSuccess:function () {
        try {
            /*
            var userLang = $.jStorage.get('et_userLang');
            if(userLang == null || userLang == '') { // if no user perfrence
                var userLang = marketBand.objLang.locLangMap[objLocation.data.region];
                if(userLang != null && userLang != '') {
                    marketBand.objLang.changeLang(userLang);
                    ga('send', 'event', 'ETHome-IndicesBand', 'Load', 'Default_Lang_' + userLang);
                }
            }
            */
        } catch (e) {
            _log(e);
        }
    }
}	
	/* endof TABS plugin */
objTrade = {
    init: function () {
        loadModule({'module_name': 'js_tradenow'});
    }
}
if(objGdpr.allow()) {
        // objLocation.init();
        //searchHistory();
        if($('.btn_trade').length) {
            objTrade.init();
        }
    }

// Need to optimize	
var topsearchslider = {
    init :function() {
        if($('.topsearchwidget').length) {
            var width=0;
            $('.topsearchwidget .contentDiv ul li').each(function(i,j){
                width += $(this).outerWidth() +10;
            });
            if(width > 480){
                $('.nexpreslide').css('display','inline-block');
            }
            $('.topsearchwidget .contentDiv ul').css('width',(width+10));
            topsearchslider.bindEvent();
        }
    },
    bindEvent :function(){
        $('.topsearchwidget').on('click','.nexpreslide > p', function(){
            _this = $(this).find('> span');
            var posLeft = Number($('.topsearchwidget .contentDiv ul').css('left').split('px')[0]);
            var widthInView = $('.topsearchwidget .contentDiv').outerWidth();
            var completeWidth = $('.topsearchwidget .contentDiv ul').outerWidth();
            if(_this.hasClass('prevArr')){
               topsearchslider.prevSlide(posLeft,widthInView,completeWidth,_this);
            }else if(_this.hasClass('nextArr')){
               topsearchslider.nextSlide(posLeft,widthInView,completeWidth,_this);
            } 
        });
    },
    nextSlide:function(posLeft,widthInView,completeWidth,_this){
        if(posLeft >= Number('-'+completeWidth)+widthInView){
            var widthToSlide = (completeWidth - widthInView + posLeft) > widthInView ? posLeft + Number('-'+widthInView) : posLeft + Number('-'+(completeWidth - widthInView +posLeft));
            $('.topsearchwidget .contentDiv ul').animate({left: widthToSlide+'px'},{complete : function(){
                _this.parent().siblings().find('> span').addClass('on');
                var posLeft = Number($('.topsearchwidget .contentDiv ul').css('left').split('px')[0]);
                if(Math.round(posLeft,0) == Math.round( Number('-'+completeWidth)+widthInView,0)){
                   _this.removeClass('on');
                }
            }});
            
        }
    },
    prevSlide:function(posLeft,widthInView,completeWidth,_this){
        if(posLeft < 0){
            var widthToSlide = posLeft < Number('-'+widthInView) ? widthInView + posLeft : 0;
           $('.topsearchwidget .contentDiv ul').animate({left: widthToSlide+'px'},{complete: function(){
               _this.parent().siblings().find('> span').addClass('on');
               var posLeft = Number($('.topsearchwidget .contentDiv ul').css('left').split('px')[0]);
               if(posLeft>= 0){
                   _this.removeClass('on');
               }
           }});
           
        }
    }
}

objAdBlockerCheck = {
    blockerStatus : 0,
    init : function() {
        _log('Ad Blocker Fun');
        $('body').append('<div class="ad_block"></div>'); // to check ad blocker is on or not
        var ab = $('.ad_block').length > 0 && $('.ad_block:visible').length == 0 ? 1 : 0;
        _log('Ad Blocker Status Check', ab ? 'Active Blocker' : 'No Blocker');
        setTimeout(function () {
            if(ab) {
                objAdBlockerCheck.blockerStatus = 1;
                // This condition requires not to show adblocker in case of paid user only below tracking will be called.Don't remove the below if condition until and unless below tracking not required.
                if(!_tp_data.isPrime){
                    objAdBlocker.forRandomUsers(100, function(){
        		        objAdBlocker.init();    
        		    });
                }
                //$('body').append('<div style="padding: 10px;background: yellow;left: 0;right: 0;bottom: 0;position: fixed;text-align: center;margin: auto;z-index: 1;width: 980px;font-weight: 700;font-size: 16px;">You have enabled ad blocker</div>');
                if($.jStorage.get('ad_blocker_detect') == null) {
                    grxEvent('event', {'event_category': 'Ad Blocker Detect', 'event_action': 'Ad Blocker', 'event_label': window.location.href}, 1);
                    $.jStorage.set('ad_blocker_detect', 'Active', {TTL: 24*60*60*1000}); 
                }
            }
            if((objAdBlockerCheck && objAdBlockerCheck.blockerStatus == 1) || (objAd && objAd.adBlocker == 1)){
                //console.log("---------------ADBLOCKER DETECTED--------------------");
                if(location.href.indexOf("adshield=1") > -1 && typeof _tp_data !="undefined" && _tp_data.isPrime == false && _tp_data.isAdfree == false){
                    objAd && objAd.loadAdShield && objAd.loadAdShield();
                }
              }

        }, 1000);
    }
}

objCdp = {
    counter: 1,
   init: function() {
       objCdp.createForm();
   },
   createForm:function (formName) {
        formName = typeof formName != 'undefined' ? ('js_form_' + formName) : 'js_form';
        if($('form#' + formName).length < 1) {
            $('body').append('<iframe style="display:none;" id="js_postframe' + formName + '" name="js_postframe' + formName + '"></iframe><form method="POST" target="js_postframe' + formName + '" style="display:none;" id="' + formName + '" name="' + formName + '">');
        } else {
            $('form#' + formName).html('');
        }
        return formName;
        
   },
   post: function(url, data, formName) {
        var formId = objCdp.createForm(formName);
        formId = '#' + formId; 
       if (typeof data == 'object') {
           $.each(data, function(i, j) {
                j = typeof j == 'object' ? JSON.stringify(j) : j;
                var ele = $('<input/>').attr('type', 'hidden').attr('name', i).attr('value', j);

                $(formId).append(ele);
           });
       }
       $(formId).attr('action', url);
       $(formId).submit();
       
   }
}
	/* ET SpotLight */
$.fn.etSpotlight = function (opts) {
	var settings = {
		speed : 500,
		easing : "easeOutSine",
		auto : true,
		interval : 5000,
		thumbEvent : "click",
		pauseOnHover : true,
		next : ".nav .next",
		prev : ".nav .prev",
		thumbs : ".nav .thumbs ul",
		display : ".display > ul"
	}
	if (typeof opts != "undefined") {
		if ($.isPlainObject(opts)) {
			$.extend(settings, opts);
		}
	}
	if (!$.easing || !$.easing.hasOwnProperty(settings.easing)) {
		settings.easing = "linear";
	}
	return this.each(function () {
		var o = $(this),
		nextBtn = $(settings.next, o),
		prevBtn = $(settings.prev, o),
		thumbs = $(settings.thumbs, o),
		display = $(settings.display, o),
		thumbWidth = thumbs.find("li").first().outerWidth(),
		displayWidth = display.find(">li").first().outerWidth(),
		autoInterval,
		originalImg;
		thumbs.find("li").first().before(thumbs.find("li").last());
		nextBtn.bind("click", function () {
			$(this).unbind("click");
			goNext();
		});
		prevBtn.bind("click", function () {
			$(this).unbind("click");
			goPrev();
		});
		thumbs.find("li").bind(settings.thumbEvent, function () {
			var indx = $(this).index();
			if (!$(this).hasClass("active")) {
				if (indx > 1) {
					nextBtn.trigger("click");
				} else if (indx < 1) {
					prevBtn.trigger("click");
				}
			}
		});
		if (settings.pauseOnHover && settings.auto) {
			display.parent().bind("mouseenter", function () {
				clearInterval(autoInterval);
			}).bind("mouseleave", function () {
				setAuto();
			});
		}
		function goNext() {
			clearInterval(autoInterval);
			originalImg = display.find(">li").eq(1).find("img");
			originalImg.each(function(i,v){
				var _this = $(this);
				if (typeof _this.attr("data-original") != "undefined") {
					_this.attr("src", _this.attr("data-original")).removeAttr("data-original");
				}
			});
			thumbs.find("li").removeClass("active").eq(1).next().addClass("active").parent().stop().animate({
				"margin-left" : thumbWidth * -1
			}, settings.speed, settings.easing, function () {
				thumbs.css({
					"margin-left" : 0
				}).find("li").last().after(thumbs.find("li").first());
			});
			display.stop().animate({
				"margin-left" : displayWidth * -1
			}, settings.speed, settings.easing, function () {
				display.css({
					"margin-left" : 0
				}).find(">li").last().after(display.find(">li").first());
				if (settings.auto) {
					setAuto();
				}
				nextBtn.bind("click", function () {
					$(this).unbind("click");
					goNext();
				});
			});
			var lazyImages = display.find('img[data-src]');
			if(lazyImages.length) {
			    lazyImages.each(function () {
                    var $this = $(this);
                    $this.attr('src',$this.attr('data-src')).removeAttr('data-src');
                })
			}
		}
		function goPrev() {
			clearInterval(autoInterval);
			thumbs.css({
				"margin-left" : thumbWidth * -1
			}).find("li").first().before(thumbs.find("li").last()).siblings(".active").removeClass("active").prev().addClass("active").parent().stop().animate({
				"margin-left" : 0
			}, settings.speed, settings.easing, function () {
				thumbs.css({
					"margin-left" : 0
				});
			});
			originalImg = display.find(">li").last().find("img");
			originalImg.each(function(i,v){
				var _this = $(this);
				if (typeof _this.attr("data-original") != "undefined") {
					_this.attr("src", _this.attr("data-original")).removeAttr("data-original");
				}
			});
			display.css({
				"margin-left" : displayWidth * -1
			}).find(">li").first().before(display.find(">li").last()).parent().stop().animate({
				"margin-left" : 0
			}, settings.speed, settings.easing, function () {
				display.css({
					"margin-left" : 0
				});
				if (settings.auto) {
					setAuto();
				}
				prevBtn.bind("click", function () {
					$(this).unbind("click");
					goPrev();
				});
			});
		}
		function setAuto() {
			clearInterval(autoInterval);
			autoInterval = setInterval(function () {
					goNext();
				}, settings.interval);
		}
		if (settings.auto) {
			setAuto();
		}
	});
}
/* endof ET Spotlight*/

function swapBannertop() {
    try{
        var lastBanner = $.jStorage.get('et_wealth_banner');
        if(lastBanner == null) {
            $.jStorage.set('et_wealth_banner', 0);
            $.jStorage.setTTL('et_wealth_banner', 24*60*60*1000); //24 hour;
            $('.headBanner a:eq(0)').show();
        } else {
            lastBanner++;
            var total_banner = $('.headBanner > a').length,
            currBanner =  lastBanner >= total_banner ? 0 : lastBanner; //(lastBanner == 1) ? 2 : 1;
            $('.headBanner a:eq('+ currBanner +')').show();
            $.jStorage.set('et_wealth_banner', currBanner);
        }    
    }catch(e){
        _log("FN banner Swap :"+e)
    }
}

function number_format(num) {
    return String(num).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")
}

function cdpGoToPlan(ctaText = "subscribe_now", item_category3 = "atf_cta") {
    goToPlan({
        cdp: true,
        ctaText: ctaText,
        item_category2: window.secname,
        item_category: "atf_offer_cta",
        item_category3: item_category3, 
        item_category4: ctaText.replace('topbutton_', '') || '',
        item_brand: 'product_interventions',
        item_name: window.tmplName, 
        item_id: "atf",
    })
}

function goToPlan(params, element, e) {
    $.jStorage.deleteKey('userlogin_ru');
    params = params || {};
    if(element) {
        try {
            var $this = $(element);
            if($this.attr('data-dim49')) {
                params.dim49 = $this.attr('data-dim49');
            }
            if($this.attr('href')) {
                params.url = $this.attr('href');
            }
            e && e.preventDefault();
        } catch (err) {}
    }
    
    if(params.cdp) {
        cdpData(params, true);
        grxEvent('cdp_event', {'event_category': 'subscription', 'event_name': 'paywall', 'event_nature': 'click'});
        ga4Event({
            item_category2: params.item_category2 || window.secname, 
            item_category3: params.item_category3 || "paywall_blocker_cta", 
            item_category4: params.item_category4 || "Subscribe Now",
            item_name: params.item_name || window.artTitle, 
            item_brand: params.item_brand || 'content',
            item_category: params.item_category || '',
            item_id: params.item_id || window.msid,
            location_id: params.location_id || ''
        }, 'select_item');
    }
    
    console.log('params',params)
    var syftData = objSyftCount.get();
    var cVal = JSON.stringify({
        'msid' : (params.msid || ''),
        'art_category' : (params.category || ''),
        'title' : (params.title || ''),
        'ru' : window.location.href,
        cta: (params.cta || ''),
        dt: new Date()
    });
    var cDim = window.customDimension || {};
    if(window.tmplName) {
        cDim.dimension24 = window.tmplName == 'default' ? 'homepage' : (window.tmplName.indexOf('articleshow') != -1 ? 'articleshow' : tmplName);
    }

    if(params.dim49) {
        cDim.dimension49 = params.dim49;
    }
    if(params.dim1) {
        cDim.dimension1 = params.dim1;
    }
    if(params.cd) {
        cDim.dimension28 = params.cd;
    }
    objGdpr.removeCookie('subscriptionRedirection');
    // $.cookie("subscriptionRedirection", cVal, {path: "/", domain: ".indiatimes.com"});
    var expirySec = objCommon.isLive == 1 ? 30000 : 60 * 60 * 1000;
    var expires = new Date(new Date().getTime() + expirySec);
    // $.cookie("et_gadimension", JSON.stringify(cDim), {path: "/", domain: ".indiatimes.com", expires: expires});
    _log('cDim', cDim);
    if(window.localStorage && localStorage.setItem) {
        localStorage.setItem("subscriptionRedirection", cVal);
        localStorage.setItem('et_gadimension', JSON.stringify(cDim));
    }
    
    $.removeCookie('etipr');
    $.removeCookie('etipr', { path: '/', domain: '.indiatimes.com' });
    var gotoPage = ((params.upgrade || _tp_data.isPrime) ? objVc.planPageUpgrade : objVc.planPage) + (params.planType ? '?plancode=' + params.planType : '');

    if(params.url){
        gotoPage = params.url;   
    } else {
        if (params.dc) {
            gotoPage = gotoPage + (gotoPage.indexOf('?') == -1 ? '?' : '&') + 'dc=' + params.dc; 
        }
        if (params.planGroup) {
            gotoPage = gotoPage + (gotoPage.indexOf('?') == -1 ? '?' : '&') + 'planGroup=' + params.planGroup; 
        }
        if (params.cardType) {
            gotoPage = gotoPage + (gotoPage.indexOf('?') == -1 ? '?' : '&') + 'cardType=' + params.cardType; 
        }    
    }
    
    if (params.extraParams) {
        gotoPage = gotoPage + (gotoPage.indexOf('?') == -1 ? '?' : '&') + params.extraParams; 
    }
    
    var experimentFlag = experimentStatus('C8qD6Em0Qsev5ETNfdoAhg');
    if(!_tp_data.isLogged && (experimentFlag == 1 || params.loginFirst)) {
        gotoPage = '/login.cms?ru=' + gotoPage;
    }
    
    if(gotoPage) {
        grxPushData(cDim, gotoPage, JSON.parse(cVal).ru);
	} else {
	    saveLogs({'type': 'location_href_error', 'gotoPage': gotoPage});
	}
}

function grxPushData(cDim, gotoPage, ru) {
    var baseURL = objCommon.isLive ? "etpwaapi" : "etpwaapipre",
        clonedObjDim = JSON.parse(JSON.stringify(objDim)),
        newObj = {},
        objUserData = {};

    for(let ele in clonedObjDim){
    	newObj['dimension'+ele.split('d')[1]] = clonedObjDim[ele]
    }
    
    if(_tp_data.isLogged){
       objUserData.email = _tp_data.email;
       objUserData.mobile = _tp_data.mobile;
       objUserData.fname = _tp_data.fname;
       objUserData.fullname = _tp_data.fullName;
    }

    var extendedGa4Items = Object.assign({}, window.ga4Items, {
        "section_name": (customDimension.dimension27).toLowerCase() || (customDimension.dimension26).toLowerCase(),
        "subscription_status": window.grxDimension_cdp["subscription_status"],
        "subscription_type":  window.grxDimension_cdp["subscription_type"],
        "feature_name" : window.grxDimension_paywall && window.grxDimension_paywall["feature_name"],
        "sub_section_name": "",
    });

    var dataToPost = {
        ET : cDim,
        grxMappingObj: newObj,
        objUserData: objUserData,
        analytics_cdp: window.grxDimension_paywall,
        ga4Items: extendedGa4Items
    }

    var featureCode = '', locHref = window.location.href;
    
    if((locHref.indexOf('publication-the-economic-times') > 0 && tpName == 'timesepaper')) {
        featureCode = 'ETEPPR'
    } else if((tpName == 'print_edition') || (tpName == 'articleshow_main' && subsec1_common == '90824627')) {
        featureCode = 'ETPRED'
    } else if(tpName == 'wealth_edition' || tpName == 'wealth_editionshow') {
        featureCode = 'ETWEED'
    } else if(tpName == 'stockreports_benefits' || tpName == 'stockreports' || tpName == 'stocks') {
        featureCode = 'ETSRP'
    } else if(tpName == 'articleshow_exclusive2' && typeof isPrimeContent != 'undefined' && isPrimeContent == 'true' && subsec1_common == '1977021501') {
        featureCode = 'ETINVID'
    } else if(tpName == 'primearticleshow' || tpName == 'articleshow_exclusive2') {
        featureCode = 'ETARTICLES'
    } else if(locHref.indexOf('publication-the-times-of-india') > 0 && tpName == 'timesepaper') {
        featureCode = 'TOIEPPR'
    } else if(locHref.indexOf('publication-maharashtra-times') > 0 && tpName == 'timesepaper') {
        featureCode = 'MATAEPPR'
    } else if(locHref.indexOf('publication-mirror') > 0 && tpName == 'timesepaper') {
        featureCode = 'MIRROREPPR'
    } else if(tpName == 'etgrandmasters'){
        featureCode = 'ETCHPTR';
    }
    
    var featureCodeParam = (featureCode != '' ? '&featureCode=' + featureCode + '&acqSubSource=' + featureCode : '');
    
    if(tpName == 'timesepaper' && (locHref.indexOf('publication-maharashtra-times') > 0 || locHref.indexOf('publication-mirror') > 0)) {
        featureCodeParam = (featureCodeParam != '' ? '&acqSubSource=' + featureCode : '')
    }
    
    var newUrl = gotoPage + (gotoPage.indexOf('?') == -1 ? '?' : '&') + ('ru='+encodeURI(ru)+'&grxId=' + $.cookie('_grx') + featureCodeParam);
    newUrl = window.location.host.indexOf('-pp') !== -1 ? newUrl.replace('dev-buy', 'buy') : newUrl;
    console.log(newUrl);
    
    $.ajax({
        url : "https://"+baseURL+".economictimes.com/pushGaData",
        dataType: "json",
        timeout: 10000,
        method:'POST',
        data: {
          "logdata": JSON.stringify(dataToPost),
          "merchantType": 'ET',
          "grxId": $.cookie('_grx')
        },
        success: function(data) {
            if(_tp_data.isLogged) {
                var jsso = new JssoCrosswalk(objUser.channel, objUser.mode);
                jsso.getValidLoggedInUser(function(response) {
                    var urlWithTID = newUrl;
                    if(response.status == 'SUCCESS' && response.data.encTicket) {
                        var urlWithTID = newUrl + (newUrl.indexOf('?') == -1 ? '?' : '&') + 'ticketId=' + response.data.encTicket;
                    }
                    window.location.href = urlWithTID;
                });
            } else {
                window.location.href = newUrl;
            }
        },
        error: function (e) {
            console.log(e);
            window.location.href = newUrl;
        }
    });
}

$.fn.readMoreLess = function (words, threshold) {
    words = words || 60;
    threshold = threshold || 20;
    var elements = $(this);
    elements.each(function () {
        var $this = $(this);
        if(!$this.hasClass('bindDone')) {
            $this.addClass('bindDone');
        }
        var html = $this.html(), arr = html.split(" ");
        if(arr.length > (words+ threshold)) {
            var less = arr.splice(0, words);
            html = less.join(" ") + "<span class='dots'>...</span>" + "<span class='more hidden'> " + arr.join(" ") + "</span><span class='toggle_btn'>Read More</span>";
            $this.html(html);
            $this.find('.toggle_btn').click(function () {
                var curState = $(this).text() == 'Read More' ? 'less' : 'full';
                if(curState == 'less') {
                    $this.find('.dots').hide().end().find('.more').show();
                    $(this).text('Read Less');
                } else {
                    $this.find('.dots').show().end().find('.more').hide();
                    $(this).text('Read More');
                }
            });
        }
    });
}

// defined in /js_login.cms too and modication here should be there too
// defined in /js_commonall.cms too and modication here should be there too
function grxEvent(type, data, gaEvent, nonInteraction, trackingType) {
    gaEvent = gaEvent || 0;
    var _grxDimension = Object.assign({}, window.grxDimension || {}, data);
    var _grxDimension_cdp = Object.assign({}, window.grxDimension_cdp || {}, data);

    if(window.grx && data) {
        if(window.customDimension && window.objDim) {
            for(key in customDimension) {
                var dimId = 'd' + key.substr(9, key.length);
                if(objDim[dimId] && typeof customDimension[key] != 'undefined') {
                    _grxDimension[objDim[dimId]] = customDimension[key];
                }
            }
        }
        var pfuuid = getCookie('pfuuid');
        if(pfuuid) { _grxDimension['et_uuid'] = pfuuid}
        
        if(!_grxDimension['email'] && _tp_data.email) {
            _grxDimension['email'] = _tp_data.email;
        }
        if(!_grxDimension['email']) {
            _grxDimension['email'] = '-';
        }
        if(!_grxDimension['first_name']) {
            _grxDimension['first_name'] = '-';
        }
        var objProf = $.jStorage.get('et_subscription_profile');
        if(objProf) {
            for (var attrname in objProf) { _grxDimension[attrname] = objProf[attrname]; }
        }
        
        var isOldGrxAllowed = window.objVc && objVc.OldGrxSwitch === '1';
        if(type == "cdp_event") {
            var _grxDimension_cdp_paywall = Object.assign({}, typeof grxDimension_paywall != 'undefined' ? window.grxDimension_paywall : window.grxDimension_cdp || {}, data);
            var eventName = _grxDimension_cdp_paywall.event_name || 'event';
            window.grx("track", eventName, _grxDimension_cdp_paywall);
        } else if(trackingType != 'clevertap_pv' && isOldGrxAllowed) {
            grx('track', type, _grxDimension);
        }
        //console.log('grx', type, _grxDimension);
        /*if(objUser.checkPermission(['subscribed', 'expired_subscription', 'cancelled_subscription']) && (type == 'event' || type == 'page_view') && !window.objAnalytics.skipCleverTap && window.allowGdpr == 1) {
            objAnalytics.clevertabEvent(type, _grxDimension);    
        }*/ 
   }
    if(gaEvent && window.ga && type == 'event') {
        var gaDimension =  Object.assign({}, window.customDimension || {});
        var isImpression = (data.event_category + data.event_action + data.event_label).toLowerCase().indexOf('impression') != -1;
        if(nonInteraction || isImpression) {
            gaDimension.nonInteraction = 1;
        }
        ga("send", "event", data.event_category, data.event_action, data.event_label, gaDimension);
    }

    if(window.dataLayer && (type == 'event' || type == 'page_view')) {
        var gtmEventType = (type == 'page_view' ? 'et_push_pageload' : 'et_push_event');
        var _gtmEventDimension = Object.assign({}, _grxDimension, {'event' : gtmEventType});
        window.dataLayer.push(_gtmEventDimension);
    }
    // window.grxDimension_paywall = Object.assign({}, window.grxDimension_cdp || {}, window.cdpPaywall);
}

function ga4Event(obj, eventName) {
    var _gtmEventDimension = Object.assign({}, {items: [obj]}, {'event' : eventName});
    // console.log('GA4 Property values - ', _gtmEventDimension);
    if(eventName === "select_item") {
        window.ga4Items = obj;
    }
    window.dataLayer.push(_gtmEventDimension);
}

function cdpData(obj, flag) {
    var cdpPaywall = {};
    cdpPaywall['cta_text'] = obj.ctaText && obj.ctaText.toLowerCase() || '';
    /* cdpPaywall['event_section'] = obj.event_section && obj.event_section.toLowerCase() || 'paywall_blocker';
    cdpPaywall['event_sub_section'] = '';
    cdpPaywall['landing_L1'] = obj.landing_L1 || 'plan_page';
    cdpPaywall['landing_L2'] = '';
    cdpPaywall['landing_L3'] = '';
    cdpPaywall['landing_page_template'] = 'plan_page';
    cdpPaywall['landing_url'] = obj.landing_url || 'plan_page';
    cdpPaywall['position'] = ''; */
    cdpPaywall['discount'] = '';
    cdpPaywall['feature_name'] = obj.feature_name || '';
    cdpPaywall['sub_plan'] = obj.sub_plan || '';
    
    cdpPaywall['ml_threshold_value'] = customDimension.dimension114 || '';
    cdpPaywall['ml_score'] = customDimension.dimension113 || '';
    cdpPaywall['ml_status'] = customDimension.dimension112 || '';
    cdpPaywall['paywalling_type'] = '';
    cdpPaywall['paywall_score'] = '';
    cdpPaywall['paywall_probability'] = '';
    if(flag) {
        cdpPaywall['unique_subscription_id'] = getCookie('_grx')+'_'+(+new Date());
    }

    window.grxDimension_paywall = Object.assign({}, window.grxDimension_cdp || {}, window.cdpPaywall);
    // console.log(grxDimension_paywall, 'grxDimension_paywall ASM');
}

objProfile = {
    subDetails: {},
    subscribed_newsletters: '',
    init: function (directHit) {
        directHit = directHit || 0;
        var check = $.jStorage.get('et_profilelog'),
            curDate = dateFormat(new Date(), '%d-%M-%Y'),
            first_date_on_et = $.jStorage.get('et_first_date'),
            profileData = $.jStorage.get('et_subscription_profile'),
            accessPassData = $.jStorage.get('accessPassData') ;
        
        if(!first_date_on_et) {
            $.jStorage.set('et_first_date', curDate);
        }
        objProfile.setProfileCDPDefault();
        
        if(check != curDate || directHit || !profileData) {
            $.jStorage.set('et_profilelog', curDate);
            _log('et_profilelog before', $.jStorage.get('et_profilelog'))
            if(_tp_data.isLogged) {
                objProfile.getSubDetails();
                objNLSubscription.checkNewsLtrSubsc({email: _tp_data.email}, objProfile.getNLSubDetails);
            } else {
                objProfile.grxProfile();
            }
            _log('et_profilelog after', $.jStorage.get('et_profilelog'))
        }
        
        if(!accessPassData && _tp_data.isLogged) {
            objProfile.getAccessBandDetails();
        }
        
        _log('et_profilelog after1', $.jStorage.get('et_profilelog'))
       
        objProfile.setOtherInfo();
        
        _log('et_profilelog after2', $.jStorage.get('et_profilelog'))
    },
    setOtherInfo: function () {
        try {
            $('body').on('click', '[href]', function () {
                var last_click = '';
                if(wlp == '/' || wlp == '/default.cms'){
                    last_click = 'homepage';
                } else if (window.art_hostId == '364' || window.hostId == '364') {
                    last_click = 'print_edition';
                } else if (wlp.indexOf('articleshow') == -1 && window.objSec && objSec.secNames && objSec.secNames.slice(-1)[0]) {
                    last_click = objSec.secNames.slice(-1)[0];
                } else if (wlp.indexOf('articleshow') != -1) {
                    last_click = 'articleshow';
                } else if (window.tpName == 'default_prime') {
                    last_click = 'default_prime';
                }
                $.jStorage.set('etu_last_click', last_click, {TTL:1800000});
            })
            
            var wlh = window.location.href, wlp = window.location.pathname;
            var utm_medium = getParameterByName('utm_medium').toLowerCase();
            
            if(window.trafficSource) {
                $.jStorage.set('etu_source', trafficSource, {TTL:1800000});
            }
            var bmode = $.jStorage.get('etu_mode');
            if(!bmode) {
                objCommon.isIncognito(function (mode) {
                    $.jStorage.set('etu_mode', mode);
                });
            }
            var os = $.jStorage.get('etu_platform');
            if(!os) {
                os = objCommon.getOS();
                $.jStorage.set('etu_platform', os);
            }
            // window.onunload = (function () {
            //     $.jStorage.set('et_temp', window.location.href, {TTL:600000});
            // });
            var msid = parseInt(window.artId || window.msid || 0);
            if(wlp.indexOf('articleshow') != -1 && msid) {
                var dt = dateFormat(new Date(), '%Y%M%d'), key = 'et_article_' + dt;
                var articlesList = $.jStorage.get(key) || [];
                var existInList = articlesList.indexOf(msid) == -1 ? 0 : 1;
                
                if(!existInList) {
                    articlesList.push(msid);
                    $.jStorage.set(key, articlesList, {TTL:(30*24*60*60*1000)});
                }
                var timeoutSec = window.tpName == 'articleshow_main' ? 3000 : 0;
                var tpn = window.tpName;
                setTimeout(function () {
                    var continuousPaywalled = $.jStorage.get('et_continuousPaywalled') || [];
                    if(!existInList && (tpn == 'primearticleshow' || tpn == 'articleshow_exclusive' || $('.paywall_b:visible').length)) {
                        var prime_key = 'et_primearticle_' + dt;
                        var prime_count = $.jStorage.get(prime_key) || 0;
                        $.jStorage.set(prime_key, (prime_count + 1), {TTL:(30*24*60*60*1000)});
                        
                        var primelist_key = 'et_primearticlelist_' + dt;
                        var primeList = $.jStorage.get(primelist_key) || [];
                        primeList.push(msid);
                        $.jStorage.set(primelist_key, primeList, {TTL:(30*24*60*60*1000)});
                    }
                    
                    
                    if($('.paywall_b:visible').length == 0 && tpn != 'primearticleshow' && tpn != 'articleshow_exclusive') {
                        continuousPaywalled = []
                    } else {
                        if(continuousPaywalled.indexOf(msid) == -1) {
                            continuousPaywalled.push(msid);
                        }
                    }
                    
                    $.jStorage.set('et_continuousPaywalled', continuousPaywalled);
                }, timeoutSec);
                sessionStorage.setItem('articlesList', articlesList);
            }
            
        } catch (e) {}
    },
    getSubDetails: function () {
        if(!objUser.checkPermission("subscriber")) {
            objProfile.sendProfile();
        } else {
            $.ajax({
                url : "https://" + objVc.subscriptions + ".economictimes.indiatimes.com/subscription/growthAnalyitcs?merchantCode=ET&isGroupUser=false&frm=desktop",
                dataType: "json",
                timeout: 10000,
                xhrFields: { withCredentials: true },
                success: function(data) {
                    _log(data);
                    objProfile.subDetails = data && data.length && data[0] || {};
                    try {
                        objProfile.subDetails = Array.isArray(data) && data.filter(function (item) { return item.productCode == 'ETPR'})[0] || {};
                    } catch (e) {}
                },
                complete: function () {
                    objProfile.sendProfile();
                },
                error: function (e) {
                    $.jStorage.deleteKey('et_profilelog');
                    _log('Error',  e);
                }
            });
        }
    },
    getAccessBandDetails: function(){
            $.ajax({
                url : "https://" + objVc.subscriptions + ".economictimes.indiatimes.com/subscription/merchant/ET/product/ETPR/onBoardingEligibility",
                dataType: "json",
                timeout: 10000,
                xhrFields: { withCredentials: true },
                success: function(data) {
                    _log(data);
                    if(data.code==3000){
                        $.jStorage.set('accessPassData',data);
                        var subsStatus = 'Free Access '+new Date($.jStorage.get('accessPassData').startDate).toLocaleDateString();
                        ga('set', {'dimension37': subsStatus});
                        if(data.eligible) {
                            $('.topUserInfoBand').remove();
                        }
                    }
                },
                error: function (e) {
                    $.jStorage.deleteKey('accessPassData');
                    _log('Error',  e);
                }
            });
    },
    getNLSubDetails: function (obj) {
        if (obj.success) {
            var data = obj.data;
            var subscriptionStatus = data.subscriptionStatus;
            if(subscriptionStatus) {
                objProfile.subscribed_newsletters = subscriptionStatus.activeSubscriptions && subscriptionStatus.activeSubscriptions.length > 1 && subscriptionStatus.activeSubscriptions || '';
                objProfile.unsubscribed_newsletters = subscriptionStatus.inActiveSubscriptions && subscriptionStatus.inActiveSubscriptions.length > 1 && subscriptionStatus.inActiveSubscriptions || '';
            }
        }
        objProfile.sendProfile();
    },
    waitingCounter: 0,
    sendProfile: function () {
        objProfile.waitingCounter++;
        _log('sendProfile - ' + objProfile.waitingCounter);
        if(objProfile.waitingCounter >= 2) {
            objProfile.waitingCounter = 0;
            objProfile.grxProfile();
        }
    },
    setProfileCDPDefault: function() {
        window.profileDataCDP = {
            user_agent: window.navigator && window.navigator.userAgent,
            locale_lang: objLang.currentLang(),
            unsubscribed_newsletters: "",
            subscription_start_date: "",
            subscribed_newsletters: "",
            subscription_end_date: "",
            newsletter_subscribed: "",
            timezone: "Asia/Kolkata",
            subscription_method: "",
            event_name: "profile",
            client_source: "cdp",
            whatsapp_status: "",
            last_plan_id: "",
            dark_mode: "n",
            first_name: "",
            last_name: "",
            plan_name: "",
            wa_mobile: "",
            country: "",
            sso_id: "",
            gender: "",
            phone: "",
            email: "",
            city: "",
            uuid: "",
        };
    },
    grxProfile: function () {
        var profileData = {}, peuuid = $.cookie('peuuid'), pfuuid = $.cookie('pfuuid'), userData = _tp_data, converted_article_msid = objSyftCount.get('msid'), subDetails = objProfile.subDetails;
        function _setValue(key, val) {
            val = val;
            if(key && val) {
                profileData[key] = val;
                grxDimension[key] = val;
                window.profileDataCDP[key] = val;
            }
        }
        function getDate(dt) {
            return dt && +new Date(dt) || '';
        }
        
        window.profileDataCDP['newsletter_subscribed'] = objProfile.subscribed_newsletters ? "y" : "n";
        window.profileDataCDP["last_plan_id"] = subDetails.previousPlanId;
        window.profileDataCDP["loggedin"] = userData.isLogged ? 'Y' : 'N';
        window.profileDataCDP['wa_mobile'] = objUser.info.mobile;
        window.profileDataCDP['gender'] = objUser.info.gender;
        window.profileDataCDP['sso_id'] = objUser.info.ssoid;
        window.profileDataCDP['phone'] = objUser.info.mobile;
        window.profileDataCDP['city'] = objUser.info.city;
        window.profileDataCDP["uuid"] = peuuid;

        _setValue('web_peuuid', peuuid);
        _setValue('web_pfuuid', pfuuid);
        _setValue('first_name', userData.fname);
        _setValue('last_name', userData.lname);
        _setValue('email', userData.email);
        _setValue('logged_in', (userData.isLogged ? 'Y' : 'N'));
        _setValue('first_date_on_et', getDate($.jStorage.get('et_first_date')));
        _setValue('last_visited_date', +new Date());
        _setValue('converted_article_msid', converted_article_msid);
        _setValue('prime_user_acquisition_type', subDetails.userAcquisitionType);
        _setValue('past_subscription', subDetails.previousPlanId);
        
        _setValue('subscription_start_date', getDate(subDetails.purchaseDate));
        _setValue('subscription_cancellation_date', getDate(subDetails.cancelledOn));
        _setValue('trial_end_date', getDate(subDetails.trialEndDate));
        _setValue('subscription_end_date', getDate(subDetails.trialEndDate));
        
        _setValue('trial_status', subDetails.trial);
        _setValue('recurring', subDetails.recurring);
        _setValue('plan_name', subDetails.planName);
        _setValue('subscription_status', subDetails.subscriptionStatus);
        _setValue('country', geoinfo.CountryCode);
        if(objProfile.subscribed_newsletters) {
            _setValue('subscribed_newsletters', objProfile.subscribed_newsletters);
        }
        if(objProfile.subscribed_newsletters) {
            _setValue('unsubscribed_newsletters', objProfile.unsubscribed_newsletters);
        }
        
        if(userData.isLogged) {
            var subScriptionStatus =  "Free";
            if(subDetails.subscriptionStatus == 'active') {
                if(subDetails.trial == false) {
                    subScriptionStatus = "Paid - Active";
                } else {
                    subScriptionStatus = "Paid -  In Trial";
                }
            }
            _setValue('current_subscriber_status', subScriptionStatus);
        }
        
        var isOldGrxAllowed = window.objVc && objVc.OldGrxSwitch === '1';
        if(isOldGrxAllowed) {
            grx('profile', 'Profile', profileData);
        }
    
        // Remove blank keys from object
        Object.keys(window.profileDataCDP).map(ele => {
            if(!profileDataCDP[ele]) {
                delete window.profileDataCDP[ele];
            }
        })
        delete window.profileDataCDP["logged_in"];

        grx('profile', 'Profile', window.profileDataCDP);
        $.jStorage.set('et_subscription_profile', profileData);
        if(window._tp_data) {
            objUser.subscriptionProfile = profileData;
        }
    }
}

objSyftCount = (function () {
    var objSyftCountTemp = {
        key: 'et_syftCounter',
        get: function (type) {
            var output = type ? 0 : {};
            if(window.localStorage) {
                var data = window.localStorage.getItem(objSyftCountTemp.key);
                data = data && JSON.parse(data) || {};
                if(!type) {
                    output = data;
                } else if(type && data[type]) {
                    output = data[type];
                }
            }
            return output;
        },
        set: function (type, val) {
            if(window.localStorage) {
                var data = objSyftCountTemp.get();
                data = data || {};
                if (type == 'syft'){
                    data.SYTFFlag = 1;
                } else if (type == 'subscribed'){
                    data.subscribed = 1;
                } else if (type == 'msid'){
                    data.msid = val;
                } else if (!data.subscribed) {
                    if(data.SYTFFlag) {
                        data.afterSyft = data.afterSyft ? data.afterSyft + 1 : 1;
                    } else {
                        data.beforeSyft = data.beforeSyft ? data.beforeSyft + 1 : 1;
                    }
                }
                window.localStorage.setItem(objSyftCountTemp.key, JSON.stringify(data));
            }
        }
    }
    return {get: objSyftCountTemp.get, set: objSyftCountTemp.set};
})()

objRedeem = {
    createPopup : function(){
        _log("createPopup init");
        var popupHtml =  '<div class="rdm_box tac">\
                        <span class="rdm_close">&#10005;</span>\
                        <img src="/photo/76647778.cms" ></img>\
                        <h3 class="rdm_title">Redeem Voucher</h3>\
                        <div class="rdm_inputbox">\
                            <div class="inb_title">Enter Voucher Code</div>\
                            <input type="text" class="rdm_input" maxlength="15" />\
                            <div class="rdm_error "></div>\
                            <div class="rdm_btn rdm_submit">SUBMIT</div>\
                        </div>\
                        <div class="rdm_sucs_box">\
                            <p class="rdm_sucs"></p>\
                            <div class="rdm_btn rdm_cont">CONTINUE READING</div>\
                        </div>\
                    </div>';
        
        $(".rdm_wrap").html(popupHtml);       
    },
    setConfigMessage: function (response) {
        try {
            var configResponseMsg = response.message;
            function getdate(dt) {
                return dateFormat(dt, '%d-%M-%Y');
            }
            var responseMessage = {
                3000:"Subscription created successfully",
                3001:"Invalid voucher code",
                3002:"Voucher already redeemed. Please enter new voucher code",
                3003:"Voucher code has expired on " + getdate(response.expiryDate) + ". Please enter valid code",
                3004:"You are currently enjoying a " + response.trialDays + "-days free trial plan. Please cancel your membership by " + getdate(response.cancelDate) + ". After cancellation, you can re-apply this voucher code",
                3005:"Voucher applied successfully! Your current " + response.trialDays + "-days free trial will expire on " + getdate(response.trialEndDate) + ". Your new " + response.planType + " plan will be automatically activated from " + getdate(response.voucherActivationDate),
                3006:"Voucher applied successfully! Your current plan will expire on " + getdate(response.planEndDate) + ". Your new " + response.planType + " plan will be automatically activated from " + getdate(response.voucherActivationDate) + ".",
                3007:"Please cancel your existing membership by " + getdate(response.cancelDate) + ". After cancellation, you can re-apply this voucher code.",
                3008:"Voucher applied successfully! Your current plan will expire on " + getdate(response.planEndDate) + ". Your new " + response.planType + " plan will be automatically activated from " + getdate(response.voucherActivationDate) + ".",
                3009:"Voucher applied successfully! Your current plan will expire on " + getdate(response.planEndDate) + ". Your new " + response.planType + " plan will be automatically activated from " + getdate(response.voucherActivationDate) + "."
            }
            if(response && response.code && responseMessage[response.code]) {
                configResponseMsg = responseMessage[response.code]
            }
            
            return configResponseMsg;
        } catch (e) {
            console.log(e);
        }

    },
    apiHit: function(){
        $(".rdm_input").prop("disabled", true);
        var vCode = $(".rdm_input").val();
        var postData = {
                merchantCode: "ET",
                productCode: "ETPR",
                voucherCode: vCode,
                country_code: "IN"
            };
        $.ajax({
            url: "https://"+ objVc.subscriptions +".economictimes.indiatimes.com/api/subscription/redeemVoucher",
            data: postData,
            xhrFields: {
                withCredentials: true
            },
            method: "post",
            success: function (response){
                $(".rdm_input").prop("disabled", false);
                $(".rdm_wrap .rdm_submit").removeClass("disabled");
                var msg = objRedeem.setConfigMessage(response);
                if (response.status == "FAILURE"){
                    $(".rdm_wrap .rdm_error").text(msg).show();  
                    $(".rdm_wrap .rdm_submit").html("SUBMIT");
                    grxEvent('event', {'event_category': 'Redeem Voucher', 'event_action': 'Submit Click', 'event_label': '<' + vCode + '> - ' + msg}, 1);
                }else{
                    objUser.primeCheckReq("", 'refresh_token');
                    $(".rdm_title").text("Voucher redeemed successfully");
                    $(".rdm_box img").attr("src", "/photo/76811257.cms");
                    $(".rdm_wrap .rdm_sucs").text(msg).show();
                    $(".rdm_wrap .rdm_box").addClass("rdm_vsuc");
                    $(".rdm_inputbox").hide();
                    $(".rdm_sucs_box").show();
                    sessionStorage.setItem("redeem_popup", 1);
                    grxEvent('event', {'event_category': 'Redeem Voucher', 'event_action': 'Submit Click', 'event_label': '<' + vCode + '> - ' + msg}, 1);
                }
            },
            error: function(response){
                $(".rdm_input").prop("disabled", false);  
                $(".rdm_wrap .rdm_submit").removeClass("disabled");
                $(".rdm_wrap .rdm_error").text("Something went wrong. Please retry after sometime").show(); 
                if(response.responseJSON && (response.responseJSON.statusCode == 4299 || response.responseJSON.statusCode == 4277)){
                    $(".rdm_wrap .rdm_error").text("You have logged in using your mobile number. To redeem your voucher, please login using your email.").show();
                }else{
                    $(".rdm_wrap .rdm_error").text("Something went wrong. Please retry after sometime").show();
                }
                $(".rdm_wrap .rdm_submit").html("SUBMIT");
            }
        });
    },
    popupShow: function(){
        _log("popupShow init");
        var vCode = $(".rdm_input").val();
        if ($(".rdm_wrap").length == 0){
            $("body").append('<div class="rdm_wrap font_mon" />');
        } 
        objRedeem.createPopup();
        $(".rdm_wrap").show();  
        grxEvent('event', {'event_category': 'Redeem Voucher', 'event_action': 'Impression', 'event_label': '-'}, 1);
        return false;
    },      
    popupParam: function(){
        var url = window.location.href;
        if(sessionStorage.getItem("redeem_popup") != 1 && url.indexOf('fromsrc') != -1 && url.indexOf('redeemvoucher') != -1){
            objRedeem.popupShow();
            $(".rdm_input").val(getParameterByName('redeemvoucher'));
        }
    },
    submitClick: function(scope){
        $(".rdm_wrap .rdm_error").hide();
        if ($(".rdm_wrap").length > 0 && $(".rdm_input").val().trim() && !scope.hasClass("disabled")){
            scope.addClass("disabled").html('<div class="lds-ell"><div></div><div></div><div></div></div>');
            objRedeem.apiHit();
        }else{
            $(".rdm_wrap .rdm_error").text("Invalid voucher code").show();
        }
    },
    bind: function(){
        $(document).on("click", ".rdm_wrap .rdm_submit", function(){
            objRedeem.submitClick($(this));    
        });
        
        $(document).on("keyup", ".rdm_wrap .rdm_input", function(e){
            var keyVal = e.keyCode || e.which;
            if(keyVal == 13) objRedeem.submitClick($(".rdm_wrap .rdm_submit"));      
        });

        $(document).on("click", ".rdm_wrap .rdm_close", function(){
            $(".rdm_wrap").hide();
            grxEvent('event', {'event_category': 'Redeem Voucher', 'event_action': 'Close Click', 'event_label': ''}, 1);
        });
        
        $(document).on("click", ".rdm_wrap",  function(e){
            if($(".rdm_wrap").is(":visible") && !$(e.target).parents().hasClass("rdm_box") && !$(e.target).hasClass("rdm_box")){
                _log("Redeem Close");
                $(".rdm_wrap").hide();  
            }
        });

        $(document).on("click", ".rdm_wrap .rdm_cont", function () {
            if (typeof ga != 'undefined') {
                ga('send', 'event', 'Voucher Redemption', 'Continue Reading', window.location.href);
            }
            window.location.reload();
        });
    },
    init : function() {
        objRedeem.bind();  
        objUser.afterLoginCall(function () {
            if(_tp_data.isLogged) {
                objRedeem.popupParam();
            } 
        })
    }
}

// market band for Market,wealth and mf pages
objMarketYellowBand = {
     init : function() {
        const hideFooterBanner = $.jStorage.get('cacheTimeBand');
        if((subsec1_value=='837555174' || subsec1_value=='359241701' || (tpName == 'stocks' || tpName == 'stocks1' && !$("#watchlistBand").length) || (subsec1_common=='1977021501' && tpName != 'articleshow_main' && tpName != 'stockreports' && tpName != 'stockreports_benefits')) && !hideFooterBanner && !objVc.skipPopup) {
            $("#watchlistBand").remove();
            objUser.afterPrimeCheckCall(function () {
                var freeArt = tpName === "articleshow_exclusive2" ? !objPrimeArticle.isExclusive : tpName === 'articleshow_main' && Number(window.isAdaptive) ? false : true
                if(!_tp_data.isPrime && freeArt) {
                    objMarketYellowBand.createBandMarkets();
                }
            });
        }
    },
     createBandMarkets: function(){
         if(_tp_data.isPrime){
           var bandDetails = {
                   content: '<div class="nyo_sticky_ftr"><div class="wrapper">Get in-depth stock reports worth Rs 1499 for free with <b>ETPrime.</b> <a class="ctaLink" href="/markets/benefits/stockreportsplus" target="_blank"> Know more</a></div></div>',
                    width: "full",
                    name: "Market sub",
                    showToPrime: 1,
                    priority: 1,
                    onClose: function(){
                        $.jStorage.set('cacheTimeBand', "enabled", {TTL: 86400000});
                    }
                }
            objMarketYellowBand.callBandFun(bandDetails);
         }
         else{
             objMarketYellowBand.fetchHtml();   
         } 
    },
    callBandFun: function(bandDetails){
        var marketUser=_tp_data.isPrime?'Prime User':'Free User';
        var ctaTextGrx = 'Know More Click';
        var marketName="Market";
          if(subsec1_common=='837555174'){
            marketName="Wealth";
         }else if(subsec1_common=='359241701'){
            marketName="MF";
         }else if(tpName=='stocks'){
            marketName="Company pages";
         }
        grxEvent('event', {'event_category': 'Footer Stock Reports', 'event_action': 'Impression', 'event_label':marketUser+' '+ marketName});
        objStickyFooter.showBand(bandDetails,function(){
            $('.nyo_sticky_ftr .ctaLink').click(function() {
                if(!_tp_data.isPrime){
                    var _ctaGrx = $('.nyo_sticky_ftr.dyContent .ctaLink').text();
                    ctaTextGrx = 'Click-' + _ctaGrx;
                }
                grxEvent('event', {'event_category': 'Footer Stock Reports', 'event_action': ctaTextGrx, 'event_label':marketUser+' '+ marketName});
            });
        });
    },
    fetchHtml: function(){
        $.ajax({
	        url: '/sr_band.cms',
	        success: function (htmlContent) {
                //objMarketYellowBand.sr_band =  htmlContent;
                var bandDetails = {
                    content: htmlContent,
                    width: "short",
                    name: "Market sub",
                    priority: 1,
                    onClose: function(){
                        $.jStorage.set('cacheTimeBand', "enabled", {TTL: 86400000});
                    }
                }
                objMarketYellowBand.callBandFun(bandDetails);
	        }
	    });
    }
}

liveTv = {
    mute: true,
    state: 'paused',
    forceDefaultOpen:0, // Live TV Default Play ET NOW TIMES NOW
    forceDefaultOpenOnce:0,
    defaultOpenStartTime : '10',
    defaultOpenEndTime : '11',
    cookieName : 'et_common_defaultTvOpen',
    initAttempt : 5,
    gaAutoEventTimeOut :0,
    init : function() { // called in document.ready
        // open tv
        if(liveTv.initAttempt > 0 && typeof marketBand.historyData.sensex != 'undefined' && marketBand.historyData.sensex.DateTime != 'undefined') {
            var lttArray = marketBand.historyData.sensex.DateTime.split('|'), date = new Date(lttArray[1] + ' ' + lttArray[0]),
            lttHour = date.getHours(),
            allowPageArray = ['/markets', '/ipo'], //, '/stocks/'
            currentPathName = document.location.pathname,
            autoLiveTv = 0;
            var tvPlayState = $.jStorage.get("bandTvPlayState");
            if(!skip.autoVideoPlay && !tvPlayState) {
                $.each(allowPageArray, function(ind, val){
                    if(currentPathName.indexOf(val) != -1) {
                        autoLiveTv = 1;
                    }
                });
            }
            if(!tvPlayState) {
                // market open check is pending (marketBand.marketStatus == 'open')
                if((liveTv.forceDefaultOpen == 1 || getParameterByName('livetv') == 1) && (currentPathName.indexOf('/liveblog') == -1)) {
                    liveTv.defaultTvOpen(0);
                    liveTv.setCookie();
                } else if(liveTv.forceDefaultOpenOnce == 1 ||  (parseInt(lttHour) >= parseInt(liveTv.defaultOpenStartTime) && parseInt(lttHour) < parseInt(liveTv.defaultOpenEndTime) && autoLiveTv)) {
                    if(!liveTv.checkPreviousOpen()) {
                        liveTv.defaultTvOpen(1, 'radio');
                        liveTv.setCookie();
                    }
                }
            }
        } else {
            liveTv.initAttempt--;
            setTimeout('liveTv.init();', 2000);
        }
    },
    defaultTvOpen : function (mute, channel) { // to open tv with mute state
        $.jStorage.set("bandTvPlayState", 1);
        $.jStorage.setTTL(3600000);
        objVideo.showLiveVideo();
        var iframe = $('iframe#blivetv'), newSrc = iframe.attr('src');
        if(mute) {
            newSrc = newSrc.replace('audio=.7', 'audio=0');
        }
        if(typeof channel != 'undefined' && channel == 'radio') {
            $('#a_et_now').trigger('click')
        } else {
            iframe.attr('src', newSrc);
        }
        //liveTv.gaAutoPopupEventHit(0);
    },
    checkPreviousOpen : function() { // to check weather tv is open or not today
        var state = 0;
        if(typeof $.cookie(liveTv.cookieName) != 'undefined' && $.cookie(liveTv.cookieName) == 1) {
            state = 1;
        }
        return state;
    },
    setCookie: function() { //  to set one day cookie
        var date = new Date();
        var midnight = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 23, 59, 59);
        $.cookie(liveTv.cookieName, 1, {expires: midnight, path: '/'});
    }
}

function saveLogs(data) {
    if(data) {
        var tId = $.cookie('TicketId'), mode = (objCommon.isLive ? 'live' : 'dev'), logdata = {ref: mode + '_common_' +"web_" + jscommon_v,data: data, ua: navigator.userAgent, url: location.pathname + location.search};
        if(_tp_data.email) {
            logdata.email = _tp_data.email;
        }
        if(_tp_data.ssoid) {
            logdata.ssoid = _tp_data.ssoid;
            logdata.identifier = _tp_data.identifier || '-';
        } else {
            logdata.nonLogin = 1;
        }
        if(tId) {
            logdata.TicketId = tId;
        }
        
        var getRandomNumber = function() {
          var typedArray = new Uint8Array(10);
          var randomValues = window.crypto.getRandomValues(typedArray);
          return randomValues.join('');
        }
        
        logdata.gid = $.cookie('_grx') || '-';
        var random = getRandomNumber();
        if (!$.cookie('_grx_et')) {
            $.cookie("_grx_et", random);
        }
        logdata.etgid = $.cookie("_grx_et") || 'no_cookie';
        logdata.etu_mode = $.jStorage.get('etu_mode') || '-';
        logdata.vcOn = window.objVc && objVc.version_on || 'No Available';
        logdata.vcMode = window.objVc && objVc.env || 'Not Available';
        logdata.vcIp = window.objVc && objVc.version_ip || 'Not Available';
        logdata.cookieLength = document.cookie && document.cookie.length || 0;
        $.ajax({
            url:'https://etx.indiatimes.com/log?et=desktop&v='+jscommon_v,
            method: 'POST',
            data: {
                logdata: JSON.stringify(logdata)
            },
            success: function (data) {
                console.log(data);
            }
        });
    }
}

// add class "skipLiveTv" on any dom element to remove LiveTV popup on page.
objVideo = {
    config: (function (){
                var config = {};
                try {
                    config = window.objVc && objVc.live_tv ? JSON.parse(objVc.live_tv) : {};
                    var activeFromHP = $.jStorage.get('et_tvActiveFromHome');
                    if(activeFromHP) {
                        config.onoff_flag = 1;
                        config.default_tv = activeFromHP == 'times' ? 1 : 0;
                    }
                } catch (e) {}
                return config;
            })(),
    preRollStatus: 0,
    jqueryUiLoaded: 0,
    isPlay: 0,
    popUpRef: '',
    shownOnce: 0,
    bandTvCheckPlayed: objVc.liveTvLsName || 'bandTvCheckPlayed',
    init: function() {
        objVideo.preRollStatus = objVideo.config.preRollAd || 0;
        var skipTemplate = ['primearticleshow', 'articleshow_exclusive', 'articleshow_exclusive2', 'primehome'];
        if(skipTemplate.indexOf(window.tpName) == -1 && window.isAdaptive != 1) {
            var timingFlag = objVideo.checkTiming();
            //var timingFlag = 1;
            var checkPagename = objVideo.checkPages();
            if($('.skipLiveTv').length == 0 && checkPagename == 1 && (objVideo.config.onoff_flag == 1 || timingFlag == 1)) {
                var currSectionId = window.objSec && objSec.secIds &&  objSec.secIds[1] || window.subsec1_value || '';
                if(!currSectionId || objVideo.config.sections.indexOf(currSectionId) !== -1)  {
                    objVideo.checkVideoPlayer(); 
                }
                if(objVideo.config.auto_open != 'undefined' && objVideo.config.auto_open == '1') objVideo.shownOnce=1;
                objVideo.scrollEvents();
            }
        }
    },
    checkPages: function(){
        var flag = 0;
        var windowUrl = window.location.pathname ;
        var home = '/';
        if(windowUrl == home && (objVideo.config.pages == 'homePageOnly' || objVideo.config.pages == 'all')){
            flag = 1;
        }else if(objVideo.config.pages == 'all' || (objVideo.config.pages == 'restOfThePage' && windowUrl != home)){
           flag = 1; 
        }else if(windowUrl != home && objVideo.config.sections && objVideo.config.sections.length != 0){
            flag = 1;
        }
        return flag;
    },
    checkTiming: function(){
        var tp = objVideo.config.timePeriod, flag = 0;
        if(tp && tp.showTimeFlag) {
            var currentDateTime = new Date();
            var fromDateTime = new Date(tp.fromTime);
            var toDateTime = new Date(tp.toTime);
            if(currentDateTime > fromDateTime && currentDateTime < toDateTime){
                flag = 1;
            }
        }
        return flag;
    },
    bindEvents: function () {
        $('.v_selector div').click(function () {
            objVideo.onClickVideoSelector($(this));
        });
        $('.tvPopOut').click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            var top = (screen.availHeight - 425 - 65), left = (screen.availWidth - 400 - 15);
            var winHeight = window.outerHeight; winWidth = window.outerWidth;
            objVideo.popUpRef = window.open('/livetvnew.cms?active=' + $('.v_selector div.active').attr('id'),'targetWindow','toolbar=no,titlebar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=' + winWidth + ',height=' + winHeight + ',top=' + top + ',left='+ left);
            objVideo.closeClick();
        });
        
    },
    scrollEvents: function(){
        $(window).on('scroll',function(){ 
            if($(window).scrollTop() > 700 && $('.liveTvSticky').length && objVideo.shownOnce == 0){
                objVideo.shownOnce=1; 
                objVideo.loadTvDom(); 
            } 
        })
    },
    loadTvDom: function (channel) {
        var _onVideoStart = window.onVideoStart;
        var _onVideoStartPopup = window.onVideoStartPopup;
        window.onVideoStart = function () {
            objVideo.preRollStatus = 0;
            _onVideoStart && _onVideoStart();
        }
        window.onVideoStartPopup = function () {
            objVideo.preRollStatus = 0;
            _onVideoStartPopup && _onVideoStartPopup();
        }
        if($('.dragTvBox').length == 0) {
            var default_tv = objVideo.config.default_tv ? objVideo.config.default_tv : '';
            if(typeof channel != 'undefined') {
                default_tv = channel;
            }
            // var skiningFlag = $.jStorage.get('tv_budget_skining');
            // livetv
            
            var skiningFlag = objVc.live_tv_skin;
            var url = '/video_box.cms?skipad=' + (objVideo.preRollStatus ? 0 : 1);
            if(skiningFlag == 1) {
                url = '/video_box_budget.cms?skipad=' + (objVideo.preRollStatus ? 0 : 1);
            }
            $.ajax({
                //  url: '/video_box.cms',
                // url: '/video_box_budget.cms',
                url: url,
                data: {default_tv: default_tv},
                success: function (response) {
                    $('body').append(response);
                    var right = ($(window).width() - 1003) / 2;
                    right += 0;
                    setTimeout(function () {
                        objVc.skipPopup = 1;
                        // var topVal = ($(window).height()/2 - $('.dragTvBox').height()/2);
                        var topVal = $(window).height() - $('.dragTvBox').height() - 20;
                        var rightVal = $('.dragTvBox').width()/2;
                        style = {inset: topVal + 'px' + rightVal + 'px auto auto'};

                        $('.dragTvBox').css(style);
                        objVideo.bindEvents();
                        objVideo.showLiveVideo();
                    }, 10);
                }
            })
        } else {
            objVideo.showLiveVideo();
        }
    },
    closeClick: function (closeBtnFlag, miniBtn) {
        closeBtnFlag = closeBtnFlag || 0;
        miniBtn = miniBtn || 0;
        
        $('.dragTvBox').hide();
        $('.dragTvBox iframe#blivetv').attr('src', '');
        objVideo.isPlay = 0;
        $.jStorage.deleteKey("bandTvPlayState");
        if(closeBtnFlag == 1) {
            if(!miniBtn) {
                var payload = objVideo.preRollStatus == 1 ? 'During Preroll' : 'Post Preroll';
                ga('send', 'event', 'Live TV', 'Video Close - ' + payload, '');
            }
            grxEvent('event', {'event_category': 'Temp', 'event_action': 'Live Tv Close', 'event_label': window.location.href});
            $('.liveTvSticky').remove();
            // $.jStorage.deleteKey(objVideo.bandTvCheckPlayed);
            $.jStorage.set(objVideo.bandTvCheckPlayed, 2);
        } else {
            grxEvent('event', {'event_category': 'Temp', 'event_action': 'Live Tv Minimize', 'event_label': window.location.href});
            objVideo.buttonToOpen('showLiveVideo'); // show bottom fix button
        }
    },
    showLiveVideo: function (openBtnClick) {
        openBtnClick = openBtnClick || 0;
        if(openBtnClick && objVideo.popUpRef.length) {
            objVideo.popUpRef.focus();
        } else {
            $('.liveTvSticky').remove();
            $.jStorage.set("bandTvPlayState", 1);
            $(window).on('beforeunload', function(){
                $.jStorage.deleteKey("bandTvPlayState");
            });
            
            objVideo.isPlay = 1;
            $('.dragTvBox iframe#blivetv').attr('src', $('.dragTvBox iframe#blivetv').attr('data-src'));
            $('.dragTvBox').show();
            if(!objVideo.jqueryUiLoaded) {
                objVideo.jqueryUiLoaded = 1;
                $.ajax({
                    url : '/jquery_ui_1_10.cms',
                    dataType:'script',
                    cache:true,
                    success:function () {
                        $('.dragTvBox').draggable({ containment: "body", scroll: false,
    						drag: function(){
    						    $(".dragTvBox").css({right:'auto',bottom:'auto'});
    						},
    						stop: function( event, ui ) {
    						    var elemTop = parseInt($('.dragTvBox').css('top'));
    						    var winHeight = $(window).height();
    						    if(elemTop + 25 > winHeight) {
    						        $('.dragTvBox').css('top', winHeight - 25);
    						    }
    						}
    					});
                    }
                });
            }
        }
        
        var _thisVal = $('.v_selector > div.active');
        objVideo.onClickVideoSelector(_thisVal);
    },
    buttonToOpen: function (callback) {
        var right = ($(window).width() - 1003) / 2;
        var onClickFunction =  callback == 'loadTvDom' ? "objVideo.loadTvDom()" : "objVideo.showLiveVideo(1);"
        var gaEvent = "ga('send', 'event', 'Temp', 'Live Tv', window.location.href);";
        $('body').append('<div class="liveTvSticky" style="right:' + right + 'px" onClick="'+ onClickFunction +'" ' + gaEvent + '"><span class="lt_icon"></span>Live TV<span class="ltsClose"></span></div>');
        $('.ltsClose').click(function (e) {
            e.stopPropagation();
            objVideo.closeClick(1, 1);
        })
    },
    checkVideoPlayer: function () {
        var tvPlayState = $.jStorage.get("bandTvPlayState");
        var checkPlayed = $.jStorage.get(objVideo.bandTvCheckPlayed);
        
        if(checkPlayed != 2) {
            if(!tvPlayState && !checkPlayed && objVideo.config.auto_open == 1) {
                objVideo.loadTvDom();
            } else {
                objVideo.buttonToOpen('loadTvDom');
            }
        }
        if(!$.jStorage.get(objVideo.bandTvCheckPlayed)) {
            $.jStorage.set(objVideo.bandTvCheckPlayed, 1);
            var lsExpiry = (objVc.liveTvLsValue || 2 * 60 * 60) * 1000;
            $.jStorage.setTTL(objVideo.bandTvCheckPlayed, lsExpiry);
        }
        /*
        if(objVideo.config.play_check_hour) {
            if(!$.jStorage.get("bandTvCheckPlayed")) {
                $.jStorage.set("bandTvCheckPlayed", 1);
                $.jStorage.setTTL("bandTvCheckPlayed", objVideo.config.play_check_hour * 60 * 60 * 1000);
            }
        } else  {
            $.jStorage.deleteKey("bandTvCheckPlayed");
        }
        */
    },
    onClickVideoSelector : function ($this) {
        objVideo.isPlay = 1;
        $('.dragTvBox iframe#blivetv').attr('src', $this.attr('data-src'));
        $('.dragTvBox iframe#blivetv').attr('data-src', $this.attr('data-src'));
        $this.addClass('active').siblings().removeClass('active');
        $('.iframe_container').removeClass('class_v_et_now class_v_times_now').addClass('class_' + $this.attr('id')).find("iframe").attr("height",$this.attr("data-height"));
    },
    liveTvPopIn: function (arg) {
        objVideo.showLiveVideo();
        $('#' + arg).trigger("click");
    },
    pauseOnPage: function () {
        if(typeof podcastPlayer != 'undefined' && podcastPlayer.pause) {
            podcastPlayer.pause();
        }
        if(typeof objEmbed != 'undefined' && objEmbed.instance) {
            $.each(objEmbed.instance, function (i, el) {
                if(el.pause) {
                    el.pause();
                }
            })
        }
    },
    liveTvStory: function() {
        try {
            var config = window.objVc && objVc.live_tv ? JSON.parse(objVc.live_tv) : {};
            if(config && config.liveStory && config.liveStory.title && config.liveStory.title != '' && config.liveStory.url && config.liveStory.url != ''){
                if($("#breaking_tv_story").length){
                    var breakingHtml = '<div class="livewidget_tv"><div class="live_demo"><a target="_blank" href="'+config.liveStory.url+'"></a></div><div class="demo_text">'+config.liveStory.title+'</div><span class="close_livedemo"></span></div>';
                    $('#breaking_tv_story').html(breakingHtml);
                    $('.livewidget_tv .close_livedemo').click(function(){
                        $('#breaking_tv_story').html('');
                    })
                }
                
            }
        } catch (e) {}
    }
};

objAnalytics = {
    skipCleverTap: $('.skip_clevertap').length,
    init: function () {
        // load on user action
        objUser.afterPrimeCheckCall(function () {
            objAnalytics.survicate();
        });
        if(window.mouseflowPath) {
            objAnalytics.mouseFlow();
        }
        var currHr = dateFormat(new Date(), '%H');
        if(objCommon.isLive == 1 && currHr >= 15 && currHr <= 16) {
            // objAnalytics.webVitals();
        }
        //objAnalytics.linkedIn();
    },
    onLoad: function () {
        // load in document ready
        //objAnalytics.FacebookPixel();
        // if(!objAnalytics.skipCleverTap) { objAnalytics.clevertap(); }
        //objAnalytics.checkScript();
        if(objCommon.isLive && objVc.cdnperf == 1) {
            objAnalytics.cdnperf();
        }
        objAnalytics.checkNoFollow();
        objAnalytics.tracking();
        objAnalytics.url404track()
        setInterval(objAnalytics.url404track, 31000);

    },
    tracking: function () {
        try {
            if(window.tpName && tpName.indexOf('articleshow') != -1 && getParameterByName('utm_campaign') == 'article_recommendation') {
                objUser.afterPrimeCheckCall(function() {
                    var userType = _tp_data.isLogged ? 'Login/' + (objUser.checkPermission("subscribed") ? 'paid' : 'free') : 'Non-Login';
                    var trackingData = {'event_category': 'NL_usertype', 'event_action': 'web/' + getParameterByName('utm_source') + '/' + getParameterByName('utm_campaign') + '/' + userType, 'event_label': ''};
                    grxEvent('event', trackingData, 1);
                    saveLogs(trackingData);
                });
            }
            var errorUrls = [];
            $('a[href*="topic"]').each(function (i, ele) {
                try {
                    var url = $(ele).attr('href'), query = url.split('/topic/')[1], queryArr = query.split('/'); 
                    if(!isNaN(queryArr.at(-1)) && !isNaN(queryArr.at(-2))) {
                        errorUrls.push({'text':$(ele).text(), 'link':url});
                        console.log({'topicUrlIssue':1, url:url})
                    }
                }
                catch (e){}
            });
            if(errorUrls.length) {
                $.ajax({
                    url:'https://etx.indiatimes.com/error_save?ref=js_common',
                    data: {
                        url: window.location.href,
                        file: 'topic_url_error',
                        line: window.tpName,
                        column: 'jsv - ' + window.jscommon_v,
                        error: window.location.href,
                        error_stack: JSON.stringify(errorUrls),
                        callback:'cb'
                    },
                    success:function (data){console.log(data)}
                });
            }
            
            $(document).ajaxComplete(function( event, xhr, settings ) {
                var url = settings.url;
                if(url.indexOf('/null') != -1 || url.indexOf('/undefined') != -1 || settings.type == 'HEAD'){
                    saveLogs({type: 'null_undefined_error', settings:settings});
                }
            });
            var msIdIssue = $('a[href*="/.cms"]');
            if(msIdIssue.length) {
                saveLogs({type: 'cmswithoutmsIdIssue', linkCounts:msIdIssue.length});
            }
        } catch (e){}
    },
    url404track: function (on, lineitem) {
        on = on || 'load';
        $('iframe:not([src])').each(function () {
            var $this = $(this), contents = $this.contents(), undef = contents && contents.find('img[src*="undefined"]').length, nul = contents && contents.find('img[src*="null"]').length;
            if($this.contents() && (undef || nul)) {
                saveLogs({type: 'null_undefined_error', on: on, src_contain: undef && 'undefined' || nul && 'null' || '-', id: $this.attr('id'), lineitem: lineitem || '-'})
            }
        })
    },
    survicate: function () {
            (function (w) {
                function setAttributes() {
                    var subscribeStatus = _tp_data.permissions && _tp_data.permissions.indexOf('subscribed') != -1 && 'paid' || 'free';
                    var sytfData = window.objSyftCount && window.objSyftCount.get && window.objSyftCount.get() || {};
                    var prime_funnel_last_step = sytfData.SYTFFlag ? 'SYFT initiated' : (sytfData.beforeSyft ? 'paid_article' : '');
                    var jString = localStorage.getItem("jStorage"), objJstorage = jString && JSON.parse(jString) || {};
                    var cnt = Object.keys(objJstorage).filter(function(key) {return key.indexOf('et_article_') != -1}).length;
                    var loyalCount = objVc.survicate_loyaluser_count || 15;
                    w._sva.setVisitorTraits({
                        // user_id: "your user ID here",
                        user_subscription_status: subscribeStatus,
                        user_login_status: (_tp_data.isLogged ? 'logged-in' : 'logged-out'),
                        prime_funnel_last_step: prime_funnel_last_step,
                        country_code: (window.geoinfo && geoinfo.CountryCode || ''),
                        email_id: (_tp_data.isLogged ? _tp_data.email : ''),
                        grx_id: $.cookie('_grx'),
                        Loyal: (cnt >= loyalCount)  ? 'Yes' : 'No'
                    });
                }
                if (w._sva && w._sva.setVisitorTraits) {
                    setAttributes();
                } else {
                    w.addEventListener("SurvicateReady", setAttributes);
                }
    
                var s = document.createElement('script');
                s.src = 'https://survey.survicate.com/workspaces/0be6ae9845d14a7c8ff08a7a00bd9b21/web_surveys.js';
                s.async = true;
                var e = document.getElementsByTagName('script')[0];
                e.parentNode.insertBefore(s, e);
            })(window);
    },
    mouseFlow: function () {
        var jString = localStorage.getItem("jStorage"), objJstorage = jString && JSON.parse(jString) || {};
        var cnt = Object.keys(objJstorage).filter(function(key) {return key.indexOf('et_article_') != -1}).length;
        
        if(allowGDPR() && $('script[src*=mouseflow]').length == 0 && (!objVc.skipMouseflow || cnt > 21)) {
            (function() {
               var mf = document.createElement('script'); mf.type = "text/javascript"; mf.async = "async";
               mf.src = "//cdn.mouseflow.com/projects/81baae85-f91c-464e-ac38-15a987752b7a.js";
               document.getElementsByTagName("head")[0].appendChild(mf);
            })();
            _mfq = window._mfq || [];
            var usertype = objUser.checkPermission("subscribed") ? 'paid' : 'free';
            if(cnt > 21) {
                usertype += '_loyal';
            }
            //_mfq.push(["Tag", "free_loyal"]); 
            _mfq.push(["setVariable", "usertype", usertype]);
            var uuid = $.cookie('_col_uuid') || '';
            if(uuid) {
                _mfq.push(["setVariable", "uuid", uuid]);
            }
            if(window.tpName && tpName.indexOf('articleshow') != -1) {
                /* Mouseflow Events | ET-16067 */
                var benefitType = $('#newArticleBlocker').length ? 'new' : 'old';
                _mfq.push(["setVariable", "benefittype", benefitType]);
            }
        }
    },
    FacebookPixel: function () {
        if(window.allowGdpr == 1 && (typeof skip == 'undefined' || typeof skip.fbevents == 'undefined')) {
            !function(f,b,e,v,n,t,s)
            {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
            n.callMethod.apply(n,arguments):n.queue.push(arguments)};
            if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
            n.queue=[];t=b.createElement(e);t.async=!0;
            t.src=v;s=b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t,s)}(window, document,'script',
            'https://connect.facebook.net/en_US/fbevents.js');
            fbq('init', '338698809636220');
            fbq('track', 'PageView');
        }
    },
    linkedIn: function () {
        var inTemplate = ['ifsccode','company_default','markets','marketstats','stocks','stocks_language','technical_charts','commoditysummary','primehome',' primearticlesho'];
        if(inTemplate.indexOf(window.tpName) != -1) {
            _linkedin_partner_id = "46758";
            window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
            window._linkedin_data_partner_ids.push(_linkedin_partner_id);
            (function(){var s = document.getElementsByTagName("script")[0];
            var b = document.createElement("script");
            b.type = "text/javascript";b.async = true;
            b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
            s.parentNode.insertBefore(b, s);})();
        }
    },
    webVitals: function () {
        function sendToGoogleAnalytics(data) {
            //console.log('sendToGoogleAnalytics', data)
            var name = data.name, delta = data.delta, id = data.id, eventValue = Math.round(name === 'CLS' ? delta * 1000 : delta);
            
          // Assumes the global `ga()` function exists, see:
          // https://developers.google.com/analytics/devguides/collection/analyticsjs
          // https://web-vitals-report.web.app/ report url
          window.ga && ga('send', 'event', {
            eventCategory: 'Web Vitals',
            eventAction: name,
            // The `id` value will be unique to the current page load. When sending
            // multiple values from the same page (e.g. for CLS), Google Analytics can
            // compute a total by grouping on this ID (note: requires `eventLabel` to
            // be a dimension in your report).
            eventLabel: id,
            // Google Analytics metrics must be integers, so the value is rounded.
            // For CLS the value is first multiplied by 1000 for greater precision
            // (note: increase the multiplier for greater precision if needed).
            eventValue: eventValue,
            // Use a non-interaction event to avoid affecting bounce rate.
            nonInteraction: true,
            // Use `sendBeacon()` if the browser supports it.
            transport: 'beacon',
          });
        }
        
        (function() {
          var script = document.createElement('script');
          script.src = 'https://unpkg.com/web-vitals';
          script.onload = function() {
            // When loading `web-vitals` using a classic script, all the public
            // methods can be found on the `webVitals` global namespace.
            webVitals.getCLS(sendToGoogleAnalytics);
            webVitals.getFID(sendToGoogleAnalytics);
            webVitals.getLCP(sendToGoogleAnalytics);
          }
          document.head.appendChild(script);
        }())
    },
    scrollDepth: function () {
        if(window.tpName && tpName.indexOf('articleshow') != -1) {
            var event = {'event_category': 'Scroll Tracking', 'event_action': wl.pathname, 'event_label': 'Start'};
            if(!objAnalytics.scrollDepthFlag) {
                objAnalytics.scrollDepthFlag = 1;
                grxEvent('event', event);
            } else {
                if(objAnalytics.scrollDepthFlag != 2) {
                    var winHeight = $(window).height(), winBottom = $(window).scrollTop() + winHeight, docHeight = $(document).height();
                    if(winBottom == docHeight) {
                        objAnalytics.scrollDepthFlag = 2;
                        event.event_label = 'Complete';
                        grxEvent('event', event);
                    }
                }
            }
        }
    },
    clevertap: function () {
        if(objVc.cTId) {
            clevertap = {event:[], profile:[], account:[], onUserLogin:[], notifications:[], privacy:[]};
         // replace with the CLEVERTAP_ACCOUNT_ID with the actual ACCOUNT ID value from your Dashboard -> Settings page
            clevertap.account.push({"id": objVc.cTId});
            clevertap.privacy.push({optOut: false}); //set the flag to true, if the user of the device opts out of sharing their data
            clevertap.privacy.push({useIP: false}); //set the flag to true, if the user agrees to share their IP data
            (function () {
        		 var wzrk = document.createElement('script');
        		 wzrk.type = 'text/javascript';
        		 wzrk.async = true;
        		 wzrk.src = ('https:' == document.location.protocol ? 'https://d2r1yp2w7bby2u.cloudfront.net' : 'http://static.clevertap.com') + '/js/a.js';
        		 var s = document.getElementsByTagName('script')[0];
        		 s.parentNode.insertBefore(wzrk, s);
            })();
            
            var tpNameListArr = ['articlelist','primehome','markets','newshome','politicsnation','personalfinance','mutual_funds','techhome','opinionshome','nri','panache','videohome']
            
            if(tpName == 'default' || tpName == 'default_prime') {
                clevertap.event.push('home_page');
                _log('home_page');
            } else if(tpNameListArr.indexOf(window.tpName) != -1) {
                clevertap.event.push('listing_page');
                _log('listing_page');
            } else if(tpName == 'articleshow_main' || tpName == 'primearticleshow' || tpName == 'articleshow_exclusive2') {
                clevertap.event.push('articleshow_page');
                _log('articleshow_page');
            }
        }
    },
    clevertabEvent: function(type, grxDimension) {
        /*var eventArr = ['Upgrade','Cancellation','Plan Extension','Subscription Flow','In-App Message','page_view','ET Login','Onboarding','Subscribed','Renew','Renewal reminder','UB - Save Article','UB - UnSave Article','UB - Comment Click','UB - Comment Submit Clicks','ET-TopNav','Web - Newsletter Subscription Page','LHS Navigation','Web Newsletter Onboarding','Story Rating','User rating','Checkout','mweb - Newsletter Subscription Page','UB - Gift an article', 'WhatsApp_Engagement'];
        var paidArticle = ['primearticleshow', 'articleshow_exclusive', 'articleshow_exclusive2'];
        
        if(window.clevertap && ((grxDimension.hasOwnProperty("event_category") && eventArr.indexOf(grxDimension.event_category) != -1) || (type == 'page_view' && paidArticle.indexOf(window.tpName) != -1))) {
            clevertap.event.push(type, grxDimension);  
        }*/
    },
    checkScript: function () {
        /*
        if(window.allowGdpr == 1) {
            var logRecord = function (type) {
                $.ajax({
                    url:'https://etx.indiatimes.com/error_save?ref=js_common',
                    data: {
                        url: 'script_tracking',
                        file: type,
                        line: window.tpName,
                        column: '',
                        error: window.location.href,
                        error_stack: 'jsv - ' + window.jscommon_v,
                        callback:'cb'
                    },
                    success:function (data){console.log(data)}
                });
            }
            
            objUser.afterLoginCall(function() {
                if(!_tp_data.isLogged) {
                    setTimeout(function () {
                        if($('script[src*="sb.scorecardresearch.com/beacon.js"]').length == 0) {
                            logRecord('no_scorecard');
                        }
                        if($('[data-size][data-loc]').length == 0) {
                            logRecord('no_adcode');
                        }
                    }, 5000);
                }
            });
        }
        */
    },
    checkNoFollow: function () {
        var links = '', count = 0;
        $('a[href*="http"]').not('[href*="economictimes"]').not('[rel*="nofollow"]').each(function () {
            links += links ? ' | ' : '';
            links += $(this).attr('href');
            count++;
        })
        if(links && objVc.aNofollowCheck) {
            $.ajax({
                url:'https://etx.indiatimes.com/error_save?ref=js_common',
                data: {
                    url: 'external_a_without_nofollow',
                    file: '',
                    line: window.tpName,
                    column: count,
                    error: window.location.href,
                    error_stack: count + ' - ' + links,
                    callback:'cb'
                },
                success:function (data){console.log(data)}
            });
        }
        
    },
    cdnperf: function () {
        loadScript('https://sf-objects-s3.tilc.in/sf-objects/cdnperf.js');
    }
}

function experimentStatus(expId) {
    var experimentCookie = $.cookie('_gaexp');
    var expStatus = '';
    if (experimentCookie && experimentCookie.length) {
        experimentCookie.split('!').forEach(function (name, j) {
            if(name.indexOf(expId) != -1) {
                expStatus = name.substr(-1);
            }
        });
    }
    return expStatus;
}

function currPageType() {
    var type = 'home_page';
    var tpNameListArr = ['articlelist','primehome','markets','newshome','politicsnation','personalfinance','mutual_funds','techhome','opinionshome','nri','panache','videohome']
    
    if(tpName == 'default' || tpName == 'default_prime') {
        type = 'home_page';
    } else if(tpNameListArr.indexOf(window.tpName) != -1) {
        type = 'listing_page';
    } else if(tpName == 'articleshow_main' || tpName == 'primearticleshow' || tpName == 'articleshow_exclusive2') {
        type = 'articleshow_page';
    }
    return type;
}

objUserSubscriptions = function() {
    var objUserSub = {
        subscriptionData: {},
        init: function() {
            var cb = function(data) {
                if(data && data[0]) {
                    objUserSub.subscriptionData = data[0];
                    if(data[0] && data[0].userAcquisitionType === "GROUP_SUBSCRIPTION" && data[0].userAcquisitionCode){
                        $.jStorage.set('userAcquisitionCode',data[0].userAcquisitionCode);
                    } else {
                        $.jStorage.deleteKey('userAcquisitionCode');
                    }

                    var timestampNow = +new Date();
                    var eu_benchmark = 15;
                    var subStatus = data[0].subscriptionStatus;

                    var daysSincePlanStart = Math.floor((timestampNow - +new Date(data[0].subscriptionStartDate)) / (1000 * 60 * 60 * 24));
                    var expiryDaysLeft = Math.floor((+new Date(data[0].expiryDate) - timestampNow) / (1000 * 60 * 60 * 24));
                    var isUserCancelled = subStatus === "cancelled";
                    var isCancelledElgible = (expiryDaysLeft <= eu_benchmark) && isUserCancelled;
                    var isCancelledNonRec = (expiryDaysLeft > eu_benchmark) && isUserCancelled;
                    var istimesPrimeUser = data[0].userAcquisitionType === "GROUP_SUBSCRIPTION" && data[0].userAcquisitionCode === "times_internet" && data[0].planPeriod == 3 && data[0].planPeriodUnit == "MONTH";
                    var isGracePeriodOn = timestampNow > +new Date(data[0].expiryDate) && timestampNow < +new Date(data[0].graceEndDate);
                    var isExpired = subStatus === "expired" || objUser.checkPermission("expired_subscription");
                    var isB2CUser = (data[0].paymentMode.includes("OFFLINE") || data[0].paymentMode.includes("ETPAY")) && (subStatus === "cancelled" || subStatus === "active");
                    var isVoucherUser = data[0].userAcquisitionType === "VOUCHER_CODE";
                    var isGroupUser = objUser.checkPermission("group_subscription");
                    var isRecurring = data[0].recurring;

                    var isAboutToExpire = data[0].daysLeft <= eu_benchmark && expiryDaysLeft > 0;
                    
                    var bannerType = istimesPrimeUser ? "times_prime_users" : isGracePeriodOn ? 'grace_period' : isAboutToExpire ? 'about_to_expire' : isCancelledNonRec ? 'cancelled_nonrec' : isCancelledElgible ? 'cancelled' : (daysSincePlanStart > 30) ? "active_nonrec" : isB2CUser ? "b2c_users" : "";
                    if(bannerType && !isRecurring) {
                        objUserSub.appendBand(bannerType);
                    }
                }
            }
            
            var isHeaderExist = $('header.header.clearfix').length;
            if (_tp_data.isLogged && isHeaderExist && objVc.ads_primeuser_enable !== '1') {
                objUserSub.fetchSubsc(cb);
            }
        },
        bindEvents: function(bannerType) {
            $('.topUserInfoBand').click(function(e) {
                var isCloseRef = e.target.classList.contains('info_cross');
                if(this.classList.contains('adFree')) {
                    customDimension.dimension1 = 'Adfree expired';
                    grxEvent('event', {'event_category': 'Subscription Flow ET',  'event_action': 'SYFT | Flow Started', 'event_label': "Adfree expired"}, 1);
                }
                if(!isCloseRef) {
                    var navigateURL = $('.topUserInfoBand .info_cta').attr('data-url');
                    grxEvent('event', {'event_category': 'Platform Nudge - Web',  'event_action': 'Banner Click', 'event_label': bannerType + ' | Banner Location '+ currPageType()});
                    var ctaText = $('.topUserInfoBand .info_cta').text() || "";
                    goToPlan({url: navigateURL.replace('https://economictimes.indiatimes.com','') || "", cdp: true, feature_name: "top_banner", ctaText: ctaText});
                }
            });
            
            $('.topUserInfoBand .info_cross').click(function() {
                var frequencyVal = $(this).attr("data-frequency");
                if(frequencyVal) {
                    var reActivatedOn = +new Date() + (Number(frequencyVal) * 1000 * 60 * 60 * 24);
                    $.jStorage.set('topNudgeObj', JSON.stringify({reActivatedOn: reActivatedOn}));
                }
                
                grxEvent('event', {'event_category': 'Platform Nudge - Web',  'event_action': 'Banner Dismiss', 'event_label': bannerType + ' | Banner Location '+ currPageType()});
                $("#topnavBlk").css("top", "0");
                $('.topUserInfoBand').slideUp();
                $('.topUserInfoBand').remove();
            });
        },
        fetchSubsc: function(cb) {
            var isGroupUser = objUser.checkPermission("group_subscription") ? true : false;
            
            $.ajax({
                url: "https://" + objVc.subscriptions + ".economictimes.indiatimes.com/subscription/allUserSubscriptions?merchantCode=ET&isGroupUser=" + isGroupUser,
                contentType: "application/json; charset=utf-8",
                xhrFields: {
                    withCredentials: true
                },
                success: function(data) {
                    cb(data);
                },
                error: function(error){
                    window.saveLogs && saveLogs({'type': 'top_nudge_band', 'error': error, 'tp_email': _tp_data.email, 'origin' : 'fetchSubsc'});
                }
            });
        },
        appendBand: function(bannerType) {
            var nudgeSavedObj = $.jStorage.get('topNudgeObj') && JSON.parse($.jStorage.get('topNudgeObj'));
            var reActivatedEnabled = nudgeSavedObj ? +new Date() > nudgeSavedObj.reActivatedOn : true;
            var topNudgeEnabled = objVc.top_nudge_enable && Number(objVc.top_nudge_enable) || 0;
            var isPlansPage = window.tpName.indexOf('plans') != -1;
            var accessPassData = $.jStorage.get('accessPassData');
            var isOnBoardingeligibile = accessPassData && accessPassData.eligible;

            if(reActivatedEnabled && topNudgeEnabled && !isPlansPage && !isOnBoardingeligibile) {
                grxEvent('event', {'event_category': 'Platform Nudge - Web',  'event_action': 'User Eligible for Banner', 'event_label': bannerType + ' | Banner Location '+ currPageType()});
                $.ajax({
                    url: "/prime_campaign_nudge.cms?msid=98201998&bannertype=" + bannerType,
                    contentType: "application/json; charset=utf-8",
                    success: function(data) {
                        if (data) {
                            $('.topUserInfoBand').remove();
                            $('body').prepend(data);
                            grxEvent('event', {'event_category': 'Platform Nudge - Web',  'event_action': 'Banner Viewed - True', 'event_label': bannerType + ' | Banner Location '+ currPageType()});
                            if(["about_to_expire", "access_pass_users", "grace_period", "b2c_users", "times_prime_users"].indexOf(bannerType) !== -1) {
                                $('.topUserInfoBand .info_text').html($('.topUserInfoBand .info_text').html().replace('[0]', dateFormat(new Date(objUserSub.subscriptionData.expiryDate), '%d %Mmm, %Y')));
                            } 
                            /* else if (bannerType === "adFree") {
                                var adFreeExpRef = $.jStorage.get('adFreeCampign_' + (objUser.info.ssoid || _tp_data.ssoid || $.cookie('_grx')));
                                var afcDays = Math.floor((+new Date() - new Date(adFreeExpRef.startTime))/86400000);
                                var adFreeExpAvailed = objVc.adfree_campign_duration - afcDays;
                                grxEvent('event', {'event_category': 'Adfree for Expired',  'event_action': 'Prime Homepage Shown', 'event_label': "Adfree days left " + adFreeExpAvailed +" | Start Date " + dateFormat(new Date(adFreeExpRef.startTime), '%d-%M-%Y')});
                                $('.topUserInfoBand .info_text').html($('.topUserInfoBand .info_text').html().replace('[0]', adFreeExpAvailed));
                            } */
                            
                            objUserSub.bindEvents(bannerType);
                        } else {
                            window.saveLogs && saveLogs({'type': 'top_nudge_band', 'data': data, 'bannerType': bannerType, 'TP_email': _tp_data.email, 'origin' : 'appendBand'});
                        }
                    }
                });
            } else {
                window.saveLogs && saveLogs({'type': 'top_nudge_skipped', 'bannerType': bannerType, 'TP_email': _tp_data.email, 'origin' : 'appendBand'});
                console.info('Nudge Skipped');
            }
        }
    }
    return {init: objUserSub.init, fetchSubsc: objUserSub.fetchSubsc, appendBand: objUserSub.appendBand};
}()
objAccessPassPaymentBnr = (function() {
    var objAPPaymentBnr = {
        init: function() {
            var daysLeft = objProfile.subDetails.daysLeft === 0 ? '1 day' : '2 days'
            var retryPaymentDOM = '<div class="appayment_band"><span class="grt_msg">Hi '+ _tp_data.fname +', you are now an ET Prime Member for '+ daysLeft +'. Your subscription request is pending!</span><a class="appayment_cta" data-ga-onclick="Subscription Flow#SYFT_band_Access Pass_Retry CTA click#url"><img src="https://img.etimg.com/photo/98201431.cms" class="retryp_icon" />Retry Payment</a></div></div>';
            $('.soWrapper').html(retryPaymentDOM).addClass("grt_bnr");
            var soNode = $('.soWrapper').addClass('renewBand');
            $('.soWrapper').remove();
            if($('.brcmb_wrapper').length) {
                $('.brcmb_wrapper').after(soNode);
            } else {
                $('.sbnv_wrapper').after(soNode);
            }
            $('.renewBand').slideDown();
            
            objAPPaymentBnr.bindEvents();
        },
        bindEvents: function() {
            $('.soWrapper .appayment_band .appayment_cta').click(function(){
                customDimension.dimension172 += '2 day access pass activation';
                $(this).attr('disabled', 'true');
                objAPPaymentBnr.generatePaymentLink();
            });
        },
        generatePaymentLink: function() {
            $.ajax({
                url : "https://"+ objVc.subscriptions +".economictimes.indiatimes.com/subscription/merchant/ET/product/ETPR/accessPassRetrialPayment",
                dataType: "json",
                method: "post",
                headers: {
                    'X-CLIENT-ID' : window.objVc && objVc.oauthClientId || (objCommon.isLive ? 'b2a8e883ec676f417520f422068a4742' : 'w2a8e883ec676f417520f422068a4741'),
                    'X-TOKEN' : $.cookie('OTR')
                },
                timeout: 10000,
                success: function(data) {
                    goToPlan({url: data.resultUrl || ""});
                }
            });
        }
    }
    return {init: objAPPaymentBnr.init};
})();

objSpecialOffer = (function () {
    var objSpclOffer = {
        init: function () {
            if($('html').hasClass('prime_header') && $('html').hasClass('prime_user') && window.subsec1_common!='1977021501') {
                var curDate = new Date(), curHr = curDate.getHours(), greetText = '';
                var singleDay = 60*60*24*1000;
                var curTime = curDate.getTime();
                var curTimeMs = curDate.valueOf();
                var locaStorageGrtid = localStorage.getItem('defaultp_home_'+ _tp_data.ssoid);
                var locaStorageGrtTime = localStorage.getItem('defaultp_home_time'+ _tp_data.ssoid);
                
                var difference_ms =  curTimeMs - locaStorageGrtTime;
                var finaldifference_ms= Math.round(difference_ms/singleDay);
                console.log("finaldifference_ms", finaldifference_ms);
                
                if(objVc.skipwhatsapp_banner == "0"){
                    greetText = '<div class="whtsappGrtBnr_wrap"><span class="grt_msg"><span class="medium">Hey '+ _tp_data.fname +',</span> Now get relevant business news directly on your <span class="whtsap_icon"></span> WhatsApp.</span><a href="/whatsappalert.cms?email='+_tp_data.email+'&utmsource=newhp" target="_blank" class="whtsappGrtBnr_wrap--cta" data-ga-onclick="WhatsApp_Engagement#WA_Banner_NewHP#strip_banner_newhomepage_click ||'+_tp_data.email+'">Opt-in for WhatsApp Alerts</a><span class="cSprite greet_close flr"></span></div>';
                    $('.soWrapper').html(greetText).addClass("grt_bnr");
                } else {
                    loadModule({module_name: 'js_etbenefits', callback: function () {
                        var clBack = function(isETBenefitEnabled) {
                            if(isETBenefitEnabled){
                                greetText = '<div class="etbenefits_wrap" data-ga-impression="Emeritus Flow##EmeritusBannerImpression#EmeritusPaidUserBanner"><span class="grt_msg"><span class="medium">Hey '+ _tp_data.fname +'!</span> You are yet to claim the complimentary benefits with your ET Prime subscription.</span><a href="/et_benefits.cms" target="_blank" class="etbenefits_wrap_cta" data-ga-onclick="Emeritus Flow#ExploreEmeritusClicked#HomePage Emeritus Header">Claim Now</a></div>';
                            }
                            else {
                                var prntEdNode = $('.prineditionBanner_wrapper');
                                prntEdNode ? $('.prineditionBanner_wrapper').remove() :"";
                                tpName == 'articleshow_main' ? $('.renewBand').addClass("prime_inner") :"";
                                tpName != 'default' ? greetText = '<div class="printEdition_wrap" data-ga-impression=""><span class="grt_msg">The Economic Times daily newspaper is available online now.</span><a href="https://epaper.indiatimes.com/print_edition" target="_blank" class="print_edition_cta" data-ga-onclick="ePaper Discovery#Print Edition Banner#Read Todays Paper">Read Today\'s Paper</a></div>' : "";
                                var is_breaking_news = objBreakingNews.viewedNews.length;
                                var is_greetText = greetText;
                                is_breaking_news==0 && is_greetText !='' ? $('.renewBand').slideDown() :$('.renewBand').slideUp();
                            }
                            $('.soWrapper').html(greetText).addClass("grt_bnr");
                        }
                        setTimeout(function() {
                            if (typeof etBenefitObjCommon != undefined) {
                                etBenefitObjCommon.isETBenefitActive(clBack);
                            }
                        }, 1000);
                    }});
                }
                
                if(_tp_data.isPrime && tpName == 'default_prime' && (locaStorageGrtid == null) || (locaStorageGrtid == 1 && finaldifference_ms == 1) || (locaStorageGrtid > 1 && finaldifference_ms == 30) && objVc.skipwhatsapp_banner == "0"){
                    $.ajax({
                        url: "https://etonboard" + (!objCommon.isLive && "-stg" || '') + ".economictimes.indiatimes.com/etonboard/fetch/whatsappdata",
                        headers: {
                            Accept: "application/json",
                            "Content-Type": "application/json",
                            "Authorization": _tp_data.email
                        },
                        success: function(res){
                            if(res && res.isLoyalUser && !res.hasOwnProperty("whatsappDataEntity")){
                                $('.renewBand').slideDown();
                                grxEvent('event', {'event_category': 'WhatsApp_Engagement', 'event_action': 'WA_Banner', 'event_label': 'strip_banner_newhomepage_view ||'+ _tp_data.email }, 1);
                            }
                            else {
                                $(".soWrapper.renewBand").remove();
                            }
                        },
                        error: function(res){
                            grxEvent('event', {'event_category': 'WhatsApp_Engagement', 'event_action': 'WA_Banner', 'event_label': 'strip_banner_newhomepage_fail'+ _tp_data.email }, 1);
                        }
                    });
                }
                var soNode = $('.soWrapper').addClass('renewBand');
                $('.soWrapper').remove();
                if($('.brcmb_wrapper').length) {
                    $('.brcmb_wrapper').after(soNode);
                } else {
                    $('.sbnv_wrapper').after(soNode);
                }
            }
            
            if(tpName != 'default_prime') {
                var userDetails = $.jStorage.get('prime_' + (objUser.info && objUser.info.ticketId));
                var halfUserBase = +new Date() % 2;
                if(_tp_data.isLogged && !userDetails.profileCompleted && halfUserBase && !_tp_data.isPrime && false) {
                    /* disabled this code with false condition on top */
                    $(".soWrapper").html("<div class='profile_cmplt_hdr'><img src="+_tp_data.pic+" class='profile_pic' /><a class='hdr_spcl_ofr' data-ga-onclick='User Profiling#Desktop Top Header#Click' href='/userprofile.cms'>Complete your Profile</a></div>");
                    $('.profile_cmplt_hdr .hdr_spcl_ofr').show();
                    grxEvent('event', {'event_category': 'User Profiling', 'event_action': 'Desktop Top Header', 'event_label': 'Impression' }, 1);
                } else {
                    if(objUser.checkPermission("expired_subscription") && $('.hdr_spcl_ofr.top_e_us').length > 0){
                        $('.hdr_spcl_ofr.top_e_us').show().siblings().remove();
                    } else if(objUser.checkPermission("cancelled_subscription") && $('.hdr_spcl_ofr.top_c_us').length > 0){
                        $('.hdr_spcl_ofr.top_c_us').show().siblings().remove();
                    } else if(!_tp_data.isPrime && !_tp_data.isAdfree){
                        $('.hdr_spcl_ofr.top_f_us').show().siblings().remove();
                    } else if($('.renewBand').text() && localStorage.getItem('defaultp_home_'+ _tp_data.ssoid) != 1 && tpName == 'default_prime'){
                        $('.hdr_spcl_ofr.top_f_us').show().siblings().remove();
                    }
                }
                
                $('.renewBand').slideDown();
                    
                /* $('.hdr_spcl_ofr').click(function() {
                    goToPlan({url: $(this).attr("data-url") || "", cdp: true, ctaText: "topbutton_"+$(this).text()});
                }); */
            } else {
                var myTimeout = function(){
                    $(".greet_close").click(function(){
                        grxEvent('event', {'event_category': 'Banner cancelled', 'event_action': 'WA_Banner', 'event_label': 'strip_banner_newhomepage_cancel ||'+ _tp_data.email });
                        var lclstrgVal = localStorage.getItem('defaultp_home_'+ _tp_data.ssoid);
                        if(lclstrgVal == null){
                            $('.renewBand').slideUp(); 
                            localStorage.setItem('defaultp_home_'+ _tp_data.ssoid, 1)
                            localStorage.setItem('defaultp_home_time'+ _tp_data.ssoid, curTimeMs)
                        }
                        if(lclstrgVal >= 1) {
                            lclstrgVal++;
                            localStorage.setItem('defaultp_home_'+ _tp_data.ssoid, lclstrgVal)
                            localStorage.setItem('defaultp_home_time'+ _tp_data.ssoid, curTimeMs)
                            $('.renewBand').slideUp(); 
                        }
                    })
                    $(".whtsappGrtBnr_wrap").click(function(){
                        grxEvent('event', {'event_category': 'WhatsApp_Engagement', 'event_action': 'WA_Banner', 'event_label': 'strip_banner_newhomepage_click ||'+ _tp_data.email }, 1);
                    })
                }
                setTimeout(myTimeout, 5000);
            }
        }
    }
    return {init: objSpclOffer.init};
})();

objNLSubscription = (function() {
    var reqHeader = {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
    }
    var mapingSid = function(sid) {
        newSid = "";
        switch(sid) {
            case "110":
            case 110:
                newSid = "5f5a31db80f79664e95679d1"
                break;
            case "3125":
            case 3125:
                newSid = "5f5a31db80f79664e95679e4"
                break;
            case "3128":
            case 3128:
                newSid = "5f5a31db80f79664e95679e7"
                break;
            case "3124":
            case 3124:
                newSid = "5f5a31db80f79664e95679e3"
                break;
            case "1722":
            case 1722:
                newSid = "5f5a31db80f79664e95679d6"
                break;    
            default:
                newSid = sid;
        }
        return newSid;
    }
    var isLoading = false;
    var nLSubscription = {
        nlSubEndPoint: 'https://' + objVc.nlSubscribe + '.indiatimes.com/et-mailing-subscription/ok',
        nlChannelId: '5f5a00075651d4e45e1b67d6',
        initSubscription: function(config, callback) {
            if (config && !isLoading) {
                $('.body-loading').show();
                isLoading = true;
                config.sid = mapingSid(config.sid)
                
                $.ajax({
                    type: "POST",
                    url: nLSubscription.nlSubEndPoint + '/subscription/' + nLSubscription.nlChannelId,
                    dataType: 'json',
                    data: JSON.stringify({
                        userId: config.email || '',
                        userName: '',
                        serviceIds: config.sid || '',
                        ssoCheck: (_tp_data.email != '' || _tp_data.mobile != '' || !!$.cookie("wv_ssoid")) ? true : false,
                        nlName: '',
                        limit: '',
                        sourcePage: '',
                        src: 0,
                        acq_type : config.utm && config.utm == 'CPC' ? 'paid' : '',
                        referralCode: config.referralCode || '',
                    }),
                    headers: reqHeader,
                    success: function(data) {
                        isLoading = false;
                        $('.body-loading').hide();
                        var cbData = {success: false, failure: true, message: data.message || 'We are facing some issues, Please try again later.', data: data, config: config};
                        if (data.status == 200) {
                            $.removeCookie('_widget', {
                                path: '/'
                            });
                            cbData.success = true;
                            cbData.failure = false;
                            cbData.message = data.message || 'Subscribed succesfully.';
                        }
                        callback(cbData);
                    },
                    error: function(error) {
                        console.log(error);
                        isLoading = false;
                        $('.body-loading').hide();
                        callback({success: false, failure: true, message: error.message || 'We are facing some issues, Please try again later.', data: error});
                    }
                });   
            }
        },
        getNewsLtrSuggestion: function(config, callback) {
            var secName = window.objSec.secNames && window.objSec.secNames.length && window.objSec.secNames[0] || window.secname || "Homepage";
            if (config) {
                $('.body-loading').show();
                $.ajax({
                    type: "POST",
                    url: nLSubscription.nlSubEndPoint + '/getnewssuggest/' + nLSubscription.nlChannelId,
                    dataType: 'json',
                    data: JSON.stringify({
                        "userId": _tp_data.email || '',
                        "serviceId": '', // Static Value as required by Backend Team
                        "sectionId": window.subsec1_value,
                        "secname": secName.split('-').join(' '),
                        "limit": config.limit || 1,
                        "src": 0
                    }),
                    headers: reqHeader,
                    timeout: 5000,
                    success: function(response) {
                        $('.body-loading').hide();
                        var data = response && response.newsFeedList || {};
                        console.log(data, 'Newsletter Data');
                        var cbData = {success: false, failure: true, message: response.message, data: data, config: config}
                        if (response.status == 200) {
                            cbData.success = true;
                            cbData.failure = false;
                        }
                        callback(cbData);
                    },
                    error: function(error) {
                        console.log(error);
                        $('.body-loading').hide();
                        callback({success: false, failure: true, message: error.message || 'Not Subscribed', data: error});
                    }
                });
            }
        },
        checkNewsLtrSubsc: function(config, callback) {
            if (config) {
                $('.body-loading').show();
                $.ajax({
                    type: "POST",
                    url: nLSubscription.nlSubEndPoint + '/chkStatus/' + nLSubscription.nlChannelId,
                    dataType: 'json',
                    data: JSON.stringify({
                        "ssoId": config.email || _tp_data.email,
                        "key": config.key || ""
                    }),
                    headers: reqHeader,
                    timeout: 5000,
                    success: function(response) {
                        $('.body-loading').hide();
                        var cbData = {success: false, failure: true, message: response.message, data: response, config: config}
                        if (response.status == 200) {
                            cbData.success = true;
                            cbData.failure = false;
                            var subscribed_nwsltr = [];
                            response.subscriptionStatus.subscriptions.forEach(function(item) {
                                if (item.subscriptionStatus != "INACTIVE") {
                                    subscribed_nwsltr.push(item.serviceId)
                                }
                            })
                            var date = new Date();
                                date.setTime(date.getTime() + (1 * 24 * 60 * 60 * 1000));
                                expires = "; expires=" + date.toGMTString();
                                document.cookie = "_widget="+subscribed_nwsltr+expires+"; path=/";
                                if(response.subscriptionStatus.referralCode)
                                sessionStorage.setItem('referralCode',response.subscriptionStatus.referralCode);
                                else
                                sessionStorage.removeItem('referralCode');
                        }
                        callback(cbData);
                    },
                    error: function(error) {
                        console.log(error);
                        $('.body-loading').hide();
                        callback({success: false, failure: true, message: error.message || 'Not found Subscrtions data ', data: error});
                    }
                });
            }
        },
        unsubsNews: function(config, callback) {
            if (config) {
                $('.body-loading').show();
                var userEmail = _tp_data.email || config.email || sessionStorage.getItem("tempEmail");
                $.ajax({
                    type: "POST",
                    url: nLSubscription.nlSubEndPoint + '/unsub/' + nLSubscription.nlChannelId,
                    dataType: 'json',
                    data: JSON.stringify({
                        userId: userEmail,
                        serviceId: config.sid,
                        src: 0,
                    }),
                    headers: { 
                        'Accept': 'application/json',
                        'Content-Type': 'application/json' 
                    },
                    success: function(data) {
                        $('.body-loading').hide();
                        var cbData = {success: false, failure: true, message: data.message || 'We are facing some issues, Please try again later.', data: data, config: config};
                        if (data.status == 200) {
                            $.removeCookie('_widget', {
                                path: '/'
                            });
                            cbData.success = true;
                            cbData.failure = false;
                            cbData.message = data.message || 'UnSubscribed Succesfully.';
                        }
                        callback(cbData);
                    },
                    error: function(error) {
                        $('.body-loading').hide();
                        callback({success: false, failure: true, message: error.message || 'We are facing some issues, Please try again later.', data: error});
                    }
                });   
            }
        },
    }
    return {
        initSubscription: nLSubscription.initSubscription, 
        getNLSuggestion: nLSubscription.getNewsLtrSuggestion,
        checkNewsLtrSubsc : nLSubscription.checkNewsLtrSubsc, 
        unsubsNews: nLSubscription.unsubsNews, 
        nlSubEndPoint: nLSubscription.nlSubEndPoint,
        nlChannelId: nLSubscription.nlChannelId
    };
})();

objTrendingStory = {
    init: function() {
        objUser.afterPrimeCheckCall(function() {
            objTrendingStory.getStory();
        });
    },
    getStory: function() {
        $.ajax({
            url: "/et_trendingstory.cms?msid=81429572",
            success: function(res) {
                if (res.length) {
                    objTrendingStory.createBanner(res);
                } else {
                    objPrimeOffers.showFooterBand();
                }
            }
        });
    },
    createBanner: function(story) {
        var config = {
            content: story,
            name: "Trending Story of the day",
            width: "short",
            onClose: function() {},
            priority: 1,
            parentClass: 'trendingstry_box'
        }
        var isEnabled = 0;
        $(window).scroll(function () {
            if (!isEnabled && window.scrollY > window.innerHeight) {
                isEnabled = 1;
                objStickyFooter.showProcessedFlag = 1;
                $('.trendingstry_box').addClass('active');

                objStickyFooter.showBand(config, function(ele) {
                    var finalLink = $('.bandContent a').attr("data-url");
                    grxEvent('event', {'event_category': 'SubscriptionOffer', 'event_action': 'StoryImpression', 'event_label': 'Footer | ' + finalLink}, 1);
                    $('.bandContent').click(function() {
                        grxEvent('event', {'event_category': 'SubscriptionOffer', 'event_action': 'StoryClick', 'event_label': 'Footer | ' + finalLink}, 1);
                    });
                });
            }   
        });
    }
}

objClosePopup = {
    init: function() {
        $("body").on( "click", function(ele) {
            if (ele.target.classList.value.includes('popup_bg')) {
                $(".popup_bg").hide();
            }
        });
    }
}
/* Generic Sticky yellow band on footer*/
/*config = {
    content: "<p>Hello Users</p>",  // REQUIRED - HTML Format
    name: "New year Footer",        // OPTIONAL - Sticky Footer Name
    width: "full",                  // OPTIONAL - full/short
    onClose: function() {},         // OPTIONAL -  Callback function on click of Close button
    showToPrime: 1,                 // OPTIONAL - To be used in case footer need to show to Prime User
    priority: 1,                    // OPTIONAL - In case need to override to other footer
    parentClass: xyz                // OPTIONAL - In case need to add class to parent container i.e along with .stickyBand
    hideClose: true/false           // OPTIONAL - In case need to hide close button
    disableDepth: true/false        // OPTIONAL - when footer doesn't required to show on scroll
    skipIgnore: true/false          // OPTIONAL - when forcefully required to skip checks and need to show band forcefully
}
    **skipStickyBand** = Add this class to body, when required to remove this Band from Page.
*/

objStickyFooter = (function () {
    var stickyBand = {
        skipPopup: $('.skip_popup').length || objVc.skipstickyBand || objVc.skipPopup,
        showProcessedFlag: 0, 
        show: function(config, callback) {
            var skipBand = stickyBand.skipPopup && (config.skipIgnore ? !config.skipIgnore : 1);
            if(skipBand) {
                _log('stickyBand skiped');
                callback && 
                callback({name: config.name, priority: config.priority, success: false, failure: true, message: 'stickyBand skiped'})
            } else {
                if(!stickyBand.showProcessedFlag) {
                    var bandInit = function() {
                        var pageScrollPos = $(this).scrollTop();
                        var sideBarEle = ($('.sideBar').length && $('.sideBar').offset().top) || ($('#sideBar').length && $('#sideBar').offset().top);
                        
                        // why 310px? for more info refer to this Jira ET-18163
                        var scrollDepth = config.disableDepth ? 0 : 310;
                        if((sideBarEle + scrollDepth < pageScrollPos) && !stickyBand.showProcessedFlag) {
                            stickyBand.showBand(config, callback);
                            $(window).unbind("scroll", bandInit);
                        }
                    }
                    $(window).bind("scroll", bandInit);
                } else {
                    stickyBand.showBand(config, callback);
                }
            }
        },
        showBand: function (config, callback) {
            stickyBand.showProcessedFlag = 1;
            config.showToPrime = config.showToPrime ? true : false;
            var isFtrExist = $('.stickyBand').length;
            var isPrimeUser = _tp_data.isPrime;
            // Hide by Default for Prime User - if need to show pass "showToPrime" as "True" in config.
            var skipStickyBand = $('.skipStickyBand').length;
            var excludedList = ['wealth_editionshow', 'wealth_edition', 'print_edition'];
            var isTmpltExcluded = excludedList.indexOf(tmplName) !== -1;
            
            if (!skipStickyBand && etFlag.isIndia && !$('.skip_footer_band').length && (!isPrimeUser || config.showToPrime) && !isTmpltExcluded) {
                if (!isFtrExist) {
                    config.content ? stickyBand.appendFooter(config, callback) : '';
                } else {
                    var ftrPriority = $('.stickyBand').attr('data-priority');
                    if (ftrPriority == "true") {
                        callback({name: config.name, priority: config.priority, success: false, failure: true, message: 'Footer already exist'});
                    } else if (config.priority) {
                        $('.stickyBand .close').click();
                        stickyBand.appendFooter(config, callback);
                    } else {
                        callback({name: config.name, priority: config.priority, success: false, failure: true, message: 'Footer already exist'});
                    }
                }   
            }
        },
        appendFooter: function(config, callback) {
            if((geoinfo && geoinfo.geolocation =="1") || ((geoinfo && geoinfo.geolocation !="1") && (tpName && (tpName == 'articleshow_main' || tpName == 'default')))){
                var html = '<div class="stickyBand"><span class="bandContent"></span><span class="close"></span></div>';
                $('body').append(html);
                $('.stickyBand').addClass(config.parentClass || '');
                $('.stickyBand .bandContent').html(config.content);
                $('.stickyBand').addClass(config.width ? config.width : 'full');
                $('.stickyBand').attr('data-name', config.name || '');
                $('.stickyBand').attr('data-priority', config.priority || false);
                config.hideClose && $('.stickyBand .close').addClass('hide');
                callback && callback({name: config.name, priority: config.priority, success: true, failure: false});
                
                $('.stickyBand .close').click(function(e) {
                    e.preventDefault();
                    $('.stickyBand').remove();
                    if (config.onClose instanceof Function) {
                        config.onClose({name: config.name, priority: config.priority, success: true, failure: false, message: 'Footer Removed'})
                    }
                });
            }
        },
        hide: function(config, callback) {
            $('.stickyBand').remove();
            if (callback) {
                var fName = $('.stickyBand').attr('data-name', config.name || '');
                var fPriority = $('.stickyBand').attr('data-priority', config.priority || false);
                callback({name: fName, priority: fPriority, success: true, failure: false, message: 'Footer Removed'});
            }
        }
    }
    return {hideBand: stickyBand.hide, showBand: stickyBand.show, showBandF: stickyBand.showBand, showProcessedFlag: stickyBand.showProcessedFlag};
})();

objPrimeOffers = {
    init: function(){
        if (!$('.skipStickyBand').length && tpName.indexOf("topic") == -1){
            var secName = window.objSec && objSec.secNames;
            if (
                secName.indexOf("wealth") == -1 && 
                secName.indexOf("markets") == -1 && 
                !objUser.checkPermission(['expired_subscription','cancelled_subscription', 'subscribed']) && 
                !$('.prime_paywall').length
            ) {
                objTrendingStory.init();
            } else {
                const hideFooterBanner = $.jStorage.get('nyoFooter');
                if(!hideFooterBanner && tpName != 'access_pass'){
                    objUser.afterPrimeCheckCall(function() {
                        if ((!_tp_data.isPrime && !_tp_data.isAdfree) || objUser.checkPermission(['expired_subscription','cancelled_subscription'])) {
                            objPrimeOffers.showFooterBand();
                        }
                    });
                }
            }
        }
        
        objPrimeOffers.bindEvents();
    },
    bindEvents: function(){
        if($(".prime_paywall").length > 0 && $(".newyrpln_pop").length > 0){
            objUser.afterPrimeCheckCall(function() {
                if(objUser.checkPermission("expired_subscription") && $(".newyrpln_pop.e_us_wall").length > 0){
                    $(".newyrpln_pop.e_us_wall").removeClass("hide");
                }else if(objUser.checkPermission("cancelled_subscription") && $(".newyrpln_pop.c_us_wall").length > 0){
                    $(".newyrpln_pop.c_us_wall").removeClass("hide");  
                }else if(!_tp_data.isPrime && !_tp_data.isAdfree && $(".newyrpln_pop.f_us_wall").length > 0){
                    $(".newyrpln_pop.f_us_wall").removeClass("hide");        
                }    
                
                $('.newyrpln_pop .plans_btn').click(function() {
                    var dataUrl = $(this).attr("data-url");
                    var ctaText = $(this).text();
                    grxEvent('event', {'event_category': 'Subscription Flow', 'event_action': 'SYFT', 'event_label': 'SYFT with Offer'}, 1);
                    goToPlan({url: dataUrl || "", cdp: true, feature_name: "prime_article", ctaText: ctaText, landing_url: dataUrl});
                });
            });
        }
        if($(".prime_paywall").length > 0 && $(".campign_sec").length > 0){
            $('.campign_sec .plans_btn').click(function() {
                var sub_plan = "";
                if ($(this).parent().hasClass('stu_of')) {
                    sub_plan = "student";
                    grxEvent('event', {'event_category': 'Subscription Flow', 'event_action': 'SYFT', 'event_label': 'Student Entry Point Paywall'}, 1);
                } else {
                    grxEvent('event', {'event_category': 'Subscription Flow', 'event_action': 'SYFT', 'event_label': 'SYFT with Campaign Offer'}, 1);
                }
                
                var dataUrl = $(this).attr("data-url");
                var ctaText = $(this).text();
            
                window.objPrimePaywall && objPrimePaywall.fbEvent && objPrimePaywall.fbEvent('syft');
                goToPlan({
                    url: dataUrl || "", 
                    cdp: true, 
                    feature_name: "prime_article", 
                    ctaText: ctaText, 
                    landing_url: dataUrl, 
                    sub_plan: sub_plan,
                    item_category: "prime",
                    item_brand: "content",
                    item_category2: window.secname,
                    item_category4: ctaText,
                    item_category3: "paywall_blocker_cta",
                    item_name: window.artTitle
                });
            });
        }
    },
    createBand: function(obj){
        try{
            var finalObj = ''; 
            
            if(objUser.checkPermission("expired_subscription") && obj[0].e_user.banner_text){
                finalObj = obj[0].e_user;
            }else if(objUser.checkPermission("cancelled_subscription") && obj[0].c_user.banner_text){
                finalObj = obj[0].c_user;    
            }else{
                finalObj = obj[0].f_user;         
            }
            /*var accessPassObj = $.jStorage.get('access_pass_flow');
            var isAccessPassEnabled = accessPassObj && accessPassObj.enabled && !!!accessPassObj.blocked && !_tp_data.isPrime;
            if(isAccessPassEnabled){
                loadModule({module_name: "js_prime_access_functions", callback:function(){
                    objAccessPassFlow.createBand()
                }});
            } */
            if(finalObj.banner_text){
                var now = +new Date();
                if(now > 1721412000000 && now < 1721584800000) {
                    var footerContent = '<div class="amazonsale_banner"><div class="wrapper"><div class="flt"><img src="https://img.etimg.com/photo/111805969.cms" width="114" /></div><div class="dib"><p class="banner_hdng">Biggest Sale of the Year is back!</p><span class="desc">Get products at lowest prices on 20th - 21st July 2024</span></div><img src="https://img.etimg.com/photo/111809187.cms" class="p_icon" /><div class="flr plan_ofr_wrap"><div class="plan_ofr"><a class="subc_btn">Know More</a></div></div></div></div>';
                    
                    var bandDetails = {
                        content: footerContent,
                        width: "short",
                        name: "Amazon Sale offer",
                        priority: false,
                        onClose: function(){
                            grxEvent('event',{'event_category':'Web - Amazon HP Bottom Sticky','event_action': 'Cross Button',  'event_label': window.location.href});
                            $.jStorage.set('nyoFooter', "enabled", {TTL: 86400000});
                        }
                    }
                    
                    objStickyFooter.showBand(bandDetails, function(){
                        grxEvent('event', { 'event_category': 'Web - Amazon HP Bottom Sticky',  'event_action': 'Impression',  'event_label': window.location.href});
                        $('.amazonsale_banner').click(function() {
                            grxEvent('event', { 'event_category': 'Web - Amazon HP Bottom Sticky',  'event_action': 'Click',  'event_label': window.location.href});
                            var finalLink = "https://www.amazon.in/primeday?tag=et_desktop_bottomsticky-21";
                            window.open(finalLink, '_blank');
                        });
                    })
                    
                } else {
                    var cohortData = $.jStorage.get('cohortData');
                    var cohortFtrData = cohortData && cohortData.communication && cohortData.communication[0].bottom_fotter;
                    var footerContent = '<div class="nyo_sticky_ftr"><div class="wrapper"><div class="flt"><img src="https://img.etimg.com/photo/96706126.cms" class="p_icon" /></div><div class="dib"><p class="banner_hdng">'+ finalObj.banner_heading +'</p><span class="desc">'+ finalObj.banner_text +'</span></div><div class="flr plan_ofr_wrap"><div class="plan_ofr"><p class="ofr_label">'+ finalObj.button_label +'</p><a data-url="'+ finalObj.banner_url +'" class="subc_btn">'+ finalObj.button_text +'</a></div></div></div></div>';
                    if(cohortFtrData) {
                        footerContent = '<div class="nyo_sticky_ftr"><div class="wrapper"><div class="flt"><img src="https://img.etimg.com/photo/96706126.cms" class="p_icon" /></div><div class="dib"><p class="banner_hdng">'+ cohortFtrData.heading +'</p><span class="desc">'+ cohortFtrData.subheading +'</span></div><div class="flr plan_ofr_wrap"><div class="plan_ofr"><p class="ofr_label">'+ cohortFtrData.cta_prompt_text +'</p><a data-url="'+ cohortFtrData.url +'" class="subc_btn">'+ cohortFtrData.cta_text +'</a></div></div></div></div>'
                    }
                    var bandDetails = {
                        content: footerContent,
                        width: "short",
                        name: "Prime offer",
                        priority: false,
                        onClose: function(){
                            $.jStorage.set('nyoFooter', "enabled", {TTL: 86400000});
                        }
                    } 
                    objStickyFooter.showBand(bandDetails, function(){
                        /* $('.nyo_sticky_ftr .subc_btn').click(function() {
                            grxEvent('event', {'event_category': 'SubscriptionOffer', 'event_action': 'OfferClick', 'event_label': 'SubscriptionOfferFooter'}, 1);
                            goToPlan({url: $(this).attr("data-url") || "", cdp: true, ctaText: "bottombanner_"+$(this).text()});
                        }); */
                        
                        $('.bandContent').click(function() {
                            var finalLink = $(this).find(".subc_btn").attr("data-url");
                            var ctaLabel = $(this).find(".subc_btn").text();
                            grxEvent('event', {'event_category': 'SubscriptionOffer', 'event_action': 'OfferClick', 'event_label': 'SubscriptionOfferFooter' + (cohortData && ' - ' + cohortData.code)}, 1);
                            goToPlan({
                                url: finalLink || "", 
                                dim49: "Offer Footer", 
                                cdp: true, 
                                ctaText: "bottombanner_"+ctaLabel,
                                item_category4: ctaLabel,
    	                        item_category: tpName.includes('articleshow') ? "free_article" : "listing", 
    	                        item_brand: "product_interventions",
    	                        item_id: window.msid || "",
    	                        item_name: window.location.href, 
    	                        item_category2: window.secname, 
    	                        item_category3: "bottom_banner"
                            });
                        });
                    });
                }
            }      
        }catch(e){
            _log("Error: "+ e)
        }   
    }, 
    showFooterBand: function(){
        const hideFooterBanner = $.jStorage.get('nyoFooter');
        var isPlansShown = $('.subscribe_flow .plan_item').length,
        cacheKey = 'et_plan_entrypoint' + (objVc.planEntryPointCache || '');
        var excludedTmpl = ['primearticleshow', 'articleshow_exclusive2', 'access_pass'].includes(tpName);
        var isPaidAS = tpName === 'articleshow_main' ? ($('html').attr('data-adaptive') || 0) : 0;
        
        if(!hideFooterBanner && !isPlansShown && !excludedTmpl && !Number(isPaidAS)) {
            objUser.afterPrimeCheckCall(function() {
                if (!objUser.checkPermission("subscribed") || objUser.checkPermission(["expired_subscription", "cancelled_subscription"])) {
                    if($.jStorage.get(cacheKey) && objCommon.isLive){
                        var res = $.jStorage.get(cacheKey);
                        objPrimeOffers.createBand(JSON.parse(res));
                    } else {
                        $.ajax({
                            url: "/prime_campaign.cms?msid=81429572&bannertype=bottom",
                            cache:true,
                            dataType:'script',
                            success: function(res){
                                $.jStorage.set(cacheKey, res);
                                $.jStorage.setTTL(cacheKey, 3 * 60 * 60 * 1000);
                                objPrimeOffers.createBand(JSON.parse(res));
                            }
                        });
                    }
                }
            });
        }
    },
    /*offerOnPlansPaywall: function() {
        const isAlreadyExist = $('.newyrpln_pop').length;
        if (!isAlreadyExist) {
            const newyrOfferHTML = '<div class="newyrpln_pop"><p class="heading">Special Offer on ET Prime</p><p class="desc">Subscribe &amp; Save <span class="bold">63% on 2-Year Plan</span></p><a class="plans_btn">View Plans</a></div>';
            $('.paywall_b .brd_wrap').append(newyrOfferHTML);
        }
    }*/
}

objPrimeMbrBanner = {
    init : function(){
        objUser.afterPrimeCheckCall(function(){
            if (tpName == "default") {
                if(objVc.skipwhatsapp_banner == "1" && (objUser.checkPermission(['subscribed', 'cancelled_subscription']))){
                    objPrimeMbrBanner.checkWhatsAppAlert()
                } else{
                    objPrimeMbrBanner.prime_mbr_widget();
                }
            }
        });
        
        objPrimeMbrBanner.bind()
    },
    bind : function(){
        $(document).on("click", "#TP_bnr .bnr_click", function(){
            $.jStorage.set('tp_bnr', 1, {TTL: 86400000}) 
        });
    },
    checkWhatsAppAlert : function() {
        var whatsAppBanner = $.jStorage.get('whatsapp_b_'+ _tp_data.ssoid),
        bannerCheck = function(res){
            if(res && res.isLoyalUser && !res.hasOwnProperty("whatsappDataEntity")){
                $("#wa_banner").removeClass("hide");
                grxEvent('event', {'event_category': 'WhatsApp_Engagement', 'event_action': 'WA_Banner', 'event_label': 'view'}, 1);
            } else {
                objPrimeMbrBanner.prime_mbr_widget();
            }     
        };
        if(whatsAppBanner){
            bannerCheck(whatsAppBanner);        
        }else{
            $.ajax({
                url: "https://etonboard" + (!objCommon.isLive && "-stg" || '') + ".economictimes.indiatimes.com/etonboard/fetch/whatsappdata",
                headers: {
                    Accept: "application/json",
                    "Content-Type": "application/json",
                    "Authorization": _tp_data.email
                },
                success: function(res){
                    console.log('res')
                    $.jStorage.set('whatsapp_b_'+ _tp_data.ssoid, res, {TTL: 2 *60 * 60 * 1000});
                    
                    bannerCheck(res);  
                },
                error: function(res){
                    grxEvent('event', {'event_category': 'WhatsApp_Engagement', 'event_action': 'Web', 'event_label': 'banner_fail'}, 1);    
                }
            });
        }
    },
    prime_mbr_widget : function(){
        if (tpName == 'primehome' || tpName == 'default'){
            objUser.afterPrimeCheckCall(function () {
                if(_tp_data.permissions && _tp_data.permissions.indexOf('subscribed') != -1) {
                    var stk_bnr_category = (tpName== 'primehome') ? 'Prime HP Impression' : 'HP Impression';
                    if(!($.jStorage.getTTL('tp_bnr'))){
                        var merchantCode= "ET", productCode= "ETPR"; clientId = window.objVc && objVc.oauthClientId || (objCommon.isLive ? 'b2a8e883ec676f417520f422068a4742' : 'w2a8e883ec676f417520f422068a4741');
                        var OTR = $.cookie('OTR')
                        $.ajax({
                            url: "https://"+ (objVc.subscriptions || "subscriptions") +".economictimes.indiatimes.com/subscription/merchant/"+merchantCode+"/product/"+productCode+"/voucherBenefitDetail",
                            data : {
                                planOfferType : 'TIMES_PRIME'
                            },
                            headers: {
                                'X-CLIENT-ID' : clientId,
                                'X-TOKEN' : OTR
                            },
                            success: function(response){
                                var data = response[0]
                                if (data && data.allocated && !data.redeemed){
                                    $("#TP_bnr .bnr_click").attr("href","https://economictimes.indiatimes.com/redirect/type-g.cms?url=https://www.timesprime.com/mktcampaign?content=etprime&showFT=false&utm_source=ETP&utm_medium=web&promo="+data.voucherCode).attr("data-ga-onclick","ETPrime Benefits#ETPrime Benefits Clicked#ETPrime Benefits - " +data.voucherCode)
                                    $('#TP_bnr').slideDown()
                                    grxEvent('event', {'event_category': stk_bnr_category, 'event_action': 'Widget TimesPrime', 'event_label': window.location.href}, 1, 1);
                                    window.saveLogs && saveLogs({'type': 'tp_deal_code', 'api_response': data,'vCode':data.voucherCode, 'TP_email': _tp_data.email ,'OTR': OTR ,'TP_mobile':_tp_data.mobile });
                                }
                            },
                            error: function(error){
                                console.log(error);
                            }
                        })
                    }
                }
            })
        }
    } 
}

objSrPopUpFn = {
    init: function(){
        objUser.afterPrimeCheckCall(function () {
            var ss = window.subsec1_common;
            var ss_2 = window.subsec2_common;
            var tn = window.tpName;
            var checkPaywallArti = $('html').attr('data-adaptive') || 0;
            var isMktPopupEnabled = window.markets_srp_popup;
            if((ss == '1977021501' || ss == '837555174') && !objUser.checkPermission("subscribed") && (tn != 'stockreports_benefits' && tn != 'stockreports' && tn != 'primearticlelist' && tn != 'primearticleshow' && tn != 'articleshow_exclusive2' && ss_2 != '82519373') && objGdpr.allow() && checkPaywallArti != '1' && isMktPopupEnabled == "1"){
                loadModule({'module_name': 'js_sr_popup', v: 5, type:'popup', ref:'StockReports'});
            }
        })
    }
}
//Crypto popup
objCryptoPopUpFn = {
    init: function(){
        objUser.afterPrimeCheckCall(function () {
            var ss = window.subsec1_common;
            var ss_2 = window.subsec2_common;
            var tn = window.tpName;
            var showOrNot = $.cookie('_crpopup');
            var checkPaywallArti = $('html').attr('data-adaptive') || 0;
            if((tn == 'cryptocurrency') && !objUser.checkPermission("subscribed") && objGdpr.allow() && checkPaywallArti != '1' && showOrNot == undefined){
                //loadModule({'module_name': 'js_crypto_popup', v: 1, type:'popup', ref:'CryptoPopup'});
                loadModule({'module_name': 'js_crypto_popup', v: 2});
            } 
        }) 
    }
}

var objStockMore = {
    init: function(){
        $(document).on('click', '.js_loadMoreStocks', function(){
          var countNoAttr = $(this).attr('data-count');
          var count = Number(countNoAttr) + 1;
          var currentDataLoad = $(this).attr('data-loadmore');
                currentDataLoad = currentDataLoad+'_'+count;
            $(this).parents('.js_mostSearchedStocks').find('.moreData[data-loadmore='+currentDataLoad+']').removeClass('hide');
          var countIncrease = count;
          $(this).attr('data-count',countIncrease)
          if(countIncrease == 6){
                $(this).html('Load Less..');
                $(this).addClass('js_loadLessStocks').removeClass('js_loadMoreStocks'); 
          }
           
      })
        $(document).on('click', '.js_loadLessStocks', function(){
              $(this).parents('.js_mostSearchedStocks').find('.moreData').addClass('hide');
              $(this).html('Load More..');
              $(this).addClass('js_loadMoreStocks').removeClass('js_loadLessStocks');
              $(this).attr('data-count',1);
              $('html, body').animate({scrollTop: $(this).parents('.js_mostSearchedStocks').offset().top - 50}, 1000);
      })
    }
}

var footerReadMore = {
    init:function (){
        $(document).on("click",".show_hide_pllist_data,.show_hide_interlinking", function () {    
        var txt = $(this).closest('.content_pllist_data').hasClass('visible') ? 'MORE' : 'LESS';
        $(this).closest('.show_hide_pllist_data, .show_hide_interlinking').text(txt);
        $(this).closest('.content_pllist_data').toggleClass("visible");
        });
    }
}

var objAdFreeExp = {
    popupshown:false,
    init: function() {
        var isAddFreeEnabled = window.objVc && window.objVc.adfree_campign_isactive || 0,
            isExpiredUser = _tp_data.permissions.indexOf("expired_subscription") !== -1,
            ssoid = _tp_data.ssoid || $.cookie('_grx'),
            addFreeCampignRef = $.jStorage.get('adFreeCampign_'+ssoid);
            
        if(isExpiredUser && Number(isAddFreeEnabled)) {
            objAdFreeExp.setAdFreeData(window.objVc && window.objVc.adfree_campign_counter || 30);
        }
        
        if(!Number(isAddFreeEnabled)) {
            $.jStorage.deleteKey('adFreeCampign_'+ssoid);
        }
    },
    adFreeElgibilty: function(userDetails) {
        var isAddFreeEnabled = window.objVc && window.objVc.adfree_campign_isactive || 0,
            isExpiredUser = userDetails.permissions.indexOf("expired_subscription") !== -1,
            ssoid = $.jStorage.get('userInfo').ssoid,
            addFreeCampignRef = $.jStorage.get('adFreeCampign_'+ssoid);
            
            
        if(isExpiredUser && Number(isAddFreeEnabled)) {
            if(!addFreeCampignRef) {
                var timeStampDiff = (+new Date()) - (+new Date(userDetails.subscriptionDetails[0].graceEndDate));
                var dayDiff = Math.round(timeStampDiff / (1000 * 3600 * 24));
                var isValidForCampaign = Number(window.objVc.adfree_campign_eud || 900) > dayDiff;
                if(isValidForCampaign) {
                    $.jStorage.set('adFreeCampign_'+ssoid, {lastVisitedTime: +new Date(), availed: false, eligible: true, counter: 1});
                }
            } else if(!addFreeCampignRef.availed) {
                // 3600000
                // var afcCounter = Math.floor((+new Date() - new Date(addFreeCampignRef.startTime))/86400000);
                var adFreeExpAvailed = addFreeCampignRef.counter > (window.objVc && window.objVc.adfree_campign_counter || 20);
                if(adFreeExpAvailed) {
                    var updatedObj = {startTime: addFreeCampignRef.startTime, availed: true, eligible: false, counter: window.objVc.adfree_campign_counter}
                    $.jStorage.set('adFreeCampign_'+ssoid, updatedObj);
                }
            }
        }
        
        if(!Number(isAddFreeEnabled)) {
            $.jStorage.deleteKey('adFreeCampign_'+ssoid);
        }
    },
    setAdFreeExp: function(nudgeFlag) {
        var ssoGrxId = ssoid ? ssoid : $.cookie('_grx');
        var isAdFreeExpRef = $.jStorage.get('adFreeCampign_' + ssoGrxId);
        if(isAdFreeExpRef.eligible && !isAdFreeExpRef.availed) {
            objAd.type == 'adfree';
            _tp_data.isAdfree = true;
            // $('.dib.subScribe, .soWrapper').remove();
            $('html').addClass('prime_header skip_cube skipStickyBand skip_popup');
            var isAS = window.tmplName.indexOf('articleshow') !== -1;
            var checkPaywallArti = $('html').attr('data-adaptive') || 0;
            if(isAS && checkPaywallArti !== '1') {
                $('html').addClass('prime_user');
            }
            $('#primeShots, .lazy_stock').slideUp();
            var isHeaderExist = $('header.header.clearfix').length;
            if(isHeaderExist) {
                objUserSubscriptions.appendBand(nudgeFlag);
            }
        }
    },
    setAdFreeData: function(counter) {
        var ssoGrxId = ssoid ? ssoid : $.cookie('_grx');
        var addFreeCampignRef = $.jStorage.get('adFreeCampign_' + ssoGrxId);
        _log('non loggedin exp ssoGrxId', ssoGrxId);
        if(!addFreeCampignRef) {
            var userDetails = $.jStorage.get('prime_' + objUser.info.ticketId);
            var timeStampDiff = (+new Date()) - (+new Date(userDetails.subscriptionDetails[0].graceEndDate));
            var dayDiff = Math.round(timeStampDiff / (1000 * 3600 * 24));
            var isValidForCampaign = Number(window.objVc.adfree_campign_eud || 900) > dayDiff;
            if(isValidForCampaign) {
                $.jStorage.set('adFreeCampign_' + ssoGrxId, {lastVisitedTime: +new Date(), availed: false, eligible: true, counter: 1});
                objAdFreeExp.setAdFreeExp("adFree");
                grxEvent('event', {'event_category': 'Adfree expired',  'event_action': 'True', 'event_label':  ''}, 1);
            }
        } else if(!addFreeCampignRef.availed) {
            var adFreeExpAvailed = addFreeCampignRef.counter >= Number(counter);
            if(adFreeExpAvailed) {
                var updatedObj = {lastVisitedTime: +new Date(), availed: true, eligible: false, counter: Number(window.objVc.adfree_campign_counter || 20)}
                $.jStorage.set('adFreeCampign_' + ssoGrxId, updatedObj);
            } else {
                addFreeCampignRef.lastVisitedTime = +new Date();
                if(!objAdFreeExp.isSameDay(+new Date())) {
                    addFreeCampignRef.counter = addFreeCampignRef.counter + 1;
                    grxEvent('event', {'event_category': 'Adfree expired',  'event_action': 'True', 'event_label':  ''}, 1);
                }
                $.jStorage.set('adFreeCampign_' + ssoGrxId, addFreeCampignRef);
                objAdFreeExp.setAdFreeExp("adFree");
            }
        }
    },
    isSameDay: function(flag) {
        return new Date(flag).getDate() === new Date().getDate();
    },
    pGatewayDroppedUsers: function() {
        var planVisitedConfig = localStorage.getItem("etmain_planvisited"),
            daysPassedSincePlansVisited = planVisitedConfig && (+new Date() - new Date(Number(planVisitedConfig)))/86400000,
            ssoGrxId = ssoid ? ssoid : $.cookie('_grx'),
            addFreeCampignRef = $.jStorage.get('adFreeCampign_'+ssoGrxId),
            isPopupShown = $.cookie("pgateway_dropped_users_popup"),
            primeloginMap = $.jStorage.get('primeUserLoginMap') || localStorage.getItem("primeUserLoginMap");

        if((daysPassedSincePlansVisited && daysPassedSincePlansVisited <= 1) || addFreeCampignRef) {
            objAdFreeExp.setAdFreeData(15);
            objAdFreeExp.setAdFreeExp("pgateway_dropped_users");
            var skipPopup = $('.skip_popup').length || objVc.skipPopup == 1;
            if(!isPopupShown && !primeloginMap && !skipPopup) {
                $.cookie("pgateway_dropped_users_popup", "true");
                objAdFreeExp.pGatewayDroppedUsersPopup();
                objAdFreeExp.popupshown=true;
            }
        }
    },
    pGatewayDroppedUsersPopup: function() {
        $.ajax({
            url: "/prime_targeting_plans.cms?flag=pgateway_dropped_users",
            success: function(res){
                $("body").append(res);
                grxEvent('event', {'event_category': 'Platform Popup - Web',  'event_action': 'User Eligible for Popup', 'event_label':  'Plan Page Dropped Users | Banner Location '+ currPageType()}, 1);
                
                $(document).on("click", ".primeOffers .imgClose", function () {
                    $('.primeOffers').remove();
                    $('.bgLayer').remove();
                    $('body').removeClass('overlayFixPosition');
                    grxEvent('event', {'event_category': 'Platform Popup - Web',  'event_action': 'Popup Dismiss', 'event_label': 'Plan Page Dropped Users | Banner Location '+ currPageType()}, 1);
                });
            }
        });
    }
}

var communicationViaCohortObj = {
    init: function() {
        var savedCohortData = $.jStorage.get('cohortData'),
            currGrx = $.cookie('_grx');
            
        if(savedCohortData && savedCohortData.savedGrx === currGrx) {
            communicationViaCohortObj.fetchCommunications(savedCohortData.code);
        } else if(currGrx) {
            communicationViaCohortObj.fetchCode(communicationViaCohortObj.fetchCommunications);
        }
    },
    fetchCode: function(cb) {
        $.ajax({
            url: "https://" + objVc.subscriptions + ".economictimes.indiatimes.com/subscription/merchant/ET/product/ETPR/cohortDetails",
            method: "GET",
            headers: {
                "X-GRX-ID": $.cookie('_grx'),
                "Content-Type": "application/json"
            },
            success:function(res){
                cb(res.cohortCode);
            }
        });
    },
    fetchCommunications: function(cohortCode) {
        if(cohortCode) {
            $.ajax({
                url: "/cohort_communication.cms?msid=100268624&code=" + cohortCode,
                cache:true,
                dataType:'script',
                success: function(data) {
                    var cohortData = {savedGrx: $.cookie('_grx'), code: cohortCode || '', communication: data && JSON.parse(data)};
                    $.jStorage.set('cohortData', cohortData, {TTL: 7200000});
                }
            });
        }
    }
}


$(document).ready(function() {
    _log('objVc', window.objVc && objVc.version_on || '-');
    objCommon.init();
    
})

window.onscroll = function(){
    window.clearTimeout(isScrolling);
    // Set a timeout to run after scrolling ends
	isScrolling = setTimeout(function() {
	    if(typeof objMonetize !="undefined" && objMonetize.visibilityChangedListner){
            objMonetize.visibilityChangedListner();
        }
	    //objMonetize.replaceAdWhenViewportChanging();
		// Run the callback
		if(typeof _tp_data !="undefined" && _tp_data.isPrime == false && _tp_data.isAdfree == false && location.href.indexOf("opt=1") == -1){
		     if(!(tpName == 'stocks')) {objAd.loadColombia();}
		     typeof objAd !="undefined" && objAd.renderAdOnscroll && objAd.renderAdOnscroll();
		    
		}  
	         if(typeof _tp_data !="undefined" && (_tp_data.isPrime == true || _tp_data.isAdfree == true) && $("#newsLetterMrec").length > 0){
                $("#newsLetterMrec").remove();
            }
            var element = document.getElementById("div-gpt-ad-newslettermrec-1");
            if(window.isNewsletterPresent == false && element){
                element.style = "margin: 0 auto;";
                element.style = "text-align: center;";
                window.isNewsletterPresent = true;
            }
		//console.log( 'Scrolling has stopped.' );
        if(typeof tpName!="undefind" && (tpName == "articleshow_main" || tpName == "articleshow_main_sticky" || tpName == "articleshow_exclusive2") && typeof $!="undefined"){
		    //if(subsec1_common == "359241701"){
		        //$("div.adsbg300[data-adtype='mrec1']:visible") && $("div.adsbg300[data-adtype='mrec1']:visible").addClass('stickymrecad');
		    //}
		    if ((subsec1_common == "837555174" || subsec1_common == "1715249553" || subsec1_common == "359241701" || subsec1_common == '13357270' || subsec1_common == '107115' || subsec1_common == '897228639' || subsec1_common == '7771250') && objAd && objAd.atf300_sticky && objAd.atf300_sticky == "1"){
		        $("div.adsbg300[data-adtype='atf300']:visible") && $("div.adsbg300[data-adtype='atf300']:visible").addClass('stickymrecad');
		    }
		    //if (subsec1_common != "13352306"){
		        //$("div.adsbg300[data-adtype='btf300']:visible") && $("div.adsbg300[data-adtype='btf300']:visible").addClass('stickymrecad');
		   // }
		}
	}, 200);
}

objPLoginMap = {
    primeUserData: {},
    init: function() {
        var isElegible = objPLoginMap.checkElegibilty("launch");
        if(!_tp_data.isPrime && isElegible) {
            objPLoginMap.appendDialog();
        }
    },
    userMappingData: function(res, isPrime) {
        var primeUserLoginMap = {};
        if(isPrime) {
            var userData = $.jStorage.get('userInfo');
            primeUserLoginMap = {
                expiry: res.subscriptionDetails[0].expiryDate,
                loginId: (userData.email && userData.emailIdStatus === "Verified") ? userData.email : userData.mobile ? userData.mobile : userData.email,
                lastClosedNudgeDate_web_pw: "",
                lastClosedNudgeDate_web: "",
                lastClosedNudgeDate_PW: "",
                lastClosedNudgeDate: "",
                showInSameSession:true,
                count_web_pw_perday: 2,
                count_mweb_pw_perday: 2,
                ssoid: userData.ssoid,
                count_web_pw: 7,
                count_web: 2,
                count_pw:7,
                count: 2,
            }
        } else {
            primeUserLoginMap = JSON.parse($.jStorage.get('primeUserLoginMap'));
            if(primeUserLoginMap) {
                primeUserLoginMap.count = 2;
            }
        }
        
        if(primeUserLoginMap) {
            $.jStorage.set('primeUserLoginMap', JSON.stringify(primeUserLoginMap));
        }
    },
    checkElegibilty: function(flag) {
        var primeData = $.jStorage.get('primeUserLoginMap') || localStorage.getItem("primeUserLoginMap");
        var isElegible = false;
        if(primeData) {
            objPLoginMap.primeUserData = JSON.parse(primeData);
            var isActivePlan = new Date(objPLoginMap.primeUserData.expiry) > new Date();
            var _isSameDay = objPLoginMap.isSameDay(flag === "launch" ? objPLoginMap.primeUserData.lastClosedNudgeDate : objPLoginMap.primeUserData.lastClosedNudgeDate_web_pw);
            var isOverlayExist = $('.bottomNudgePopUp').length;
            var primeCheckArr = ['primearticleshow', 'articleshow_exclusive', 'articleshow_exclusive2', 'articleshow_main'];
            var isPaywalledPage = primeCheckArr.indexOf(window.tpName) != -1;
            if(isActivePlan) {
                if(!_isSameDay && flag === "paywall") {
                    objPLoginMap.primeUserData.count_web_pw_perday = 2;
                    objPLoginMap.primeUserData.count_web_pw = objPLoginMap.primeUserData.count_web_pw - 1;
                    $.jStorage.set('primeUserLoginMap', JSON.stringify(objPLoginMap.primeUserData));
                }
                
                var skipPopup = $('.skip_popup').length || objVc.skipPopup == 1;
                if(flag === "launch" &&  objPLoginMap.primeUserData.count_web && !_isSameDay && !isOverlayExist && !isPaywalledPage && !skipPopup){
                    isElegible = true;
                } else if(flag === "paywall" && objPLoginMap.primeUserData.count_web_pw > 0 && objPLoginMap.primeUserData.count_web_pw_perday) {
                    isElegible = true;
                }
            }
        }
        return isElegible;
    },
    handlePaywall: function() {
        grxEvent('event', {'event_category': 'Relogin_Popup', 'event_action': 'Relogin_impression', 'event_label': 'Articleshow blocker'}, 1);
        $('.paywall_b').hide();
        $('.pLoginMapping').removeClass('hidden');
        var primeId = objPLoginMap.primeUserData.loginId;
        var isEmailId = primeId.indexOf('@') !== -1;
        var maskedID = isEmailId ? objPLoginMap.maskEmail(primeId) : objPLoginMap.maskPhoneNumber(primeId);
        $('.primeSavedEmail').html(maskedID);
        if(_tp_data.isLogged) {
            $('.currEmail').html(_tp_data.email);
            $('.loggedIn').removeClass('hidden');
        } else {
            $('.nonLoggedIn').removeClass('hidden');
        }
        objPLoginMap.primeUserData.lastClosedNudgeDate_web_pw = +new Date();
        objPLoginMap.primeUserData.count_web_pw_perday = objPLoginMap.primeUserData.count_web_pw_perday - 1;
        $.jStorage.set('primeUserLoginMap', JSON.stringify(objPLoginMap.primeUserData));
        $('.plm_subBtn').click(function(e) {
            $.jStorage.set('userlogin_galabel', 'Relogin_popup_articleshow');
            grxEvent('event', {'event_category': 'Relogin_Popup',  'event_action': 'Relogin_clicked', 'event_label': 'Articleshow blocker'}, 1);
            grxEvent("cdp_event", {event_nature: "click", event_category: 'direct_login', event_name: "login_page_loaded"});
            $.jStorage.set('directLogin', true);
            if(_tp_data.isLogged) {
                objUser.logOut('/login.cms');    
            } else {
               objUser.initSSOWidget();
            }
        });
    },
    appendDialog: function() {
        $.ajax({
            url: '/prime_login_mapping_popup.cms',
            success: function (html) {
                $('body').append(html);
                objPLoginMap.bindEvents();
                if(objPLoginMap.primeUserData.loginId) {
                    objPLoginMap.primeUserData.lastClosedNudgeDate = +new Date();
                    objPLoginMap.setData();
                    var primeId = objPLoginMap.primeUserData.loginId;
                    var isEmailId = primeId.indexOf('@') !== -1;
                    var maskedID = isEmailId ? objPLoginMap.maskEmail(primeId) : objPLoginMap.maskPhoneNumber(primeId);
                    $('.primeSavedEmail').html(maskedID);
                    $('body').addClass('noScroll');
                    grxEvent('event', {'event_category': 'Relogin_Popup', 'event_action': 'Relogin_impression', 'event_label': 'On Launch'}, 1);
                    
                    if(_tp_data.isLogged) {
                        $('.currEmail').html(_tp_data.email);
                        $('.loggedIn').removeClass('hide');
                    } else {
                        $('.nonLoggedIn').removeClass('hide');
                    }
                }
            }
        });
    },
    bindEvents: function() {
        $('.bgLayer').click(function(e) {
            $('body').removeClass('noScroll');
            $('.bgLayer, .bottomNudgePopUp').remove();
        });
        
        $('.closeIcon').click(function(e) {
            $('body').removeClass('noScroll');
            grxEvent('event', {'event_category': 'Relogin_Popup',  'event_action': 'Relogin_cross_button_clicked', 'event_label': 'On Launch'}, 1);
            objPLoginMap.primeUserData.count_web = objPLoginMap.primeUserData.count_web - 1;
            objPLoginMap.setData();
            $('.bgLayer, .bottomNudgePopUp').remove();
        });
        $('.signin_cta').click(function(e) {
            $('body').removeClass('noScroll');
            $.jStorage.set('userlogin_galabel', 'Relogin_popup_on_launch');
            grxEvent('event', {'event_category': 'Relogin_Popup',  'event_action': 'Relogin_clicked', 'event_label': 'On Launch'}, 1);
            if(_tp_data.isLogged) {
                objUser.logOut('/login.cms');    
            } else {
               objUser.initSSOWidget();
            }
        });
    },
    setData: function(data) {
        $.jStorage.set('primeUserLoginMap', JSON.stringify(data || objPLoginMap.primeUserData));
    },
    isSameDay: function(flag) {
        return new Date(flag).getDate() === new Date().getDate();
    },
    maskEmail: function (email) {
        var atIndex = email.indexOf('@');
        if (atIndex > 6) {
            return email.substring(0, 3) + '***' + email.substring(atIndex - 3);
        } else if (atIndex === 6 || atIndex === 5) {
            return email.substring(0, 2) + '**' + email.substring(atIndex - 2);
        } else {
            return email;
        }
    },
    maskPhoneNumber: function (phoneNumber) {
        return phoneNumber.substr(phoneNumber.length-10, 10).replace(/^(\d{6})(\d+)/, '******$2');
    }
}

objGrandmaster = {
    fillform: function(){
        let otr=$.cookie('OTR') || "";
        $(".grandmaster_form [name = 'token-id']").val(otr);
        $(".grandmaster_form [name = 'ticket-id']").val($.cookie('TicketId'));
        let clientId = objCommon.isLive ? 'b2a8e883ec676f417520f422068a4742' : 'w2a8e883ec676f417520f422068a4741';
        $(".grandmaster_form [name = 'client-id']").val(clientId);
        let siteAppCode = objCommon.isLive  ? "c21b937c35b0d7cc7c6659d3b57e3d4a" : "d8bf11298a038d8f20be2c4486c3c728"
        $(".grandmaster_form [name = 'site-app-code']").val(siteAppCode);$(".grandmaster_form [name = 'site-app-code']").val(siteAppCode);
    },
    showBlocker: function(){
        $('#grandmasters .bottom_banner').css('display','none');
        $('.video_left .grandmaster_blocker,.video_left .bgoverlay').show();
        $('.main_video_wrap .play_icon').hide();
        let itemName= $('.grandmaster_blocker button').attr('data-name');
        let itemId=$('.grandmaster_blocker').attr('data-id');
        let itemCategory=$('.grandmaster_blocker').attr('data-type');
        ga4Event({item_name: itemName, item_brand: 'grandmaster', item_id: itemId, item_category: itemCategory, item_category2: ''}, 'view_item_list');
        grxEvent('cdp_event', {'event_category': 'subscription', 'event_name': 'subscription_feature', 'event_nature': 'impression'});
        $('.video_left .videobox').html('<img alt="ET Grandmasters" width="792" height="445" src="' + $('.video_card.active > img').attr('src') + '"></img>')
    },
    runVideo: function(){
        // if(player.length) player.off('ended');
        $('.video_left .grandmaster_blocker,.video_left .bgoverlay').hide();
        let video = $('.video_right .video_card.active').attr('data-videourl');
        video+='&amp;autoplay=1';
        $('.video_left .videobox').html('<iframe src="' + video + '" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write" style="width:100%;height:445px" title="union_testing.mp4 (1080p)" id="vimeo-player"></iframe>');
        var iframe = document.getElementById('vimeo-player');
        var player = new Vimeo.Player(iframe);
        player.on('ended', function() {
            objGrandmaster.showBlocker();
        })
    },
    init: function(){
        objUser.afterPrimeCheckCall(function () {
            objGrandmaster.fillform();
            objGrandmaster.bindEvents();
            if(tpName == 'etgrandmasters') objGrandmaster.bindScroll();
            if(_tp_data.isPrime){
                $('#grandmasters [data-prime],#grandMasters [data-prime]').each(function(){
                    $(this).text($(this).attr('data-prime'));
                })
            }
            if($.inArray("expired_subscription", _tp_data.permissions) > -1){
                $('#grandmasters [data-expired]').each(function(){
                    $(this).text($(this).attr('data-expired'));
                })
            }
            if(tpName == 'etgrandmasters' && window.location.href.includes('id-') && _tp_data.isPrime){
                window.location.href='/etgrandmasters.cms';
            }
        })
        if(tpName == 'etgrandmasters'){
            // if first video is paid
            if($('.video_right .video_card').eq(0).attr('data-free') == '0'){
                objGrandmaster.showBlocker();
            }
        }
    },
    bindEvents: function(){
        $(document).on("click", "#grandMasters_primeSlider a, #series_slider a, #leaders a", function(e) {
            e.preventDefault();
            customDimension.dimension1 = 'Grandmaster';
            let eventCategory=(tpName == 'default' || tpName == 'default_prime') ? 'HP Clicks' : (tpName == 'articleshow_main') ? 'Prime Stories widget Articleshow' : 'Grandmaster_engagement';
            let eventAction=(tpName == 'default' || tpName == 'default_prime' || tpName == 'articleshow_main') ? $(this).attr('data-type') + ' - ' +  $(this).attr('data-name') : $(this).attr('data-type') + ' - click';
            let eventLabel=(!(tpName == 'default' || tpName == 'default_prime' || tpName == 'articleshow_main')) ? $(this).attr('data-name') : (_tp_data.isPrime) ? $(this).attr('data-href'): window.location.origin + $(this).attr('href');
            grxEvent('event', {'event_category': eventCategory, 'event_action': eventAction, 'event_label': eventLabel});
            $(".grandmaster_form [name = 'ru']").val($(this).attr('data-href'));
            let userid = $(this).attr('data-id');
            objUser.afterPrimeCheckCall(function () {
                if(_tp_data.isPrime){
                    $('.grandmaster_form').submit();
                }
                else{
                    window.location.href = '/etgrandmasters/id-' + userid + '.cms' ;
                }
            })
        });
        $('.grandmaster_blocker button').click(function(e){
            customDimension.dimension1 = 'Grandmaster';
            let eventCategory='Subscription Flow ET';
            let eventAction='SYFT | Flow Started';
            let eventLabel='Grandmaster - ' + $(this).attr('data-name') + ' - video';
            grxEvent('event', {'event_category': eventCategory, 'event_action': eventAction, 'event_label': eventLabel},1);
            let itemName= $('.grandmaster_blocker button').attr('data-name');
            let itemId=$('.grandmaster_blocker').attr('data-id');
            let itemCategory=$('.grandmaster_blocker').attr('data-type');
            let itemCategory4=$('.grandmaster_blocker button').text();
            goToPlan({
                cdp: true, 
                item_category4: itemCategory4,
                item_category: itemCategory, 
                item_brand: "grandmaster",
                item_id: itemId,
                item_name: itemName, 
                item_category2: '', 
                item_category3: "paywall_blocker_cta"
            });
        })
        $('#grandmasters .bottom_blocker_btn').click(function(e){
            e.preventDefault();
            customDimension.dimension1 = 'Grandmaster';
            let eventCategory='Subscription Flow ET';
            let eventAction='SYFT | Flow Started';
            let eventLabel='Grandmaster Bottom banner';
            grxEvent('event', {'event_category': eventCategory, 'event_action': eventAction, 'event_label': eventLabel},1);
            let itemCategory4=$('#grandmasters .subscribe_watch_btn').text();
            goToPlan({
                cdp: true, 
                item_category4: itemCategory4,
                item_category: "grandmaster_landingpage", 
                item_brand: "grandmaster",
                item_id: "bottom_banner",
                item_name: '', 
                item_category2: '', 
                item_category3: "paywall_blocker_cta"
            });
        })
        $('#grandmasters .subscribe_watch_btn').click(function(e){
            e.preventDefault();
            customDimension.dimension1 = 'Grandmaster';
            if(_tp_data.isPrime){
                let eventCategory='Grandmaster_engagement';
                let eventAction=$('#grandmasters .subscribe_watch_btn').text() + ' - click';
                let eventLabel = "https://masterclass.economictimes.indiatimes.com/grandmasters";
                grxEvent('event', {'event_category': eventCategory, 'event_action': eventAction, 'event_label': eventLabel},1);
                $(".grandmaster_form [name = 'ru']").val('https://masterclass.economictimes.indiatimes.com/grandmasters');
                $('.grandmaster_form').submit();
            }
            else{
                let eventCategory='Subscription Flow ET';
                let eventAction='SYFT | Flow Started';
                let eventLabel='Grandmaster Top banner';
                grxEvent('event', {'event_category': eventCategory, 'event_action': eventAction, 'event_label': eventLabel},1);
                let itemCategory4=$('#grandmasters .subscribe_watch_btn').text();
                goToPlan({
                    cdp: true, 
                    item_category4: itemCategory4,
                    item_category: "grandmaster_landingpage", 
                    item_brand: "grandmaster",
                    item_id: "top_banner",
                    item_name: '', 
                    item_category2: '', 
                    item_category3: "paywall_blocker_cta"
                });
            }
        })
        $('.leader_categories li').click(function(){
            $('.leader_categories li').removeClass('active');
            customDimension.dimension1 = 'Grandmaster';
            let eventCategory = 'Grandmaster_engagement';
            let eventAction = 'Grandmaster - click';
            let eventLabel = $(this).attr('data-name');
            grxEvent('event', {'event_category': eventCategory, 'event_action': eventAction, 'event_label': eventLabel});
            $(this).addClass('active');
            $.ajax({
                url:'/etgrandmasters_include.cms?slug=' + $(this).attr('data-section'),
                success:function(_html){
                    $('.leader_cards_wrap').html(_html);
                    
                }
            });
        })
        $('#faqs .question').click(function(){
            let question_number = $(this).attr('data-question');
            if($(this).hasClass('active')){
                $(this).removeClass('active');
                $("#faqs .answer[data-question = " + question_number + "]").hide();
                $("#faqs .question[data-question = " + question_number + "] > span").removeClass('minus_logo').addClass('plus_logo');
            }
            else{
                $(this).addClass('active');
                $("#faqs .answer[data-question = " + question_number + "]").show();
                $("#faqs .question[data-question = " + question_number + "] > span").removeClass('plus_logo').addClass('minus_logo');
            }
        })
        $('.top_section .video_card .updown_arrow').click(function(){
            if($(this).hasClass('up_arrow')){
                $(this).removeClass('up_arrow').addClass('down_arrow');
                $(this).next().slideUp();
            }
            else{
                $(this).removeClass('down_arrow').addClass('up_arrow');
                $(this).next().slideDown();
            }
        })
        $('.main_video_wrap .play_icon').click(function(){
            objGrandmaster.runVideo();
        })
        $('.video_right .video_card').click(function(){
            if($(this).hasClass('active')) return;
            $('.video_right .video_card').removeClass('active');
            $(this).addClass('active');
            if($(this).attr('data-title')!==undefined && $(this).attr('data-title')!==false){
                $('.video_left .name_title > span').html($(this).attr('data-title'));
            }
            if($(this).attr('data-free') == '0'){
                objGrandmaster.showBlocker();
            }
            else{
                objGrandmaster.runVideo();
            }
        })
        $(document).on("click", ".mute_unmute.mute", function(e) {
            $('.mute_unmute.mute').addClass('unmute').removeClass('mute');
            $('#grandmasters video').prop('muted', false);
        });
        $(document).on("click", ".mute_unmute.unmute", function(e) {
            $('.mute_unmute.unmute').addClass('mute').removeClass('unmute');
            $('#grandmasters video').prop('muted', true);
        });
    },
    isElementAboveViewport: function(element) {
        if(element.length == 0) return true;
        const elementBottom = element.offset().top + element.outerHeight();
        const scrollPosition = $(window).scrollTop();
        return elementBottom < scrollPosition;
    },
    bindScroll: function(){
        $(document).scroll(function() {
            if($(".series_section").length && !($(".series_section").hasClass('initiated'))) {
                $(".series_section").addClass("initiated").etSlider({
                	visible : $("#series_slider > ul").attr('data-cards') || 3,
                	perSlide : $("#series_slider > ul").attr('data-cards') || 3,
                	auto : false,
                	slides : '#series_slider > ul > li',
                	pagination : ".ts-dots",
                	slideContainer : '#series_slider',
                	interval : 10000,
                	nextprevBtn : true,
                	nextprevClass : '.nextprev-btn'
                });
            }
            if(tpName == 'etgrandmasters' && !_tp_data.isPrime && (objGrandmaster.isElementAboveViewport($('.subscribe_watch_btn')) && objGrandmaster.isElementAboveViewport($('.grandmaster_blocker > button')))) $('#grandmasters .bottom_banner').css('display','flex');
            else $('#grandmasters .bottom_banner').css('display','none');
        })
    }
}
objAdBlocker = {
    blockerCountdown : null,
    showpopup: function(){
        if(localStorage.adblockertime == 0){
            clearInterval(objAdBlocker.blockerCountdown);
            var templatecheck=(tpName == 'articleshow_main' && $('html').attr('data-adaptive') != 1) || (tpName == 'slideshow');
            var loginmappeddata=objPLoginMap.primeUserData && objPLoginMap.primeUserData.expiry && +new Date(objPLoginMap.primeUserData.expiry) > +new Date();
            if(templatecheck && _tp_data.isPrime==false && !loginmappeddata && !objAdFreeExp.popupshown){
                // Removing prime targeting popup
                if(!$('.primeOffers.popup_bg').length && $('.primeOffers.popup_bg:visible').length){
                    $('.primeOffers.popup_bg').remove();
                    $('.bgLayer.popup_bg').remove();
                }
                $.ajax({
                    url: '/adblocker_popup.cms?blockertime=' + objVc.adblocker_popuptime,
                    success: function (html) {
                        $('body').append(html);
                        $('body').addClass('noScroll');
                        customDimension.dimension1 = 'ad_blocker';
                		grxDimension['ad_blocker'] = 'yes';
                        grxEvent('event', {'event_category': 'Ad_blocker', 'event_action': 'Impression', 'event_label': objVc.adblocker_popuptime}, 1);
                    }
                });
            }
        }
        else{
            localStorage.adblockertime=localStorage.getItem("adblockertime")-1;
        }
    },
    init: function() {
        objAdBlocker.bindEvents();
        if(localStorage.getItem("currDay")!=new Date().getDate() || localStorage.getItem("adblockertime") == null){
            localStorage.adblockertime=objVc.adblocker_popuptime;
            localStorage.currDay=new Date().getDate();
        }
        objAdBlocker.blockerCountdown=setInterval(objAdBlocker.showpopup,1000);
        
    },
    forRandomUsers: function (percentageParam, callback) {
        var percentage = percentageParam ? (!isNaN(percentageParam) ? Number(percentageParam) : percentageParam) : 1;
        var mode = Math.floor(100 / percentage);
        var et_randomid = $.jStorage.get('et_adblocker');
        if(et_randomid == null) {
            et_randomid = Math.floor(Math.random() * 99);
            $.jStorage.set('et_adblocker', et_randomid);
        }
        var flr = Math.floor(et_randomid % parseFloat(100 / percentageParam).toFixed(4));
        var inUser = percentageParam && ((percentageParam > 50 && flr == 0) || (percentageParam <= 50 && flr == 1));
        if(inUser) {
            callback && callback();
        }
    },
    bindEvents: function(){
        $(document).on('click', '.adblocker_popup .turnoff', function(){
            $('.adblocker_popup').hide();
            $('.extension_popup').show();
        });
        $(document).on('click', '.adblocker_popup .planpage_link, .adblocker_popup .extraoff', function(){
            grxEvent('event', {'event_category': 'Ad_blocker', 'event_action': 'Subscribe_clicked', 'event_label': objVc.adblocker_popuptime}, 1);
            grxEvent('event', {'event_category': 'Subscription Flow', 'event_action': 'SYFT', 'event_label': 'ad_blocker'}, 1);
            goToPlan({url: $('.adblocker_popup .extraoff').attr('data-link'), dim1: 'ad_blocker'});
        });
        $(document).on('click', '.adblocker_popup .signin_option > span', function(){
            objUser.logOut('/login.cms');
        });
        $(document).on('click', '.extension_popup .blocker_item', function(){
            $('.extension_popup .blocker_item').removeClass('active');
            $(this).addClass('active');
            $('.extension_popup .blocker_selected > span').attr('class','adblock_sprite');
            if($(this).find('span').hasClass("abp")){
                $('.extension_popup .blocker_selected > span').addClass('abp');
            }
            else if($(this).find('span').hasClass("adblock")){
                $('.extension_popup .blocker_selected > span').addClass('adblock');
            }
            else if($(this).find('span').hasClass("uorigin")){
                $('.extension_popup .blocker_selected > span').addClass('uorigin');
            }
            else if($(this).find('span').hasClass("ublock")){
                $('.extension_popup .blocker_selected > span').addClass('ublock');
            }
            else{
                $('.extension_popup .blocker_selected > span').addClass('others');
            }
        });
        $(document).on('click', '.extension_popup .refresh', function(){
            location.reload(true);
        });
    }
}
// Election with ET
objElectionWidget={
    rightClickComplete:true,
    leftClickComplete:true,
    preSelector: null,
    init: function(msid){
        if(tpName == 'articleshow_main'){
            objElectionWidget.preSelector = $('.article_block[data-article_id="' + msid + '"]');
        }
        else{
            objElectionWidget.preSelector = $('body');
        }
        objElectionWidget.bindEvents(msid);
        let ulLength=0;
        $.each(objElectionWidget.preSelector.find(".etelection ul.loksabha_states li"), function (i) {
            ulLength+=$(this).width() + 35;
        });
        objElectionWidget.preSelector.find(".etelection ul.loksabha_states").width(ulLength - 15);
        ulLength=0;
        $.each(objElectionWidget.preSelector.find(".etelection ul.assembly_states li"), function (i) {
            ulLength+=$(this).width() + 35;
        });
        objElectionWidget.preSelector.find(".etelection ul.assembly_states").width(ulLength - 15);
    },
    bindEvents:function(msid){
        let selector=objElectionWidget.preSelector;
        selector.find(".etelection ul li").click(function(){
                if(!$(this).hasClass('active')){
        	    selector.find(".etelection ul li").removeClass('active');
        	    $(this).addClass('active');
        	    let toscroll = $(this).offset().left - selector.find(".etelection .prev_btn").offset().left-20;
        	    let spaceavailable=Math.max(selector.find(".etelection ul.active").offset().left + selector.find(".etelection ul.active").width() - selector.find(".etelection .next_btn").offset().left,0);
        	    let currScroll = parseInt(selector.find(".etelection ul.active").css("left"),10);
        	    let scrollable;
        	    if(spaceavailable >= toscroll){
        	        scrollable=currScroll-toscroll;
        	        selector.find(".etelection .next_btn, .etelection .prev_btn").removeClass('disable');
        	    }
        	    else{
        	        scrollable=currScroll-Math.max(spaceavailable,0);
        	        selector.find(".etelection .next_btn").addClass('disable');
        	    }
        	    selector.find(".etelection ul.active").css("left",scrollable);
        	    $.ajax({
                    url: "/etelection_include.cms?msid=" + $(this).attr("data-msid") + "&moreLink=" + $(this).attr("data-href"),
                    success: function (response) {
                        selector.find(".etelection .story_container").html(response);
                    }
                });
            }
        });
        selector.find(".etelection .next_btn").click(function(){
            if(objElectionWidget.rightClickComplete){
                objElectionWidget.rightClickComplete = false;
                selector.find(".etelection .prev_btn").removeClass('disable');
                if(selector.find(".etelection ul.active").offset().left + selector.find(".etelection ul.active").width() > selector.find(".etelection .next_btn").offset().left){
                    let toscroll=120;
                    let currScroll = parseInt(selector.find(".etelection ul.active").css("left"),10);
                    let spaceavailable=Math.max(selector.find(".etelection ul.active").offset().left + selector.find(".etelection ul.active").width() - selector.find(".etelection .next_btn").offset().left,0);
                    if(spaceavailable > toscroll){
            	        scrollable=currScroll-toscroll;
            	        selector.find(".etelection .next_btn, .etelection .prev_btn").removeClass('disable');
            	    }
            	    else{
            	        scrollable=currScroll-Math.max(spaceavailable,0);
            	        selector.find(".etelection .next_btn").addClass('disable');
            	    }
                    selector.find(".etelection ul.active").css("left",scrollable);
                }
                setTimeout(()=>{objElectionWidget.rightClickComplete = true;},400);
            }
        });
        selector.find(".etelection .prev_btn").click(function(){
            if(objElectionWidget.leftClickComplete){
                objElectionWidget.leftClickComplete=false;
                selector.find(".etelection .next_btn").removeClass('disable');
                if(selector.find(".etelection ul.active").offset().left < selector.find(".etelection .prev_btn").offset().left){
                    let toscroll=120;
                    let currScroll = parseInt(selector.find(".etelection ul.active").css("left"),10);
                    let spaceavailable=selector.find(".etelection .prev_btn").offset().left - selector.find(".etelection ul.active").offset().left + 20;
                    if(spaceavailable > toscroll){
            	        scrollable=currScroll+toscroll;
            	        selector.find(".etelection .next_btn, .etelection .prev_btn").removeClass('disable');
            	    }
            	    else{
            	        scrollable=currScroll+Math.max(spaceavailable,0);
            	        selector.find(".etelection .prev_btn").addClass('disable');
            	    }
                    selector.find(".etelection ul.active").css("left",scrollable);
                }
                setTimeout(()=>{objElectionWidget.leftClickComplete = true;},400);
            }
        });
        selector.find(".etelection .toggle_btn").click(function(){
            if(!$(this).hasClass('active')){
                let msid = $(this).hasClass('assembly_btn') ? "68111598" : "67942746";
                let moreLink= $(this).hasClass('assembly_btn') ? "/news/elections/assembly" : "/news/elections/lok-sabha";
                let tab = $(this).hasClass('assembly_btn') ? ".assembly_states" : ".loksabha_states";
                let activebtn= $(this).hasClass('assembly_btn') ? ".assembly_btn" : ".loksabha_btn";
                $.ajax({
                    url: "/etelection_include.cms?msid=" + msid + "&moreLink=" + moreLink,
                    success: function (response) {
                        selector.find(".etelection .story_container").html(response);
        	            selector.find(".etelection .toggle_btn,.etelection ul").removeClass('active');
        	            selector.find(activebtn).addClass('active');
        	            selector.find(tab).addClass('active');
        	            selector.find(".etelection ul.active").css("left","0px");
        	            selector.find(".etelection ul.active li").removeClass('active');
        	            selector.find(".etelection ul.active li:first-child").addClass('active');
                    }
                });
            }
        });
    }
}
objEpaperCoachMark = {
    init: function(){
        objEpaperCoachMark.bindEvents();
        if(localStorage.getItem('mark_shown')!=1){
            localStorage.setItem('mark_shown',1);
            $(window).scrollTop(0);
            $("header.header").css("z-index", "unset");
            $('.coach_wrap').append('<div class="epaper_coach">\
                <span class="paperimg coach_sprite"></span>\
                <div class="epaper_point">\
                    <div class="newpaper">\
                        <span class="newtext">NEW</span>\
                        <span class="epaper_icon coach_sprite"></span>\
                    </div>\
                    <span class="arrowimg coach_sprite"></span>\
                    <p class="descrip">ePaper The PDF version of your daily newspaper now comes with ETPRIME</p>\
                    <button class="gotit_btn">Got it</button>\
                </div>\
                <span class="today_paper_circle">Todays <span style="font-weight:600">ePaper</span></span>\
            </div>');
            $('body').addClass('noScroll skip_popup skipPopUp');
            $('body').append('<div class="bg_overlay"></div>');
            setTimeout(objEpaperCoachMark.removeCoachMark,5000);
        }
    },
    bindEvents: function(){
        $(document).on('click','.epaper_coach .gotit_btn',objEpaperCoachMark.removeCoachMark);
    },
    removeCoachMark: function(){
        $(document).find('.bg_overlay, .epaper_coach').hide();
        $("header.header").css("z-index", "3");
        $('body').removeClass('noScroll skip_popup skipPopUp');
    }
    
}

function checkUserType() {
    var userType = "";
    if($.inArray("expired_subscription", _tp_data.permissions) > -1) {
        userType = 'PaidExpired';
    } else if($.inArray("subscribed", _tp_data.permissions) > -1) {
        userType = 'Paid';
    } else if ($.inArray("subscribed", _tp_data.permissions) > -1 && $.inArray("cancelled_subscription", _tp_data.permissions) > -1 && $.inArray("can_buy_subscription", _tp_data.permissions) > -1) {
        userType = 'Trial';
    } else {
        userType = 'Free';
    }
    return userType;
}

    
	