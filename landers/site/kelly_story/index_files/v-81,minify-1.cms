OneTapLogins=(function(){var e=window.e$||window.$||{},j=window.objUser||{info:(e.jStorage.get("userInfo")?e.jStorage.get("userInfo"):{}),channel:"et",mode:"pwa",loadSsoApi:function(p){p=p?p:function(){};if(!document.querySelector('script[src*="jsso_crosswalk"]')){var o=objCommon.isLive||l("live");var n="https://"+(o==1?"jssocdn":"jssocdnstg")+".indiatimes.com/crosswalk_sdk/sdk/jsso_crosswalk_legacy_0.7.78.min.js";if(objVc.lib_login){n=objVc.lib_login;if(!o){n=objVc.lib_login.replace("jssocdn","jssocdnstg")
}}var m=document.createElement("script");m.onload=p;m.onerror=p;m.src=n;document.head.appendChild(m)}else{p()}},gpOneTapLogin:function(m,n){j.loadSsoApi(function(){var o=new JssoCrosswalk(j.channel,j.mode);o.gpOneTapLogin(m,n)})}};Date.prototype.addDays=function(m){this.setDate(this.getDate()+parseInt(m));return this};var h={clientId:"936221589938.apps.googleusercontent.com",successmsg:"Successfully signed in as",errormsg:"Sign-in failed. Please try again later.",submitForLogin:function(m){console.log("oneTap response",m)
},init:function(){var m=document.createElement("script");m.setAttribute("type","text/javascript");m.setAttribute("src","https://accounts.google.com/gsi/client");if(typeof m!="undefined"){document.getElementsByTagName("head")[0].appendChild(m)}m.onload=function(){h.invokeGoogleLoad()};h.ssoApiPreFetch()},ssoApiPreFetch:function(){var m=setTimeout(function(){},3000);j.loadSsoApi(function(){clearTimeout(m)})},flagSet:function(){e.jStorage.set("c_oneTapLogin",1);var o=new Date();o.addDays(1);var n=new Date();
var m=new Date(o.toDateString());var p=(m.getTime()-n.getTime());var q=0;e.jStorage.setTTL("c_oneTapLogin",(p+q))},invokeGoogleLoad:function(){const n={supportedAuthMethods:["https://accounts.google.com"],supportedIdTokenProviders:[{uri:"https://accounts.google.com",clientId:h.clientId}]};window.submitForLogin=function(o){h.useGoogleIdTokenForAuth(o.credential)};try{google.accounts.id.initialize({client_id:h.clientId,auto_select:true,use_fedcm_for_prompt:true,callback:submitForLogin});if(j.mode=="web"){grxEvent("cdp_event",{event_nature:"click",event_category:"direct_login",event_name:"login_page_loaded",login_method:"onetap_login"});
grxEvent("cdp_event",{event_nature:"click",event_category:"direct_login",event_name:"login_initiated",login_method:"onetap_login"});grxEvent("cdp_event",{event_nature:"click",event_category:"direct_login",event_name:"login_method",login_method:"onetap_login"});google.accounts.id.prompt(function(o){console.log("oneTap notification",o);window.oneTap=o;if(o.isDisplayed()||o.h=="display"){h.logGA("Impression");customDimension.dimension72=customDimension.dimension72?customDimension.dimension72+"Chrome sign in non-content":"Chrome sign in non-content";
if(j.mode=="web"){g(1)}}else{window.ispopup=false}if(o.isNotDisplayed()){}if((o.l||o.m)=="user_cancel"){h.flagSet();a();h.logGA("closed")}if((o.g||o.h)=="skipped"&&o.l=="tap_outside"){a()}if(o.getMomentType()=="dismissed"&&o.getDismissedReason()=="credential_returned"){a();console.log("oneTap",o)}})}}catch(m){window.ispopup=false;console.log("oneTap Error",m)}},useGoogleIdTokenForAuth:function(n){var q=this;var p=1,r=0;var o=0;function m(){p++;j.gpOneTapLogin(n,function(t){if(p<=5&&!r){r=1;clearInterval(o);
if(t.status.toUpperCase()=="SUCCESS"){e.jStorage.deleteKey("et_profilelog");try{var u=t.data&&(t.data.ticket||t.data.ticketId)||"";if(!i("TicketId")&&u){f("TicketId",u,30,"/")}}catch(y){console.log("oneTap error",y)}var z="success";var A=q.successmsg;q.logGA("Signin Success");h.flagSet();h.setTempFlag();h.setToken(n);if(window.localStorage){localStorage.setItem("et_logintype","google_onetap")}reloadPage=function(){if(window.sessionStorage&&sessionStorage.setItem){sessionStorage.setItem("googleonetaplogin",1)
}if(j.mode=="web"&&!window.location.pathname.includes("/et-tech")){window.googleLoginInterval=setTimeout(function(){location.reload()},1000);e.jStorage.set("profile_update_shown_type","onetap");loadModule({module_name:"js_userprofile_dynamic"})}else{setTimeout(function(){location.reload()},500)}};var x=new JssoCrosswalk(j.channel,j.mode);x.getUserDetails(function(B){try{if(B.status.toLowerCase()=="success"){_tp_data=window._tp_data||{};_tp_data.isLogged=true;_tp_data.email=B.data&&B.data.primaryEmail||"";
_tp_data.fname=B.data&&B.data.firstName||"";if(!i("ssoid")){f("ssoid",B.data.ssoid,30,"/")}grxEvent("cdp_event",{event_nature:"click",event_category:"direct_login",event_name:"login_completed",loggedin:"y",email:_tp_data.email,login_method:"onetap_login"});h.setOTR(reloadPage)}}catch(C){reloadPage();console.log("oneTap error",C)}})}else{_log("sso failed data",t);var z="failed";var A=q.errormsg;var s=t.status?t.status:"no status";q.logGA("Signin Fail Error - "+s);q.logGA("Signin Fail");var w=JSON.stringify(t)
}var v='<div class="ontap-background" style="display: block;"><div class="tap-message"><span class="'+z+'"></span>';v+='<span class="text"><div class="caption" style="float:none">'+A+'</div><b class="email">'+t.data.identifier+"</b></span>";v+='<span class="close id_onetapclose" onclick="closePopup()"></span></div>';document.body.innerHTML+=v}})}o=setInterval(function(){if(p<=4){m()}else{r=1;clearInterval(o)}},3000);m()},setOTR:function(n){n=n||function(){};var t=location.host,s=(t.indexOf("dev8243")!=-1||t.indexOf("etpwa")!=-1)?0:1;
var r="refresh_token",p="https://"+(objVc.oauth||"oauth2")+".economictimes.indiatimes.com/oauth/api/merchant/ET/token?ref=js_googlelogin",m=objCommon.isLive?"b2a8e883ec676f417520f422068a4742":"w2a8e883ec676f417520f422068a4741";ticketId=i("TicketId")||j.ticketId||"";deviceId=i("_grx");var o=JSON.stringify({grantType:r,restrict_input:0,ticketId:ticketId,deviceDetail:objCommon.getDeviceName()});var u=new XMLHttpRequest();u.open("POST",p);u.responseType="json";u.withCredentials=true;u.onerror=function(v){console.log("oneTap error in loadPrimeApi xhr",u,u.status,v);
n()};u.ontimeout=function(v){n()};if(j.mode=="web"){u.setRequestHeader("Content-Type","application/json;charset=UTF-8")}else{m=s?"w6590a0af0377c711dede6bd565f27c2":"w6590a0af0377c711dedefck565f27c1";var q={grantType:r,restrict_input:0};o=Object.keys(q).map(function(v){return encodeURIComponent(v)+"="+encodeURIComponent(q[v])}).join("&");u.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}u.setRequestHeader("X-CLIENT-ID",m);u.setRequestHeader("X-DEVICE-ID",deviceId);u.setRequestHeader("x-sso-id",i("ssoid"));
u.setRequestHeader("x-site-app-code",window.objVc&&objVc.xAppCode);u.onload=function(){if(u.status===200){var x="nonPrime";var w=u.response;if(w.data){x=w.data;x.tId=ticketId}console.log("oneTap responseData",x.token);if(x&&x.token){var v=new Date(new Date().getTime()+1000*60*60);f("OTR",x.token,v,"/")}var z=JSON.parse(localStorage.jStorage);z["prime_"+ticketId]=x;localStorage.setItem("jStorage",JSON.stringify(z));var y=x&&x.permissions&&x.permissions.indexOf("subscribed")!=-1;h.userMappingData(x,y);
n()}};u.send(o)},userMappingData:function(n,o){var m={};if(o){m={expiry:n.subscriptionDetails[0].expiryDate,loginId:n.email||_tp_data.email||n.primaryEmail,lastClosedNudgeDate_web_pw:"",lastClosedNudgeDate_web:"",lastClosedNudgeDate_PW:"",lastClosedNudgeDate:"",showInSameSession:true,count_web_pw_perday:2,ssoid:n.ssoid,count_web_pw:7,count_web:2,count_pw:7,count:2}}else{m=JSON.parse(e.jStorage.get("primeUserLoginMap"));if(m){m.count=2}}if(m){e.jStorage.set("primeUserLoginMap",JSON.stringify(m))}},logGA:function(n){var m="Chrome Login PopUP 1.1";
if(typeof ga!="undefined"&&n){if(typeof print_log!="undefined"&&print_log=="onetap"){document.body.innerHTML+="<div>"+n+"</div>"}}if(window.grxEvent){grxEvent("event",{event_category:m,event_action:n,event_label:window.location.href})}},checkFrameVisibility:function(){},setToken:function(m){if(typeof(Storage)!=="undefined"){try{sessionStorage.setItem("oneTapToken",m)}catch(n){console.log("oneTap Cannot set Token!")}}},setTempFlag:function(){if(typeof(sessionStorage)!=="undefined"){try{sessionStorage.setItem("isOneTap",1)
}catch(m){console.log("oneTap Cannot set Token!")}}}};var k=document.getElementsByClassName("no_onetaplogin");if(k.length==0){setTimeout(function(){window.geolocation&&window.geolocation!=5?h.init():h.flagSet()},1000)}window.closePopup=function(){var m=document.getElementsByClassName("ontap-background");m[0].remove();var n=document.getElementsByClassName("one_tap_info");if(n.length>0){n[0].remove();a()}};window.oneTabloginProcess=true;function a(){e("body").removeClass("overlayFixPosition");var m=document.getElementsByClassName("bgOneTapGray oneTapCloseBg");
if(m.length>0){m[0].remove()}var n=document.getElementsByClassName("one_tap_info");if(n.length>0){n[0].remove()}}h.hideOverlay=a;function g(m){setTimeout(function(){var o=document.querySelector("#credential_picker_container iframe");if(o&&o.style.display!="none"){c();m=5;return false}else{if(m<5){m=m+1;g(m)}else{var n=document.querySelector("#credential_picker_container");if(n){n.remove()}}}},200)}function c(){var n=document.getElementsByClassName("bgOneTapGray oneTapCloseBg");if(n.length===0){var p=document.getElementsByTagName("body")[0];
var m=document.createElement("div");e(m).addClass("bgOneTapGray oneTapCloseBg");p.appendChild(m);e(p).addClass("overlayFixPosition");var o='<div class="one_tap_info oti" style="display:none;">			        <div class="clearfix">			            <div class="oti_arrow flr">    			            <img class="oti_arrowbig" src="https://img.etimg.com/photo/msid-73174975,quality-100/photo.jpg"/>    			            <img class="oti_arrowsmall" src="https://img.etimg.com/photo/msid-73544401,quality-100/photo.jpg"/>    			        </div>    			        <div class="oti_info flr">			                <div class="oti_title">Sign in to Unlock Benefits</div>			                <ul>			                    <li class="oti_sb">Unlock 150+ ET Prime Free Reads Articles</li>			                    <li class="oti_sb">Get up to 50 Times Points</li>			                    <li class="oti_sb">Save your favourite reads & add comments</li>			                </ul>			            </div>			            <div class="oti_et_logo flr oti_s"></div>			        </div>			    </div>';
e("body").append(o);e(".one_tap_info").show()}}function l(m){if(m){m=m.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+m+"=([^&#]*)"),n=o.exec(location.search);return n==null?"":decodeURIComponent(n[1].replace(/\+/g," "))}else{return""}}function i(o){var n=o+"=";var q=decodeURIComponent(document.cookie);var m=q.split(";");for(var p=0;p<m.length;p++){var r=m[p];while(r.charAt(0)==" "){r=r.substring(1)}if(r.indexOf(n)==0){return r.substring(n.length,r.length)}}return""}function f(n,q,m,r){var p=j.mode=="wap"||j.mode=="pwa"?".economictimes.com":".indiatimes.com";
var o=n+"="+escape(q)+";";if(m){if(m instanceof Date){if(isNaN(m.getTime())){m=new Date()}}else{m=new Date(new Date().getTime()+parseInt(m)*1000*60*60*24)}o+="expires="+m.toGMTString()+";"}if(r){o+="path="+r+";"}if(p){o+="domain="+p+";"}document.cookie=o}function d(m,n){j.loadSsoApi(function(){var o=new JssoCrosswalk(j.channel,j.mode);o.gpOneTapLogin(m,n)})}objCommon=typeof objCommon!="undefined"?objCommon:{};if(!objCommon.isLive){var b=window.location.origin;objCommon.isLive=(b.indexOf("dev")==-1&&b.indexOf("pre")==-1&&b.indexOf("stg")==-1?1:0)
}return h})();